(()=>{var de=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var v=(e,t,a)=>new Promise((n,s)=>{var o=c=>{try{d(a.next(c))}catch(u){s(u)}},i=c=>{try{d(a.throw(c))}catch(u){s(u)}},d=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,i);d((a=a.apply(e,t)).next())});var De=de(oe=>{let b=[],h=[],U="",_=["all"],B=null,V="",j="setup",L=null,A=null,I="en",$=45,S="normal",g="spotify",re=!1,x=!0,M=[],H=null;const ee="beatify_last_player",te="beatify_game_settings",W=["media-players","music-service","playlists","game-settings","admin-actions","my-requests"],ue={music_assistant:{icon:"\u{1F3B5}",label:"Music Assistant",recommended:!0},sonos:{icon:"\u{1F50A}",label:"Sonos"},alexa_media:{icon:"\u{1F4E2}",label:"Alexa"},alexa:{icon:"\u{1F4E2}",label:"Alexa"}},m=window.BeatifyUtils||{};document.addEventListener("DOMContentLoaded",()=>v(oe,null,function*(){var t,a,n,s,o,i;(yield m.waitForI18n())?(yield BeatifyI18n.init(),BeatifyI18n.initPageTranslations(),I=BeatifyI18n.getLanguage()):console.error("[Beatify] BeatifyI18n module failed to load - UI will use fallback text"),document.querySelectorAll(".chip[data-lang]").forEach(d=>{d.classList.toggle("chip--active",d.dataset.lang===I)}),(t=document.getElementById("start-game"))==null||t.addEventListener("click",Ce),(a=document.getElementById("print-qr"))==null||a.addEventListener("click",Me),(n=document.getElementById("rejoin-game"))==null||n.addEventListener("click",Te),(s=document.getElementById("end-game"))==null||s.addEventListener("click",O),(o=document.getElementById("end-game-lobby"))==null||o.addEventListener("click",O),(i=document.getElementById("end-game-existing"))==null||i.addEventListener("click",O),Re(),Pe(),fe(),pe(),Ne(),yield ye(),yield me(),Ge()}));function me(){return v(this,null,function*(){try{const e=yield fetch("/beatify/api/status");if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=yield e.json();U=t.playlist_docs_url||"",V=t.media_player_docs_url||"",re=t.has_music_assistant===!0;const a=document.getElementById("app-version");a&&t.version&&(a.textContent="v"+t.version,window.BEATIFY_VERSION=t.version),ve(t.media_players),F(t.playlists,t.playlist_dir),P(),t.active_game?qe(t.active_game):ne()}catch(e){console.error("Failed to load status:",e);const t=document.getElementById("media-players-list");t&&(t.innerHTML='<span class="status-error">Failed to load status</span>')}})}function fe(){var e,t,a;(e=document.getElementById("media-players-toggle"))==null||e.addEventListener("click",function(){const n=document.getElementById("media-players");n&&(n.classList.toggle("collapsed"),this.setAttribute("aria-expanded",!n.classList.contains("collapsed")))}),(t=document.getElementById("game-settings-toggle"))==null||t.addEventListener("click",function(){const n=document.getElementById("game-settings");n&&(n.classList.toggle("collapsed"),this.setAttribute("aria-expanded",!n.classList.contains("collapsed")))}),(a=document.getElementById("my-requests-toggle"))==null||a.addEventListener("click",function(){const n=document.getElementById("my-requests");n&&(n.classList.toggle("collapsed"),this.setAttribute("aria-expanded",!n.classList.contains("collapsed")))}),document.querySelectorAll(".lobby-container--compact .section-header-collapsible").forEach(function(n){n.addEventListener("click",function(){const s=n.closest(".section-collapsible");s&&(s.classList.toggle("collapsed"),n.setAttribute("aria-expanded",!s.classList.contains("collapsed")))})})}function pe(){var e;document.querySelectorAll(".chip[data-lang]").forEach(t=>{t.addEventListener("click",function(){return v(this,null,function*(){const a=this.dataset.lang;document.querySelectorAll(".chip[data-lang]").forEach(n=>n.classList.remove("chip--active")),this.classList.add("chip--active"),I=a,window.BeatifyI18n&&(yield BeatifyI18n.setLanguage(a),BeatifyI18n.initPageTranslations()),w(),k()})})}),document.querySelectorAll(".chip[data-duration]").forEach(t=>{t.addEventListener("click",function(){const a=parseInt(this.dataset.duration,10);document.querySelectorAll(".chip[data-duration]").forEach(n=>n.classList.remove("chip--active")),this.classList.add("chip--active"),$=a,w(),k()})}),document.querySelectorAll(".chip[data-difficulty]").forEach(t=>{t.addEventListener("click",function(){const a=this.dataset.difficulty;document.querySelectorAll(".chip[data-difficulty]").forEach(n=>n.classList.remove("chip--active")),this.classList.add("chip--active"),S=a,w(),k()})}),(e=document.getElementById("artist-challenge-toggle"))==null||e.addEventListener("change",function(){x=this.checked,w(),k()}),document.querySelectorAll(".chip[data-provider]").forEach(t=>{t.addEventListener("click",function(){if(this.disabled||this.classList.contains("chip--disabled"))return;const a=this.dataset.provider;document.querySelectorAll(".chip[data-provider]").forEach(n=>n.classList.remove("chip--active")),this.classList.add("chip--active"),g=a,w(),k(),h.length>0&&F(h,"",!0)})})}function ye(){return v(this,null,function*(){try{const e=localStorage.getItem(te);if(e){const t=JSON.parse(e);if(t.language&&(I=t.language,document.querySelectorAll(".chip[data-lang]").forEach(a=>{a.classList.toggle("chip--active",a.dataset.lang===t.language)}),window.BeatifyI18n&&(yield BeatifyI18n.setLanguage(t.language))),t.duration&&($=t.duration,document.querySelectorAll(".chip[data-duration]").forEach(a=>{a.classList.toggle("chip--active",parseInt(a.dataset.duration,10)===t.duration)})),t.difficulty&&(S=t.difficulty,document.querySelectorAll(".chip[data-difficulty]").forEach(a=>{a.classList.toggle("chip--active",a.dataset.difficulty===t.difficulty)})),typeof t.artistChallenge=="boolean"){x=t.artistChallenge;const a=document.getElementById("artist-challenge-toggle");a&&(a.checked=t.artistChallenge)}t.provider&&(g=t.provider,document.querySelectorAll(".chip[data-provider]").forEach(a=>{a.classList.toggle("chip--active",a.dataset.provider===t.provider)}))}}catch(e){console.warn("Failed to load saved settings:",e)}w()})}function k(){try{const e={language:I,duration:$,difficulty:S,artistChallenge:x,provider:g};localStorage.setItem(te,JSON.stringify(e))}catch(e){console.warn("Failed to save settings:",e)}}function w(){const e=document.getElementById("game-settings-summary");if(!e)return;const t={easy:"Easy",normal:"Normal",hard:"Hard"},a={en:"EN",de:"DE",es:"ES"},n=x?" \u2022 \u{1F3A4}":"";e.textContent=`${t[S]||"Normal"} \u2022 ${$}s \u2022 ${a[I]||"EN"}${n}`}function ge(e){const t=document.getElementById("media-player-summary");t&&(t.textContent=e||"Select...")}function ve(e){const t=document.getElementById("media-players-list");t==null||t.removeAttribute("data-i18n");const a=e?e.length:0;B=null;const n=(e||[]).filter(i=>i.state!=="unavailable"),s=document.getElementById("media-player-validation-msg");if(a===0){t.innerHTML=`
            <div class="no-players-message">
                <h3>\u{1F3B5} No Compatible Players Found</h3>
                <p>Beatify works with Music Assistant, Sonos, and Alexa players.</p>
                <p><strong>Recommended:</strong> Install Music Assistant for the best experience with any speaker.</p>
                <div class="button-group">
                    <a href="https://music-assistant.io/getting-started/"
                       target="_blank" class="btn btn-secondary">
                        \u{1F4D6} Music Assistant Setup Guide
                    </a>
                    <button onclick="loadStatus()" class="btn btn-primary">
                        \u{1F504} Refresh
                    </button>
                </div>
            </div>
        `,s&&s.classList.add("hidden");const i=document.getElementById("start-game");i&&(i.disabled=!0);return}if(n.length===0){const i=V?`<a href="${m.escapeHtml(V)}" target="_blank" rel="noopener">Troubleshooting</a>`:"";t.innerHTML=`
            <div class="empty-state">
                <p class="status-error">All media players are unavailable. Check your devices are powered on.</p>
                ${i?`<p style="margin-top: 12px;">${i}</p>`:""}
            </div>
        `,s&&s.classList.add("hidden");return}t.innerHTML=n.map(i=>he(i)).join(""),be();const o=localStorage.getItem(ee);if(o){const i=t.querySelector(`[data-entity-id="${o}"]`);if(i){i.checked=!0,J(i,!0);const d=document.getElementById("media-players");if(d){d.classList.add("collapsed");const c=document.getElementById("media-players-toggle");c&&c.setAttribute("aria-expanded","false")}}}}function he(e){const t=ue[e.platform]||{icon:"\u{1F508}",label:e.platform},a=`<span class="platform-badge platform-badge--${m.escapeHtml(e.platform)}">${t.icon} ${t.label}</span>`;return`
        <div class="media-player-item list-item is-selectable"
             data-entity-id="${m.escapeHtml(e.entity_id)}"
             data-platform="${m.escapeHtml(e.platform)}"
             data-supports-spotify="${e.supports_spotify}"
             data-supports-apple-music="${e.supports_apple_music}"
             data-supports-youtube-music="${e.supports_youtube_music}"
             data-supports-tidal="${e.supports_tidal}">
            <label class="radio-label">
                <input type="radio"
                       class="media-player-radio"
                       name="media-player"
                       data-entity-id="${m.escapeHtml(e.entity_id)}"
                       data-state="${m.escapeHtml(e.state)}"
                       data-platform="${m.escapeHtml(e.platform)}"
                       data-supports-spotify="${e.supports_spotify}"
                       data-supports-apple-music="${e.supports_apple_music}"
                       data-supports-youtube-music="${e.supports_youtube_music}"
                       data-supports-tidal="${e.supports_tidal}">
                <span class="player-info">
                    <span class="player-name">${m.escapeHtml(e.friendly_name)}</span>
                    ${a}
                </span>
            </label>
            <span class="meta">
                <span class="state-dot state-${m.escapeHtml(e.state)}"></span>
                ${m.escapeHtml(e.state)}
            </span>
        </div>
    `}function be(){const e=document.getElementById("media-players-list");e&&(e.querySelectorAll(".media-player-radio").forEach(t=>{t.addEventListener("change",function(){J(this)})}),e.querySelectorAll(".media-player-item").forEach(t=>{t.addEventListener("click",function(a){if(a.target.classList.contains("media-player-radio")||a.target.closest(".radio-label"))return;const n=t.querySelector(".media-player-radio");n&&!n.checked&&(n.checked=!0,J(n))})}))}function J(e,t=!1){var f,p;const a=e.dataset.entityId,n=e.dataset.state,s=e.dataset.platform,o=e.dataset.supportsSpotify==="true",i=e.dataset.supportsAppleMusic==="true",d=e.dataset.supportsYoutubeMusic==="true",c=e.dataset.supportsTidal==="true";B={entityId:a,state:n,platform:s,supportsSpotify:o,supportsAppleMusic:i,supportsYoutubeMusic:d,supportsTidal:c},document.querySelectorAll(".media-player-item").forEach(y=>{y.classList.remove("is-selected")});const u=e.closest(".media-player-item");u.classList.add("is-selected");const l=((p=(f=u.querySelector(".player-name"))==null?void 0:f.textContent)==null?void 0:p.trim())||a;ge(l);const r=document.getElementById("music-service");if(r&&r.classList.remove("hidden"),Ee(B),Le(B),!t)try{localStorage.setItem(ee,a)}catch(y){console.warn("Failed to save last player:",y)}P()}function Ee(e){const t=document.querySelector('.chip[data-provider="spotify"]'),a=document.querySelector('.chip[data-provider="apple_music"]'),n=document.querySelector('.chip[data-provider="youtube_music"]'),s=document.querySelector('.chip[data-provider="tidal"]');t&&(t.disabled=!e.supportsSpotify,t.classList.toggle("chip--disabled",!e.supportsSpotify)),a&&(a.disabled=!e.supportsAppleMusic,a.classList.toggle("chip--disabled",!e.supportsAppleMusic)),n&&(n.disabled=!e.supportsYoutubeMusic,n.classList.toggle("chip--disabled",!e.supportsYoutubeMusic)),s&&(s.disabled=!e.supportsTidal,s.classList.toggle("chip--disabled",!e.supportsTidal)),g==="apple_music"&&!e.supportsAppleMusic&&(document.querySelectorAll(".chip[data-provider]").forEach(i=>i.classList.remove("chip--active")),t&&t.classList.add("chip--active"),g="spotify"),g==="youtube_music"&&!e.supportsYoutubeMusic&&(document.querySelectorAll(".chip[data-provider]").forEach(i=>i.classList.remove("chip--active")),t&&t.classList.add("chip--active"),g="spotify"),g==="tidal"&&!e.supportsTidal&&(document.querySelectorAll(".chip[data-provider]").forEach(i=>i.classList.remove("chip--active")),t&&t.classList.add("chip--active"),g="spotify");const o=document.getElementById("provider-hint");if(o){const i=[];e.supportsAppleMusic||i.push("Apple Music"),e.supportsYoutubeMusic||i.push("YouTube Music"),e.supportsTidal||i.push("Tidal"),i.length>0?(o.textContent=`${i.join(" and ")} require${i.length===1?"s":""} Music Assistant speaker`,o.classList.remove("hidden")):o.classList.add("hidden")}}function Le(e){const t=document.getElementById("provider-warning");if(!t)return;const n={music_assistant:{warning:"Premium account must be configured in Music Assistant"},sonos:{warning:"Spotify must be linked in Sonos app"},alexa_media:{warning:"Service must be linked in Alexa app",caveat:"Uses voice search - may occasionally play a different version of the song"},alexa:{warning:"Service must be linked in Alexa app",caveat:"Uses voice search - may occasionally play a different version of the song"}}[e.platform];if(n){let s=`<p>\u26A0\uFE0F ${m.escapeHtml(n.warning)}</p>`;n.caveat&&(s+=`<p class="warning-caveat">\u2139\uFE0F ${m.escapeHtml(n.caveat)}</p>`),t.innerHTML=s,t.classList.remove("hidden")}else t.classList.add("hidden")}function F(e,t,a=!1){var d,c,u;const n=document.getElementById("playlists-list");n==null||n.removeAttribute("data-i18n");const s=a?[...b]:[];b=[],h=e||[],Ie(h);let o=h;!_.includes("all")&&_.length>0&&(o=h.filter(l=>{const r=l.tags||[];return _.every(f=>r.includes(f))}));const i=h.some(l=>l.is_valid);if(!h||h.length===0){const l=U?`<a href="${m.escapeHtml(U)}" target="_blank" rel="noopener">How to create playlists</a>`:"";n.innerHTML=`
            <div class="empty-state">
                <p class="status-error">No playlists found. Add playlist JSON files to:</p>
                <p style="font-size: 14px;"><code>${m.escapeHtml(t)}</code></p>
                ${l?`<p style="margin-top: 12px;">${l}</p>`:""}
            </div>
        `,(d=document.getElementById("start-game"))==null||d.classList.add("hidden");return}if(o.length===0){n.innerHTML=`
            <div class="empty-state">
                <p>No playlists match the selected filter.</p>
                <button type="button" class="btn btn-secondary" onclick="clearPlaylistFilters()">Clear Filters</button>
            </div>
        `;return}n.innerHTML=o.map(l=>{if(l.is_valid){const r=l.song_count||0,f=l.spotify_count||0,p=l.apple_music_count||0,y=l.youtube_music_count||0,T=l.tidal_count||0;let E=r;g==="spotify"?E=f||r:g==="apple_music"?E=p:g==="youtube_music"?E=y:g==="tidal"&&(E=T);const N=E===0,le=N?"is-disabled":"",ce=N?"disabled":"";let z="";return E<r&&(z=`<span class="${E===0?"playlist-coverage playlist-coverage--none":"playlist-coverage playlist-coverage--warning"}">${E}/${r}</span>`),`
                <div class="playlist-item list-item ${N?"":"is-selectable"} ${le}"
                     data-provider-count="${E}"
                     data-tags="${m.escapeHtml((l.tags||[]).join(","))}">
                    <label class="checkbox-label">
                        <input type="checkbox"
                               class="playlist-checkbox"
                               data-path="${m.escapeHtml(l.path)}"
                               data-song-count="${m.escapeHtml(String(r))}"
                               data-provider-count="${E}"
                               ${ce}>
                        <span class="playlist-name">${m.escapeHtml(l.name)}</span>
                    </label>
                    <span class="meta">${z||m.escapeHtml(String(r))} songs</span>
                </div>
            `}else{const r=l.errors&&l.errors[0]||"Unknown error";return`
                <div class="list-item is-invalid">
                    <span class="name">${m.escapeHtml(l.name)}</span>
                    <span class="meta">Invalid: ${m.escapeHtml(r)}</span>
                </div>
            `}}).join(""),n.querySelectorAll(".playlist-checkbox").forEach(l=>{l.addEventListener("change",function(){X(this)})}),n.querySelectorAll(".playlist-item.is-selectable").forEach(l=>{l.addEventListener("click",function(r){if(r.target.classList.contains("playlist-checkbox")||r.target.closest(".checkbox-label"))return;const f=l.querySelector(".playlist-checkbox");f&&(f.checked=!f.checked,X(f))})}),a&&s.length>0&&s.forEach(l=>{const r=n.querySelector(`.playlist-checkbox[data-path="${CSS.escape(l.path)}"]`);if(r&&!r.disabled){r.checked=!0;const f=parseInt(r.dataset.providerCount,10)||0,p=r.closest(".playlist-item");f>0&&(b.push({path:l.path,songCount:f}),p==null||p.classList.add("is-selected"))}}),i?(c=document.getElementById("start-game"))==null||c.classList.remove("hidden"):(u=document.getElementById("start-game"))==null||u.classList.add("hidden"),ae(),P()}function X(e){const t=e.dataset.path,a=parseInt(e.dataset.providerCount,10)||0,n=e.closest(".playlist-item");e.checked?(b.some(s=>s.path===t)||b.push({path:t,songCount:a}),n.classList.add("is-selected")):(b=b.filter(s=>s.path!==t),n.classList.remove("is-selected")),ae(),P()}const Be={decade:{label:"Decade",tags:["1970s","1980s","1990s","2000s"]},style:{label:"Style",tags:["rock","pop","ballads","electronic","eurodance","yacht-rock","soft-rock","pop-punk","schlager","party"]},region:{label:"Region",tags:["international","german","dutch"]},special:{label:"Special",tags:["movies","soundtrack","eurovision","carnival","classics"]}};let q={decade:"",style:"",region:"",special:""};function Ie(e){const t=document.getElementById("playlist-filter-bar");if(!t)return;const a=new Set;if(e.forEach(i=>{(i.tags||[]).forEach(d=>a.add(d))}),a.size===0){t.classList.add("hidden");return}const n=i=>i.charAt(0).toUpperCase()+i.slice(1);let s='<div class="filter-dropdowns">';Object.entries(Be).forEach(([i,d])=>{const c=d.tags.filter(l=>a.has(l));if(c.length===0)return;const u=q[i]||"";s+=`
            <select class="filter-dropdown" data-category="${i}">
                <option value="">${d.label}</option>
                ${c.map(l=>{const r=u===l?"selected":"";return`<option value="${m.escapeHtml(l)}" ${r}>${n(l)}</option>`}).join("")}
            </select>
        `}),s+="</div>";const o=Object.entries(q).filter(([i,d])=>d).map(([i,d])=>n(d));o.length>0&&(s+=`
            <div class="filter-summary">
                <span class="filter-summary-text">Showing: ${o.join(" \u2022 ")}</span>
                <button type="button" class="filter-clear" onclick="clearPlaylistFilters()">Clear</button>
            </div>
        `),t.innerHTML=s,t.classList.remove("hidden"),t.querySelectorAll(".filter-dropdown").forEach(i=>{i.addEventListener("change",function(){we(this.dataset.category,this.value)})})}function we(e,t){q[e]=t,Se(),F(h,"",!0)}function Se(){const e=Object.values(q).filter(t=>t);_=e.length>0?e:["all"]}function ke(){q={decade:"",style:"",region:"",special:""},_=["all"],F(h,"",!0)}window.clearPlaylistFilters=ke;function _e(){return b.reduce((e,t)=>e+t.songCount,0)}function ae(){const e=document.getElementById("playlist-summary"),t=document.getElementById("selected-count"),a=document.getElementById("total-songs");!e||!t||!a||(b.length===0?e.classList.add("hidden"):(e.classList.remove("hidden"),t.textContent=b.length,a.textContent=_e()))}function P(){const e=document.getElementById("start-game"),t=document.getElementById("playlist-validation-msg"),a=document.getElementById("media-player-validation-msg");if(!e)return;const n=b.length===0,s=B===null;e.disabled=n||s,t&&t.classList.toggle("hidden",!n),a&&a.classList.toggle("hidden",!s)}function ne(){var t,a,n;j="setup",L=null,Q(),M=[],W.forEach(s=>{const o=document.getElementById(s);o&&o.classList.remove("hidden")}),h.some(s=>s.is_valid)&&((t=document.getElementById("start-game"))==null||t.classList.remove("hidden")),(a=document.getElementById("lobby-section"))==null||a.classList.add("hidden"),(n=document.getElementById("existing-game-section"))==null||n.classList.add("hidden")}function se(e){var o,i,d,c;j="lobby",L=e,W.forEach(u=>{const l=document.getElementById(u);l&&l.classList.add("hidden")}),(o=document.getElementById("start-game"))==null||o.classList.add("hidden"),(i=document.getElementById("playlist-validation-msg"))==null||i.classList.add("hidden"),(d=document.getElementById("existing-game-section"))==null||d.classList.add("hidden"),(c=document.getElementById("lobby-section"))==null||c.classList.remove("hidden");const t=document.getElementById("qr-code");t&&e.join_url&&A!==e.join_url&&(t.innerHTML="",typeof QRCode!="undefined"?new QRCode(t,{text:e.join_url,width:180,height:180,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M}):t.innerHTML='<p class="status-error">QR code library not loaded</p>',A=e.join_url);const a=document.getElementById("join-url");a&&e.join_url&&(a.textContent=e.join_url);var n=window.location.origin+"/beatify/dashboard",s=document.getElementById("admin-dashboard-url");s&&(s.href=n),ie(e.players||[]),Fe(),je(e.difficulty||S),Ae()}function Z(){if(A){var e=document.getElementById("qr-modal"),t=document.getElementById("qr-modal-code");if(!(!e||!t)){t.innerHTML="",typeof QRCode!="undefined"&&new QRCode(t,{text:A,width:280,height:280,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M}),e.classList.remove("hidden"),document.body.style.overflow="hidden";var a=document.getElementById("qr-modal-close");a&&a.focus()}}}function G(){var e=document.getElementById("qr-modal");e&&(e.classList.add("hidden"),document.body.style.overflow="")}function Ae(){var e=document.getElementById("admin-qr-container"),t=document.getElementById("qr-modal"),a=t?t.querySelector(".qr-modal-backdrop"):null,n=document.getElementById("qr-modal-close");e&&(e.addEventListener("click",Z),e.addEventListener("keydown",function(s){(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),Z())})),a&&a.addEventListener("click",G),n&&n.addEventListener("click",G),document.addEventListener("keydown",function(s){s.key==="Escape"&&t&&!t.classList.contains("hidden")&&G()})}function qe(e){var s,o,i,d,c;j="existing-game",L=e,W.forEach(u=>{const l=document.getElementById(u);l&&l.classList.add("hidden")}),(s=document.getElementById("start-game"))==null||s.classList.add("hidden"),(o=document.getElementById("playlist-validation-msg"))==null||o.classList.add("hidden"),(i=document.getElementById("lobby-section"))==null||i.classList.add("hidden"),(d=document.getElementById("existing-game-section"))==null||d.classList.remove("hidden");const t=document.getElementById("existing-game-id"),a=document.getElementById("existing-game-phase"),n=document.getElementById("existing-game-players");t&&(t.textContent=e.game_id||"Unknown"),a&&(a.textContent=e.phase||"Unknown"),n&&(n.textContent=(c=e.player_count)!=null?c:0)}function Ce(){return v(this,null,function*(){const e=document.getElementById("start-game");if(!e||e.disabled)return;e.disabled=!0;const t=e.textContent;e.textContent="Starting...";try{const a=yield fetch("/beatify/api/start-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playlists:b.map(s=>s.path),media_player:B==null?void 0:B.entityId,language:I,round_duration:$,difficulty:S,provider:g,artist_challenge_enabled:x})}),n=yield a.json();if(!a.ok){C(n.message||"Failed to start game");return}n.warnings&&n.warnings.length>0&&console.warn("Game started with warnings:",n.warnings),se(n)}catch(a){C("Network error. Please try again."),console.error("Start game error:",a)}finally{e.disabled=!1,e.textContent=t,P()}})}function $e(){const e=document.getElementById("end-game-modal");e&&e.classList.remove("hidden")}function R(){const e=document.getElementById("end-game-modal");e&&e.classList.add("hidden")}function O(){$e()}function xe(){return v(this,null,function*(){R();try{const e=yield fetch("/beatify/api/end-game",{method:"POST"});if(e.ok)A=null,ne();else{const t=yield e.json();C(t.message||"Failed to end game")}}catch(e){console.error("End game error:",e),C("Network error. Please try again.")}})}function Pe(){const e=document.getElementById("end-game-confirm-btn"),t=document.getElementById("end-game-cancel-btn"),a=document.querySelector("#end-game-modal .modal-backdrop");e==null||e.addEventListener("click",xe),t==null||t.addEventListener("click",R),a==null||a.addEventListener("click",R)}function Te(){return v(this,null,function*(){if(L){try{var e=yield fetch("/beatify/api/status");if(e.ok){var t=yield e.json();t.active_game&&(L=t.active_game)}}catch(a){console.error("Failed to refresh game status:",a)}se(L)}})}function Me(){window.print()}function C(e){alert(e)}function He(){var t;const e=document.getElementById("admin-join-modal");e&&(e.classList.remove("hidden"),(t=document.getElementById("admin-name-input"))==null||t.focus())}function D(){const e=document.getElementById("admin-join-modal");e&&e.classList.add("hidden");const t=document.getElementById("admin-name-input"),a=document.getElementById("admin-join-btn"),n=document.getElementById("admin-name-error");t&&(t.value=""),a&&(a.disabled=!0,a.textContent="Join"),n&&n.classList.add("hidden")}function Re(){const e=document.getElementById("participate-btn"),t=document.getElementById("admin-cancel-btn"),a=document.getElementById("admin-join-btn"),n=document.getElementById("admin-name-input"),s=document.querySelector("#admin-join-modal .modal-backdrop");e==null||e.addEventListener("click",He),t==null||t.addEventListener("click",D),s==null||s.addEventListener("click",D),n==null||n.addEventListener("input",function(){const o=this.value.trim();a.disabled=!o||o.length>20}),n==null||n.addEventListener("keypress",function(o){o.key==="Enter"&&!a.disabled&&K()}),a==null||a.addEventListener("click",K),document.addEventListener("keydown",function(o){if(o.key==="Escape"){const i=document.getElementById("admin-join-modal"),d=document.getElementById("end-game-modal");i&&!i.classList.contains("hidden")&&D(),d&&!d.classList.contains("hidden")&&R()}})}function K(){const e=document.getElementById("admin-name-input"),t=document.getElementById("admin-join-btn"),a=e==null?void 0:e.value.trim();if(a){t.disabled=!0,t.textContent="Joining...";try{sessionStorage.setItem("beatify_admin_name",a),sessionStorage.setItem("beatify_is_admin","true");const n=L==null?void 0:L.game_id;n?window.location.href="/beatify/play?game="+encodeURIComponent(n):(C("No active game found"),t.disabled=!1,t.textContent="Join")}catch(n){console.error("Admin join failed:",n),t.disabled=!1,t.textContent="Join"}}}function je(e){var t=document.getElementById("lobby-difficulty-badge");if(t){var a={easy:"game.difficultyEasy",normal:"game.difficultyNormal",hard:"game.difficultyHard"}[e]||"game.difficultyNormal",n=m.t(a);t.textContent=n,t.className="difficulty-badge difficulty-badge--"+(e||"normal")}}function ie(e){var t=document.getElementById("lobby-players"),a=document.getElementById("lobby-player-count"),n=document.getElementById("admin-players-summary"),s=document.getElementById("lobby-players-empty");if(t){if(e=e||[],a&&(a.textContent=e.length),n&&(n.textContent=e.length),e.length===0){t.innerHTML="",s&&s.classList.remove("hidden"),M=[];return}s&&s.classList.add("hidden");var o=e.slice().sort(function(c,u){return c.connected!==u.connected?c.connected?-1:1:0}),i=M.map(function(c){return c.name}),d=o.filter(function(c){return i.indexOf(c.name)===-1}).map(function(c){return c.name});t.innerHTML=o.map(function(c){var u=d.indexOf(c.name)!==-1,l=c.connected===!1,r=c.is_admin===!0,f=["player-card",u?"is-new":"",l?"player-card--disconnected":""].filter(Boolean).join(" "),p=r?'<span class="admin-badge">\u{1F451}</span>':"",y=l?'<span class="away-badge">'+m.t("lobby.away","away")+"</span>":"";return'<div class="'+f+'" data-player="'+m.escapeHtml(c.name)+'"><span class="player-name">'+m.escapeHtml(c.name)+p+"</span>"+y+"</div>"}).join(""),setTimeout(function(){for(var c=t.querySelectorAll(".is-new"),u=0;u<c.length;u++)c[u].classList.remove("is-new")},2e3),M=e.slice()}}function Fe(){Q(),H=setInterval(function(){return v(this,null,function*(){if(j!=="lobby"){Q();return}try{var e=yield fetch("/beatify/api/status");if(!e.ok)return;var t=yield e.json();t.active_game&&t.active_game.players&&ie(t.active_game.players)}catch(a){console.error("Lobby polling error:",a)}})},3e3)}function Q(){H&&(clearInterval(H),H=null)}function Ne(){var i,d,c,u,l;const e=document.getElementById("request-modal"),t=document.getElementById("request-success-modal"),a=document.getElementById("spotify-url-input"),n=document.getElementById("spotify-url-error"),s=document.getElementById("request-submit-btn");(i=document.getElementById("request-playlist-btn"))==null||i.addEventListener("click",()=>{e&&(e.classList.remove("hidden"),a==null||a.focus())}),(d=document.getElementById("request-cancel-btn"))==null||d.addEventListener("click",()=>{o()}),(c=e==null?void 0:e.querySelector(".modal-backdrop"))==null||c.addEventListener("click",()=>{o()}),a==null||a.addEventListener("input",()=>{var p;const r=a.value.trim(),f=(p=window.PlaylistRequests)==null?void 0:p.isValidSpotifyUrl(r);r&&!f?(a.classList.add("input-error"),n==null||n.classList.remove("hidden")):(a.classList.remove("input-error"),n==null||n.classList.add("hidden")),s&&(s.disabled=!f)}),s==null||s.addEventListener("click",()=>v(this,null,function*(){var f,p;const r=a==null?void 0:a.value.trim();if(!(!r||!((f=window.PlaylistRequests)!=null&&f.isValidSpotifyUrl(r)))){s.classList.add("btn--loading"),s.disabled=!0;try{const y=yield window.PlaylistRequests.submitRequest(r);o();const T=document.getElementById("request-success-name");T&&(T.textContent=y.playlist_name),t==null||t.classList.remove("hidden"),yield Y()}catch(y){console.error("Failed to submit request:",y),a==null||a.classList.add("input-error"),n&&(n.textContent=y.message||"Failed to submit request",n.classList.remove("hidden"))}finally{s.classList.remove("btn--loading");const y=(p=window.PlaylistRequests)==null?void 0:p.isValidSpotifyUrl((a==null?void 0:a.value.trim())||"");s.disabled=!y}}})),(u=document.getElementById("request-success-close-btn"))==null||u.addEventListener("click",()=>{t==null||t.classList.add("hidden")}),(l=t==null?void 0:t.querySelector(".modal-backdrop"))==null||l.addEventListener("click",()=>{t==null||t.classList.add("hidden")});function o(){e==null||e.classList.add("hidden"),a&&(a.value="",a.classList.remove("input-error")),n==null||n.classList.add("hidden"),s&&(s.disabled=!0,s.classList.remove("btn--loading"))}}function Ge(){return v(this,null,function*(){if(yield Y(),window.PlaylistRequests)try{(yield window.PlaylistRequests.pollStatuses())&&(yield Y())}catch(e){console.error("Failed to poll request statuses:",e)}})}function Y(){return v(this,null,function*(){const e=document.getElementById("my-requests"),t=document.getElementById("my-requests-list"),a=document.getElementById("my-requests-empty"),n=document.getElementById("my-requests-summary");if(!window.PlaylistRequests){e==null||e.classList.add("hidden");return}e==null||e.classList.remove("hidden");const s=yield window.PlaylistRequests.getRequestsForDisplayAsync();n&&(n.textContent=s.length.toString()),s.length===0?(t.innerHTML="",a==null||a.classList.remove("hidden")):(a==null||a.classList.add("hidden"),t.innerHTML=s.map(o=>{const i=`request-status--${o.status}`,c={pending:"\u23F3 Pending",ready:"\u2705 Ready",installed:"\u2713 Installed",declined:"\u274C Declined"}[o.status]||o.status,u=o.thumbnail_url?`<img class="request-item-thumbnail" src="${o.thumbnail_url}" alt="">`:'<div class="request-item-thumbnail-placeholder">\u{1F3B5}</div>';let l="";return o.status==="ready"&&o.update_available&&(l=`<a href="https://github.com/mholzi/beatify/releases" target="_blank"
                    class="btn btn-primary request-update-btn">Update to v${o.release_version}</a>`),`
                <div class="request-item">
                    ${u}
                    <div class="request-item-info">
                        <div class="request-item-name">${Oe(o.playlist_name)}</div>
                        <div class="request-item-meta">${o.relative_time}</div>
                    </div>
                    <span class="request-status ${i}">${c}</span>
                    ${l}
                </div>
            `}).join(""))})}function Oe(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/beatify/static/sw.js",{scope:"/beatify/"}).then(function(e){console.log("[Admin] SW registered:",e.scope)}).catch(function(e){console.warn("[Admin] SW registration failed:",e)})})});De();})();
//# sourceMappingURL=admin.min.js.map

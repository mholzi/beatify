{
  "version": 3,
  "sources": ["admin.js"],
  "sourcesContent": ["/**\n * Beatify Admin Page\n * Vanilla JS - no frameworks\n */\n\n// Module-level state\nlet selectedPlaylists = [];\nlet playlistData = [];\nlet playlistDocsUrl = '';\nlet activeFilterTags = ['all'];  // Tag filter state (Issue #70)\nlet selectedMediaPlayer = null;  // { entityId: string, state: string } or null\nlet mediaPlayerDocsUrl = '';\n\n// View state management (Story 2.3)\nlet currentView = 'setup';\nlet currentGame = null;\nlet cachedQRUrl = null;\n\n// Language state (Story 12.4)\nlet selectedLanguage = 'en';\n\n// Timer state (Story 13.1)\nlet selectedDuration = 45;\n\n// Difficulty state (Story 14.1)\nlet selectedDifficulty = 'normal';\n\n// Provider state (Story 17.2)\nlet selectedProvider = 'spotify';\nlet hasMusicAssistant = false;\n\n// Artist Challenge state (Story 20.7)\nlet artistChallengeEnabled = true;\n\n// Lobby state (Story 16.8)\nlet previousLobbyPlayers = [];\nlet lobbyPollingInterval = null;\n\n// LocalStorage keys\nconst STORAGE_LAST_PLAYER = 'beatify_last_player';\nconst STORAGE_GAME_SETTINGS = 'beatify_game_settings';\n\n// Setup sections to hide/show as a group\nconst setupSections = ['media-players', 'music-service', 'playlists', 'game-settings', 'admin-actions', 'my-requests'];\n\n// Platform display labels for speaker grouping\nconst PLATFORM_LABELS = {\n    music_assistant: { icon: '\uD83C\uDFB5', label: 'Music Assistant', recommended: true },\n    sonos: { icon: '\uD83D\uDD0A', label: 'Sonos' },\n    alexa_media: { icon: '\uD83D\uDCE2', label: 'Alexa' },\n    alexa: { icon: '\uD83D\uDCE2', label: 'Alexa' },\n};\n\n// Alias BeatifyUtils for convenience\nconst utils = window.BeatifyUtils || {};\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n    // Initialize i18n based on browser language (Story 12.4)\n    // Guard clause: wait for BeatifyI18n in case fallback script is loading\n    const i18nAvailable = await utils.waitForI18n();\n    if (!i18nAvailable) {\n        console.error('[Beatify] BeatifyI18n module failed to load - UI will use fallback text');\n    } else {\n        await BeatifyI18n.init();\n        BeatifyI18n.initPageTranslations();\n        selectedLanguage = BeatifyI18n.getLanguage();\n    }\n    // Set initial language chip active state\n    document.querySelectorAll('.chip[data-lang]').forEach(c => {\n        c.classList.toggle('chip--active', c.dataset.lang === selectedLanguage);\n    });\n\n    // Wire event listeners\n    document.getElementById('start-game')?.addEventListener('click', startGame);\n    document.getElementById('print-qr')?.addEventListener('click', printQRCode);\n    document.getElementById('rejoin-game')?.addEventListener('click', rejoinGame);\n\n    // Dashboard URL is now set in showLobbyView() for analytics layout\n    document.getElementById('end-game')?.addEventListener('click', endGame);\n    document.getElementById('end-game-lobby')?.addEventListener('click', endGame);\n    document.getElementById('end-game-existing')?.addEventListener('click', endGame);\n\n    // Admin join setup\n    setupAdminJoin();\n\n    // End game modal setup (Story 9.10)\n    setupEndGameModal();\n\n    // Collapsible sections setup\n    setupCollapsibleSections();\n\n    // Game settings setup (language, timer, difficulty, artist challenge)\n    setupGameSettings();\n\n    // Playlist requests setup (Story 44.2, 44.3)\n    setupPlaylistRequests();\n\n    // Load saved game settings from localStorage\n    await loadSavedSettings();\n\n    await loadStatus();\n\n    // Initialize playlist requests display (Story 44.3, 44.4)\n    initPlaylistRequests();\n});\n\n/**\n * Fetch and render current status from the API\n */\nasync function loadStatus() {\n    try {\n        const response = await fetch('/beatify/api/status');\n\n        if (!response.ok) {\n            throw new Error(`HTTP ${response.status}`);\n        }\n\n        const status = await response.json();\n\n        playlistDocsUrl = status.playlist_docs_url || '';\n        mediaPlayerDocsUrl = status.media_player_docs_url || '';\n        // Set Music Assistant availability from backend (not based on entity names)\n        hasMusicAssistant = status.has_music_assistant === true;\n        // Display version in footer and expose globally (Story 44.5)\n        const versionEl = document.getElementById('app-version');\n        if (versionEl && status.version) {\n            versionEl.textContent = 'v' + status.version;\n            window.BEATIFY_VERSION = status.version;\n        }\n        renderMediaPlayers(status.media_players);\n        renderPlaylists(status.playlists, status.playlist_dir);\n        updateStartButtonState();\n\n        // Check for active game and show appropriate view\n        if (status.active_game) {\n            showExistingGameView(status.active_game);\n        } else {\n            showSetupView();\n        }\n    } catch (error) {\n        console.error('Failed to load status:', error);\n        const container = document.getElementById('media-players-list');\n        if (container) {\n            container.innerHTML = '<span class=\"status-error\">Failed to load status</span>';\n        }\n    }\n}\n\n/**\n * Setup collapsible section toggles\n */\nfunction setupCollapsibleSections() {\n    // Media players toggle\n    document.getElementById('media-players-toggle')?.addEventListener('click', function() {\n        const section = document.getElementById('media-players');\n        if (section) {\n            section.classList.toggle('collapsed');\n            this.setAttribute('aria-expanded', !section.classList.contains('collapsed'));\n        }\n    });\n\n    // Game settings toggle\n    document.getElementById('game-settings-toggle')?.addEventListener('click', function() {\n        const section = document.getElementById('game-settings');\n        if (section) {\n            section.classList.toggle('collapsed');\n            this.setAttribute('aria-expanded', !section.classList.contains('collapsed'));\n        }\n    });\n\n    // My Requests toggle (Story 44.3)\n    document.getElementById('my-requests-toggle')?.addEventListener('click', function() {\n        const section = document.getElementById('my-requests');\n        if (section) {\n            section.classList.toggle('collapsed');\n            this.setAttribute('aria-expanded', !section.classList.contains('collapsed'));\n        }\n    });\n\n    // Lobby section toggles (new compact layout)\n    document.querySelectorAll('.lobby-container--compact .section-header-collapsible').forEach(function(header) {\n        header.addEventListener('click', function() {\n            const section = header.closest('.section-collapsible');\n            if (section) {\n                section.classList.toggle('collapsed');\n                header.setAttribute('aria-expanded', !section.classList.contains('collapsed'));\n            }\n        });\n    });\n}\n\n/**\n * Setup game settings controls (chips for language, timer, difficulty, toggle for artist challenge)\n */\nfunction setupGameSettings() {\n    // Language chips\n    document.querySelectorAll('.chip[data-lang]').forEach(chip => {\n        chip.addEventListener('click', async function() {\n            const lang = this.dataset.lang;\n            document.querySelectorAll('.chip[data-lang]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedLanguage = lang;\n            if (window.BeatifyI18n) {\n                await BeatifyI18n.setLanguage(lang);\n                BeatifyI18n.initPageTranslations();\n            }\n            updateGameSettingsSummary();\n            saveGameSettings();\n        });\n    });\n\n    // Timer chips\n    document.querySelectorAll('.chip[data-duration]').forEach(chip => {\n        chip.addEventListener('click', function() {\n            const duration = parseInt(this.dataset.duration, 10);\n            document.querySelectorAll('.chip[data-duration]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedDuration = duration;\n            updateGameSettingsSummary();\n            saveGameSettings();\n        });\n    });\n\n    // Difficulty chips\n    document.querySelectorAll('.chip[data-difficulty]').forEach(chip => {\n        chip.addEventListener('click', function() {\n            const difficulty = this.dataset.difficulty;\n            document.querySelectorAll('.chip[data-difficulty]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedDifficulty = difficulty;\n            updateGameSettingsSummary();\n            saveGameSettings();\n        });\n    });\n\n    // Artist Challenge toggle\n    document.getElementById('artist-challenge-toggle')?.addEventListener('change', function() {\n        artistChallengeEnabled = this.checked;\n        updateGameSettingsSummary();\n        saveGameSettings();\n    });\n\n    // Provider chips (Music Service)\n    document.querySelectorAll('.chip[data-provider]').forEach(chip => {\n        chip.addEventListener('click', function() {\n            // Don't allow clicking disabled chips\n            if (this.disabled || this.classList.contains('chip--disabled')) {\n                return;\n            }\n            const provider = this.dataset.provider;\n            document.querySelectorAll('.chip[data-provider]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedProvider = provider;\n            updateGameSettingsSummary();\n            saveGameSettings();\n            // Re-render playlists to show coverage for selected provider (preserve valid selections)\n            if (playlistData.length > 0) {\n                renderPlaylists(playlistData, '', true);\n            }\n        });\n    });\n}\n\n/**\n * Load saved settings from localStorage\n */\nasync function loadSavedSettings() {\n    try {\n        const saved = localStorage.getItem(STORAGE_GAME_SETTINGS);\n        if (saved) {\n            const settings = JSON.parse(saved);\n\n            // Apply language\n            if (settings.language) {\n                selectedLanguage = settings.language;\n                document.querySelectorAll('.chip[data-lang]').forEach(c => {\n                    c.classList.toggle('chip--active', c.dataset.lang === settings.language);\n                });\n                if (window.BeatifyI18n) {\n                    await BeatifyI18n.setLanguage(settings.language);\n                    // Note: initPageTranslations called by DOMContentLoaded after loadSavedSettings\n                }\n            }\n\n            // Apply timer\n            if (settings.duration) {\n                selectedDuration = settings.duration;\n                document.querySelectorAll('.chip[data-duration]').forEach(c => {\n                    c.classList.toggle('chip--active', parseInt(c.dataset.duration, 10) === settings.duration);\n                });\n            }\n\n            // Apply difficulty\n            if (settings.difficulty) {\n                selectedDifficulty = settings.difficulty;\n                document.querySelectorAll('.chip[data-difficulty]').forEach(c => {\n                    c.classList.toggle('chip--active', c.dataset.difficulty === settings.difficulty);\n                });\n            }\n\n            // Apply artist challenge\n            if (typeof settings.artistChallenge === 'boolean') {\n                artistChallengeEnabled = settings.artistChallenge;\n                const toggle = document.getElementById('artist-challenge-toggle');\n                if (toggle) toggle.checked = settings.artistChallenge;\n            }\n\n            // Apply provider\n            if (settings.provider) {\n                selectedProvider = settings.provider;\n                document.querySelectorAll('.chip[data-provider]').forEach(c => {\n                    c.classList.toggle('chip--active', c.dataset.provider === settings.provider);\n                });\n            }\n        }\n    } catch (e) {\n        console.warn('Failed to load saved settings:', e);\n    }\n    // Always update summary (uses current state values)\n    updateGameSettingsSummary();\n}\n\n/**\n * Save game settings to localStorage\n */\nfunction saveGameSettings() {\n    try {\n        const settings = {\n            language: selectedLanguage,\n            duration: selectedDuration,\n            difficulty: selectedDifficulty,\n            artistChallenge: artistChallengeEnabled,\n            provider: selectedProvider\n        };\n        localStorage.setItem(STORAGE_GAME_SETTINGS, JSON.stringify(settings));\n    } catch (e) {\n        console.warn('Failed to save settings:', e);\n    }\n}\n\n/**\n * Update the game settings summary badge\n */\nfunction updateGameSettingsSummary() {\n    const summary = document.getElementById('game-settings-summary');\n    if (!summary) return;\n\n    const difficultyLabels = { easy: 'Easy', normal: 'Normal', hard: 'Hard' };\n    const langLabels = { en: 'EN', de: 'DE', es: 'ES' };\n    const artistIcon = artistChallengeEnabled ? ' \u2022 \uD83C\uDFA4' : '';\n\n    summary.textContent = `${difficultyLabels[selectedDifficulty] || 'Normal'} \u2022 ${selectedDuration}s \u2022 ${langLabels[selectedLanguage] || 'EN'}${artistIcon}`;\n}\n\n/**\n * Update media player summary badge\n * @param {string} playerName - Friendly name of selected player\n */\nfunction updateMediaPlayerSummary(playerName) {\n    const summary = document.getElementById('media-player-summary');\n    if (summary) {\n        summary.textContent = playerName || 'Select...';\n    }\n}\n\n/**\n * Group players by platform for organized display\n * @param {Array} players\n * @returns {Object} Grouped players by platform\n */\nfunction groupPlayersByPlatform(players) {\n    const groups = {};\n    players.forEach(player => {\n        const platform = player.platform || 'unknown';\n        if (!groups[platform]) {\n            groups[platform] = [];\n        }\n        groups[platform].push(player);\n    });\n    return groups;\n}\n\n/**\n * Render media players list grouped by platform with capability info\n * Filters out unavailable players\n * @param {Array} players\n */\nfunction renderMediaPlayers(players) {\n    const container = document.getElementById('media-players-list');\n    // Remove data-i18n to prevent initPageTranslations from overwriting rendered content\n    container?.removeAttribute('data-i18n');\n    const totalPlayers = players ? players.length : 0;\n\n    // Reset selection state\n    selectedMediaPlayer = null;\n\n    // Filter out unavailable players\n    const availablePlayers = (players || []).filter(p => p.state !== 'unavailable');\n\n    // Hide validation message when showing empty states (avoid redundant messaging)\n    const validationMsg = document.getElementById('media-player-validation-msg');\n\n    if (totalPlayers === 0) {\n        // No compatible players found - show setup message with MA link\n        container.innerHTML = `\n            <div class=\"no-players-message\">\n                <h3>\uD83C\uDFB5 No Compatible Players Found</h3>\n                <p>Beatify works with Music Assistant, Sonos, and Alexa players.</p>\n                <p><strong>Recommended:</strong> Install Music Assistant for the best experience with any speaker.</p>\n                <div class=\"button-group\">\n                    <a href=\"https://music-assistant.io/getting-started/\"\n                       target=\"_blank\" class=\"btn btn-secondary\">\n                        \uD83D\uDCD6 Music Assistant Setup Guide\n                    </a>\n                    <button onclick=\"loadStatus()\" class=\"btn btn-primary\">\n                        \uD83D\uDD04 Refresh\n                    </button>\n                </div>\n            </div>\n        `;\n        if (validationMsg) {\n            validationMsg.classList.add('hidden');\n        }\n        // Disable start button when no players\n        const startBtn = document.getElementById('start-game');\n        if (startBtn) startBtn.disabled = true;\n        return;\n    }\n\n    if (availablePlayers.length === 0) {\n        // Players exist but all unavailable\n        const docsLink = mediaPlayerDocsUrl\n            ? `<a href=\"${utils.escapeHtml(mediaPlayerDocsUrl)}\" target=\"_blank\" rel=\"noopener\">Troubleshooting</a>`\n            : '';\n        container.innerHTML = `\n            <div class=\"empty-state\">\n                <p class=\"status-error\">All media players are unavailable. Check your devices are powered on.</p>\n                ${docsLink ? `<p style=\"margin-top: 12px;\">${docsLink}</p>` : ''}\n            </div>\n        `;\n        if (validationMsg) {\n            validationMsg.classList.add('hidden');\n        }\n        return;\n    }\n\n    // Render all players with platform badges on each item\n    container.innerHTML = availablePlayers.map(player => renderPlayerItem(player)).join('');\n    attachPlayerSelectionHandlers();\n\n    // Try to auto-select last used player from localStorage\n    const lastPlayerId = localStorage.getItem(STORAGE_LAST_PLAYER);\n    if (lastPlayerId) {\n        const lastPlayerRadio = container.querySelector(`[data-entity-id=\"${lastPlayerId}\"]`);\n        if (lastPlayerRadio) {\n            lastPlayerRadio.checked = true;\n            handleMediaPlayerSelect(lastPlayerRadio, true); // true = skip localStorage save\n            // Collapse section since we have a valid selection\n            const section = document.getElementById('media-players');\n            if (section) {\n                section.classList.add('collapsed');\n                const toggle = document.getElementById('media-players-toggle');\n                if (toggle) toggle.setAttribute('aria-expanded', 'false');\n            }\n        }\n    }\n}\n\n/**\n * Render a single player item with platform badge and capability data attributes\n * @param {Object} player - Player object from backend\n * @returns {string} HTML string\n */\nfunction renderPlayerItem(player) {\n    const info = PLATFORM_LABELS[player.platform] || { icon: '\uD83D\uDD08', label: player.platform };\n    const platformBadge = `<span class=\"platform-badge platform-badge--${utils.escapeHtml(player.platform)}\">${info.icon} ${info.label}</span>`;\n\n    return `\n        <div class=\"media-player-item list-item is-selectable\"\n             data-entity-id=\"${utils.escapeHtml(player.entity_id)}\"\n             data-platform=\"${utils.escapeHtml(player.platform)}\"\n             data-supports-spotify=\"${player.supports_spotify}\"\n             data-supports-apple-music=\"${player.supports_apple_music}\"\n             data-supports-youtube-music=\"${player.supports_youtube_music}\"\n             data-supports-tidal=\"${player.supports_tidal}\">\n            <label class=\"radio-label\">\n                <input type=\"radio\"\n                       class=\"media-player-radio\"\n                       name=\"media-player\"\n                       data-entity-id=\"${utils.escapeHtml(player.entity_id)}\"\n                       data-state=\"${utils.escapeHtml(player.state)}\"\n                       data-platform=\"${utils.escapeHtml(player.platform)}\"\n                       data-supports-spotify=\"${player.supports_spotify}\"\n                       data-supports-apple-music=\"${player.supports_apple_music}\"\n                       data-supports-youtube-music=\"${player.supports_youtube_music}\"\n                       data-supports-tidal=\"${player.supports_tidal}\">\n                <span class=\"player-info\">\n                    <span class=\"player-name\">${utils.escapeHtml(player.friendly_name)}</span>\n                    ${platformBadge}\n                </span>\n            </label>\n            <span class=\"meta\">\n                <span class=\"state-dot state-${utils.escapeHtml(player.state)}\"></span>\n                ${utils.escapeHtml(player.state)}\n            </span>\n        </div>\n    `;\n}\n\n/**\n * Attach event handlers to player selection elements\n */\nfunction attachPlayerSelectionHandlers() {\n    const container = document.getElementById('media-players-list');\n    if (!container) return;\n\n    // Attach event listeners to radio buttons\n    container.querySelectorAll('.media-player-radio').forEach(radio => {\n        radio.addEventListener('change', function() {\n            handleMediaPlayerSelect(this);\n        });\n    });\n\n    // Make entire row clickable (for hidden input UX)\n    container.querySelectorAll('.media-player-item').forEach(item => {\n        item.addEventListener('click', function(e) {\n            // Don't double-trigger if clicking on the radio or within the label\n            if (e.target.classList.contains('media-player-radio') || e.target.closest('.radio-label')) return;\n            const radio = item.querySelector('.media-player-radio');\n            if (radio && !radio.checked) {\n                radio.checked = true;\n                handleMediaPlayerSelect(radio);\n            }\n        });\n    });\n}\n\n/**\n * Handle media player radio button selection (AC4)\n * Updates provider options based on platform capabilities.\n * @param {HTMLInputElement} radio\n * @param {boolean} skipSave - If true, don't save to localStorage (used for auto-select)\n */\nfunction handleMediaPlayerSelect(radio, skipSave = false) {\n    const entityId = radio.dataset.entityId;\n    const state = radio.dataset.state;\n    const platform = radio.dataset.platform;\n    const supportsSpotify = radio.dataset.supportsSpotify === 'true';\n    const supportsAppleMusic = radio.dataset.supportsAppleMusic === 'true';\n    const supportsYoutubeMusic = radio.dataset.supportsYoutubeMusic === 'true';\n    const supportsTidal = radio.dataset.supportsTidal === 'true';\n\n    // Update module state with platform capabilities\n    selectedMediaPlayer = {\n        entityId,\n        state,\n        platform,\n        supportsSpotify,\n        supportsAppleMusic,\n        supportsYoutubeMusic,\n        supportsTidal,\n    };\n\n    // Update visual selection\n    document.querySelectorAll('.media-player-item').forEach(item => {\n        item.classList.remove('is-selected');\n    });\n    const playerItem = radio.closest('.media-player-item');\n    playerItem.classList.add('is-selected');\n\n    // Get player name for summary\n    const playerName = playerItem.querySelector('.player-name')?.textContent?.trim() || entityId;\n    updateMediaPlayerSummary(playerName);\n\n    // Show Music Service section\n    const musicServiceSection = document.getElementById('music-service');\n    if (musicServiceSection) {\n        musicServiceSection.classList.remove('hidden');\n    }\n\n    // Update provider options based on platform capabilities\n    updateProviderOptions(selectedMediaPlayer);\n\n    // Update warning message\n    updateProviderWarning(selectedMediaPlayer);\n\n    // Save to localStorage\n    if (!skipSave) {\n        try {\n            localStorage.setItem(STORAGE_LAST_PLAYER, entityId);\n        } catch (e) {\n            console.warn('Failed to save last player:', e);\n        }\n    }\n\n    updateStartButtonState();\n}\n\n/**\n * Update provider button states based on selected player capabilities\n * @param {Object} player - Selected player with capability flags\n */\nfunction updateProviderOptions(player) {\n    const spotifyBtn = document.querySelector('.chip[data-provider=\"spotify\"]');\n    const appleBtn = document.querySelector('.chip[data-provider=\"apple_music\"]');\n    const youtubeBtn = document.querySelector('.chip[data-provider=\"youtube_music\"]');\n    const tidalBtn = document.querySelector('.chip[data-provider=\"tidal\"]');\n\n    if (spotifyBtn) {\n        spotifyBtn.disabled = !player.supportsSpotify;\n        spotifyBtn.classList.toggle('chip--disabled', !player.supportsSpotify);\n    }\n\n    if (appleBtn) {\n        appleBtn.disabled = !player.supportsAppleMusic;\n        appleBtn.classList.toggle('chip--disabled', !player.supportsAppleMusic);\n    }\n\n    if (youtubeBtn) {\n        youtubeBtn.disabled = !player.supportsYoutubeMusic;\n        youtubeBtn.classList.toggle('chip--disabled', !player.supportsYoutubeMusic);\n    }\n\n    if (tidalBtn) {\n        tidalBtn.disabled = !player.supportsTidal;\n        tidalBtn.classList.toggle('chip--disabled', !player.supportsTidal);\n    }\n\n    // If current selection is now disabled, switch to Spotify\n    if (selectedProvider === 'apple_music' && !player.supportsAppleMusic) {\n        // Update UI\n        document.querySelectorAll('.chip[data-provider]').forEach(c => c.classList.remove('chip--active'));\n        if (spotifyBtn) spotifyBtn.classList.add('chip--active');\n        selectedProvider = 'spotify';\n    }\n\n    if (selectedProvider === 'youtube_music' && !player.supportsYoutubeMusic) {\n        // Update UI\n        document.querySelectorAll('.chip[data-provider]').forEach(c => c.classList.remove('chip--active'));\n        if (spotifyBtn) spotifyBtn.classList.add('chip--active');\n        selectedProvider = 'spotify';\n    }\n\n    if (selectedProvider === 'tidal' && !player.supportsTidal) {\n        // Update UI\n        document.querySelectorAll('.chip[data-provider]').forEach(c => c.classList.remove('chip--active'));\n        if (spotifyBtn) spotifyBtn.classList.add('chip--active');\n        selectedProvider = 'spotify';\n    }\n\n    // Show hint for disabled providers\n    const hint = document.getElementById('provider-hint');\n    if (hint) {\n        const disabledProviders = [];\n        if (!player.supportsAppleMusic) disabledProviders.push('Apple Music');\n        if (!player.supportsYoutubeMusic) disabledProviders.push('YouTube Music');\n        if (!player.supportsTidal) disabledProviders.push('Tidal');\n\n        if (disabledProviders.length > 0) {\n            hint.textContent = `${disabledProviders.join(' and ')} require${disabledProviders.length === 1 ? 's' : ''} Music Assistant speaker`;\n            hint.classList.remove('hidden');\n        } else {\n            hint.classList.add('hidden');\n        }\n    }\n}\n\n/**\n * Update provider warning based on selected speaker platform\n * Shows setup requirements and caveats per platform\n * @param {Object} player - Selected player with platform info\n */\nfunction updateProviderWarning(player) {\n    const warningEl = document.getElementById('provider-warning');\n    if (!warningEl) return;\n\n    const platformInfo = {\n        music_assistant: {\n            warning: 'Premium account must be configured in Music Assistant',\n        },\n        sonos: {\n            warning: 'Spotify must be linked in Sonos app',\n        },\n        alexa_media: {\n            warning: 'Service must be linked in Alexa app',\n            caveat: 'Uses voice search - may occasionally play a different version of the song',\n        },\n        alexa: {\n            warning: 'Service must be linked in Alexa app',\n            caveat: 'Uses voice search - may occasionally play a different version of the song',\n        },\n    };\n\n    const info = platformInfo[player.platform];\n    if (info) {\n        let html = `<p>\u26A0\uFE0F ${utils.escapeHtml(info.warning)}</p>`;\n        if (info.caveat) {\n            html += `<p class=\"warning-caveat\">\u2139\uFE0F ${utils.escapeHtml(info.caveat)}</p>`;\n        }\n        warningEl.innerHTML = html;\n        warningEl.classList.remove('hidden');\n    } else {\n        warningEl.classList.add('hidden');\n    }\n}\n\n/**\n * Render playlists list with checkboxes for valid playlists\n * @param {Array} playlists\n * @param {string} playlistDir\n * @param {boolean} preserveSelection - If true, preserve valid selections (used when provider changes)\n */\nfunction renderPlaylists(playlists, playlistDir, preserveSelection = false) {\n    const container = document.getElementById('playlists-list');\n    // Remove data-i18n to prevent initPageTranslations from overwriting rendered content\n    container?.removeAttribute('data-i18n');\n\n    // Store previous selections before reset (for preserveSelection mode)\n    const previousSelections = preserveSelection ? [...selectedPlaylists] : [];\n\n    // Reset selection state\n    selectedPlaylists = [];\n    playlistData = playlists || [];\n\n    // Render filter bar (Issue #70)\n    renderPlaylistFilterBar(playlistData);\n\n    // Filter playlists based on active filters (Issue #70 - Option B)\n    // Uses AND logic: playlist must match ALL selected category filters\n    let filteredPlaylists = playlistData;\n    if (!activeFilterTags.includes('all') && activeFilterTags.length > 0) {\n        filteredPlaylists = playlistData.filter(p => {\n            const playlistTags = p.tags || [];\n            // Playlist must contain ALL active filter tags (AND logic)\n            return activeFilterTags.every(tag => playlistTags.includes(tag));\n        });\n    }\n\n    // Check if we have any valid playlists\n    const hasValidPlaylists = playlistData.some(p => p.is_valid);\n\n    if (!playlistData || playlistData.length === 0) {\n        // AC2: No playlists error with documentation link\n        const docsLink = playlistDocsUrl\n            ? `<a href=\"${utils.escapeHtml(playlistDocsUrl)}\" target=\"_blank\" rel=\"noopener\">How to create playlists</a>`\n            : '';\n        container.innerHTML = `\n            <div class=\"empty-state\">\n                <p class=\"status-error\">No playlists found. Add playlist JSON files to:</p>\n                <p style=\"font-size: 14px;\"><code>${utils.escapeHtml(playlistDir)}</code></p>\n                ${docsLink ? `<p style=\"margin-top: 12px;\">${docsLink}</p>` : ''}\n            </div>\n        `;\n        // Hide start button when no playlists (Story 9.10)\n        document.getElementById('start-game')?.classList.add('hidden');\n        return;\n    }\n\n    // Show message if filter results in no playlists (Issue #70)\n    if (filteredPlaylists.length === 0) {\n        container.innerHTML = `\n            <div class=\"empty-state\">\n                <p>No playlists match the selected filter.</p>\n                <button type=\"button\" class=\"btn btn-secondary\" onclick=\"clearPlaylistFilters()\">Clear Filters</button>\n            </div>\n        `;\n        return;\n    }\n\n    container.innerHTML = filteredPlaylists.map(playlist => {\n        if (playlist.is_valid) {\n            // AC1: Valid playlists with checkbox\n            const songCount = playlist.song_count || 0;\n            const spotifyCount = playlist.spotify_count || 0;\n            const appleMusicCount = playlist.apple_music_count || 0;\n            const youtubeMusicCount = playlist.youtube_music_count || 0;\n            const tidalCount = playlist.tidal_count || 0;\n\n            // Get provider count based on selected provider\n            let providerCount = songCount;\n            if (selectedProvider === 'spotify') {\n                providerCount = spotifyCount || songCount; // fallback for legacy playlists\n            } else if (selectedProvider === 'apple_music') {\n                providerCount = appleMusicCount;\n            } else if (selectedProvider === 'youtube_music') {\n                providerCount = youtubeMusicCount;\n            } else if (selectedProvider === 'tidal') {\n                providerCount = tidalCount;\n            }\n\n            // Disable playlist if no songs for selected provider\n            const isDisabled = providerCount === 0;\n            const disabledClass = isDisabled ? 'is-disabled' : '';\n            const disabledAttr = isDisabled ? 'disabled' : '';\n\n            // Build coverage indicator\n            let coverageHtml = '';\n            if (providerCount < songCount) {\n                const coverageClass = providerCount === 0\n                    ? 'playlist-coverage playlist-coverage--none'\n                    : 'playlist-coverage playlist-coverage--warning';\n                coverageHtml = `<span class=\"${coverageClass}\">${providerCount}/${songCount}</span>`;\n            }\n\n            return `\n                <div class=\"playlist-item list-item ${isDisabled ? '' : 'is-selectable'} ${disabledClass}\"\n                     data-provider-count=\"${providerCount}\"\n                     data-tags=\"${utils.escapeHtml((playlist.tags || []).join(','))}\">\n                    <label class=\"checkbox-label\">\n                        <input type=\"checkbox\"\n                               class=\"playlist-checkbox\"\n                               data-path=\"${utils.escapeHtml(playlist.path)}\"\n                               data-song-count=\"${utils.escapeHtml(String(songCount))}\"\n                               data-provider-count=\"${providerCount}\"\n                               ${disabledAttr}>\n                        <span class=\"playlist-name\">${utils.escapeHtml(playlist.name)}</span>\n                    </label>\n                    <span class=\"meta\">${coverageHtml || utils.escapeHtml(String(songCount))} songs</span>\n                </div>\n            `;\n        } else {\n            // Invalid playlists: no checkbox, greyed out\n            const errorMsg = (playlist.errors && playlist.errors[0]) || 'Unknown error';\n            return `\n                <div class=\"list-item is-invalid\">\n                    <span class=\"name\">${utils.escapeHtml(playlist.name)}</span>\n                    <span class=\"meta\">Invalid: ${utils.escapeHtml(errorMsg)}</span>\n                </div>\n            `;\n        }\n    }).join('');\n\n    // Attach event listeners to checkboxes (instead of inline handlers)\n    container.querySelectorAll('.playlist-checkbox').forEach(checkbox => {\n        checkbox.addEventListener('change', function() {\n            handlePlaylistToggle(this);\n        });\n    });\n\n    // Make entire row clickable (for hidden input UX)\n    container.querySelectorAll('.playlist-item.is-selectable').forEach(item => {\n        item.addEventListener('click', function(e) {\n            // Don't double-trigger if clicking on the checkbox or within the label\n            // (label clicks already toggle the checkbox via native browser behavior)\n            if (e.target.classList.contains('playlist-checkbox') || e.target.closest('.checkbox-label')) return;\n            const checkbox = item.querySelector('.playlist-checkbox');\n            if (checkbox) {\n                checkbox.checked = !checkbox.checked;\n                handlePlaylistToggle(checkbox);\n            }\n        });\n    });\n\n    // Restore valid selections when preserving (provider change)\n    if (preserveSelection && previousSelections.length > 0) {\n        previousSelections.forEach(prev => {\n            const checkbox = container.querySelector(`.playlist-checkbox[data-path=\"${CSS.escape(prev.path)}\"]`);\n            if (checkbox && !checkbox.disabled) {\n                checkbox.checked = true;\n                const providerCount = parseInt(checkbox.dataset.providerCount, 10) || 0;\n                const item = checkbox.closest('.playlist-item');\n                if (providerCount > 0) {\n                    selectedPlaylists.push({ path: prev.path, songCount: providerCount });\n                    item?.classList.add('is-selected');\n                }\n            }\n        });\n    }\n\n    // Show start button if we have valid playlists (Story 9.10)\n    if (hasValidPlaylists) {\n        document.getElementById('start-game')?.classList.remove('hidden');\n    } else {\n        document.getElementById('start-game')?.classList.add('hidden');\n    }\n\n    // Initialize summary as hidden\n    updateSelectionSummary();\n    updateStartButtonState();\n}\n\n/**\n * Handle playlist checkbox toggle\n * @param {HTMLInputElement} checkbox\n */\nfunction handlePlaylistToggle(checkbox) {\n    const path = checkbox.dataset.path;\n    // Use provider-specific count for selection tracking\n    const providerCount = parseInt(checkbox.dataset.providerCount, 10) || 0;\n    const item = checkbox.closest('.playlist-item');\n\n    if (checkbox.checked) {\n        // Prevent duplicate selections\n        if (!selectedPlaylists.some(p => p.path === path)) {\n            selectedPlaylists.push({ path, songCount: providerCount });\n        }\n        item.classList.add('is-selected');\n    } else {\n        selectedPlaylists = selectedPlaylists.filter(p => p.path !== path);\n        item.classList.remove('is-selected');\n    }\n\n    updateSelectionSummary();\n    updateStartButtonState();\n}\n\n/**\n * Render the playlist filter bar with tag buttons (Issue #70)\n * @param {Array} playlists\n */\n// Tag category definitions for dropdown filters\nconst TAG_CATEGORIES = {\n    decade: {\n        label: 'Decade',\n        tags: ['1970s', '1980s', '1990s', '2000s']\n    },\n    style: {\n        label: 'Style',\n        tags: ['rock', 'pop', 'ballads', 'electronic', 'eurodance', 'yacht-rock', 'soft-rock', 'pop-punk', 'schlager', 'party']\n    },\n    region: {\n        label: 'Region',\n        tags: ['international', 'german', 'dutch']\n    },\n    special: {\n        label: 'Special',\n        tags: ['movies', 'soundtrack', 'eurovision', 'carnival', 'classics']\n    }\n};\n\n// Active filter state per category\nlet activeFilters = {\n    decade: '',\n    style: '',\n    region: '',\n    special: ''\n};\n\nfunction renderPlaylistFilterBar(playlists) {\n    const filterBar = document.getElementById('playlist-filter-bar');\n    if (!filterBar) return;\n\n    // Extract unique tags from all playlists\n    const availableTags = new Set();\n    playlists.forEach(p => {\n        (p.tags || []).forEach(tag => availableTags.add(tag));\n    });\n\n    // If no tags found, hide filter bar\n    if (availableTags.size === 0) {\n        filterBar.classList.add('hidden');\n        return;\n    }\n\n    // Capitalize first letter helper\n    const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);\n\n    // Build dropdown HTML for each category\n    let html = '<div class=\"filter-dropdowns\">';\n    \n    Object.entries(TAG_CATEGORIES).forEach(([categoryKey, category]) => {\n        // Filter to only tags that exist in playlists\n        const categoryTags = category.tags.filter(tag => availableTags.has(tag));\n        \n        if (categoryTags.length === 0) return;\n        \n        const currentValue = activeFilters[categoryKey] || '';\n        \n        html += `\n            <select class=\"filter-dropdown\" data-category=\"${categoryKey}\">\n                <option value=\"\">${category.label}</option>\n                ${categoryTags.map(tag => {\n                    const selected = currentValue === tag ? 'selected' : '';\n                    return `<option value=\"${utils.escapeHtml(tag)}\" ${selected}>${capitalize(tag)}</option>`;\n                }).join('')}\n            </select>\n        `;\n    });\n    \n    html += '</div>';\n\n    // Show active filters summary\n    const activeFiltersList = Object.entries(activeFilters)\n        .filter(([_, value]) => value)\n        .map(([_, value]) => capitalize(value));\n    \n    if (activeFiltersList.length > 0) {\n        html += `\n            <div class=\"filter-summary\">\n                <span class=\"filter-summary-text\">Showing: ${activeFiltersList.join(' \u2022 ')}</span>\n                <button type=\"button\" class=\"filter-clear\" onclick=\"clearPlaylistFilters()\">Clear</button>\n            </div>\n        `;\n    }\n\n    filterBar.innerHTML = html;\n    filterBar.classList.remove('hidden');\n\n    // Attach event listeners to dropdowns\n    filterBar.querySelectorAll('.filter-dropdown').forEach(select => {\n        select.addEventListener('change', function() {\n            handleFilterDropdownChange(this.dataset.category, this.value);\n        });\n    });\n}\n\n/**\n * Handle filter dropdown change (Issue #70 - Option B)\n * @param {string} category - The filter category (decade, style, region, special)\n * @param {string} value - The selected tag value\n */\nfunction handleFilterDropdownChange(category, value) {\n    activeFilters[category] = value;\n    \n    // Update activeFilterTags for compatibility with existing filter logic\n    updateActiveFilterTags();\n    \n    // Re-render playlists with new filter\n    renderPlaylists(playlistData, '', true);\n}\n\n/**\n * Update activeFilterTags array from activeFilters object\n */\nfunction updateActiveFilterTags() {\n    const selectedTags = Object.values(activeFilters).filter(v => v);\n    activeFilterTags = selectedTags.length > 0 ? selectedTags : ['all'];\n}\n\n/**\n * Clear all playlist filters (Issue #70)\n */\nfunction clearPlaylistFilters() {\n    activeFilters = {\n        decade: '',\n        style: '',\n        region: '',\n        special: ''\n    };\n    activeFilterTags = ['all'];\n    renderPlaylists(playlistData, '', true);\n}\n\n// Expose clearPlaylistFilters globally for onclick handler\nwindow.clearPlaylistFilters = clearPlaylistFilters;\n\n/**\n * Calculate total songs from selected playlists\n * @returns {number}\n */\nfunction calculateTotalSongs() {\n    return selectedPlaylists.reduce((sum, p) => sum + p.songCount, 0);\n}\n\n/**\n * Update the selection summary display\n */\nfunction updateSelectionSummary() {\n    const summary = document.getElementById('playlist-summary');\n    const selectedCount = document.getElementById('selected-count');\n    const totalSongs = document.getElementById('total-songs');\n\n    // Null check for DOM elements\n    if (!summary || !selectedCount || !totalSongs) {\n        return;\n    }\n\n    if (selectedPlaylists.length === 0) {\n        summary.classList.add('hidden');\n    } else {\n        summary.classList.remove('hidden');\n        selectedCount.textContent = selectedPlaylists.length;\n        totalSongs.textContent = calculateTotalSongs();\n    }\n}\n\n/**\n * Update start button enabled/disabled state and validation messages\n * Checks for both playlist AND media player selection\n */\nfunction updateStartButtonState() {\n    const btn = document.getElementById('start-game');\n    const playlistMsg = document.getElementById('playlist-validation-msg');\n    const mediaPlayerMsg = document.getElementById('media-player-validation-msg');\n\n    if (!btn) {\n        return;\n    }\n\n    const noPlaylist = selectedPlaylists.length === 0;\n    const noMediaPlayer = selectedMediaPlayer === null;\n\n    // Disable button if either selection is missing\n    btn.disabled = noPlaylist || noMediaPlayer;\n\n    // Show/hide playlist validation message\n    if (playlistMsg) {\n        playlistMsg.classList.toggle('hidden', !noPlaylist);\n    }\n\n    // Show/hide media player validation message\n    if (mediaPlayerMsg) {\n        mediaPlayerMsg.classList.toggle('hidden', !noMediaPlayer);\n    }\n}\n\n// escapeHtml moved to BeatifyUtils\n\n// ==========================================\n// View State Machine (Story 2.3)\n// ==========================================\n\n/**\n * Show setup view (initial state)\n */\nfunction showSetupView() {\n    currentView = 'setup';\n    currentGame = null;\n\n    // Stop lobby polling (Story 16.8)\n    stopLobbyPolling();\n    previousLobbyPlayers = [];\n\n    // Show setup sections\n    setupSections.forEach(id => {\n        const el = document.getElementById(id);\n        if (el) el.classList.remove('hidden');\n    });\n\n    // Show start button if there are valid playlists (Story 9.10)\n    const hasValidPlaylists = playlistData.some(p => p.is_valid);\n    if (hasValidPlaylists) {\n        document.getElementById('start-game')?.classList.remove('hidden');\n    }\n\n    // Hide other views\n    document.getElementById('lobby-section')?.classList.add('hidden');\n    document.getElementById('existing-game-section')?.classList.add('hidden');\n}\n\n/**\n * Show lobby view with QR code\n * @param {Object} gameData - Game data from API\n */\nfunction showLobbyView(gameData) {\n    currentView = 'lobby';\n    currentGame = gameData;\n\n    // Hide setup sections\n    setupSections.forEach(id => {\n        const el = document.getElementById(id);\n        if (el) el.classList.add('hidden');\n    });\n\n    // Hide start button and validation message (Story 9.10)\n    document.getElementById('start-game')?.classList.add('hidden');\n    document.getElementById('playlist-validation-msg')?.classList.add('hidden');\n\n    // Hide existing game view\n    document.getElementById('existing-game-section')?.classList.add('hidden');\n\n    // Show lobby\n    document.getElementById('lobby-section')?.classList.remove('hidden');\n\n    // Generate QR code (only if URL changed) - compact size, CSS scales for desktop\n    const qrContainer = document.getElementById('qr-code');\n    if (qrContainer && gameData.join_url) {\n        if (cachedQRUrl !== gameData.join_url) {\n            qrContainer.innerHTML = '';\n\n            if (typeof QRCode !== 'undefined') {\n                new QRCode(qrContainer, {\n                    text: gameData.join_url,\n                    width: 180,\n                    height: 180,\n                    colorDark: '#000000',\n                    colorLight: '#ffffff',\n                    correctLevel: QRCode.CorrectLevel.M\n                });\n            } else {\n                qrContainer.innerHTML = '<p class=\"status-error\">QR code library not loaded</p>';\n            }\n\n            cachedQRUrl = gameData.join_url;\n        }\n    }\n\n    // Display join URL\n    const urlEl = document.getElementById('join-url');\n    if (urlEl && gameData.join_url) {\n        urlEl.textContent = gameData.join_url;\n    }\n\n    // Update dashboard URL (compact inline link)\n    var dashboardUrl = window.location.origin + '/beatify/dashboard';\n    var dashboardLink = document.getElementById('admin-dashboard-url');\n    if (dashboardLink) {\n        dashboardLink.href = dashboardUrl;\n    }\n\n    // Render initial player list and start polling (Story 16.8)\n    renderLobbyPlayers(gameData.players || []);\n    startLobbyPolling();\n\n    // Update difficulty badge (use gameData.difficulty if available, else selectedDifficulty)\n    updateLobbyDifficultyBadge(gameData.difficulty || selectedDifficulty);\n\n    // Setup QR tap-to-enlarge\n    setupQRModal();\n}\n\n// ==========================================\n// QR Modal Functions (tap to enlarge)\n// ==========================================\n\n/**\n * Open QR modal with enlarged code\n */\nfunction openQRModal() {\n    if (!cachedQRUrl) return;\n\n    var modal = document.getElementById('qr-modal');\n    var modalCode = document.getElementById('qr-modal-code');\n    if (!modal || !modalCode) return;\n\n    // Clear and render larger QR\n    modalCode.innerHTML = '';\n\n    if (typeof QRCode !== 'undefined') {\n        new QRCode(modalCode, {\n            text: cachedQRUrl,\n            width: 280,\n            height: 280,\n            colorDark: '#000000',\n            colorLight: '#ffffff',\n            correctLevel: QRCode.CorrectLevel.M\n        });\n    }\n\n    modal.classList.remove('hidden');\n    document.body.style.overflow = 'hidden';\n\n    // Focus close button for accessibility\n    var closeBtn = document.getElementById('qr-modal-close');\n    if (closeBtn) closeBtn.focus();\n}\n\n/**\n * Close QR modal\n */\nfunction closeQRModal() {\n    var modal = document.getElementById('qr-modal');\n    if (modal) {\n        modal.classList.add('hidden');\n        document.body.style.overflow = '';\n    }\n}\n\n/**\n * Setup QR modal event handlers\n */\nfunction setupQRModal() {\n    var qrContainer = document.getElementById('admin-qr-container');\n    var modal = document.getElementById('qr-modal');\n    var backdrop = modal ? modal.querySelector('.qr-modal-backdrop') : null;\n    var closeBtn = document.getElementById('qr-modal-close');\n\n    // QR container tap to enlarge\n    if (qrContainer) {\n        qrContainer.addEventListener('click', openQRModal);\n        qrContainer.addEventListener('keydown', function(e) {\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                openQRModal();\n            }\n        });\n    }\n\n    if (backdrop) {\n        backdrop.addEventListener('click', closeQRModal);\n    }\n    if (closeBtn) {\n        closeBtn.addEventListener('click', closeQRModal);\n    }\n\n    // Escape key to close\n    document.addEventListener('keydown', function(e) {\n        if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {\n            closeQRModal();\n        }\n    });\n}\n\n/**\n * Show existing game view (for rejoin/end)\n * @param {Object} gameData - Game data from status API\n */\nfunction showExistingGameView(gameData) {\n    currentView = 'existing-game';\n    currentGame = gameData;\n\n    // Hide setup sections\n    setupSections.forEach(id => {\n        const el = document.getElementById(id);\n        if (el) el.classList.add('hidden');\n    });\n\n    // Hide start button and validation message (Story 9.10)\n    document.getElementById('start-game')?.classList.add('hidden');\n    document.getElementById('playlist-validation-msg')?.classList.add('hidden');\n\n    // Hide lobby\n    document.getElementById('lobby-section')?.classList.add('hidden');\n\n    // Show existing game section\n    document.getElementById('existing-game-section')?.classList.remove('hidden');\n\n    // Update game info\n    const idEl = document.getElementById('existing-game-id');\n    const phaseEl = document.getElementById('existing-game-phase');\n    const playersEl = document.getElementById('existing-game-players');\n\n    if (idEl) idEl.textContent = gameData.game_id || 'Unknown';\n    if (phaseEl) phaseEl.textContent = gameData.phase || 'Unknown';\n    if (playersEl) playersEl.textContent = gameData.player_count ?? 0;\n}\n\n// ==========================================\n// Game Control Functions (Story 2.3)\n// ==========================================\n\n/**\n * Start a new game\n */\nasync function startGame() {\n    const btn = document.getElementById('start-game');\n    if (!btn || btn.disabled) return;\n\n    btn.disabled = true;\n    const originalText = btn.textContent;\n    btn.textContent = 'Starting...';\n\n    try {\n        const response = await fetch('/beatify/api/start-game', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                playlists: selectedPlaylists.map(p => p.path),\n                media_player: selectedMediaPlayer?.entityId,\n                language: selectedLanguage,\n                round_duration: selectedDuration,  // Story 13.1\n                difficulty: selectedDifficulty,  // Story 14.1\n                provider: selectedProvider,  // Story 17.2\n                artist_challenge_enabled: artistChallengeEnabled  // Story 20.7\n            })\n        });\n\n        const data = await response.json();\n\n        if (!response.ok) {\n            showError(data.message || 'Failed to start game');\n            return;\n        }\n\n        if (data.warnings && data.warnings.length > 0) {\n            console.warn('Game started with warnings:', data.warnings);\n        }\n\n        showLobbyView(data);\n\n    } catch (err) {\n        showError('Network error. Please try again.');\n        console.error('Start game error:', err);\n    } finally {\n        btn.disabled = false;\n        btn.textContent = originalText;\n        updateStartButtonState();\n    }\n}\n\n/**\n * Show end game confirmation modal (Story 9.10)\n */\nfunction showEndGameModal() {\n    const modal = document.getElementById('end-game-modal');\n    if (modal) {\n        modal.classList.remove('hidden');\n    }\n}\n\n/**\n * Close end game confirmation modal (Story 9.10)\n */\nfunction closeEndGameModal() {\n    const modal = document.getElementById('end-game-modal');\n    if (modal) {\n        modal.classList.add('hidden');\n    }\n}\n\n/**\n * End the current game - shows confirmation modal (Story 9.10)\n */\nfunction endGame() {\n    showEndGameModal();\n}\n\n/**\n * Actually end the game after confirmation\n */\nasync function confirmEndGame() {\n    closeEndGameModal();\n\n    try {\n        const response = await fetch('/beatify/api/end-game', { method: 'POST' });\n        if (response.ok) {\n            cachedQRUrl = null;  // Clear QR cache\n            showSetupView();\n        } else {\n            const data = await response.json();\n            showError(data.message || 'Failed to end game');\n        }\n    } catch (err) {\n        console.error('End game error:', err);\n        showError('Network error. Please try again.');\n    }\n}\n\n/**\n * Setup end game modal event listeners (Story 9.10)\n */\nfunction setupEndGameModal() {\n    const confirmBtn = document.getElementById('end-game-confirm-btn');\n    const cancelBtn = document.getElementById('end-game-cancel-btn');\n    const backdrop = document.querySelector('#end-game-modal .modal-backdrop');\n\n    confirmBtn?.addEventListener('click', confirmEndGame);\n    cancelBtn?.addEventListener('click', closeEndGameModal);\n    backdrop?.addEventListener('click', closeEndGameModal);\n\n    // ESC key handling added to global handler below\n}\n\n/**\n * Rejoin the current game - fetches fresh status first\n */\nasync function rejoinGame() {\n    if (!currentGame) return;\n\n    // Fetch fresh status to get latest player list\n    try {\n        var response = await fetch('/beatify/api/status');\n        if (response.ok) {\n            var status = await response.json();\n            if (status.active_game) {\n                currentGame = status.active_game;\n            }\n        }\n    } catch (err) {\n        console.error('Failed to refresh game status:', err);\n    }\n\n    // Show lobby view with current (possibly refreshed) game data\n    showLobbyView(currentGame);\n}\n\n/**\n * Print QR code\n */\nfunction printQRCode() {\n    window.print();\n}\n\n/**\n * Show error message to user\n * @param {string} message\n */\nfunction showError(message) {\n    // Simple alert for now - can be enhanced with toast notifications\n    alert(message);\n}\n\n// ==========================================\n// Admin Join Functions (Story 3.5)\n// ==========================================\n\n/**\n * Open admin join modal\n */\nfunction openAdminJoinModal() {\n    const modal = document.getElementById('admin-join-modal');\n    if (modal) {\n        modal.classList.remove('hidden');\n        document.getElementById('admin-name-input')?.focus();\n    }\n}\n\n/**\n * Close admin join modal\n */\nfunction closeAdminJoinModal() {\n    const modal = document.getElementById('admin-join-modal');\n    if (modal) {\n        modal.classList.add('hidden');\n    }\n    // Reset form\n    const nameInput = document.getElementById('admin-name-input');\n    const joinBtn = document.getElementById('admin-join-btn');\n    const errorMsg = document.getElementById('admin-name-error');\n    if (nameInput) nameInput.value = '';\n    if (joinBtn) {\n        joinBtn.disabled = true;\n        joinBtn.textContent = 'Join';\n    }\n    if (errorMsg) errorMsg.classList.add('hidden');\n}\n\n/**\n * Setup admin join modal and button handlers\n */\nfunction setupAdminJoin() {\n    const participateBtn = document.getElementById('participate-btn');\n    const cancelBtn = document.getElementById('admin-cancel-btn');\n    const joinBtn = document.getElementById('admin-join-btn');\n    const nameInput = document.getElementById('admin-name-input');\n    const backdrop = document.querySelector('#admin-join-modal .modal-backdrop');\n\n    participateBtn?.addEventListener('click', openAdminJoinModal);\n    cancelBtn?.addEventListener('click', closeAdminJoinModal);\n    backdrop?.addEventListener('click', closeAdminJoinModal);\n\n    nameInput?.addEventListener('input', function() {\n        const name = this.value.trim();\n        joinBtn.disabled = !name || name.length > 20;\n    });\n\n    nameInput?.addEventListener('keypress', function(e) {\n        if (e.key === 'Enter' && !joinBtn.disabled) {\n            handleAdminJoin();\n        }\n    });\n\n    joinBtn?.addEventListener('click', handleAdminJoin);\n\n    // Close modals on Escape (Story 9.10: also handles end-game-modal)\n    document.addEventListener('keydown', function(e) {\n        if (e.key === 'Escape') {\n            const adminModal = document.getElementById('admin-join-modal');\n            const endGameModal = document.getElementById('end-game-modal');\n\n            if (adminModal && !adminModal.classList.contains('hidden')) {\n                closeAdminJoinModal();\n            }\n            if (endGameModal && !endGameModal.classList.contains('hidden')) {\n                closeEndGameModal();\n            }\n        }\n    });\n}\n\n/**\n * Handle admin join button click\n */\nfunction handleAdminJoin() {\n    const nameInput = document.getElementById('admin-name-input');\n    const joinBtn = document.getElementById('admin-join-btn');\n    const name = nameInput?.value.trim();\n\n    if (!name) return;\n\n    joinBtn.disabled = true;\n    joinBtn.textContent = 'Joining...';\n\n    try {\n        // Store admin name for player page\n        sessionStorage.setItem('beatify_admin_name', name);\n        sessionStorage.setItem('beatify_is_admin', 'true');\n\n        // Redirect to player page with game ID\n        const gameId = currentGame?.game_id;\n        if (gameId) {\n            window.location.href = '/beatify/play?game=' + encodeURIComponent(gameId);\n        } else {\n            showError('No active game found');\n            joinBtn.disabled = false;\n            joinBtn.textContent = 'Join';\n        }\n    } catch (err) {\n        console.error('Admin join failed:', err);\n        joinBtn.disabled = false;\n        joinBtn.textContent = 'Join';\n    }\n}\n\n/**\n * Setup language selector buttons (Story 12.4)\n */\nfunction setupLanguageSelector() {\n    var langButtons = document.querySelectorAll('.lang-btn');\n\n    langButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            var lang = btn.getAttribute('data-lang');\n            if (lang && lang !== selectedLanguage) {\n                setLanguage(lang);\n            }\n        });\n    });\n}\n\n/**\n * Update language button states (Story 12.4)\n * @param {string} lang - Language code ('en', 'de', or 'es')\n */\nfunction updateLanguageButtons(lang) {\n    var langButtons = document.querySelectorAll('.lang-btn');\n    langButtons.forEach(function(btn) {\n        var btnLang = btn.getAttribute('data-lang');\n        if (btnLang === lang) {\n            btn.classList.add('lang-btn--active');\n        } else {\n            btn.classList.remove('lang-btn--active');\n        }\n    });\n}\n\n/**\n * Set language and update UI (Story 12.4, 16.3)\n * @param {string} lang - Language code ('en', 'de', or 'es')\n */\nasync function setLanguage(lang) {\n    if (lang !== 'en' && lang !== 'de' && lang !== 'es') {\n        lang = 'en';\n    }\n\n    selectedLanguage = lang;\n    updateLanguageButtons(lang);\n\n    // Update i18n and re-render page\n    await BeatifyI18n.setLanguage(lang);\n    BeatifyI18n.initPageTranslations();\n}\n\n// ==========================================\n// Timer Selector Functions (Story 13.1)\n// ==========================================\n\n/**\n * Setup timer selector buttons\n */\nfunction setupTimerSelector() {\n    var timerButtons = document.querySelectorAll('.timer-btn');\n\n    timerButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            var duration = parseInt(btn.getAttribute('data-duration'), 10);\n            if (duration && duration !== selectedDuration) {\n                setTimerDuration(duration);\n            }\n        });\n    });\n}\n\n/**\n * Update timer button states\n * @param {number} duration - Duration in seconds (15, 30, or 45)\n */\nfunction updateTimerButtons(duration) {\n    var timerButtons = document.querySelectorAll('.timer-btn');\n    timerButtons.forEach(function(btn) {\n        var btnDuration = parseInt(btn.getAttribute('data-duration'), 10);\n        if (btnDuration === duration) {\n            btn.classList.add('timer-btn--active');\n        } else {\n            btn.classList.remove('timer-btn--active');\n        }\n    });\n}\n\n/**\n * Set timer duration\n * @param {number} duration - Duration in seconds (10-60 range)\n */\nfunction setTimerDuration(duration) {\n    // Validate duration is within valid range (matches backend: 10-60)\n    if (typeof duration !== 'number' || duration < 10 || duration > 60) {\n        duration = 30;\n    }\n\n    selectedDuration = duration;\n    updateTimerButtons(duration);\n}\n\n// ==========================================\n// Difficulty Selector Functions (Story 14.1)\n// ==========================================\n\n// Mapping of difficulty levels to their description i18n keys\nconst difficultyDescriptions = {\n    easy: 'admin.difficultyEasyDesc',\n    normal: 'admin.difficultyNormalDesc',\n    hard: 'admin.difficultyHardDesc'\n};\n\n/**\n * Setup difficulty selector buttons\n */\nfunction setupDifficultySelector() {\n    var difficultyButtons = document.querySelectorAll('.difficulty-btn');\n\n    difficultyButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            var difficulty = btn.getAttribute('data-difficulty');\n            if (difficulty && difficulty !== selectedDifficulty) {\n                setDifficulty(difficulty);\n            }\n        });\n    });\n}\n\n/**\n * Update difficulty button states\n * @param {string} difficulty - Difficulty level ('easy', 'normal', or 'hard')\n */\nfunction updateDifficultyButtons(difficulty) {\n    var difficultyButtons = document.querySelectorAll('.difficulty-btn');\n    difficultyButtons.forEach(function(btn) {\n        var btnDifficulty = btn.getAttribute('data-difficulty');\n        if (btnDifficulty === difficulty) {\n            btn.classList.add('difficulty-btn--active');\n        } else {\n            btn.classList.remove('difficulty-btn--active');\n        }\n    });\n}\n\n/**\n * Set difficulty level and update UI\n * @param {string} difficulty - Difficulty level ('easy', 'normal', or 'hard')\n */\nfunction setDifficulty(difficulty) {\n    // Validate difficulty\n    var validDifficulties = ['easy', 'normal', 'hard'];\n    if (validDifficulties.indexOf(difficulty) === -1) {\n        difficulty = 'normal';\n    }\n\n    selectedDifficulty = difficulty;\n    updateDifficultyButtons(difficulty);\n\n    // Update description text\n    var descriptionEl = document.getElementById('difficulty-description');\n    if (descriptionEl) {\n        var descKey = difficultyDescriptions[difficulty];\n        descriptionEl.setAttribute('data-i18n', descKey);\n        // Use i18n translation if available\n        if (typeof BeatifyI18n !== 'undefined' && BeatifyI18n.t) {\n            descriptionEl.textContent = BeatifyI18n.t(descKey);\n        }\n    }\n}\n\n/**\n * Update difficulty badge in lobby view\n * @param {string} difficulty - Difficulty level ('easy', 'normal', or 'hard')\n */\nfunction updateLobbyDifficultyBadge(difficulty) {\n    var badge = document.getElementById('lobby-difficulty-badge');\n    if (!badge) return;\n\n    var labelKey = {\n        easy: 'game.difficultyEasy',\n        normal: 'game.difficultyNormal',\n        hard: 'game.difficultyHard'\n    }[difficulty] || 'game.difficultyNormal';\n\n    var label = utils.t(labelKey);\n    badge.textContent = label;\n    badge.className = 'difficulty-badge difficulty-badge--' + (difficulty || 'normal');\n}\n\n// ==========================================\n// Artist Challenge Toggle Functions (Story 20.7)\n// ==========================================\n\n/**\n * Setup artist challenge toggle\n */\nfunction setupArtistChallengeToggle() {\n    var toggle = document.getElementById('artist-challenge-toggle');\n    if (!toggle) return;\n\n    // Load saved preference\n    var saved = localStorage.getItem('beatify_artist_challenge');\n    if (saved !== null) {\n        artistChallengeEnabled = saved === 'true';\n        toggle.checked = artistChallengeEnabled;\n    }\n\n    toggle.addEventListener('change', function() {\n        artistChallengeEnabled = toggle.checked;\n        // Save preference\n        localStorage.setItem('beatify_artist_challenge', artistChallengeEnabled.toString());\n    });\n}\n\n// ==========================================\n// Provider Selector Functions (Story 17.2)\n// ==========================================\n\n/**\n * Setup provider selector buttons\n */\nfunction setupProviderSelector() {\n    var providerButtons = document.querySelectorAll('.provider-btn');\n\n    providerButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            // Don't allow clicking disabled buttons\n            if (btn.classList.contains('provider-btn--disabled')) {\n                return;\n            }\n            var provider = btn.getAttribute('data-provider');\n            if (provider && provider !== selectedProvider) {\n                setProvider(provider);\n            }\n        });\n    });\n}\n\n/**\n * Update provider button states\n * @param {string} provider - Provider identifier ('spotify' or 'apple_music')\n */\nfunction updateProviderButtons(provider) {\n    var providerButtons = document.querySelectorAll('.provider-btn');\n    providerButtons.forEach(function(btn) {\n        var btnProvider = btn.getAttribute('data-provider');\n        if (btnProvider === provider) {\n            btn.classList.add('provider-btn--active');\n        } else {\n            btn.classList.remove('provider-btn--active');\n        }\n    });\n}\n\n/**\n * Set music provider and update UI\n * @param {string} provider - Provider identifier (only 'spotify' supported, Story 17.6)\n */\nfunction setProvider(provider) {\n    // Only Spotify is supported (Story 17.6: Apple Music removed)\n    selectedProvider = 'spotify';\n    updateProviderButtons('spotify');\n\n    // Re-render playlists to show coverage for selected provider\n    if (playlistData.length > 0) {\n        renderPlaylists(playlistData, '');\n    }\n}\n\n// ==========================================\n// Lobby Player List Functions (Story 16.8)\n// ==========================================\n\n// t() moved to BeatifyUtils\n\n/**\n * Render player list in admin lobby (analytics grid layout)\n * @param {Array} players - Array of player objects from game state\n */\nfunction renderLobbyPlayers(players) {\n    var listEl = document.getElementById('lobby-players');\n    var countEl = document.getElementById('lobby-player-count');\n    var summaryEl = document.getElementById('admin-players-summary');\n    var emptyEl = document.getElementById('lobby-players-empty');\n    if (!listEl) return;\n\n    players = players || [];\n\n    // Update player count (stat card value - just the number)\n    if (countEl) {\n        countEl.textContent = players.length;\n    }\n\n    // Update players section summary badge\n    if (summaryEl) {\n        summaryEl.textContent = players.length;\n    }\n\n    // Handle empty state visibility\n    if (players.length === 0) {\n        listEl.innerHTML = '';\n        if (emptyEl) emptyEl.classList.remove('hidden');\n        previousLobbyPlayers = [];\n        return;\n    }\n\n    // Hide empty state when we have players\n    if (emptyEl) emptyEl.classList.add('hidden');\n\n    // Sort: connected first, disconnected last\n    var sortedPlayers = players.slice().sort(function(a, b) {\n        if (a.connected !== b.connected) {\n            return a.connected ? -1 : 1;\n        }\n        return 0;\n    });\n\n    // Find new players by comparing with previous list\n    var previousNames = previousLobbyPlayers.map(function(p) { return p.name; });\n    var newNames = sortedPlayers\n        .filter(function(p) { return previousNames.indexOf(p.name) === -1; })\n        .map(function(p) { return p.name; });\n\n    // Render player cards (grid layout)\n    listEl.innerHTML = sortedPlayers.map(function(player) {\n        var isNew = newNames.indexOf(player.name) !== -1;\n        var isDisconnected = player.connected === false;\n        var isAdmin = player.is_admin === true;\n        var classes = [\n            'player-card',\n            isNew ? 'is-new' : '',\n            isDisconnected ? 'player-card--disconnected' : ''\n        ].filter(Boolean).join(' ');\n\n        // Crown badge for admin\n        var adminBadge = isAdmin ? '<span class=\"admin-badge\">\uD83D\uDC51</span>' : '';\n        // Badge for disconnected players\n        var awayBadge = isDisconnected ? '<span class=\"away-badge\">' + utils.t('lobby.away', 'away') + '</span>' : '';\n\n        return '<div class=\"' + classes + '\" data-player=\"' + utils.escapeHtml(player.name) + '\">' +\n            '<span class=\"player-name\">' +\n                utils.escapeHtml(player.name) +\n                adminBadge +\n            '</span>' +\n            awayBadge +\n        '</div>';\n    }).join('');\n\n    // Remove .is-new class after animation\n    setTimeout(function() {\n        var newCards = listEl.querySelectorAll('.is-new');\n        for (var i = 0; i < newCards.length; i++) {\n            newCards[i].classList.remove('is-new');\n        }\n    }, 2000);\n\n    previousLobbyPlayers = players.slice();\n}\n\n/**\n * Start polling for lobby state updates\n */\nfunction startLobbyPolling() {\n    // Clear any existing interval\n    stopLobbyPolling();\n\n    // Poll every 3 seconds (balanced between responsiveness and server load)\n    lobbyPollingInterval = setInterval(async function() {\n        if (currentView !== 'lobby') {\n            stopLobbyPolling();\n            return;\n        }\n\n        try {\n            var response = await fetch('/beatify/api/status');\n            if (!response.ok) return;\n\n            var status = await response.json();\n            if (status.active_game && status.active_game.players) {\n                renderLobbyPlayers(status.active_game.players);\n            }\n        } catch (err) {\n            console.error('Lobby polling error:', err);\n        }\n    }, 3000);\n}\n\n/**\n * Stop polling for lobby state updates\n */\nfunction stopLobbyPolling() {\n    if (lobbyPollingInterval) {\n        clearInterval(lobbyPollingInterval);\n        lobbyPollingInterval = null;\n    }\n}\n\n// ============================================\n// Playlist Requests (Story 44)\n// ============================================\n\n/**\n * Setup event handlers for playlist request modal\n */\nfunction setupPlaylistRequests() {\n    const requestModal = document.getElementById('request-modal');\n    const successModal = document.getElementById('request-success-modal');\n    const urlInput = document.getElementById('spotify-url-input');\n    const urlError = document.getElementById('spotify-url-error');\n    const submitBtn = document.getElementById('request-submit-btn');\n\n    // Open request modal from button\n    document.getElementById('request-playlist-btn')?.addEventListener('click', () => {\n        if (requestModal) {\n            requestModal.classList.remove('hidden');\n            urlInput?.focus();\n        }\n    });\n\n    // Close request modal\n    document.getElementById('request-cancel-btn')?.addEventListener('click', () => {\n        closeRequestModal();\n    });\n\n    // Close on backdrop click\n    requestModal?.querySelector('.modal-backdrop')?.addEventListener('click', () => {\n        closeRequestModal();\n    });\n\n    // URL input validation\n    urlInput?.addEventListener('input', () => {\n        const url = urlInput.value.trim();\n        const isValid = window.PlaylistRequests?.isValidSpotifyUrl(url);\n\n        if (url && !isValid) {\n            urlInput.classList.add('input-error');\n            urlError?.classList.remove('hidden');\n        } else {\n            urlInput.classList.remove('input-error');\n            urlError?.classList.add('hidden');\n        }\n\n        if (submitBtn) {\n            submitBtn.disabled = !isValid;\n        }\n    });\n\n    // Submit request\n    submitBtn?.addEventListener('click', async () => {\n        const url = urlInput?.value.trim();\n        if (!url || !window.PlaylistRequests?.isValidSpotifyUrl(url)) return;\n\n        // Show loading state\n        submitBtn.classList.add('btn--loading');\n        submitBtn.disabled = true;\n\n        try {\n            const result = await window.PlaylistRequests.submitRequest(url);\n\n            // Close request modal\n            closeRequestModal();\n\n            // Show success modal\n            const successName = document.getElementById('request-success-name');\n            if (successName) {\n                successName.textContent = result.playlist_name;\n            }\n            successModal?.classList.remove('hidden');\n\n            // Refresh the requests list\n            await renderRequestsList();\n\n        } catch (error) {\n            console.error('Failed to submit request:', error);\n            urlInput?.classList.add('input-error');\n            if (urlError) {\n                urlError.textContent = error.message || 'Failed to submit request';\n                urlError.classList.remove('hidden');\n            }\n        } finally {\n            submitBtn.classList.remove('btn--loading');\n            // Re-enable based on input validity\n            const isValid = window.PlaylistRequests?.isValidSpotifyUrl(urlInput?.value.trim() || '');\n            submitBtn.disabled = !isValid;\n        }\n    });\n\n    // Close success modal\n    document.getElementById('request-success-close-btn')?.addEventListener('click', () => {\n        successModal?.classList.add('hidden');\n    });\n\n    successModal?.querySelector('.modal-backdrop')?.addEventListener('click', () => {\n        successModal?.classList.add('hidden');\n    });\n\n    function closeRequestModal() {\n        requestModal?.classList.add('hidden');\n        if (urlInput) {\n            urlInput.value = '';\n            urlInput.classList.remove('input-error');\n        }\n        urlError?.classList.add('hidden');\n        if (submitBtn) {\n            submitBtn.disabled = true;\n            submitBtn.classList.remove('btn--loading');\n        }\n    }\n}\n\n/**\n * Initialize playlist requests display and polling\n */\nasync function initPlaylistRequests() {\n    // Render existing requests (loads from backend)\n    await renderRequestsList();\n\n    // Poll for status updates (Story 44.4)\n    if (window.PlaylistRequests) {\n        try {\n            const changed = await window.PlaylistRequests.pollStatuses();\n            if (changed) {\n                await renderRequestsList();\n            }\n        } catch (e) {\n            console.error('Failed to poll request statuses:', e);\n        }\n    }\n}\n\n/**\n * Render the list of playlist requests\n */\nasync function renderRequestsList() {\n    const section = document.getElementById('my-requests');\n    const listContainer = document.getElementById('my-requests-list');\n    const emptyState = document.getElementById('my-requests-empty');\n    const summary = document.getElementById('my-requests-summary');\n\n    if (!window.PlaylistRequests) {\n        section?.classList.add('hidden');\n        return;\n    }\n\n    // Always show section so users can request playlists\n    section?.classList.remove('hidden');\n\n    // Load requests from backend (async)\n    const requests = await window.PlaylistRequests.getRequestsForDisplayAsync();\n\n    // Update summary badge\n    if (summary) {\n        summary.textContent = requests.length.toString();\n    }\n\n    // Render list or empty state\n    if (requests.length === 0) {\n        listContainer.innerHTML = '';\n        emptyState?.classList.remove('hidden');\n    } else {\n        emptyState?.classList.add('hidden');\n        listContainer.innerHTML = requests.map(request => {\n            const statusClass = `request-status--${request.status}`;\n            const statusLabels = {\n                pending: '\u23F3 Pending',\n                ready: '\u2705 Ready',\n                installed: '\u2713 Installed',\n                declined: '\u274C Declined'\n            };\n            const statusLabel = statusLabels[request.status] || request.status;\n\n            const thumbnail = request.thumbnail_url\n                ? `<img class=\"request-item-thumbnail\" src=\"${request.thumbnail_url}\" alt=\"\">`\n                : `<div class=\"request-item-thumbnail-placeholder\">\uD83C\uDFB5</div>`;\n\n            let actionButton = '';\n            if (request.status === 'ready' && request.update_available) {\n                actionButton = `<a href=\"https://github.com/mholzi/beatify/releases\" target=\"_blank\"\n                    class=\"btn btn-primary request-update-btn\">Update to v${request.release_version}</a>`;\n            }\n\n            return `\n                <div class=\"request-item\">\n                    ${thumbnail}\n                    <div class=\"request-item-info\">\n                        <div class=\"request-item-name\">${escapeHtml(request.playlist_name)}</div>\n                        <div class=\"request-item-meta\">${request.relative_time}</div>\n                    </div>\n                    <span class=\"request-status ${statusClass}\">${statusLabel}</span>\n                    ${actionButton}\n                </div>\n            `;\n        }).join('');\n    }\n}\n\n/**\n * Escape HTML to prevent XSS\n */\nfunction escapeHtml(text) {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// ============================================\n// Service Worker Registration (Story 18.5)\n// ============================================\n\n/**\n * Register service worker for asset caching\n */\nif ('serviceWorker' in navigator) {\n    window.addEventListener('load', function() {\n        navigator.serviceWorker.register('/beatify/static/sw.js', {\n            scope: '/beatify/'\n        }).then(function(registration) {\n            console.log('[Admin] SW registered:', registration.scope);\n        }).catch(function(error) {\n            console.warn('[Admin] SW registration failed:', error);\n        });\n    });\n}\n"],
  "mappings": "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",
  "names": ["require_admin", "__commonJSMin", "exports", "selectedPlaylists", "playlistData", "playlistDocsUrl", "activeFilterTags", "selectedMediaPlayer", "mediaPlayerDocsUrl", "currentView", "currentGame", "cachedQRUrl", "selectedLanguage", "selectedDuration", "selectedDifficulty", "selectedProvider", "hasMusicAssistant", "artistChallengeEnabled", "previousLobbyPlayers", "lobbyPollingInterval", "STORAGE_LAST_PLAYER", "STORAGE_GAME_SETTINGS", "setupSections", "PLATFORM_LABELS", "utils", "__async", "_a", "_b", "_c", "_d", "_e", "_f", "c", "startGame", "printQRCode", "rejoinGame", "endGame", "setupAdminJoin", "setupEndGameModal", "setupCollapsibleSections", "setupGameSettings", "setupPlaylistRequests", "loadSavedSettings", "loadStatus", "initPlaylistRequests", "response", "status", "versionEl", "renderMediaPlayers", "renderPlaylists", "updateStartButtonState", "showExistingGameView", "showSetupView", "error", "container", "section", "header", "chip", "lang", "updateGameSettingsSummary", "saveGameSettings", "duration", "difficulty", "provider", "saved", "settings", "toggle", "summary", "difficultyLabels", "langLabels", "artistIcon", "updateMediaPlayerSummary", "playerName", "players", "totalPlayers", "availablePlayers", "p", "validationMsg", "startBtn", "docsLink", "player", "renderPlayerItem", "attachPlayerSelectionHandlers", "lastPlayerId", "lastPlayerRadio", "handleMediaPlayerSelect", "info", "platformBadge", "radio", "item", "e", "skipSave", "entityId", "state", "platform", "supportsSpotify", "supportsAppleMusic", "supportsYoutubeMusic", "supportsTidal", "playerItem", "musicServiceSection", "updateProviderOptions", "updateProviderWarning", "spotifyBtn", "appleBtn", "youtubeBtn", "tidalBtn", "hint", "disabledProviders", "warningEl", "html", "playlists", "playlistDir", "preserveSelection", "previousSelections", "renderPlaylistFilterBar", "filteredPlaylists", "playlistTags", "tag", "hasValidPlaylists", "playlist", "songCount", "spotifyCount", "appleMusicCount", "youtubeMusicCount", "tidalCount", "providerCount", "isDisabled", "disabledClass", "disabledAttr", "coverageHtml", "errorMsg", "checkbox", "handlePlaylistToggle", "prev", "updateSelectionSummary", "path", "TAG_CATEGORIES", "activeFilters", "filterBar", "availableTags", "capitalize", "str", "categoryKey", "category", "categoryTags", "currentValue", "selected", "activeFiltersList", "_", "value", "select", "handleFilterDropdownChange", "updateActiveFilterTags", "selectedTags", "v", "clearPlaylistFilters", "calculateTotalSongs", "sum", "selectedCount", "totalSongs", "btn", "playlistMsg", "mediaPlayerMsg", "noPlaylist", "noMediaPlayer", "stopLobbyPolling", "id", "el", "showLobbyView", "gameData", "qrContainer", "urlEl", "dashboardUrl", "dashboardLink", "renderLobbyPlayers", "startLobbyPolling", "updateLobbyDifficultyBadge", "setupQRModal", "openQRModal", "modal", "modalCode", "closeBtn", "closeQRModal", "backdrop", "idEl", "phaseEl", "playersEl", "originalText", "data", "showError", "err", "showEndGameModal", "closeEndGameModal", "confirmEndGame", "confirmBtn", "cancelBtn", "message", "openAdminJoinModal", "closeAdminJoinModal", "nameInput", "joinBtn", "participateBtn", "name", "handleAdminJoin", "adminModal", "endGameModal", "gameId", "badge", "labelKey", "label", "listEl", "countEl", "summaryEl", "emptyEl", "sortedPlayers", "a", "b", "previousNames", "newNames", "isNew", "isDisconnected", "isAdmin", "classes", "adminBadge", "awayBadge", "newCards", "i", "requestModal", "successModal", "urlInput", "urlError", "submitBtn", "closeRequestModal", "url", "isValid", "result", "successName", "renderRequestsList", "listContainer", "emptyState", "requests", "request", "statusClass", "statusLabel", "thumbnail", "actionButton", "escapeHtml", "text", "div", "registration"]
}

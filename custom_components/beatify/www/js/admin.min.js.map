{
  "version": 3,
  "sources": ["admin.js"],
  "sourcesContent": ["/**\n * Beatify Admin Page\n * Vanilla JS - no frameworks\n */\n\n// Module-level state\nlet selectedPlaylists = [];\nlet playlistData = [];\nlet playlistDocsUrl = '';\nlet selectedMediaPlayer = null;  // { entityId: string, state: string } or null\nlet mediaPlayerDocsUrl = '';\n\n// View state management (Story 2.3)\nlet currentView = 'setup';\nlet currentGame = null;\nlet cachedQRUrl = null;\n\n// Language state (Story 12.4)\nlet selectedLanguage = 'en';\n\n// Timer state (Story 13.1)\nlet selectedDuration = 45;\n\n// Difficulty state (Story 14.1)\nlet selectedDifficulty = 'normal';\n\n// Provider state (Story 17.2)\nlet selectedProvider = 'spotify';\nlet hasMusicAssistant = false;\n\n// Artist Challenge state (Story 20.7)\nlet artistChallengeEnabled = true;\n\n// Lobby state (Story 16.8)\nlet previousLobbyPlayers = [];\nlet lobbyPollingInterval = null;\n\n// LocalStorage keys\nconst STORAGE_LAST_PLAYER = 'beatify_last_player';\nconst STORAGE_GAME_SETTINGS = 'beatify_game_settings';\n\n// Setup sections to hide/show as a group\nconst setupSections = ['media-players', 'playlists', 'game-settings', 'admin-actions'];\n\n// Platform display labels for speaker grouping\nconst PLATFORM_LABELS = {\n    music_assistant: { icon: '\uD83C\uDFB5', label: 'Music Assistant', recommended: true },\n    sonos: { icon: '\uD83D\uDD0A', label: 'Sonos' },\n    alexa_media: { icon: '\uD83D\uDCE2', label: 'Alexa' },\n    alexa: { icon: '\uD83D\uDCE2', label: 'Alexa' },\n};\n\n// Alias BeatifyUtils for convenience\nconst utils = window.BeatifyUtils || {};\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n    // Initialize i18n based on browser language (Story 12.4)\n    // Guard clause: wait for BeatifyI18n in case fallback script is loading\n    const i18nAvailable = await utils.waitForI18n();\n    if (!i18nAvailable) {\n        console.error('[Beatify] BeatifyI18n module failed to load - UI will use fallback text');\n    } else {\n        await BeatifyI18n.init();\n        BeatifyI18n.initPageTranslations();\n        selectedLanguage = BeatifyI18n.getLanguage();\n    }\n    // Set initial language chip active state\n    document.querySelectorAll('.chip[data-lang]').forEach(c => {\n        c.classList.toggle('chip--active', c.dataset.lang === selectedLanguage);\n    });\n\n    // Wire event listeners\n    document.getElementById('start-game')?.addEventListener('click', startGame);\n    document.getElementById('print-qr')?.addEventListener('click', printQRCode);\n    document.getElementById('rejoin-game')?.addEventListener('click', rejoinGame);\n\n    // Dashboard URL is now set in showLobbyView() for analytics layout\n    document.getElementById('end-game')?.addEventListener('click', endGame);\n    document.getElementById('end-game-lobby')?.addEventListener('click', endGame);\n    document.getElementById('end-game-existing')?.addEventListener('click', endGame);\n\n    // Admin join setup\n    setupAdminJoin();\n\n    // End game modal setup (Story 9.10)\n    setupEndGameModal();\n\n    // Collapsible sections setup\n    setupCollapsibleSections();\n\n    // Game settings setup (language, timer, difficulty, artist challenge)\n    setupGameSettings();\n\n    // Load saved game settings from localStorage\n    await loadSavedSettings();\n\n    await loadStatus();\n});\n\n/**\n * Fetch and render current status from the API\n */\nasync function loadStatus() {\n    try {\n        const response = await fetch('/beatify/api/status');\n\n        if (!response.ok) {\n            throw new Error(`HTTP ${response.status}`);\n        }\n\n        const status = await response.json();\n\n        playlistDocsUrl = status.playlist_docs_url || '';\n        mediaPlayerDocsUrl = status.media_player_docs_url || '';\n        // Set Music Assistant availability from backend (not based on entity names)\n        hasMusicAssistant = status.has_music_assistant === true;\n        // Display version in footer\n        const versionEl = document.getElementById('app-version');\n        if (versionEl && status.version) {\n            versionEl.textContent = 'v' + status.version;\n        }\n        renderMediaPlayers(status.media_players);\n        renderPlaylists(status.playlists, status.playlist_dir);\n        updateStartButtonState();\n\n        // Check for active game and show appropriate view\n        if (status.active_game) {\n            showExistingGameView(status.active_game);\n        } else {\n            showSetupView();\n        }\n    } catch (error) {\n        console.error('Failed to load status:', error);\n        const container = document.getElementById('media-players-list');\n        if (container) {\n            container.innerHTML = '<span class=\"status-error\">Failed to load status</span>';\n        }\n    }\n}\n\n/**\n * Setup collapsible section toggles\n */\nfunction setupCollapsibleSections() {\n    // Media players toggle\n    document.getElementById('media-players-toggle')?.addEventListener('click', function() {\n        const section = document.getElementById('media-players');\n        if (section) {\n            section.classList.toggle('collapsed');\n            this.setAttribute('aria-expanded', !section.classList.contains('collapsed'));\n        }\n    });\n\n    // Game settings toggle\n    document.getElementById('game-settings-toggle')?.addEventListener('click', function() {\n        const section = document.getElementById('game-settings');\n        if (section) {\n            section.classList.toggle('collapsed');\n            this.setAttribute('aria-expanded', !section.classList.contains('collapsed'));\n        }\n    });\n\n    // Lobby section toggles (new compact layout)\n    document.querySelectorAll('.lobby-container--compact .section-header-collapsible').forEach(function(header) {\n        header.addEventListener('click', function() {\n            const section = header.closest('.section-collapsible');\n            if (section) {\n                section.classList.toggle('collapsed');\n                header.setAttribute('aria-expanded', !section.classList.contains('collapsed'));\n            }\n        });\n    });\n}\n\n/**\n * Setup game settings controls (chips for language, timer, difficulty, toggle for artist challenge)\n */\nfunction setupGameSettings() {\n    // Language chips\n    document.querySelectorAll('.chip[data-lang]').forEach(chip => {\n        chip.addEventListener('click', async function() {\n            const lang = this.dataset.lang;\n            document.querySelectorAll('.chip[data-lang]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedLanguage = lang;\n            if (window.BeatifyI18n) {\n                await BeatifyI18n.setLanguage(lang);\n                BeatifyI18n.initPageTranslations();\n            }\n            updateGameSettingsSummary();\n            saveGameSettings();\n        });\n    });\n\n    // Timer chips\n    document.querySelectorAll('.chip[data-duration]').forEach(chip => {\n        chip.addEventListener('click', function() {\n            const duration = parseInt(this.dataset.duration, 10);\n            document.querySelectorAll('.chip[data-duration]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedDuration = duration;\n            updateGameSettingsSummary();\n            saveGameSettings();\n        });\n    });\n\n    // Difficulty chips\n    document.querySelectorAll('.chip[data-difficulty]').forEach(chip => {\n        chip.addEventListener('click', function() {\n            const difficulty = this.dataset.difficulty;\n            document.querySelectorAll('.chip[data-difficulty]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedDifficulty = difficulty;\n            updateGameSettingsSummary();\n            saveGameSettings();\n        });\n    });\n\n    // Artist Challenge toggle\n    document.getElementById('artist-challenge-toggle')?.addEventListener('change', function() {\n        artistChallengeEnabled = this.checked;\n        updateGameSettingsSummary();\n        saveGameSettings();\n    });\n\n    // Provider chips (Music Service)\n    document.querySelectorAll('.chip[data-provider]').forEach(chip => {\n        chip.addEventListener('click', function() {\n            // Don't allow clicking disabled chips\n            if (this.disabled || this.classList.contains('provider-btn--disabled')) {\n                return;\n            }\n            const provider = this.dataset.provider;\n            document.querySelectorAll('.chip[data-provider]').forEach(c => c.classList.remove('chip--active'));\n            this.classList.add('chip--active');\n            selectedProvider = provider;\n            updateGameSettingsSummary();\n            saveGameSettings();\n        });\n    });\n}\n\n/**\n * Load saved settings from localStorage\n */\nasync function loadSavedSettings() {\n    try {\n        const saved = localStorage.getItem(STORAGE_GAME_SETTINGS);\n        if (saved) {\n            const settings = JSON.parse(saved);\n\n            // Apply language\n            if (settings.language) {\n                selectedLanguage = settings.language;\n                document.querySelectorAll('.chip[data-lang]').forEach(c => {\n                    c.classList.toggle('chip--active', c.dataset.lang === settings.language);\n                });\n                if (window.BeatifyI18n) {\n                    await BeatifyI18n.setLanguage(settings.language);\n                    // Note: initPageTranslations called by DOMContentLoaded after loadSavedSettings\n                }\n            }\n\n            // Apply timer\n            if (settings.duration) {\n                selectedDuration = settings.duration;\n                document.querySelectorAll('.chip[data-duration]').forEach(c => {\n                    c.classList.toggle('chip--active', parseInt(c.dataset.duration, 10) === settings.duration);\n                });\n            }\n\n            // Apply difficulty\n            if (settings.difficulty) {\n                selectedDifficulty = settings.difficulty;\n                document.querySelectorAll('.chip[data-difficulty]').forEach(c => {\n                    c.classList.toggle('chip--active', c.dataset.difficulty === settings.difficulty);\n                });\n            }\n\n            // Apply artist challenge\n            if (typeof settings.artistChallenge === 'boolean') {\n                artistChallengeEnabled = settings.artistChallenge;\n                const toggle = document.getElementById('artist-challenge-toggle');\n                if (toggle) toggle.checked = settings.artistChallenge;\n            }\n\n            // Apply provider\n            if (settings.provider) {\n                selectedProvider = settings.provider;\n                document.querySelectorAll('.chip[data-provider]').forEach(c => {\n                    c.classList.toggle('chip--active', c.dataset.provider === settings.provider);\n                });\n            }\n        }\n    } catch (e) {\n        console.warn('Failed to load saved settings:', e);\n    }\n    // Always update summary (uses current state values)\n    updateGameSettingsSummary();\n}\n\n/**\n * Save game settings to localStorage\n */\nfunction saveGameSettings() {\n    try {\n        const settings = {\n            language: selectedLanguage,\n            duration: selectedDuration,\n            difficulty: selectedDifficulty,\n            artistChallenge: artistChallengeEnabled,\n            provider: selectedProvider\n        };\n        localStorage.setItem(STORAGE_GAME_SETTINGS, JSON.stringify(settings));\n    } catch (e) {\n        console.warn('Failed to save settings:', e);\n    }\n}\n\n/**\n * Update the game settings summary badge\n */\nfunction updateGameSettingsSummary() {\n    const summary = document.getElementById('game-settings-summary');\n    if (!summary) return;\n\n    const difficultyLabels = { easy: 'Easy', normal: 'Normal', hard: 'Hard' };\n    const langLabels = { en: 'EN', de: 'DE', es: 'ES' };\n    const artistIcon = artistChallengeEnabled ? ' \u2022 \uD83C\uDFA4' : '';\n\n    summary.textContent = `${difficultyLabels[selectedDifficulty] || 'Normal'} \u2022 ${selectedDuration}s \u2022 ${langLabels[selectedLanguage] || 'EN'}${artistIcon}`;\n}\n\n/**\n * Update media player summary badge\n * @param {string} playerName - Friendly name of selected player\n */\nfunction updateMediaPlayerSummary(playerName) {\n    const summary = document.getElementById('media-player-summary');\n    if (summary) {\n        summary.textContent = playerName || 'Select...';\n    }\n}\n\n/**\n * Group players by platform for organized display\n * @param {Array} players\n * @returns {Object} Grouped players by platform\n */\nfunction groupPlayersByPlatform(players) {\n    const groups = {};\n    players.forEach(player => {\n        const platform = player.platform || 'unknown';\n        if (!groups[platform]) {\n            groups[platform] = [];\n        }\n        groups[platform].push(player);\n    });\n    return groups;\n}\n\n/**\n * Render media players list grouped by platform with capability info\n * Filters out unavailable players\n * @param {Array} players\n */\nfunction renderMediaPlayers(players) {\n    const container = document.getElementById('media-players-list');\n    // Remove data-i18n to prevent initPageTranslations from overwriting rendered content\n    container?.removeAttribute('data-i18n');\n    const totalPlayers = players ? players.length : 0;\n\n    // Reset selection state\n    selectedMediaPlayer = null;\n\n    // Filter out unavailable players\n    const availablePlayers = (players || []).filter(p => p.state !== 'unavailable');\n\n    // Hide validation message when showing empty states (avoid redundant messaging)\n    const validationMsg = document.getElementById('media-player-validation-msg');\n\n    if (totalPlayers === 0) {\n        // No compatible players found - show setup message with MA link\n        container.innerHTML = `\n            <div class=\"no-players-message\">\n                <h3>\uD83C\uDFB5 No Compatible Players Found</h3>\n                <p>Beatify works with Music Assistant, Sonos, and Alexa players.</p>\n                <p><strong>Recommended:</strong> Install Music Assistant for the best experience with any speaker.</p>\n                <div class=\"button-group\">\n                    <a href=\"https://music-assistant.io/getting-started/\"\n                       target=\"_blank\" class=\"btn btn-secondary\">\n                        \uD83D\uDCD6 Music Assistant Setup Guide\n                    </a>\n                    <button onclick=\"loadStatus()\" class=\"btn btn-primary\">\n                        \uD83D\uDD04 Refresh\n                    </button>\n                </div>\n            </div>\n        `;\n        if (validationMsg) {\n            validationMsg.classList.add('hidden');\n        }\n        // Disable start button when no players\n        const startBtn = document.getElementById('start-game');\n        if (startBtn) startBtn.disabled = true;\n        return;\n    }\n\n    if (availablePlayers.length === 0) {\n        // Players exist but all unavailable\n        const docsLink = mediaPlayerDocsUrl\n            ? `<a href=\"${utils.escapeHtml(mediaPlayerDocsUrl)}\" target=\"_blank\" rel=\"noopener\">Troubleshooting</a>`\n            : '';\n        container.innerHTML = `\n            <div class=\"empty-state\">\n                <p class=\"status-error\">All media players are unavailable. Check your devices are powered on.</p>\n                ${docsLink ? `<p style=\"margin-top: 12px;\">${docsLink}</p>` : ''}\n            </div>\n        `;\n        if (validationMsg) {\n            validationMsg.classList.add('hidden');\n        }\n        return;\n    }\n\n    // Group players by platform\n    const grouped = groupPlayersByPlatform(availablePlayers);\n\n    // Render grouped players\n    let html = '';\n    for (const [platform, platformPlayers] of Object.entries(grouped)) {\n        const info = PLATFORM_LABELS[platform] || { icon: '\uD83D\uDD08', label: platform };\n        const recommended = info.recommended ? ' <span class=\"badge-recommended\">Recommended</span>' : '';\n\n        html += `\n            <div class=\"player-group\">\n                <h4 class=\"player-group-header\">${info.icon} ${info.label}${recommended}</h4>\n                ${platformPlayers.map(player => renderPlayerItem(player)).join('')}\n            </div>\n        `;\n    }\n\n    container.innerHTML = html;\n    attachPlayerSelectionHandlers();\n\n    // Try to auto-select last used player from localStorage\n    const lastPlayerId = localStorage.getItem(STORAGE_LAST_PLAYER);\n    if (lastPlayerId) {\n        const lastPlayerRadio = container.querySelector(`[data-entity-id=\"${lastPlayerId}\"]`);\n        if (lastPlayerRadio) {\n            lastPlayerRadio.checked = true;\n            handleMediaPlayerSelect(lastPlayerRadio, true); // true = skip localStorage save\n            // Collapse section since we have a valid selection\n            const section = document.getElementById('media-players');\n            if (section) {\n                section.classList.add('collapsed');\n                const toggle = document.getElementById('media-players-toggle');\n                if (toggle) toggle.setAttribute('aria-expanded', 'false');\n            }\n        }\n    }\n}\n\n/**\n * Render a single player item with capability data attributes\n * @param {Object} player - Player object from backend\n * @returns {string} HTML string\n */\nfunction renderPlayerItem(player) {\n    const caveat = player.caveat ? `<div class=\"player-caveat\">${utils.escapeHtml(player.caveat)}</div>` : '';\n\n    return `\n        <div class=\"media-player-item list-item is-selectable\"\n             data-entity-id=\"${utils.escapeHtml(player.entity_id)}\"\n             data-platform=\"${utils.escapeHtml(player.platform)}\"\n             data-supports-spotify=\"${player.supports_spotify}\"\n             data-supports-apple-music=\"${player.supports_apple_music}\">\n            <label class=\"radio-label\">\n                <input type=\"radio\"\n                       class=\"media-player-radio\"\n                       name=\"media-player\"\n                       data-entity-id=\"${utils.escapeHtml(player.entity_id)}\"\n                       data-state=\"${utils.escapeHtml(player.state)}\"\n                       data-platform=\"${utils.escapeHtml(player.platform)}\"\n                       data-supports-spotify=\"${player.supports_spotify}\"\n                       data-supports-apple-music=\"${player.supports_apple_music}\">\n                <span class=\"player-name\">${utils.escapeHtml(player.friendly_name)}</span>\n            </label>\n            <span class=\"meta\">\n                <span class=\"state-dot state-${utils.escapeHtml(player.state)}\"></span>\n                ${utils.escapeHtml(player.state)}\n            </span>\n            ${caveat}\n        </div>\n    `;\n}\n\n/**\n * Attach event handlers to player selection elements\n */\nfunction attachPlayerSelectionHandlers() {\n    const container = document.getElementById('media-players-list');\n    if (!container) return;\n\n    // Attach event listeners to radio buttons\n    container.querySelectorAll('.media-player-radio').forEach(radio => {\n        radio.addEventListener('change', function() {\n            handleMediaPlayerSelect(this);\n        });\n    });\n\n    // Make entire row clickable (for hidden input UX)\n    container.querySelectorAll('.media-player-item').forEach(item => {\n        item.addEventListener('click', function(e) {\n            // Don't double-trigger if clicking on the radio or within the label\n            if (e.target.classList.contains('media-player-radio') || e.target.closest('.radio-label')) return;\n            const radio = item.querySelector('.media-player-radio');\n            if (radio && !radio.checked) {\n                radio.checked = true;\n                handleMediaPlayerSelect(radio);\n            }\n        });\n    });\n}\n\n/**\n * Handle media player radio button selection (AC4)\n * Updates provider options based on platform capabilities.\n * @param {HTMLInputElement} radio\n * @param {boolean} skipSave - If true, don't save to localStorage (used for auto-select)\n */\nfunction handleMediaPlayerSelect(radio, skipSave = false) {\n    const entityId = radio.dataset.entityId;\n    const state = radio.dataset.state;\n    const platform = radio.dataset.platform;\n    const supportsSpotify = radio.dataset.supportsSpotify === 'true';\n    const supportsAppleMusic = radio.dataset.supportsAppleMusic === 'true';\n\n    // Update module state with platform capabilities\n    selectedMediaPlayer = {\n        entityId,\n        state,\n        platform,\n        supportsSpotify,\n        supportsAppleMusic,\n    };\n\n    // Update visual selection\n    document.querySelectorAll('.media-player-item').forEach(item => {\n        item.classList.remove('is-selected');\n    });\n    const playerItem = radio.closest('.media-player-item');\n    playerItem.classList.add('is-selected');\n\n    // Get player name for summary\n    const playerName = playerItem.querySelector('.player-name')?.textContent?.trim() || entityId;\n    updateMediaPlayerSummary(playerName);\n\n    // Update provider options based on platform capabilities\n    updateProviderOptions(selectedMediaPlayer);\n\n    // Update warning message\n    updateProviderWarning(selectedMediaPlayer);\n\n    // Save to localStorage\n    if (!skipSave) {\n        try {\n            localStorage.setItem(STORAGE_LAST_PLAYER, entityId);\n        } catch (e) {\n            console.warn('Failed to save last player:', e);\n        }\n    }\n\n    updateStartButtonState();\n}\n\n/**\n * Update provider button states based on selected player capabilities\n * @param {Object} player - Selected player with capability flags\n */\nfunction updateProviderOptions(player) {\n    const spotifyBtn = document.querySelector('.chip[data-provider=\"spotify\"]');\n    const appleBtn = document.querySelector('.chip[data-provider=\"apple_music\"]');\n\n    if (spotifyBtn) {\n        spotifyBtn.disabled = !player.supportsSpotify;\n        spotifyBtn.classList.toggle('chip--disabled', !player.supportsSpotify);\n    }\n\n    if (appleBtn) {\n        appleBtn.disabled = !player.supportsAppleMusic;\n        appleBtn.classList.toggle('chip--disabled', !player.supportsAppleMusic);\n    }\n\n    // If current selection is now disabled, switch to Spotify\n    if (selectedProvider === 'apple_music' && !player.supportsAppleMusic) {\n        // Update UI\n        document.querySelectorAll('.chip[data-provider]').forEach(c => c.classList.remove('chip--active'));\n        if (spotifyBtn) spotifyBtn.classList.add('chip--active');\n        selectedProvider = 'spotify';\n    }\n\n    // Show hint for disabled Apple Music\n    const hint = document.getElementById('provider-hint');\n    if (hint) {\n        if (!player.supportsAppleMusic) {\n            hint.textContent = 'Apple Music requires Music Assistant speaker';\n            hint.classList.remove('hidden');\n        } else {\n            hint.classList.add('hidden');\n        }\n    }\n}\n\n/**\n * Update provider warning based on selected speaker platform\n * @param {Object} player - Selected player with platform info\n */\nfunction updateProviderWarning(player) {\n    const warningEl = document.getElementById('provider-warning');\n    if (!warningEl) return;\n\n    const platformWarnings = {\n        music_assistant: 'Premium account must be configured in Music Assistant',\n        sonos: 'Spotify must be linked in Sonos app',\n        alexa_media: 'Service must be linked in Alexa app',\n        alexa: 'Service must be linked in Alexa app',\n    };\n\n    const warning = platformWarnings[player.platform];\n    if (warning) {\n        warningEl.innerHTML = `<p>\u26A0\uFE0F ${utils.escapeHtml(warning)}</p>`;\n        warningEl.classList.remove('hidden');\n    } else {\n        warningEl.classList.add('hidden');\n    }\n}\n\n/**\n * Render playlists list with checkboxes for valid playlists\n * @param {Array} playlists\n * @param {string} playlistDir\n */\nfunction renderPlaylists(playlists, playlistDir) {\n    const container = document.getElementById('playlists-list');\n    // Remove data-i18n to prevent initPageTranslations from overwriting rendered content\n    container?.removeAttribute('data-i18n');\n\n    // Reset selection state\n    selectedPlaylists = [];\n    playlistData = playlists || [];\n\n    // Check if we have any valid playlists\n    const hasValidPlaylists = playlistData.some(p => p.is_valid);\n\n    if (!playlists || playlists.length === 0) {\n        // AC2: No playlists error with documentation link\n        const docsLink = playlistDocsUrl\n            ? `<a href=\"${utils.escapeHtml(playlistDocsUrl)}\" target=\"_blank\" rel=\"noopener\">How to create playlists</a>`\n            : '';\n        container.innerHTML = `\n            <div class=\"empty-state\">\n                <p class=\"status-error\">No playlists found. Add playlist JSON files to:</p>\n                <p style=\"font-size: 14px;\"><code>${utils.escapeHtml(playlistDir)}</code></p>\n                ${docsLink ? `<p style=\"margin-top: 12px;\">${docsLink}</p>` : ''}\n            </div>\n        `;\n        // Hide start button when no playlists (Story 9.10)\n        document.getElementById('start-game')?.classList.add('hidden');\n        return;\n    }\n\n    container.innerHTML = playlists.map(playlist => {\n        if (playlist.is_valid) {\n            // AC1: Valid playlists with checkbox\n            const songCount = playlist.song_count || 0;\n            // Provider count - Spotify only (Story 17.6)\n            const providerCount = playlist.spotify_count || songCount;\n\n            // Build coverage indicator\n            let coverageHtml = '';\n            if (providerCount < songCount) {\n                const coverageClass = providerCount === 0\n                    ? 'playlist-coverage playlist-coverage--none'\n                    : 'playlist-coverage playlist-coverage--warning';\n                coverageHtml = `<span class=\"${coverageClass}\">${providerCount}/${songCount}</span>`;\n            }\n\n            return `\n                <div class=\"playlist-item list-item is-selectable\">\n                    <label class=\"checkbox-label\">\n                        <input type=\"checkbox\"\n                               class=\"playlist-checkbox\"\n                               data-path=\"${utils.escapeHtml(playlist.path)}\"\n                               data-song-count=\"${utils.escapeHtml(String(songCount))}\">\n                        <span class=\"playlist-name\">${utils.escapeHtml(playlist.name)}</span>\n                    </label>\n                    <span class=\"meta\">${coverageHtml || utils.escapeHtml(String(songCount))} songs</span>\n                </div>\n            `;\n        } else {\n            // Invalid playlists: no checkbox, greyed out\n            const errorMsg = (playlist.errors && playlist.errors[0]) || 'Unknown error';\n            return `\n                <div class=\"list-item is-invalid\">\n                    <span class=\"name\">${utils.escapeHtml(playlist.name)}</span>\n                    <span class=\"meta\">Invalid: ${utils.escapeHtml(errorMsg)}</span>\n                </div>\n            `;\n        }\n    }).join('');\n\n    // Attach event listeners to checkboxes (instead of inline handlers)\n    container.querySelectorAll('.playlist-checkbox').forEach(checkbox => {\n        checkbox.addEventListener('change', function() {\n            handlePlaylistToggle(this);\n        });\n    });\n\n    // Make entire row clickable (for hidden input UX)\n    container.querySelectorAll('.playlist-item.is-selectable').forEach(item => {\n        item.addEventListener('click', function(e) {\n            // Don't double-trigger if clicking on the checkbox or within the label\n            // (label clicks already toggle the checkbox via native browser behavior)\n            if (e.target.classList.contains('playlist-checkbox') || e.target.closest('.checkbox-label')) return;\n            const checkbox = item.querySelector('.playlist-checkbox');\n            if (checkbox) {\n                checkbox.checked = !checkbox.checked;\n                handlePlaylistToggle(checkbox);\n            }\n        });\n    });\n\n    // Show start button if we have valid playlists (Story 9.10)\n    if (hasValidPlaylists) {\n        document.getElementById('start-game')?.classList.remove('hidden');\n    } else {\n        document.getElementById('start-game')?.classList.add('hidden');\n    }\n\n    // Initialize summary as hidden\n    updateSelectionSummary();\n}\n\n/**\n * Handle playlist checkbox toggle\n * @param {HTMLInputElement} checkbox\n */\nfunction handlePlaylistToggle(checkbox) {\n    const path = checkbox.dataset.path;\n    const songCount = parseInt(checkbox.dataset.songCount, 10) || 0;\n    const item = checkbox.closest('.playlist-item');\n\n    if (checkbox.checked) {\n        // Prevent duplicate selections\n        if (!selectedPlaylists.some(p => p.path === path)) {\n            selectedPlaylists.push({ path, songCount });\n        }\n        item.classList.add('is-selected');\n    } else {\n        selectedPlaylists = selectedPlaylists.filter(p => p.path !== path);\n        item.classList.remove('is-selected');\n    }\n\n    updateSelectionSummary();\n    updateStartButtonState();\n}\n\n/**\n * Calculate total songs from selected playlists\n * @returns {number}\n */\nfunction calculateTotalSongs() {\n    return selectedPlaylists.reduce((sum, p) => sum + p.songCount, 0);\n}\n\n/**\n * Update the selection summary display\n */\nfunction updateSelectionSummary() {\n    const summary = document.getElementById('playlist-summary');\n    const selectedCount = document.getElementById('selected-count');\n    const totalSongs = document.getElementById('total-songs');\n\n    // Null check for DOM elements\n    if (!summary || !selectedCount || !totalSongs) {\n        return;\n    }\n\n    if (selectedPlaylists.length === 0) {\n        summary.classList.add('hidden');\n    } else {\n        summary.classList.remove('hidden');\n        selectedCount.textContent = selectedPlaylists.length;\n        totalSongs.textContent = calculateTotalSongs();\n    }\n}\n\n/**\n * Update start button enabled/disabled state and validation messages\n * Checks for both playlist AND media player selection\n */\nfunction updateStartButtonState() {\n    const btn = document.getElementById('start-game');\n    const playlistMsg = document.getElementById('playlist-validation-msg');\n    const mediaPlayerMsg = document.getElementById('media-player-validation-msg');\n\n    if (!btn) {\n        return;\n    }\n\n    const noPlaylist = selectedPlaylists.length === 0;\n    const noMediaPlayer = selectedMediaPlayer === null;\n\n    // Disable button if either selection is missing\n    btn.disabled = noPlaylist || noMediaPlayer;\n\n    // Show/hide playlist validation message\n    if (playlistMsg) {\n        playlistMsg.classList.toggle('hidden', !noPlaylist);\n    }\n\n    // Show/hide media player validation message\n    if (mediaPlayerMsg) {\n        mediaPlayerMsg.classList.toggle('hidden', !noMediaPlayer);\n    }\n}\n\n// escapeHtml moved to BeatifyUtils\n\n// ==========================================\n// View State Machine (Story 2.3)\n// ==========================================\n\n/**\n * Show setup view (initial state)\n */\nfunction showSetupView() {\n    currentView = 'setup';\n    currentGame = null;\n\n    // Stop lobby polling (Story 16.8)\n    stopLobbyPolling();\n    previousLobbyPlayers = [];\n\n    // Show setup sections\n    setupSections.forEach(id => {\n        const el = document.getElementById(id);\n        if (el) el.classList.remove('hidden');\n    });\n\n    // Show start button if there are valid playlists (Story 9.10)\n    const hasValidPlaylists = playlistData.some(p => p.is_valid);\n    if (hasValidPlaylists) {\n        document.getElementById('start-game')?.classList.remove('hidden');\n    }\n\n    // Hide other views\n    document.getElementById('lobby-section')?.classList.add('hidden');\n    document.getElementById('existing-game-section')?.classList.add('hidden');\n}\n\n/**\n * Show lobby view with QR code\n * @param {Object} gameData - Game data from API\n */\nfunction showLobbyView(gameData) {\n    currentView = 'lobby';\n    currentGame = gameData;\n\n    // Hide setup sections\n    setupSections.forEach(id => {\n        const el = document.getElementById(id);\n        if (el) el.classList.add('hidden');\n    });\n\n    // Hide start button and validation message (Story 9.10)\n    document.getElementById('start-game')?.classList.add('hidden');\n    document.getElementById('playlist-validation-msg')?.classList.add('hidden');\n\n    // Hide existing game view\n    document.getElementById('existing-game-section')?.classList.add('hidden');\n\n    // Show lobby\n    document.getElementById('lobby-section')?.classList.remove('hidden');\n\n    // Generate QR code (only if URL changed) - compact size, CSS scales for desktop\n    const qrContainer = document.getElementById('qr-code');\n    if (qrContainer && gameData.join_url) {\n        if (cachedQRUrl !== gameData.join_url) {\n            qrContainer.innerHTML = '';\n\n            if (typeof QRCode !== 'undefined') {\n                new QRCode(qrContainer, {\n                    text: gameData.join_url,\n                    width: 180,\n                    height: 180,\n                    colorDark: '#000000',\n                    colorLight: '#ffffff',\n                    correctLevel: QRCode.CorrectLevel.M\n                });\n            } else {\n                qrContainer.innerHTML = '<p class=\"status-error\">QR code library not loaded</p>';\n            }\n\n            cachedQRUrl = gameData.join_url;\n        }\n    }\n\n    // Display join URL\n    const urlEl = document.getElementById('join-url');\n    if (urlEl && gameData.join_url) {\n        urlEl.textContent = gameData.join_url;\n    }\n\n    // Update dashboard URL (compact inline link)\n    var dashboardUrl = window.location.origin + '/beatify/dashboard';\n    var dashboardLink = document.getElementById('admin-dashboard-url');\n    if (dashboardLink) {\n        dashboardLink.href = dashboardUrl;\n    }\n\n    // Render initial player list and start polling (Story 16.8)\n    renderLobbyPlayers(gameData.players || []);\n    startLobbyPolling();\n\n    // Update difficulty badge (use gameData.difficulty if available, else selectedDifficulty)\n    updateLobbyDifficultyBadge(gameData.difficulty || selectedDifficulty);\n\n    // Setup QR tap-to-enlarge\n    setupQRModal();\n}\n\n// ==========================================\n// QR Modal Functions (tap to enlarge)\n// ==========================================\n\n/**\n * Open QR modal with enlarged code\n */\nfunction openQRModal() {\n    if (!cachedQRUrl) return;\n\n    var modal = document.getElementById('qr-modal');\n    var modalCode = document.getElementById('qr-modal-code');\n    if (!modal || !modalCode) return;\n\n    // Clear and render larger QR\n    modalCode.innerHTML = '';\n\n    if (typeof QRCode !== 'undefined') {\n        new QRCode(modalCode, {\n            text: cachedQRUrl,\n            width: 280,\n            height: 280,\n            colorDark: '#000000',\n            colorLight: '#ffffff',\n            correctLevel: QRCode.CorrectLevel.M\n        });\n    }\n\n    modal.classList.remove('hidden');\n    document.body.style.overflow = 'hidden';\n\n    // Focus close button for accessibility\n    var closeBtn = document.getElementById('qr-modal-close');\n    if (closeBtn) closeBtn.focus();\n}\n\n/**\n * Close QR modal\n */\nfunction closeQRModal() {\n    var modal = document.getElementById('qr-modal');\n    if (modal) {\n        modal.classList.add('hidden');\n        document.body.style.overflow = '';\n    }\n}\n\n/**\n * Setup QR modal event handlers\n */\nfunction setupQRModal() {\n    var qrContainer = document.getElementById('admin-qr-container');\n    var modal = document.getElementById('qr-modal');\n    var backdrop = modal ? modal.querySelector('.qr-modal-backdrop') : null;\n    var closeBtn = document.getElementById('qr-modal-close');\n\n    // QR container tap to enlarge\n    if (qrContainer) {\n        qrContainer.addEventListener('click', openQRModal);\n        qrContainer.addEventListener('keydown', function(e) {\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                openQRModal();\n            }\n        });\n    }\n\n    if (backdrop) {\n        backdrop.addEventListener('click', closeQRModal);\n    }\n    if (closeBtn) {\n        closeBtn.addEventListener('click', closeQRModal);\n    }\n\n    // Escape key to close\n    document.addEventListener('keydown', function(e) {\n        if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {\n            closeQRModal();\n        }\n    });\n}\n\n/**\n * Show existing game view (for rejoin/end)\n * @param {Object} gameData - Game data from status API\n */\nfunction showExistingGameView(gameData) {\n    currentView = 'existing-game';\n    currentGame = gameData;\n\n    // Hide setup sections\n    setupSections.forEach(id => {\n        const el = document.getElementById(id);\n        if (el) el.classList.add('hidden');\n    });\n\n    // Hide start button and validation message (Story 9.10)\n    document.getElementById('start-game')?.classList.add('hidden');\n    document.getElementById('playlist-validation-msg')?.classList.add('hidden');\n\n    // Hide lobby\n    document.getElementById('lobby-section')?.classList.add('hidden');\n\n    // Show existing game section\n    document.getElementById('existing-game-section')?.classList.remove('hidden');\n\n    // Update game info\n    const idEl = document.getElementById('existing-game-id');\n    const phaseEl = document.getElementById('existing-game-phase');\n    const playersEl = document.getElementById('existing-game-players');\n\n    if (idEl) idEl.textContent = gameData.game_id || 'Unknown';\n    if (phaseEl) phaseEl.textContent = gameData.phase || 'Unknown';\n    if (playersEl) playersEl.textContent = gameData.player_count ?? 0;\n}\n\n// ==========================================\n// Game Control Functions (Story 2.3)\n// ==========================================\n\n/**\n * Start a new game\n */\nasync function startGame() {\n    const btn = document.getElementById('start-game');\n    if (!btn || btn.disabled) return;\n\n    btn.disabled = true;\n    const originalText = btn.textContent;\n    btn.textContent = 'Starting...';\n\n    try {\n        const response = await fetch('/beatify/api/start-game', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                playlists: selectedPlaylists.map(p => p.path),\n                media_player: selectedMediaPlayer?.entityId,\n                language: selectedLanguage,\n                round_duration: selectedDuration,  // Story 13.1\n                difficulty: selectedDifficulty,  // Story 14.1\n                provider: selectedProvider,  // Story 17.2\n                artist_challenge_enabled: artistChallengeEnabled  // Story 20.7\n            })\n        });\n\n        const data = await response.json();\n\n        if (!response.ok) {\n            showError(data.message || 'Failed to start game');\n            return;\n        }\n\n        if (data.warnings && data.warnings.length > 0) {\n            console.warn('Game started with warnings:', data.warnings);\n        }\n\n        showLobbyView(data);\n\n    } catch (err) {\n        showError('Network error. Please try again.');\n        console.error('Start game error:', err);\n    } finally {\n        btn.disabled = false;\n        btn.textContent = originalText;\n        updateStartButtonState();\n    }\n}\n\n/**\n * Show end game confirmation modal (Story 9.10)\n */\nfunction showEndGameModal() {\n    const modal = document.getElementById('end-game-modal');\n    if (modal) {\n        modal.classList.remove('hidden');\n    }\n}\n\n/**\n * Close end game confirmation modal (Story 9.10)\n */\nfunction closeEndGameModal() {\n    const modal = document.getElementById('end-game-modal');\n    if (modal) {\n        modal.classList.add('hidden');\n    }\n}\n\n/**\n * End the current game - shows confirmation modal (Story 9.10)\n */\nfunction endGame() {\n    showEndGameModal();\n}\n\n/**\n * Actually end the game after confirmation\n */\nasync function confirmEndGame() {\n    closeEndGameModal();\n\n    try {\n        const response = await fetch('/beatify/api/end-game', { method: 'POST' });\n        if (response.ok) {\n            cachedQRUrl = null;  // Clear QR cache\n            showSetupView();\n        } else {\n            const data = await response.json();\n            showError(data.message || 'Failed to end game');\n        }\n    } catch (err) {\n        console.error('End game error:', err);\n        showError('Network error. Please try again.');\n    }\n}\n\n/**\n * Setup end game modal event listeners (Story 9.10)\n */\nfunction setupEndGameModal() {\n    const confirmBtn = document.getElementById('end-game-confirm-btn');\n    const cancelBtn = document.getElementById('end-game-cancel-btn');\n    const backdrop = document.querySelector('#end-game-modal .modal-backdrop');\n\n    confirmBtn?.addEventListener('click', confirmEndGame);\n    cancelBtn?.addEventListener('click', closeEndGameModal);\n    backdrop?.addEventListener('click', closeEndGameModal);\n\n    // ESC key handling added to global handler below\n}\n\n/**\n * Rejoin the current game - fetches fresh status first\n */\nasync function rejoinGame() {\n    if (!currentGame) return;\n\n    // Fetch fresh status to get latest player list\n    try {\n        var response = await fetch('/beatify/api/status');\n        if (response.ok) {\n            var status = await response.json();\n            if (status.active_game) {\n                currentGame = status.active_game;\n            }\n        }\n    } catch (err) {\n        console.error('Failed to refresh game status:', err);\n    }\n\n    // Show lobby view with current (possibly refreshed) game data\n    showLobbyView(currentGame);\n}\n\n/**\n * Print QR code\n */\nfunction printQRCode() {\n    window.print();\n}\n\n/**\n * Show error message to user\n * @param {string} message\n */\nfunction showError(message) {\n    // Simple alert for now - can be enhanced with toast notifications\n    alert(message);\n}\n\n// ==========================================\n// Admin Join Functions (Story 3.5)\n// ==========================================\n\n/**\n * Open admin join modal\n */\nfunction openAdminJoinModal() {\n    const modal = document.getElementById('admin-join-modal');\n    if (modal) {\n        modal.classList.remove('hidden');\n        document.getElementById('admin-name-input')?.focus();\n    }\n}\n\n/**\n * Close admin join modal\n */\nfunction closeAdminJoinModal() {\n    const modal = document.getElementById('admin-join-modal');\n    if (modal) {\n        modal.classList.add('hidden');\n    }\n    // Reset form\n    const nameInput = document.getElementById('admin-name-input');\n    const joinBtn = document.getElementById('admin-join-btn');\n    const errorMsg = document.getElementById('admin-name-error');\n    if (nameInput) nameInput.value = '';\n    if (joinBtn) {\n        joinBtn.disabled = true;\n        joinBtn.textContent = 'Join';\n    }\n    if (errorMsg) errorMsg.classList.add('hidden');\n}\n\n/**\n * Setup admin join modal and button handlers\n */\nfunction setupAdminJoin() {\n    const participateBtn = document.getElementById('participate-btn');\n    const cancelBtn = document.getElementById('admin-cancel-btn');\n    const joinBtn = document.getElementById('admin-join-btn');\n    const nameInput = document.getElementById('admin-name-input');\n    const backdrop = document.querySelector('#admin-join-modal .modal-backdrop');\n\n    participateBtn?.addEventListener('click', openAdminJoinModal);\n    cancelBtn?.addEventListener('click', closeAdminJoinModal);\n    backdrop?.addEventListener('click', closeAdminJoinModal);\n\n    nameInput?.addEventListener('input', function() {\n        const name = this.value.trim();\n        joinBtn.disabled = !name || name.length > 20;\n    });\n\n    nameInput?.addEventListener('keypress', function(e) {\n        if (e.key === 'Enter' && !joinBtn.disabled) {\n            handleAdminJoin();\n        }\n    });\n\n    joinBtn?.addEventListener('click', handleAdminJoin);\n\n    // Close modals on Escape (Story 9.10: also handles end-game-modal)\n    document.addEventListener('keydown', function(e) {\n        if (e.key === 'Escape') {\n            const adminModal = document.getElementById('admin-join-modal');\n            const endGameModal = document.getElementById('end-game-modal');\n\n            if (adminModal && !adminModal.classList.contains('hidden')) {\n                closeAdminJoinModal();\n            }\n            if (endGameModal && !endGameModal.classList.contains('hidden')) {\n                closeEndGameModal();\n            }\n        }\n    });\n}\n\n/**\n * Handle admin join button click\n */\nfunction handleAdminJoin() {\n    const nameInput = document.getElementById('admin-name-input');\n    const joinBtn = document.getElementById('admin-join-btn');\n    const name = nameInput?.value.trim();\n\n    if (!name) return;\n\n    joinBtn.disabled = true;\n    joinBtn.textContent = 'Joining...';\n\n    try {\n        // Store admin name for player page\n        sessionStorage.setItem('beatify_admin_name', name);\n        sessionStorage.setItem('beatify_is_admin', 'true');\n\n        // Redirect to player page with game ID\n        const gameId = currentGame?.game_id;\n        if (gameId) {\n            window.location.href = '/beatify/play?game=' + encodeURIComponent(gameId);\n        } else {\n            showError('No active game found');\n            joinBtn.disabled = false;\n            joinBtn.textContent = 'Join';\n        }\n    } catch (err) {\n        console.error('Admin join failed:', err);\n        joinBtn.disabled = false;\n        joinBtn.textContent = 'Join';\n    }\n}\n\n/**\n * Setup language selector buttons (Story 12.4)\n */\nfunction setupLanguageSelector() {\n    var langButtons = document.querySelectorAll('.lang-btn');\n\n    langButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            var lang = btn.getAttribute('data-lang');\n            if (lang && lang !== selectedLanguage) {\n                setLanguage(lang);\n            }\n        });\n    });\n}\n\n/**\n * Update language button states (Story 12.4)\n * @param {string} lang - Language code ('en', 'de', or 'es')\n */\nfunction updateLanguageButtons(lang) {\n    var langButtons = document.querySelectorAll('.lang-btn');\n    langButtons.forEach(function(btn) {\n        var btnLang = btn.getAttribute('data-lang');\n        if (btnLang === lang) {\n            btn.classList.add('lang-btn--active');\n        } else {\n            btn.classList.remove('lang-btn--active');\n        }\n    });\n}\n\n/**\n * Set language and update UI (Story 12.4, 16.3)\n * @param {string} lang - Language code ('en', 'de', or 'es')\n */\nasync function setLanguage(lang) {\n    if (lang !== 'en' && lang !== 'de' && lang !== 'es') {\n        lang = 'en';\n    }\n\n    selectedLanguage = lang;\n    updateLanguageButtons(lang);\n\n    // Update i18n and re-render page\n    await BeatifyI18n.setLanguage(lang);\n    BeatifyI18n.initPageTranslations();\n}\n\n// ==========================================\n// Timer Selector Functions (Story 13.1)\n// ==========================================\n\n/**\n * Setup timer selector buttons\n */\nfunction setupTimerSelector() {\n    var timerButtons = document.querySelectorAll('.timer-btn');\n\n    timerButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            var duration = parseInt(btn.getAttribute('data-duration'), 10);\n            if (duration && duration !== selectedDuration) {\n                setTimerDuration(duration);\n            }\n        });\n    });\n}\n\n/**\n * Update timer button states\n * @param {number} duration - Duration in seconds (15, 30, or 45)\n */\nfunction updateTimerButtons(duration) {\n    var timerButtons = document.querySelectorAll('.timer-btn');\n    timerButtons.forEach(function(btn) {\n        var btnDuration = parseInt(btn.getAttribute('data-duration'), 10);\n        if (btnDuration === duration) {\n            btn.classList.add('timer-btn--active');\n        } else {\n            btn.classList.remove('timer-btn--active');\n        }\n    });\n}\n\n/**\n * Set timer duration\n * @param {number} duration - Duration in seconds (10-60 range)\n */\nfunction setTimerDuration(duration) {\n    // Validate duration is within valid range (matches backend: 10-60)\n    if (typeof duration !== 'number' || duration < 10 || duration > 60) {\n        duration = 30;\n    }\n\n    selectedDuration = duration;\n    updateTimerButtons(duration);\n}\n\n// ==========================================\n// Difficulty Selector Functions (Story 14.1)\n// ==========================================\n\n// Mapping of difficulty levels to their description i18n keys\nconst difficultyDescriptions = {\n    easy: 'admin.difficultyEasyDesc',\n    normal: 'admin.difficultyNormalDesc',\n    hard: 'admin.difficultyHardDesc'\n};\n\n/**\n * Setup difficulty selector buttons\n */\nfunction setupDifficultySelector() {\n    var difficultyButtons = document.querySelectorAll('.difficulty-btn');\n\n    difficultyButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            var difficulty = btn.getAttribute('data-difficulty');\n            if (difficulty && difficulty !== selectedDifficulty) {\n                setDifficulty(difficulty);\n            }\n        });\n    });\n}\n\n/**\n * Update difficulty button states\n * @param {string} difficulty - Difficulty level ('easy', 'normal', or 'hard')\n */\nfunction updateDifficultyButtons(difficulty) {\n    var difficultyButtons = document.querySelectorAll('.difficulty-btn');\n    difficultyButtons.forEach(function(btn) {\n        var btnDifficulty = btn.getAttribute('data-difficulty');\n        if (btnDifficulty === difficulty) {\n            btn.classList.add('difficulty-btn--active');\n        } else {\n            btn.classList.remove('difficulty-btn--active');\n        }\n    });\n}\n\n/**\n * Set difficulty level and update UI\n * @param {string} difficulty - Difficulty level ('easy', 'normal', or 'hard')\n */\nfunction setDifficulty(difficulty) {\n    // Validate difficulty\n    var validDifficulties = ['easy', 'normal', 'hard'];\n    if (validDifficulties.indexOf(difficulty) === -1) {\n        difficulty = 'normal';\n    }\n\n    selectedDifficulty = difficulty;\n    updateDifficultyButtons(difficulty);\n\n    // Update description text\n    var descriptionEl = document.getElementById('difficulty-description');\n    if (descriptionEl) {\n        var descKey = difficultyDescriptions[difficulty];\n        descriptionEl.setAttribute('data-i18n', descKey);\n        // Use i18n translation if available\n        if (typeof BeatifyI18n !== 'undefined' && BeatifyI18n.t) {\n            descriptionEl.textContent = BeatifyI18n.t(descKey);\n        }\n    }\n}\n\n/**\n * Update difficulty badge in lobby view\n * @param {string} difficulty - Difficulty level ('easy', 'normal', or 'hard')\n */\nfunction updateLobbyDifficultyBadge(difficulty) {\n    var badge = document.getElementById('lobby-difficulty-badge');\n    if (!badge) return;\n\n    var labelKey = {\n        easy: 'game.difficultyEasy',\n        normal: 'game.difficultyNormal',\n        hard: 'game.difficultyHard'\n    }[difficulty] || 'game.difficultyNormal';\n\n    var label = utils.t(labelKey);\n    badge.textContent = label;\n    badge.className = 'difficulty-badge difficulty-badge--' + (difficulty || 'normal');\n}\n\n// ==========================================\n// Artist Challenge Toggle Functions (Story 20.7)\n// ==========================================\n\n/**\n * Setup artist challenge toggle\n */\nfunction setupArtistChallengeToggle() {\n    var toggle = document.getElementById('artist-challenge-toggle');\n    if (!toggle) return;\n\n    // Load saved preference\n    var saved = localStorage.getItem('beatify_artist_challenge');\n    if (saved !== null) {\n        artistChallengeEnabled = saved === 'true';\n        toggle.checked = artistChallengeEnabled;\n    }\n\n    toggle.addEventListener('change', function() {\n        artistChallengeEnabled = toggle.checked;\n        // Save preference\n        localStorage.setItem('beatify_artist_challenge', artistChallengeEnabled.toString());\n    });\n}\n\n// ==========================================\n// Provider Selector Functions (Story 17.2)\n// ==========================================\n\n/**\n * Setup provider selector buttons\n */\nfunction setupProviderSelector() {\n    var providerButtons = document.querySelectorAll('.provider-btn');\n\n    providerButtons.forEach(function(btn) {\n        btn.addEventListener('click', function() {\n            // Don't allow clicking disabled buttons\n            if (btn.classList.contains('provider-btn--disabled')) {\n                return;\n            }\n            var provider = btn.getAttribute('data-provider');\n            if (provider && provider !== selectedProvider) {\n                setProvider(provider);\n            }\n        });\n    });\n}\n\n/**\n * Update provider button states\n * @param {string} provider - Provider identifier ('spotify' or 'apple_music')\n */\nfunction updateProviderButtons(provider) {\n    var providerButtons = document.querySelectorAll('.provider-btn');\n    providerButtons.forEach(function(btn) {\n        var btnProvider = btn.getAttribute('data-provider');\n        if (btnProvider === provider) {\n            btn.classList.add('provider-btn--active');\n        } else {\n            btn.classList.remove('provider-btn--active');\n        }\n    });\n}\n\n/**\n * Set music provider and update UI\n * @param {string} provider - Provider identifier (only 'spotify' supported, Story 17.6)\n */\nfunction setProvider(provider) {\n    // Only Spotify is supported (Story 17.6: Apple Music removed)\n    selectedProvider = 'spotify';\n    updateProviderButtons('spotify');\n\n    // Re-render playlists to show coverage for selected provider\n    if (playlistData.length > 0) {\n        renderPlaylists(playlistData, '');\n    }\n}\n\n// ==========================================\n// Lobby Player List Functions (Story 16.8)\n// ==========================================\n\n// t() moved to BeatifyUtils\n\n/**\n * Render player list in admin lobby (analytics grid layout)\n * @param {Array} players - Array of player objects from game state\n */\nfunction renderLobbyPlayers(players) {\n    var listEl = document.getElementById('lobby-players');\n    var countEl = document.getElementById('lobby-player-count');\n    var summaryEl = document.getElementById('admin-players-summary');\n    var emptyEl = document.getElementById('lobby-players-empty');\n    if (!listEl) return;\n\n    players = players || [];\n\n    // Update player count (stat card value - just the number)\n    if (countEl) {\n        countEl.textContent = players.length;\n    }\n\n    // Update players section summary badge\n    if (summaryEl) {\n        summaryEl.textContent = players.length;\n    }\n\n    // Handle empty state visibility\n    if (players.length === 0) {\n        listEl.innerHTML = '';\n        if (emptyEl) emptyEl.classList.remove('hidden');\n        previousLobbyPlayers = [];\n        return;\n    }\n\n    // Hide empty state when we have players\n    if (emptyEl) emptyEl.classList.add('hidden');\n\n    // Sort: connected first, disconnected last\n    var sortedPlayers = players.slice().sort(function(a, b) {\n        if (a.connected !== b.connected) {\n            return a.connected ? -1 : 1;\n        }\n        return 0;\n    });\n\n    // Find new players by comparing with previous list\n    var previousNames = previousLobbyPlayers.map(function(p) { return p.name; });\n    var newNames = sortedPlayers\n        .filter(function(p) { return previousNames.indexOf(p.name) === -1; })\n        .map(function(p) { return p.name; });\n\n    // Render player cards (grid layout)\n    listEl.innerHTML = sortedPlayers.map(function(player) {\n        var isNew = newNames.indexOf(player.name) !== -1;\n        var isDisconnected = player.connected === false;\n        var isAdmin = player.is_admin === true;\n        var classes = [\n            'player-card',\n            isNew ? 'is-new' : '',\n            isDisconnected ? 'player-card--disconnected' : ''\n        ].filter(Boolean).join(' ');\n\n        // Crown badge for admin\n        var adminBadge = isAdmin ? '<span class=\"admin-badge\">\uD83D\uDC51</span>' : '';\n        // Badge for disconnected players\n        var awayBadge = isDisconnected ? '<span class=\"away-badge\">' + utils.t('lobby.away', 'away') + '</span>' : '';\n\n        return '<div class=\"' + classes + '\" data-player=\"' + utils.escapeHtml(player.name) + '\">' +\n            '<span class=\"player-name\">' +\n                utils.escapeHtml(player.name) +\n                adminBadge +\n            '</span>' +\n            awayBadge +\n        '</div>';\n    }).join('');\n\n    // Remove .is-new class after animation\n    setTimeout(function() {\n        var newCards = listEl.querySelectorAll('.is-new');\n        for (var i = 0; i < newCards.length; i++) {\n            newCards[i].classList.remove('is-new');\n        }\n    }, 2000);\n\n    previousLobbyPlayers = players.slice();\n}\n\n/**\n * Start polling for lobby state updates\n */\nfunction startLobbyPolling() {\n    // Clear any existing interval\n    stopLobbyPolling();\n\n    // Poll every 3 seconds (balanced between responsiveness and server load)\n    lobbyPollingInterval = setInterval(async function() {\n        if (currentView !== 'lobby') {\n            stopLobbyPolling();\n            return;\n        }\n\n        try {\n            var response = await fetch('/beatify/api/status');\n            if (!response.ok) return;\n\n            var status = await response.json();\n            if (status.active_game && status.active_game.players) {\n                renderLobbyPlayers(status.active_game.players);\n            }\n        } catch (err) {\n            console.error('Lobby polling error:', err);\n        }\n    }, 3000);\n}\n\n/**\n * Stop polling for lobby state updates\n */\nfunction stopLobbyPolling() {\n    if (lobbyPollingInterval) {\n        clearInterval(lobbyPollingInterval);\n        lobbyPollingInterval = null;\n    }\n}\n\n// ============================================\n// Service Worker Registration (Story 18.5)\n// ============================================\n\n/**\n * Register service worker for asset caching\n */\nif ('serviceWorker' in navigator) {\n    window.addEventListener('load', function() {\n        navigator.serviceWorker.register('/beatify/static/sw.js', {\n            scope: '/beatify/'\n        }).then(function(registration) {\n            console.log('[Admin] SW registered:', registration.scope);\n        }).catch(function(error) {\n            console.warn('[Admin] SW registration failed:', error);\n        });\n    });\n}\n"],
  "mappings": "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",
  "names": ["require_admin", "__commonJSMin", "exports", "selectedPlaylists", "playlistData", "playlistDocsUrl", "selectedMediaPlayer", "mediaPlayerDocsUrl", "currentView", "currentGame", "cachedQRUrl", "selectedLanguage", "selectedDuration", "selectedDifficulty", "selectedProvider", "hasMusicAssistant", "artistChallengeEnabled", "previousLobbyPlayers", "lobbyPollingInterval", "STORAGE_LAST_PLAYER", "STORAGE_GAME_SETTINGS", "setupSections", "PLATFORM_LABELS", "utils", "__async", "_a", "_b", "_c", "_d", "_e", "_f", "c", "startGame", "printQRCode", "rejoinGame", "endGame", "setupAdminJoin", "setupEndGameModal", "setupCollapsibleSections", "setupGameSettings", "loadSavedSettings", "loadStatus", "response", "status", "versionEl", "renderMediaPlayers", "renderPlaylists", "updateStartButtonState", "showExistingGameView", "showSetupView", "error", "container", "section", "header", "chip", "lang", "updateGameSettingsSummary", "saveGameSettings", "duration", "difficulty", "provider", "saved", "settings", "toggle", "summary", "difficultyLabels", "langLabels", "artistIcon", "updateMediaPlayerSummary", "playerName", "groupPlayersByPlatform", "players", "groups", "player", "platform", "totalPlayers", "availablePlayers", "p", "validationMsg", "startBtn", "docsLink", "grouped", "html", "platformPlayers", "info", "recommended", "renderPlayerItem", "attachPlayerSelectionHandlers", "lastPlayerId", "lastPlayerRadio", "handleMediaPlayerSelect", "caveat", "radio", "item", "e", "skipSave", "entityId", "state", "supportsSpotify", "supportsAppleMusic", "playerItem", "updateProviderOptions", "updateProviderWarning", "spotifyBtn", "appleBtn", "hint", "warningEl", "warning", "playlists", "playlistDir", "hasValidPlaylists", "playlist", "songCount", "providerCount", "coverageHtml", "errorMsg", "checkbox", "handlePlaylistToggle", "updateSelectionSummary", "path", "calculateTotalSongs", "sum", "selectedCount", "totalSongs", "btn", "playlistMsg", "mediaPlayerMsg", "noPlaylist", "noMediaPlayer", "stopLobbyPolling", "id", "el", "showLobbyView", "gameData", "qrContainer", "urlEl", "dashboardUrl", "dashboardLink", "renderLobbyPlayers", "startLobbyPolling", "updateLobbyDifficultyBadge", "setupQRModal", "openQRModal", "modal", "modalCode", "closeBtn", "closeQRModal", "backdrop", "idEl", "phaseEl", "playersEl", "originalText", "data", "showError", "err", "showEndGameModal", "closeEndGameModal", "confirmEndGame", "confirmBtn", "cancelBtn", "message", "openAdminJoinModal", "closeAdminJoinModal", "nameInput", "joinBtn", "participateBtn", "name", "handleAdminJoin", "adminModal", "endGameModal", "gameId", "badge", "labelKey", "label", "listEl", "countEl", "summaryEl", "emptyEl", "sortedPlayers", "a", "b", "previousNames", "newNames", "isNew", "isDisconnected", "isAdmin", "classes", "adminBadge", "awayBadge", "newCards", "i", "registration"]
}

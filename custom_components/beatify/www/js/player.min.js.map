{
  "version": 3,
  "sources": ["player.js"],
  "sourcesContent": ["/**\n * Beatify Player Page\n * Validates game and shows appropriate state\n */\n(function() {\n    'use strict';\n\n    // Get game ID from URL\n    const urlParams = new URLSearchParams(window.location.search);\n    const gameId = urlParams.get('game');\n\n    // View elements\n    const loadingView = document.getElementById('loading-view');\n    const notFoundView = document.getElementById('not-found-view');\n    const endedView = document.getElementById('ended-view');\n    const inProgressView = document.getElementById('in-progress-view');\n    const joinView = document.getElementById('join-view');\n    const lobbyView = document.getElementById('lobby-view');\n    const gameView = document.getElementById('game-view');\n    const revealView = document.getElementById('reveal-view');\n    const pausedView = document.getElementById('paused-view');\n    const endView = document.getElementById('end-view');\n    const connectionLostView = document.getElementById('connection-lost-view');\n\n    /**\n     * Show a specific view and hide all others\n     * @param {string} viewId - ID of view to show\n     */\n    function showView(viewId) {\n        [loadingView, notFoundView, endedView, inProgressView, joinView, lobbyView, gameView, revealView, pausedView, endView, connectionLostView].forEach(function(v) {\n            if (v) {\n                v.classList.add('hidden');\n            }\n        });\n        const view = document.getElementById(viewId);\n        if (view) {\n            view.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Validate game ID format\n     * @param {string} id - Game ID to validate\n     * @returns {boolean} - True if valid format\n     */\n    function isValidGameIdFormat(id) {\n        if (!id || typeof id !== 'string') {\n            return false;\n        }\n        // Game IDs are alphanumeric with dashes and underscores, 8-16 chars\n        // token_urlsafe(8) produces 11 characters\n        return /^[a-zA-Z0-9_-]{8,16}$/.test(id);\n    }\n\n    /**\n     * Wait for BeatifyI18n to be available (handles fallback script race condition)\n     * @param {number} timeout - Max wait time in ms\n     * @param {number} interval - Check interval in ms\n     * @returns {Promise<boolean>} - true if available, false if timeout\n     */\n    async function waitForI18n(timeout, interval) {\n        timeout = timeout || 3000;\n        interval = interval || 50;\n        var start = Date.now();\n        while (typeof BeatifyI18n === 'undefined') {\n            if (Date.now() - start > timeout) {\n                return false;\n            }\n            await new Promise(function(resolve) { setTimeout(resolve, interval); });\n        }\n        return true;\n    }\n\n    /**\n     * Fallback translation function when BeatifyI18n is unavailable\n     * Returns the last part of the translation key as readable text\n     * @param {string} key - Translation key (e.g., 'lobby.playerJoined')\n     * @param {Object} params - Optional interpolation params\n     * @returns {string} - Translated text or fallback\n     */\n    function t(key, params) {\n        // Use BeatifyI18n.t if available\n        if (typeof BeatifyI18n !== 'undefined' && BeatifyI18n.t) {\n            return BeatifyI18n.t(key, params);\n        }\n        // Fallback: extract last part of key and make it readable\n        // e.g., 'lobby.playerJoined' -> 'Player Joined'\n        var fallback = key.split('.').pop()\n            .replace(/([A-Z])/g, ' $1')\n            .replace(/^./, function(str) { return str.toUpperCase(); })\n            .trim();\n        // Handle params substitution if provided\n        if (params && typeof params === 'object') {\n            Object.keys(params).forEach(function(param) {\n                fallback = fallback.replace(new RegExp('\\\\{' + param + '\\\\}', 'g'), params[param]);\n            });\n        }\n        return fallback;\n    }\n\n    /**\n     * Get localized content field from song with English fallback (Story 16.1, 16.3)\n     * @param {Object} song - Song object\n     * @param {string} field - Base field name ('fun_fact' or 'awards')\n     * @returns {string|Array|null} Localized content or English fallback\n     */\n    function getLocalizedSongField(song, field) {\n        if (!song) return null;\n        // Guard: fall back to English if i18n unavailable\n        var lang = (typeof BeatifyI18n !== 'undefined') ? BeatifyI18n.getLanguage() : 'en';\n        // Try localized field first (for non-English)\n        if (lang && lang !== 'en') {\n            var localizedKey = field + '_' + lang;\n            if (song[localizedKey]) {\n                return song[localizedKey];\n            }\n        }\n        // Fallback to base field (English)\n        return song[field] || null;\n    }\n\n    /**\n     * Check game status with the server\n     */\n    async function checkGameStatus() {\n        // Validate game ID exists\n        if (!gameId) {\n            showView('not-found-view');\n            return;\n        }\n\n        // Validate game ID format\n        if (!isValidGameIdFormat(gameId)) {\n            showView('not-found-view');\n            return;\n        }\n\n        try {\n            const response = await fetch(`/beatify/api/game-status?game=${encodeURIComponent(gameId)}`);\n            const data = await response.json();\n\n            if (!data.exists) {\n                showView('not-found-view');\n                return;\n            }\n\n            if (data.phase === 'END') {\n                showView('ended-view');\n                return;\n            }\n\n            // Check for admin redirect first (from admin.js) - let initAll() handle it\n            // Only check beatify_admin_name since beatify_is_admin may be cleared\n            // by checkAdminStatus() before this async function completes\n            var adminName = sessionStorage.getItem('beatify_admin_name');\n            if (adminName) {\n                // Admin redirect - initAll() will handle connection\n                return;\n            }\n\n            // Story 11.2: Check for session cookie to auto-reconnect\n            // This must happen BEFORE can_join check - existing players should\n            // be able to reconnect even during REVEAL/PAUSED phases\n            var sessionCookie = getSessionCookie();\n            if (sessionCookie) {\n                // Attempt session-based reconnection (works for any phase except END)\n                connectWithSession();\n                return;\n            }\n\n            // New players: can join during LOBBY, PLAYING, or REVEAL (Story 16.5)\n            if (data.can_join) {\n                showView('join-view');\n            } else {\n                // PAUSED or END - new players can't join right now\n                showView('in-progress-view');\n            }\n\n        } catch (err) {\n            console.error('Failed to check game status:', err);\n            showView('not-found-view');\n        }\n    }\n\n    // Initialize\n    checkGameStatus();\n\n    // Wire refresh/retry buttons\n    document.getElementById('refresh-btn')?.addEventListener('click', () => {\n        showView('loading-view');\n        checkGameStatus();\n    });\n\n    document.getElementById('retry-btn')?.addEventListener('click', () => {\n        showView('loading-view');\n        checkGameStatus();\n    });\n\n    // ============================================\n    // Session Cookie Management (Story 11.1)\n    // ============================================\n\n    var SESSION_COOKIE_NAME = 'beatify_session';\n\n    /**\n     * Set session cookie with session ID\n     * @param {string} sessionId - Session ID from server\n     */\n    function setSessionCookie(sessionId) {\n        // Add Secure flag when on HTTPS (security best practice)\n        var secureFlag = location.protocol === 'https:' ? '; Secure' : '';\n        document.cookie = SESSION_COOKIE_NAME + '=' + sessionId +\n            '; path=/beatify; SameSite=Strict; max-age=86400' + secureFlag;\n    }\n\n    /**\n     * Get session cookie value\n     * @returns {string|null} Session ID or null if not found\n     */\n    function getSessionCookie() {\n        var cookies = document.cookie.split(';');\n        for (var i = 0; i < cookies.length; i++) {\n            var cookie = cookies[i].trim();\n            if (cookie.indexOf(SESSION_COOKIE_NAME + '=') === 0) {\n                return cookie.substring(SESSION_COOKIE_NAME.length + 1);\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Clear session cookie\n     */\n    function clearSessionCookie() {\n        document.cookie = SESSION_COOKIE_NAME + '=; path=/beatify; max-age=0';\n    }\n\n    // ============================================\n    // Score Animation Utilities (Story 13.2)\n    // ============================================\n\n    /**\n     * Check if user prefers reduced motion\n     * @returns {boolean} True if reduced motion is preferred\n     */\n    function prefersReducedMotion() {\n        return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n    }\n\n    /**\n     * Easing function for smooth deceleration\n     * @param {number} t - Progress value 0-1\n     * @returns {number} Eased value\n     */\n    function easeOutQuart(t) {\n        return 1 - Math.pow(1 - t, 4);\n    }\n\n    /**\n     * Animate a numeric value from start to end\n     * Story 18.3: Now device-tier aware with instant updates for low-end devices\n     * @param {HTMLElement} element - Element to update textContent\n     * @param {number} start - Starting value\n     * @param {number} end - Ending value\n     * @param {number} duration - Animation duration in ms\n     * @param {Function} easing - Easing function (optional, defaults to easeOutQuart)\n     * @returns {Object} Controller with cancel() and skipToEnd() methods\n     */\n    function animateValue(element, start, end, duration, easing) {\n        // Skip animation if reduced motion or start equals end\n        if (prefersReducedMotion() || start === end) {\n            element.textContent = end;\n            return { cancel: function() {}, skipToEnd: function() { element.textContent = end; } };\n        }\n\n        // Story 18.3: Get device-aware duration\n        var quality = AnimationUtils.getQualitySettings();\n        if (quality.scoreDuration === 0) {\n            // Low-end device: instant update\n            element.textContent = end;\n            return { cancel: function() {}, skipToEnd: function() { element.textContent = end; } };\n        }\n\n        // Scale duration based on device tier\n        var adjustedDuration = Math.min(duration, quality.scoreDuration || duration);\n\n        easing = easing || easeOutQuart;\n        var startTime = null;\n        var animationId = null;\n        var cancelled = false;\n        var finalValue = end;\n\n        function step(timestamp) {\n            if (cancelled) return;\n\n            if (!startTime) startTime = timestamp;\n            var elapsed = timestamp - startTime;\n            var progress = Math.min(elapsed / adjustedDuration, 1);\n            var easedProgress = easing(progress);\n\n            var currentValue = Math.round(start + (finalValue - start) * easedProgress);\n            element.textContent = currentValue;\n\n            if (progress < 1) {\n                animationId = requestAnimationFrame(step);\n            }\n        }\n\n        animationId = requestAnimationFrame(step);\n\n        return {\n            cancel: function() {\n                cancelled = true;\n                if (animationId) {\n                    cancelAnimationFrame(animationId);\n                }\n            },\n            skipToEnd: function() {\n                cancelled = true;\n                if (animationId) {\n                    cancelAnimationFrame(animationId);\n                }\n                element.textContent = finalValue;\n            }\n        };\n    }\n\n    /**\n     * Animate score change with visual effects\n     * @param {HTMLElement} element - Score element to animate\n     * @param {number} oldScore - Previous score value\n     * @param {number} newScore - New score value\n     * @param {Object} options - Effect options: { betWon, betLost, streakMilestone, isBigScore }\n     */\n    function animateScoreChange(element, oldScore, newScore, options) {\n        options = options || {};\n\n        // Determine animation duration based on effect type\n        var duration = 500; // default\n        if (options.betWon) {\n            duration = 800;\n        } else if (options.isBigScore) {\n            duration = 700;\n        } else if (options.betLost) {\n            duration = 400;\n        }\n\n        // Add tabular-nums class for stable width during animation\n        element.classList.add('score-animating');\n\n        // Apply appropriate CSS animation class\n        var animationClass = null;\n        if (options.betWon) {\n            animationClass = 'score-glow-gold';\n        } else if (options.betLost) {\n            animationClass = 'score-shake';\n            element.classList.add('score-flash-red');\n        } else if (options.streakMilestone) {\n            animationClass = 'score-burst';\n        } else if (options.isBigScore) {\n            animationClass = 'score-pop';\n        }\n\n        if (animationClass && !prefersReducedMotion()) {\n            element.classList.add(animationClass);\n        }\n\n        // Animate the number value\n        animateValue(element, oldScore, newScore, duration);\n\n        // Remove animation classes after animation completes\n        function cleanup() {\n            element.classList.remove('score-animating');\n            if (animationClass) {\n                element.classList.remove(animationClass);\n            }\n            element.classList.remove('score-flash-red');\n        }\n\n        // Use animationend for CSS animations, or timeout for value animation only\n        if (animationClass && !prefersReducedMotion()) {\n            element.addEventListener('animationend', function onEnd() {\n                element.removeEventListener('animationend', onEnd);\n                cleanup();\n            });\n        } else {\n            setTimeout(cleanup, duration + 50);\n        }\n    }\n\n    /**\n     * Show floating points popup above target element\n     * @param {HTMLElement} targetElement - Element to position popup relative to\n     * @param {number} points - Points value to display\n     * @param {Object} options - Options: { text, isStreak, isBetWin }\n     */\n    function showPointsPopup(targetElement, points, options) {\n        options = options || {};\n\n        // Skip popup entirely for reduced motion\n        if (prefersReducedMotion()) {\n            return;\n        }\n\n        var popup = document.createElement('div');\n        popup.className = 'points-popup';\n        popup.textContent = options.text || ('+' + points);\n\n        if (options.isStreak) {\n            popup.classList.add('points-popup--streak');\n        } else if (options.isBetWin) {\n            popup.classList.add('points-popup--gold');\n        }\n\n        // Position above target\n        var rect = targetElement.getBoundingClientRect();\n        popup.style.left = (rect.left + rect.width / 2) + 'px';\n        popup.style.top = rect.top + 'px';\n\n        document.body.appendChild(popup);\n\n        // Remove after animation\n        popup.addEventListener('animationend', function() {\n            if (popup.parentNode) {\n                popup.parentNode.removeChild(popup);\n            }\n        });\n\n        // Fallback removal in case animationend doesn't fire\n        setTimeout(function() {\n            if (popup.parentNode) {\n                popup.parentNode.removeChild(popup);\n            }\n        }, 1200);\n    }\n\n    // Previous state cache for detecting score changes (Story 13.2)\n    var previousState = {\n        players: {},      // name -> { score, rank, streak }\n        leaderboard: [],  // ordered list of names\n        initialized: false // Flag to skip animations on first state (reconnect case)\n    };\n\n    /**\n     * Check if previous state has been initialized\n     * Used to skip animations when player reconnects mid-game\n     * @returns {boolean} True if state has been initialized\n     */\n    function isPreviousStateInitialized() {\n        return previousState.initialized;\n    }\n\n    // Streak milestones for bonus detection\n    var STREAK_MILESTONES = [3, 5, 10];\n\n    // ============================================\n    // Animation Performance Utilities (Story 18.3)\n    // ============================================\n\n    /**\n     * Centralized animation utilities with device-aware performance optimization\n     */\n    var AnimationUtils = (function() {\n        // Cache reduced-motion preference\n        var reducedMotionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');\n        var _prefersReducedMotion = reducedMotionQuery.matches;\n\n        // Listen for preference changes (user toggles OS setting)\n        reducedMotionQuery.addEventListener('change', function(e) {\n            _prefersReducedMotion = e.matches;\n        });\n\n        // Cache device tier (computed once on load)\n        var _deviceTier = null;\n\n        /**\n         * Detect device capability tier\n         * @returns {'high'|'medium'|'low'} Device performance tier\n         */\n        function getDeviceTier() {\n            if (_deviceTier !== null) return _deviceTier;\n\n            var cores = navigator.hardwareConcurrency || 2;\n            var memory = navigator.deviceMemory || 4;\n\n            // iOS Safari detection (often resource-constrained)\n            var isIOSSafari = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;\n\n            if (cores <= 2 || memory <= 2) {\n                _deviceTier = 'low';\n            } else if (cores <= 4 || memory <= 4 || isIOSSafari) {\n                _deviceTier = 'medium';\n            } else {\n                _deviceTier = 'high';\n            }\n\n            return _deviceTier;\n        }\n\n        // Initialize tier on load\n        getDeviceTier();\n\n        return {\n            /**\n             * Check if reduced motion is preferred\n             * @returns {boolean}\n             */\n            prefersReducedMotion: function() {\n                return _prefersReducedMotion;\n            },\n\n            /**\n             * Get device performance tier\n             * @returns {'high'|'medium'|'low'}\n             */\n            getDeviceTier: getDeviceTier,\n\n            /**\n             * Get animation quality settings based on device tier\n             * @returns {Object} Quality settings for various animation types\n             */\n            getQualitySettings: function() {\n                var tier = getDeviceTier();\n                if (_prefersReducedMotion) {\n                    return {\n                        confettiParticles: 0,\n                        scoreDuration: 0,\n                        leaderboardAnimation: 'none',\n                        neonGlow: false,\n                        enableAnimations: false\n                    };\n                }\n                switch (tier) {\n                    case 'low':\n                        return {\n                            confettiParticles: 5,\n                            scoreDuration: 0,\n                            leaderboardAnimation: 'none',\n                            neonGlow: false,\n                            enableAnimations: true\n                        };\n                    case 'medium':\n                        return {\n                            confettiParticles: 10,\n                            scoreDuration: 300,\n                            leaderboardAnimation: 'simplified',\n                            neonGlow: false,\n                            enableAnimations: true\n                        };\n                    default: // high\n                        return {\n                            confettiParticles: 15,\n                            scoreDuration: 500,\n                            leaderboardAnimation: 'full',\n                            neonGlow: true,\n                            enableAnimations: true\n                        };\n                }\n            },\n\n            /**\n             * Execute animation with reduced-motion fallback\n             * @param {Function} animationFn - Animation function to run\n             * @param {Function} fallbackFn - Fallback for reduced motion (optional)\n             */\n            ifMotionAllowed: function(animationFn, fallbackFn) {\n                if (_prefersReducedMotion) {\n                    if (fallbackFn) fallbackFn();\n                } else {\n                    animationFn();\n                }\n            },\n\n            /**\n             * Apply will-change before animation, clean up after\n             * @param {HTMLElement} element - Element to optimize\n             * @param {string} properties - CSS properties (e.g., 'transform, opacity')\n             * @param {number} durationMs - Expected animation duration in milliseconds\n             */\n            withWillChange: function(element, properties, durationMs) {\n                if (!element) return;\n                element.style.willChange = properties;\n                // Schedule cleanup after animation duration + buffer\n                setTimeout(function() {\n                    if (element && element.style) {\n                        element.style.willChange = 'auto';\n                    }\n                }, (durationMs || 500) + 100);\n            }\n        };\n    })();\n\n    /**\n     * Interruptible animation queue for reveal phase (Story 18.3)\n     * Caps total animation time and allows skip-to-end\n     */\n    var AnimationQueue = (function() {\n        var queue = [];\n        var running = false;\n        var currentAnimation = null;\n        var animationTimeoutId = null;\n        var MAX_ANIMATION_DURATION = 2000; // AC4: 2 second cap per animation\n\n        function processNext() {\n            // Clear any previous timeout\n            if (animationTimeoutId) {\n                clearTimeout(animationTimeoutId);\n                animationTimeoutId = null;\n            }\n\n            if (queue.length === 0) {\n                running = false;\n                currentAnimation = null;\n                return;\n            }\n            currentAnimation = queue.shift();\n\n            // Set timeout to force skip if animation takes too long (AC4)\n            animationTimeoutId = setTimeout(function() {\n                if (currentAnimation && currentAnimation.skipToEnd) {\n                    currentAnimation.skipToEnd();\n                }\n                processNext();\n            }, MAX_ANIMATION_DURATION);\n\n            currentAnimation.run(function() {\n                // Clear timeout if animation completes normally\n                if (animationTimeoutId) {\n                    clearTimeout(animationTimeoutId);\n                    animationTimeoutId = null;\n                }\n                processNext();\n            });\n        }\n\n        return {\n            /**\n             * Add animation to queue\n             * @param {Object} animation - { run: function(done), skipToEnd: function() }\n             */\n            add: function(animation) {\n                queue.push(animation);\n                if (!running) {\n                    running = true;\n                    processNext();\n                }\n            },\n\n            /**\n             * Skip current animation and clear queue\n             */\n            skipAll: function() {\n                // Clear timeout\n                if (animationTimeoutId) {\n                    clearTimeout(animationTimeoutId);\n                    animationTimeoutId = null;\n                }\n                // Skip current animation\n                if (currentAnimation && currentAnimation.skipToEnd) {\n                    currentAnimation.skipToEnd();\n                }\n                // Skip all queued animations\n                queue.forEach(function(anim) {\n                    if (anim.skipToEnd) anim.skipToEnd();\n                });\n                queue = [];\n                running = false;\n                currentAnimation = null;\n            },\n\n            /**\n             * Clear queue without running skip callbacks\n             */\n            clear: function() {\n                // Clear timeout\n                if (animationTimeoutId) {\n                    clearTimeout(animationTimeoutId);\n                    animationTimeoutId = null;\n                }\n                queue = [];\n                running = false;\n                currentAnimation = null;\n            },\n\n            /**\n             * Check if queue is running\n             * @returns {boolean}\n             */\n            isRunning: function() {\n                return running;\n            },\n\n            /**\n             * Get max duration setting\n             * @returns {number}\n             */\n            getMaxDuration: function() {\n                return maxDuration;\n            }\n        };\n    })();\n\n    // ============================================\n    // Lazy Loading Configuration (Story 18.1)\n    // ============================================\n\n    var LEADERBOARD_LAZY_CONFIG = {\n        VISIBLE_BUFFER: 2,      // Extra entries above/below viewport\n        ENTRY_HEIGHT: 48,       // Fixed height per leaderboard entry (px)\n        MIN_PLAYERS_FOR_LAZY: 10, // Only use lazy loading with 10+ players\n        ROOT_MARGIN: '96px 0px', // 2 entries buffer for IntersectionObserver\n        DEFAULT_VIEWPORT_HEIGHT: 280 // Default viewport height for leaderboard (px)\n    };\n\n    // Lazy loading state\n    var lazyLeaderboardState = {\n        observer: null,           // IntersectionObserver instance\n        fullData: [],             // Complete leaderboard data\n        visibleRange: { start: 0, end: 10 }, // Currently rendered range\n        listEl: null,             // Reference to list element\n        isLazyEnabled: false      // Whether lazy loading is active\n    };\n\n    /**\n     * Initialize IntersectionObserver for lazy leaderboard loading\n     * @param {Element} listEl - Leaderboard list element\n     */\n    function initLeaderboardObserver(listEl) {\n        if (!listEl) return;\n\n        // Clean up existing observer if list element changed (prevents memory leak)\n        if (lazyLeaderboardState.observer && lazyLeaderboardState.listEl !== listEl) {\n            lazyLeaderboardState.observer.disconnect();\n            lazyLeaderboardState.observer = null;\n        }\n\n        if (lazyLeaderboardState.observer) return;\n\n        lazyLeaderboardState.listEl = listEl;\n\n        // Observer callback for lazy loading (sentinels created inline in renderLazyLeaderboardRange)\n        lazyLeaderboardState.observer = new IntersectionObserver(function(entries) {\n            entries.forEach(function(entry) {\n                if (!entry.isIntersecting || !lazyLeaderboardState.isLazyEnabled) return;\n\n                var fullData = lazyLeaderboardState.fullData;\n                var range = lazyLeaderboardState.visibleRange;\n                var buffer = LEADERBOARD_LAZY_CONFIG.VISIBLE_BUFFER;\n\n                if (entry.target.classList.contains('leaderboard-sentinel--top')) {\n                    // Scrolled to top - load more entries above\n                    if (range.start > 0) {\n                        var newStart = Math.max(0, range.start - buffer);\n                        lazyLeaderboardState.visibleRange.start = newStart;\n                        renderLazyLeaderboardRange();\n                    }\n                } else if (entry.target.classList.contains('leaderboard-sentinel--bottom')) {\n                    // Scrolled to bottom - load more entries below\n                    if (range.end < fullData.length) {\n                        var newEnd = Math.min(fullData.length, range.end + buffer);\n                        lazyLeaderboardState.visibleRange.end = newEnd;\n                        renderLazyLeaderboardRange();\n                    }\n                }\n            });\n        }, {\n            root: listEl,\n            rootMargin: LEADERBOARD_LAZY_CONFIG.ROOT_MARGIN,\n            threshold: 0\n        });\n    }\n\n    /**\n     * Render the visible range of leaderboard entries with spacers\n     */\n    function renderLazyLeaderboardRange() {\n        var listEl = lazyLeaderboardState.listEl;\n        var fullData = lazyLeaderboardState.fullData;\n        var range = lazyLeaderboardState.visibleRange;\n\n        if (!listEl || !fullData.length) return;\n\n        var entryHeight = LEADERBOARD_LAZY_CONFIG.ENTRY_HEIGHT;\n        var topSpacerHeight = range.start * entryHeight;\n        var bottomSpacerHeight = (fullData.length - range.end) * entryHeight;\n\n        // Preserve scroll position\n        var scrollTop = listEl.scrollTop;\n\n        // Build HTML with spacers\n        var html = '';\n\n        // Top spacer\n        if (topSpacerHeight > 0) {\n            html += '<div class=\"leaderboard-spacer-top\" style=\"height: ' + topSpacerHeight + 'px;\"></div>';\n        }\n\n        // Top sentinel for IntersectionObserver\n        html += '<div class=\"leaderboard-sentinel leaderboard-sentinel--top\" style=\"height: 1px;\"></div>';\n\n        // Render visible entries\n        for (var i = range.start; i < range.end && i < fullData.length; i++) {\n            html += renderLeaderboardEntry(fullData[i]);\n        }\n\n        // Bottom sentinel for IntersectionObserver\n        html += '<div class=\"leaderboard-sentinel leaderboard-sentinel--bottom\" style=\"height: 1px;\"></div>';\n\n        // Bottom spacer\n        if (bottomSpacerHeight > 0) {\n            html += '<div class=\"leaderboard-spacer-bottom\" style=\"height: ' + bottomSpacerHeight + 'px;\"></div>';\n        }\n\n        listEl.innerHTML = html;\n\n        // Restore scroll position\n        listEl.scrollTop = scrollTop;\n\n        // Re-attach observer to sentinels\n        if (lazyLeaderboardState.observer) {\n            var sentinels = listEl.querySelectorAll('.leaderboard-sentinel');\n            sentinels.forEach(function(sentinel) {\n                lazyLeaderboardState.observer.observe(sentinel);\n            });\n        }\n    }\n\n    /**\n     * Render a single leaderboard entry HTML\n     * @param {Object} entry - Leaderboard entry data\n     * @returns {string} HTML string\n     */\n    function renderLeaderboardEntry(entry) {\n        // Validate entry exists\n        if (!entry) return '';\n\n        if (entry.separator) {\n            return '<div class=\"leaderboard-separator\">...</div>';\n        }\n\n        // Validate required fields with safe defaults\n        var name = entry.name || 'Unknown';\n        var rank = entry.rank || 0;\n        var score = entry.score || 0;\n\n        var rankClass = rank <= 3 ? 'is-top-' + rank : '';\n        var currentClass = entry.is_current ? 'is-current' : '';\n\n        // Rank change animation class\n        var animationClass = '';\n        if (entry.rank_change > 0 || entry._rankChange === 'up') {\n            animationClass = 'leaderboard-entry--climbing leaderboard-entry--slide-up';\n        } else if (entry.rank_change < 0 || entry._rankChange === 'down') {\n            animationClass = 'leaderboard-entry--falling leaderboard-entry--slide-down';\n        }\n\n        // Rank change indicator\n        var changeIndicator = '';\n        if (entry.rank_change > 0) {\n            changeIndicator = '<span class=\"rank-up\">\u25B2' + entry.rank_change + '</span>';\n        } else if (entry.rank_change < 0) {\n            changeIndicator = '<span class=\"rank-down\">\u25BC' + Math.abs(entry.rank_change) + '</span>';\n        }\n\n        // Streak indicator with hot glow for 5+\n        var streakIndicator = '';\n        if (entry.streak >= 2) {\n            var hotClass = entry.streak >= 5 ? 'streak-indicator--hot' : '';\n            streakIndicator = '<span class=\"streak-indicator ' + hotClass + '\">\uD83D\uDD25' + entry.streak + '</span>';\n        }\n\n        // Disconnected player styling\n        var disconnectedClass = entry.connected === false ? 'leaderboard-entry--disconnected' : '';\n        var awayBadge = entry.connected === false ? '<span class=\"away-badge\">(away)</span>' : '';\n\n        // Score display (use validated score variable)\n        var displayScore = entry._displayScore !== undefined ? entry._displayScore : score;\n\n        return '<div class=\"leaderboard-entry ' + rankClass + ' ' + currentClass + ' ' + animationClass + ' ' + disconnectedClass + '\" data-rank=\"' + rank + '\" data-name=\"' + escapeHtml(name) + '\">' +\n            '<span class=\"entry-rank\">#' + rank + '</span>' +\n            '<span class=\"entry-name\">' + escapeHtml(name) + awayBadge + '</span>' +\n            '<span class=\"entry-meta\">' +\n                streakIndicator +\n                changeIndicator +\n            '</span>' +\n            '<span class=\"entry-score\" data-prev-score=\"' + (entry._prevScore || score) + '\">' + displayScore + '</span>' +\n        '</div>';\n    }\n\n    /**\n     * Calculate initial visible range based on viewport and current player position\n     * @param {Array} displayList - Processed leaderboard data\n     * @param {string} currentPlayerName - Name of current player\n     * @returns {Object} Range object with start and end indices\n     */\n    function calculateInitialVisibleRange(displayList, currentPlayerName) {\n        var config = LEADERBOARD_LAZY_CONFIG;\n        // Use actual list element height if available, otherwise fall back to config default\n        var viewportHeight = lazyLeaderboardState.listEl\n            ? lazyLeaderboardState.listEl.clientHeight || config.DEFAULT_VIEWPORT_HEIGHT\n            : config.DEFAULT_VIEWPORT_HEIGHT;\n        var viewportEntries = Math.ceil(viewportHeight / config.ENTRY_HEIGHT);\n        var buffer = config.VISIBLE_BUFFER;\n\n        // Find current player index\n        var currentIdx = -1;\n        for (var i = 0; i < displayList.length; i++) {\n            if (displayList[i].name === currentPlayerName) {\n                currentIdx = i;\n                break;\n            }\n        }\n\n        var start, end;\n        if (currentIdx === -1 || currentIdx < viewportEntries) {\n            // Current player at top or not found - start from beginning\n            start = 0;\n            end = Math.min(displayList.length, viewportEntries + buffer * 2);\n        } else if (currentIdx >= displayList.length - viewportEntries) {\n            // Current player near bottom\n            start = Math.max(0, displayList.length - viewportEntries - buffer);\n            end = displayList.length;\n        } else {\n            // Current player in middle - center around them\n            start = Math.max(0, currentIdx - Math.floor(viewportEntries / 2) - buffer);\n            end = Math.min(displayList.length, currentIdx + Math.ceil(viewportEntries / 2) + buffer);\n        }\n\n        return { start: start, end: end };\n    }\n\n    /**\n     * Clean up lazy loading observer\n     */\n    function cleanupLeaderboardObserver() {\n        if (lazyLeaderboardState.observer) {\n            lazyLeaderboardState.observer.disconnect();\n            lazyLeaderboardState.observer = null;\n        }\n        lazyLeaderboardState.isLazyEnabled = false;\n        lazyLeaderboardState.fullData = [];\n    }\n\n    /**\n     * Setup resize/orientation change handler for lazy leaderboard (Story 18.1)\n     * Recalculates visible range when viewport size changes\n     */\n    function setupLeaderboardResizeHandler() {\n        var resizeTimeout;\n\n        function handleResize() {\n            // Debounce resize events\n            clearTimeout(resizeTimeout);\n            resizeTimeout = setTimeout(function() {\n                if (lazyLeaderboardState.isLazyEnabled && lazyLeaderboardState.fullData.length > 0) {\n                    // Recalculate visible range based on new viewport\n                    lazyLeaderboardState.visibleRange = calculateInitialVisibleRange(\n                        lazyLeaderboardState.fullData,\n                        playerName\n                    );\n                    renderLazyLeaderboardRange();\n                }\n            }, 150);\n        }\n\n        window.addEventListener('resize', handleResize);\n        window.addEventListener('orientationchange', handleResize);\n    }\n\n    // ============================================\n    // Virtual List for Player Lists (Story 18.2)\n    // ============================================\n\n    var VIRTUAL_LIST_CONFIG = {\n        ITEM_HEIGHT: 60,        // Player card height + gap (52px card + 8px gap)\n        OVERSCAN: 3,            // Extra items above/below viewport\n        THRESHOLD: 15,          // Min players before virtualizing\n        CONTAINER_HEIGHT: 320   // Default container height\n    };\n\n    // Virtual list state\n    var virtualPlayerList = {\n        container: null,\n        items: [],\n        scrollTop: 0,\n        isVirtual: false,\n        topSpacer: null,\n        bottomSpacer: null,\n        contentWrapper: null,\n        scrollHandler: null,\n        resizeHandler: null\n    };\n\n    /**\n     * Initialize virtual list for player list container\n     * @param {Element} container - The player list container element\n     */\n    function initVirtualPlayerList(container) {\n        if (!container) return;\n\n        virtualPlayerList.container = container;\n\n        // Create scroll handler with requestAnimationFrame batching\n        var ticking = false;\n        virtualPlayerList.scrollHandler = function() {\n            virtualPlayerList.scrollTop = container.scrollTop;\n            if (!ticking) {\n                requestAnimationFrame(function() {\n                    renderVirtualPlayerList();\n                    ticking = false;\n                });\n                ticking = true;\n            }\n        };\n\n        // Create resize handler with debouncing\n        var resizeTimeout;\n        virtualPlayerList.resizeHandler = function() {\n            clearTimeout(resizeTimeout);\n            resizeTimeout = setTimeout(function() {\n                if (virtualPlayerList.isVirtual) {\n                    renderVirtualPlayerList();\n                }\n            }, 100);\n        };\n\n        container.addEventListener('scroll', virtualPlayerList.scrollHandler, { passive: true });\n        window.addEventListener('resize', virtualPlayerList.resizeHandler);\n    }\n\n    /**\n     * Set items for virtual list and render\n     * @param {Array} items - Array of player objects\n     * @param {Function} renderItemFn - Function to render a single item HTML\n     */\n    function setVirtualPlayerListItems(items, renderItemFn) {\n        virtualPlayerList.items = items;\n        virtualPlayerList.renderItem = renderItemFn;\n\n        var container = virtualPlayerList.container;\n        if (!container) return;\n\n        // Preserve scroll position when crossing threshold\n        var prevScrollTop = container.scrollTop;\n        var wasVirtual = virtualPlayerList.isVirtual;\n\n        if (items.length < VIRTUAL_LIST_CONFIG.THRESHOLD) {\n            // Below threshold: render all (non-virtual)\n            virtualPlayerList.isVirtual = false;\n            container.classList.remove('player-list--virtual');\n            renderAllPlayerCards(items, renderItemFn);\n        } else {\n            // Above threshold: use virtual scrolling\n            virtualPlayerList.isVirtual = true;\n            container.classList.add('player-list--virtual');\n            setupVirtualContainer();\n            renderVirtualPlayerList();\n        }\n\n        // Restore scroll position after mode change\n        if (wasVirtual !== virtualPlayerList.isVirtual && prevScrollTop > 0) {\n            container.scrollTop = prevScrollTop;\n            virtualPlayerList.scrollTop = prevScrollTop;\n        }\n    }\n\n    /**\n     * Setup virtual container with spacers\n     */\n    function setupVirtualContainer() {\n        var container = virtualPlayerList.container;\n        if (!container) return;\n\n        // Clear and create structure\n        container.innerHTML = '';\n\n        // Create top spacer\n        var topSpacer = document.createElement('div');\n        topSpacer.className = 'virtual-spacer-top';\n        virtualPlayerList.topSpacer = topSpacer;\n\n        // Create content wrapper for positioned items\n        var contentWrapper = document.createElement('div');\n        contentWrapper.className = 'virtual-content-wrapper';\n        virtualPlayerList.contentWrapper = contentWrapper;\n\n        // Create bottom spacer\n        var bottomSpacer = document.createElement('div');\n        bottomSpacer.className = 'virtual-spacer-bottom';\n        virtualPlayerList.bottomSpacer = bottomSpacer;\n\n        container.appendChild(topSpacer);\n        container.appendChild(contentWrapper);\n        container.appendChild(bottomSpacer);\n    }\n\n    /**\n     * Render visible items in virtual list\n     */\n    function renderVirtualPlayerList() {\n        var config = VIRTUAL_LIST_CONFIG;\n        var items = virtualPlayerList.items;\n        var container = virtualPlayerList.container;\n        var contentWrapper = virtualPlayerList.contentWrapper;\n\n        if (!container || !contentWrapper || !items.length) return;\n\n        var containerHeight = container.clientHeight || config.CONTAINER_HEIGHT;\n        var scrollTop = virtualPlayerList.scrollTop;\n        var itemHeight = config.ITEM_HEIGHT;\n        var overscan = config.OVERSCAN;\n\n        // Calculate visible range\n        var startIdx = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);\n        var endIdx = Math.min(\n            items.length,\n            Math.ceil((scrollTop + containerHeight) / itemHeight) + overscan\n        );\n\n        // Update spacer heights\n        if (virtualPlayerList.topSpacer) {\n            virtualPlayerList.topSpacer.style.height = (startIdx * itemHeight) + 'px';\n        }\n        if (virtualPlayerList.bottomSpacer) {\n            virtualPlayerList.bottomSpacer.style.height = ((items.length - endIdx) * itemHeight) + 'px';\n        }\n\n        // Build HTML for visible items\n        var html = '';\n        for (var i = startIdx; i < endIdx; i++) {\n            html += virtualPlayerList.renderItem(items[i], i);\n        }\n\n        contentWrapper.innerHTML = html;\n    }\n\n    /**\n     * Render all player cards (non-virtual mode)\n     * @param {Array} items - Player items\n     * @param {Function} renderItemFn - Render function\n     */\n    function renderAllPlayerCards(items, renderItemFn) {\n        var container = virtualPlayerList.container;\n        if (!container) return;\n\n        var html = '';\n        for (var i = 0; i < items.length; i++) {\n            html += renderItemFn(items[i], i);\n        }\n        container.innerHTML = html;\n    }\n\n    /**\n     * Clean up virtual player list\n     */\n    function cleanupVirtualPlayerList() {\n        var container = virtualPlayerList.container;\n        if (container && virtualPlayerList.scrollHandler) {\n            container.removeEventListener('scroll', virtualPlayerList.scrollHandler);\n        }\n        if (virtualPlayerList.resizeHandler) {\n            window.removeEventListener('resize', virtualPlayerList.resizeHandler);\n        }\n        virtualPlayerList.container = null;\n        virtualPlayerList.items = [];\n        virtualPlayerList.isVirtual = false;\n        virtualPlayerList.topSpacer = null;\n        virtualPlayerList.bottomSpacer = null;\n        virtualPlayerList.contentWrapper = null;\n    }\n\n    /**\n     * Check if a streak milestone was just reached\n     * @param {number} oldStreak - Previous streak value\n     * @param {number} newStreak - Current streak value\n     * @returns {number|null} Milestone reached or null\n     */\n    function isStreakMilestone(oldStreak, newStreak) {\n        for (var i = 0; i < STREAK_MILESTONES.length; i++) {\n            var milestone = STREAK_MILESTONES[i];\n            if (oldStreak < milestone && newStreak >= milestone) {\n                return milestone;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Detect rank changes in leaderboard\n     * @param {Array} newLeaderboard - New leaderboard array\n     * @returns {Object} Map of name -> 'up', 'down', 'new', or undefined\n     */\n    function detectRankChanges(newLeaderboard) {\n        var newOrder = newLeaderboard.map(function(entry) { return entry.name; });\n        var changes = {};\n\n        newOrder.forEach(function(name, newRank) {\n            var oldRank = previousState.leaderboard.indexOf(name);\n            if (oldRank === -1) {\n                changes[name] = 'new';\n            } else if (newRank < oldRank) {\n                changes[name] = 'up';\n            } else if (newRank > oldRank) {\n                changes[name] = 'down';\n            }\n        });\n\n        return changes;\n    }\n\n    /**\n     * Update previous state cache after rendering\n     * @param {Array} players - Current players array\n     * @param {Array} leaderboard - Current leaderboard array\n     */\n    function updatePreviousState(players, leaderboard) {\n        // Update players cache\n        previousState.players = {};\n        players.forEach(function(player) {\n            previousState.players[player.name] = {\n                score: player.score,\n                rank: player.rank || 0,\n                streak: player.streak || 0\n            };\n        });\n\n        // Update leaderboard order\n        if (leaderboard) {\n            previousState.leaderboard = leaderboard.map(function(entry) {\n                return entry.name;\n            });\n        }\n\n        // Mark as initialized after first update (Story 13.2 - reconnect fix)\n        previousState.initialized = true;\n    }\n\n    /**\n     * Reset previous state (called on game end/new game)\n     */\n    function resetPreviousState() {\n        previousState.players = {};\n        previousState.leaderboard = [];\n        previousState.initialized = false;\n    }\n\n    /**\n     * Validate UUID format (basic check)\n     * @param {string} str - String to validate\n     * @returns {boolean} True if valid UUID format\n     */\n    function isValidUUID(str) {\n        if (!str || typeof str !== 'string') return false;\n        // UUID v4 format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (36 chars with dashes)\n        // Python uuid.uuid4() without dashes: 32 hex chars\n        // Allow both formats\n        return /^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i.test(str) ||\n               /^[a-f0-9]{32}$/i.test(str);\n    }\n\n    /**\n     * Attempt to connect with existing session (Story 11.2)\n     * Called when page loads and session cookie exists\n     */\n    function connectWithSession() {\n        var sessionId = getSessionCookie();\n        if (!sessionId || !isValidUUID(sessionId)) {\n            // No session or invalid format, clear and show join form\n            if (sessionId) clearSessionCookie();\n            showView('join-view');\n            return;\n        }\n\n        var wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n        var wsUrl = wsProtocol + '//' + window.location.host + '/beatify/ws';\n\n        ws = new WebSocket(wsUrl);\n\n        ws.onopen = function() {\n            reconnectAttempts = 0;\n            isReconnecting = false;\n            hideReconnectingOverlay();\n\n            // Send reconnect message with session ID\n            ws.send(JSON.stringify({\n                type: 'reconnect',\n                session_id: sessionId\n            }));\n        };\n\n        ws.onmessage = function(event) {\n            try {\n                var data = JSON.parse(event.data);\n                handleServerMessage(data);\n            } catch (e) {\n                console.error('Failed to parse WebSocket message:', e);\n            }\n        };\n\n        ws.onclose = function() {\n            // If we have a playerName (reconnect succeeded), try to reconnect\n            if (playerName && reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {\n                isReconnecting = true;\n                reconnectAttempts++;\n                showReconnectingOverlay();\n                updateReconnectStatus(reconnectAttempts);\n\n                var delay = getReconnectDelay();\n                console.log('WebSocket closed. Reconnecting in ' + delay + 'ms... (attempt ' + reconnectAttempts + ')');\n                setTimeout(function() { connectWithSession(); }, delay);\n            } else if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                isReconnecting = false;\n                hideReconnectingOverlay();\n                showConnectionLostView();\n            } else {\n                // No playerName means reconnect failed, show join form\n                showView('join-view');\n            }\n        };\n\n        ws.onerror = function(err) {\n            console.error('WebSocket error:', err);\n        };\n    }\n\n    /**\n     * Show welcome back toast (Story 11.2)\n     * @param {string} name - Player name\n     */\n    function showWelcomeBackToast(name) {\n        var indicator = document.getElementById('volume-indicator');\n        if (indicator) {\n            indicator.textContent = 'Welcome back, ' + name + '!';\n            indicator.classList.remove('hidden');\n            indicator.classList.add('is-visible');\n            setTimeout(function() {\n                indicator.classList.remove('is-visible');\n                setTimeout(function() {\n                    indicator.classList.add('hidden');\n                }, 300);\n            }, 2000);\n        }\n    }\n\n    // ============================================\n    // Name Entry & Join Form (Story 3.1)\n    // ============================================\n\n    const MAX_NAME_LENGTH = 20;\n\n    // ============================================\n    // Player List Rendering (Story 3.3)\n    // ============================================\n\n    let previousPlayers = [];\n\n    /**\n     * Escape HTML to prevent XSS\n     * @param {string} text - Text to escape\n     * @returns {string} Escaped text\n     */\n    function escapeHtml(text) {\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    }\n\n    /**\n     * Render player list in lobby (Story 18.2: Virtual scrolling for 15+ players)\n     * @param {Array} players - Array of player objects\n     */\n    function renderPlayerList(players) {\n        const listEl = document.getElementById('player-list');\n        const countEl = document.getElementById('player-count');\n        if (!listEl) return;\n\n        // Update player count (Story 16.3 - i18n)\n        if (countEl) {\n            const count = players.length;\n            countEl.textContent = count === 1\n                ? t('lobby.playerJoined')\n                : t('lobby.playersJoined', { count: count });\n        }\n\n        // Story 11.4: Sort players - connected first, then disconnected\n        var sortedPlayers = players.slice().sort(function(a, b) {\n            if (a.connected !== b.connected) {\n                return a.connected ? -1 : 1;\n            }\n            return 0;  // Preserve order within groups\n        });\n\n        // Find new players by comparing with previous list\n        const previousNames = previousPlayers.map(function(p) { return p.name; });\n        const newNames = sortedPlayers\n            .filter(function(p) { return previousNames.indexOf(p.name) === -1; })\n            .map(function(p) { return p.name; });\n\n        // Story 18.2: Initialize virtual list if not already done\n        if (!virtualPlayerList.container) {\n            initVirtualPlayerList(listEl);\n        }\n\n        // Create render function for player cards\n        var renderPlayerCard = function(player) {\n            var isNew = newNames.indexOf(player.name) !== -1;\n            var isYou = player.name === playerName;\n            var isDisconnected = player.connected === false;\n            var classes = [\n                'player-card',\n                isNew ? 'is-new' : '',\n                isYou ? 'player-card--you' : '',\n                isDisconnected ? 'player-card--disconnected' : ''\n            ].filter(Boolean).join(' ');\n\n            // Story 11.4: Add \"(away)\" badge for disconnected players\n            var awayBadge = isDisconnected ? '<span class=\"away-badge\">(away)</span>' : '';\n\n            return '<div class=\"' + classes + '\" data-player=\"' + escapeHtml(player.name) + '\">' +\n                '<span class=\"player-name\">' +\n                    escapeHtml(player.name) +\n                    (isYou ? '<span class=\"you-badge\">' + t('leaderboard.you') + '</span>' : '') +\n                    awayBadge +\n                '</span>' +\n            '</div>';\n        };\n\n        // Story 18.2: Use virtual list (threshold-based)\n        setVirtualPlayerListItems(sortedPlayers, renderPlayerCard);\n\n        // Remove .is-new class after animation\n        setTimeout(function() {\n            var container = virtualPlayerList.isVirtual ? virtualPlayerList.contentWrapper : listEl;\n            if (!container) return;\n            const newCards = container.querySelectorAll('.is-new');\n            for (let i = 0; i < newCards.length; i++) {\n                newCards[i].classList.remove('is-new');\n            }\n        }, 2000);\n\n        previousPlayers = players.slice();\n    }\n\n    // ============================================\n    // Difficulty Badge (Story 14.1)\n    // ============================================\n\n    /**\n     * Render difficulty badge in lobby and game views\n     * @param {string} difficulty - Difficulty level ('easy', 'normal', or 'hard')\n     */\n    function renderDifficultyBadge(difficulty) {\n        var labelKey = {\n            easy: 'game.difficultyEasy',\n            normal: 'game.difficultyNormal',\n            hard: 'game.difficultyHard'\n        }[difficulty] || 'game.difficultyNormal';\n\n        var label = t(labelKey);\n\n        // Update both lobby and game view badges\n        var lobbyBadge = document.getElementById('lobby-difficulty-badge');\n        var gameBadge = document.getElementById('game-difficulty-badge');\n\n        if (lobbyBadge) {\n            lobbyBadge.textContent = label;\n            lobbyBadge.className = 'difficulty-badge difficulty-badge--' + (difficulty || 'normal');\n        }\n\n        if (gameBadge) {\n            gameBadge.textContent = label;\n            gameBadge.className = 'difficulty-badge difficulty-badge--' + (difficulty || 'normal');\n        }\n    }\n\n    // ============================================\n    // QR Code Sharing (Story 3.4)\n    // ============================================\n\n    let currentJoinUrl = null;\n\n    /**\n     * Render QR code for sharing\n     * @param {string} joinUrl - URL to encode in QR\n     */\n    function renderQRCode(joinUrl) {\n        if (!joinUrl) return;\n        currentJoinUrl = joinUrl;\n\n        var container = document.getElementById('player-qr-code');\n        if (!container) return;\n\n        // Clear previous QR\n        container.innerHTML = '';\n\n        // Generate QR code using qrcodejs (matches admin.js pattern)\n        if (typeof QRCode !== 'undefined') {\n            new QRCode(container, {\n                text: joinUrl,\n                width: 128,\n                height: 128,\n                colorDark: '#000000',\n                colorLight: '#ffffff',\n                correctLevel: QRCode.CorrectLevel.M\n            });\n        } else {\n            container.innerHTML = '<p class=\"status-error\">QR code library not loaded</p>';\n        }\n\n        // Add click handler for modal\n        container.onclick = openQRModal;\n        container.onkeydown = function(e) {\n            if (e.key === 'Enter' || e.key === ' ') {\n                e.preventDefault();\n                openQRModal();\n            }\n        };\n    }\n\n    /**\n     * Open QR modal with enlarged code\n     */\n    function openQRModal() {\n        if (!currentJoinUrl) return;\n\n        var modal = document.getElementById('qr-modal');\n        var modalCode = document.getElementById('qr-modal-code');\n        if (!modal || !modalCode) return;\n\n        // Clear and render larger QR\n        modalCode.innerHTML = '';\n\n        // Generate larger QR code using qrcodejs (matches admin.js pattern)\n        if (typeof QRCode !== 'undefined') {\n            new QRCode(modalCode, {\n                text: currentJoinUrl,\n                width: 256,\n                height: 256,\n                colorDark: '#000000',\n                colorLight: '#ffffff',\n                correctLevel: QRCode.CorrectLevel.M\n            });\n        } else {\n            modalCode.innerHTML = '<p class=\"status-error\">QR code library not loaded</p>';\n        }\n\n        modal.classList.remove('hidden');\n        document.body.style.overflow = 'hidden';\n\n        // Focus close button for accessibility\n        var closeBtn = document.getElementById('qr-modal-close');\n        if (closeBtn) closeBtn.focus();\n    }\n\n    /**\n     * Close QR modal\n     */\n    function closeQRModal() {\n        var modal = document.getElementById('qr-modal');\n        if (modal) {\n            modal.classList.add('hidden');\n            document.body.style.overflow = '';\n        }\n    }\n\n    /**\n     * Setup QR modal event handlers\n     */\n    function setupQRModal() {\n        var modal = document.getElementById('qr-modal');\n        var backdrop = modal ? modal.querySelector('.qr-modal-backdrop') : null;\n        var closeBtn = document.getElementById('qr-modal-close');\n\n        if (backdrop) {\n            backdrop.addEventListener('click', closeQRModal);\n        }\n        if (closeBtn) {\n            closeBtn.addEventListener('click', closeQRModal);\n        }\n\n        // Close on Escape key\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {\n                closeQRModal();\n            }\n        });\n    }\n\n    // ============================================\n    // Invite Modal (Story 16.5)\n    // ============================================\n\n    /**\n     * Open invite modal with QR code and URL for late joiners\n     */\n    function openInviteModal() {\n        if (!currentJoinUrl) return;\n\n        var modal = document.getElementById('invite-modal');\n        var modalCode = document.getElementById('invite-modal-code');\n        var urlInput = document.getElementById('invite-modal-url');\n        if (!modal || !modalCode) return;\n\n        // Clear and render QR code\n        modalCode.innerHTML = '';\n\n        if (typeof QRCode !== 'undefined') {\n            new QRCode(modalCode, {\n                text: currentJoinUrl,\n                width: 256,\n                height: 256,\n                colorDark: '#000000',\n                colorLight: '#ffffff',\n                correctLevel: QRCode.CorrectLevel.M\n            });\n        } else {\n            modalCode.innerHTML = '<p class=\"status-error\">QR code library not loaded</p>';\n        }\n\n        // Set URL in input field\n        if (urlInput) {\n            urlInput.value = currentJoinUrl;\n        }\n\n        modal.classList.remove('hidden');\n        document.body.style.overflow = 'hidden';\n\n        // Focus close button for accessibility\n        var closeBtn = document.getElementById('invite-modal-close');\n        if (closeBtn) closeBtn.focus();\n    }\n\n    /**\n     * Close invite modal\n     */\n    function closeInviteModal() {\n        var modal = document.getElementById('invite-modal');\n        if (modal) {\n            modal.classList.add('hidden');\n            document.body.style.overflow = '';\n        }\n        // Hide copy feedback\n        var feedback = document.getElementById('invite-copy-feedback');\n        if (feedback) feedback.classList.add('hidden');\n    }\n\n    /**\n     * Copy join URL to clipboard\n     */\n    function copyJoinUrl() {\n        var urlInput = document.getElementById('invite-modal-url');\n        var feedback = document.getElementById('invite-copy-feedback');\n        if (!urlInput || !currentJoinUrl) return;\n\n        // Use Clipboard API if available, otherwise fallback to select/copy\n        if (navigator.clipboard && navigator.clipboard.writeText) {\n            navigator.clipboard.writeText(currentJoinUrl).then(function() {\n                showCopyFeedback(feedback);\n            }).catch(function() {\n                fallbackCopy(urlInput, feedback);\n            });\n        } else {\n            fallbackCopy(urlInput, feedback);\n        }\n    }\n\n    /**\n     * Fallback copy method for older browsers\n     * @param {HTMLInputElement} urlInput - The input element\n     * @param {HTMLElement} feedback - The feedback element\n     */\n    function fallbackCopy(urlInput, feedback) {\n        urlInput.select();\n        urlInput.setSelectionRange(0, 99999); // For mobile\n        try {\n            document.execCommand('copy');\n            showCopyFeedback(feedback);\n        } catch (e) {\n            console.warn('[Beatify] Copy failed:', e);\n        }\n    }\n\n    /**\n     * Show copy success feedback\n     * @param {HTMLElement} feedback - The feedback element\n     */\n    function showCopyFeedback(feedback) {\n        if (!feedback) return;\n        feedback.classList.remove('hidden');\n        // Auto-hide after animation\n        setTimeout(function() {\n            feedback.classList.add('hidden');\n        }, 2000);\n    }\n\n    /**\n     * Setup invite modal event handlers\n     */\n    function setupInviteModal() {\n        var modal = document.getElementById('invite-modal');\n        var backdrop = modal ? modal.querySelector('.invite-modal-backdrop') : null;\n        var closeBtn = document.getElementById('invite-modal-close');\n        var inviteBtn = document.getElementById('invite-players-btn');\n        var copyBtn = document.getElementById('invite-copy-btn');\n\n        if (backdrop) {\n            backdrop.addEventListener('click', closeInviteModal);\n        }\n        if (closeBtn) {\n            closeBtn.addEventListener('click', closeInviteModal);\n        }\n        if (inviteBtn) {\n            inviteBtn.addEventListener('click', openInviteModal);\n        }\n        if (copyBtn) {\n            copyBtn.addEventListener('click', copyJoinUrl);\n        }\n\n        // Close on Escape key\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {\n                closeInviteModal();\n            }\n        });\n    }\n\n    // ============================================\n    // Countdown Timer (Story 4.2)\n    // ============================================\n\n    let countdownInterval = null;\n\n    /**\n     * Start countdown timer\n     * @param {number} deadline - Server deadline timestamp in milliseconds\n     */\n    function startCountdown(deadline) {\n        // Clear any existing countdown\n        stopCountdown();\n\n        var timerElement = document.getElementById('timer');\n        if (!timerElement) return;\n\n        // Remove previous state classes\n        timerElement.classList.remove('timer--warning', 'timer--critical');\n\n        function updateCountdown() {\n            var now = Date.now();\n            var remaining = Math.max(0, Math.ceil((deadline - now) / 1000));\n\n            timerElement.textContent = remaining;\n\n            // Update timer color based on remaining time\n            if (remaining <= 5) {\n                timerElement.classList.remove('timer--warning');\n                timerElement.classList.add('timer--critical');\n            } else if (remaining <= 10) {\n                timerElement.classList.remove('timer--critical');\n                timerElement.classList.add('timer--warning');\n            } else {\n                timerElement.classList.remove('timer--warning', 'timer--critical');\n            }\n\n            // ARIA announcements at key moments (Story 9.7)\n            if (remaining === 10) {\n                timerElement.setAttribute('aria-label', '10 seconds remaining');\n            } else if (remaining === 5) {\n                timerElement.setAttribute('aria-label', '5 seconds!');\n            } else if (remaining === 0) {\n                timerElement.setAttribute('aria-label', 'Time is up!');\n            } else {\n                timerElement.setAttribute('aria-label', 'Time remaining: ' + remaining + ' seconds');\n            }\n\n            // Stop countdown when reaching 0\n            if (remaining <= 0) {\n                stopCountdown();\n            }\n        }\n\n        // Initial update immediately\n        updateCountdown();\n\n        // Then update every second\n        countdownInterval = setInterval(updateCountdown, 1000);\n    }\n\n    /**\n     * Stop countdown timer\n     */\n    function stopCountdown() {\n        if (countdownInterval) {\n            clearInterval(countdownInterval);\n            countdownInterval = null;\n        }\n    }\n\n    /**\n     * Update game view with round data\n     * @param {Object} data - State data from server\n     */\n    function updateGameView(data) {\n        // Update round indicator\n        var currentRound = document.getElementById('current-round');\n        var totalRounds = document.getElementById('total-rounds');\n        var lastRoundBanner = document.getElementById('last-round-banner');\n\n        if (currentRound) currentRound.textContent = data.round || 1;\n        if (totalRounds) totalRounds.textContent = data.total_rounds || 10;\n\n        // Show/hide last round banner\n        if (lastRoundBanner) {\n            if (data.last_round) {\n                lastRoundBanner.classList.remove('hidden');\n            } else {\n                lastRoundBanner.classList.add('hidden');\n            }\n        }\n\n        // Update album cover\n        var albumCover = document.getElementById('album-cover');\n        var albumLoading = document.getElementById('album-loading');\n\n        if (albumCover && data.song) {\n            // Show loading state\n            if (albumLoading) albumLoading.classList.remove('hidden');\n\n            var newSrc = data.song.album_art || '/beatify/static/img/no-artwork.svg';\n\n            // Handle image load\n            albumCover.onload = function() {\n                if (albumLoading) albumLoading.classList.add('hidden');\n            };\n\n            // Handle image error - fallback to placeholder\n            albumCover.onerror = function() {\n                albumCover.src = '/beatify/static/img/no-artwork.svg';\n                if (albumLoading) albumLoading.classList.add('hidden');\n            };\n\n            albumCover.src = newSrc;\n        }\n\n        // Render submission tracker\n        renderSubmissionTracker(data.players);\n\n        // Update leaderboard (Story 5.5)\n        if (data.leaderboard) {\n            updateLeaderboard(data, 'leaderboard-list');\n        }\n\n        // Update steal UI (Story 15.3)\n        updateStealUI(data.players);\n    }\n\n    // ============================================\n    // Submission Tracker (Story 4.4)\n    // ============================================\n\n    /**\n     * Get initials from player name\n     * @param {string} name - Player name\n     * @returns {string} Initials (1-2 characters)\n     */\n    function getInitials(name) {\n        if (!name) return '?';\n        var trimmed = name.trim();\n        if (!trimmed) return '?';\n\n        // Handle hyphenated names: \"Mary-Jane\" -> \"MJ\"\n        var parts = trimmed.split(/[\\s-]+/).filter(Boolean);\n        if (parts.length >= 2) {\n            return (parts[0][0] + parts[1][0]).toUpperCase();\n        }\n        // Single word: take first 2 chars, or 1 if single char name\n        return trimmed.slice(0, Math.min(2, trimmed.length)).toUpperCase();\n    }\n\n    /**\n     * Render submission tracker showing who has submitted\n     * @param {Array} players - Array of player objects\n     */\n    function renderSubmissionTracker(players) {\n        var tracker = document.getElementById('submission-tracker');\n        var container = document.getElementById('submitted-players');\n        var countEl = document.getElementById('submission-count');\n\n        if (!tracker || !container || !countEl) return;\n\n        var playerList = players || [];\n        var submittedCount = playerList.filter(function(p) {\n            return p.submitted;\n        }).length;\n        var totalCount = playerList.length;\n\n        // Update count (Story 16.3 - i18n)\n        countEl.textContent = t('game.submittedCount', { count: submittedCount, total: totalCount });\n\n        // Check if all submitted\n        var allSubmitted = submittedCount === totalCount && totalCount > 0;\n        tracker.classList.toggle('all-submitted', allSubmitted);\n\n        // Compact mode for many players\n        var isCompact = playerList.length > 10;\n        tracker.classList.toggle('is-compact', isCompact);\n\n        if (isCompact) {\n            container.innerHTML = '';\n            return;\n        }\n\n        // Render player indicators (Story 9.10: added is-betting class, Story 11.4: disconnected)\n        container.innerHTML = playerList.map(function(player) {\n            var initials = getInitials(player.name);\n            var isCurrentPlayer = player.name === playerName;\n            var isDisconnected = player.connected === false;\n            var classes = [\n                'player-indicator',\n                player.submitted ? 'is-submitted' : '',\n                isCurrentPlayer ? 'is-current-player' : '',\n                player.bet ? 'is-betting' : '',\n                isDisconnected ? 'player-indicator--disconnected' : ''\n            ].filter(Boolean).join(' ');\n\n            return '<div class=\"' + classes + '\">' +\n                '<div class=\"player-avatar\">' +\n                    '<span class=\"player-initials\">' + escapeHtml(initials) + '</span>' +\n                '</div>' +\n                '<span class=\"player-name\">' + escapeHtml(player.name) + '</span>' +\n            '</div>';\n        }).join('');\n    }\n\n    // ============================================\n    // Leaderboard (Story 5.5)\n    // ============================================\n\n    /**\n     * Update leaderboard display (Story 18.1: Lazy loading for 10+ players)\n     * @param {Object} data - State data containing leaderboard\n     * @param {string} targetListId - ID of list container (for different views)\n     * @param {boolean} isRevealPhase - True if rendering during REVEAL phase (animate scores)\n     */\n    function updateLeaderboard(data, targetListId, isRevealPhase) {\n        var leaderboard = data.leaderboard || [];\n        var listEl = document.getElementById(targetListId || 'leaderboard-list');\n        if (!listEl) return;\n\n        // Story 13.2: Skip animations on first state (reconnect case)\n        var shouldAnimate = isRevealPhase && isPreviousStateInitialized();\n\n        // Detect rank changes using Story 13.2 utilities (only if animating)\n        var rankChanges = shouldAnimate ? detectRankChanges(leaderboard) : {};\n\n        // Mark is_current client-side and add metadata for rendering\n        leaderboard.forEach(function(entry) {\n            entry.is_current = (entry.name === playerName);\n\n            // Add rank change class for renderLeaderboardEntry\n            var rankChange = rankChanges[entry.name];\n            if (rankChange) {\n                entry._rankChange = rankChange;\n            }\n\n            // Get previous score for animation (Story 13.2)\n            var prevPlayer = previousState.players[entry.name];\n            var prevScore = prevPlayer ? prevPlayer.score : entry.score;\n            entry._prevScore = prevScore;\n            entry._displayScore = isRevealPhase ? prevScore : entry.score;\n        });\n\n        // Smart compression for >10 players (Story 9.5)\n        var displayList = compressLeaderboard(leaderboard, playerName);\n\n        // Story 18.1: Use lazy loading for large player lists\n        var useLazyLoading = leaderboard.length >= LEADERBOARD_LAZY_CONFIG.MIN_PLAYERS_FOR_LAZY;\n\n        if (useLazyLoading) {\n            // Initialize observer if not already done\n            if (!lazyLeaderboardState.observer) {\n                initLeaderboardObserver(listEl);\n            }\n\n            // Store full data for lazy rendering\n            lazyLeaderboardState.fullData = displayList;\n            lazyLeaderboardState.isLazyEnabled = true;\n            lazyLeaderboardState.listEl = listEl;\n\n            // Calculate initial visible range centered on current player\n            lazyLeaderboardState.visibleRange = calculateInitialVisibleRange(displayList, playerName);\n\n            // Render visible range with spacers\n            renderLazyLeaderboardRange();\n        } else {\n            // Disable lazy loading for small lists\n            lazyLeaderboardState.isLazyEnabled = false;\n\n            // Standard rendering for small lists\n            var html = '';\n            displayList.forEach(function(entry) {\n                html += renderLeaderboardEntry(entry);\n            });\n\n            listEl.innerHTML = html;\n        }\n\n        // Store entries that need score animation (Story 13.2)\n        var scoreAnimations = [];\n        if (shouldAnimate) {\n            displayList.forEach(function(entry) {\n                if (!entry.separator && entry._prevScore !== entry.score) {\n                    scoreAnimations.push({\n                        name: entry.name,\n                        prevScore: entry._prevScore,\n                        newScore: entry.score\n                    });\n                }\n            });\n        }\n\n        // Animate score values within leaderboard entries (Story 13.2)\n        if (shouldAnimate && scoreAnimations.length > 0) {\n            // Use requestAnimationFrame for batched DOM updates (Story 18.1)\n            requestAnimationFrame(function() {\n                // Build a map of name -> entry element for safe lookup (avoids CSS selector injection)\n                var entryMap = {};\n                var entries = listEl.querySelectorAll('.leaderboard-entry[data-name]');\n                for (var i = 0; i < entries.length; i++) {\n                    var entry = entries[i];\n                    var name = entry.getAttribute('data-name');\n                    if (name) {\n                        entryMap[name] = entry;\n                    }\n                }\n\n                scoreAnimations.forEach(function(anim) {\n                    var entryEl = entryMap[anim.name];\n                    if (entryEl) {\n                        var scoreEl = entryEl.querySelector('.entry-score');\n                        if (scoreEl) {\n                            animateValue(scoreEl, anim.prevScore, anim.newScore, 500);\n                        }\n                    }\n                });\n            });\n        }\n\n        // Scroll to current player if many players\n        if (leaderboard.length > 8) {\n            scrollToCurrentPlayer(listEl);\n        }\n\n        // Update quick indicator\n        updateYouIndicator(leaderboard);\n\n        // Update previous state for next comparison (Story 13.2)\n        updatePreviousState(data.players || [], leaderboard);\n    }\n\n    /**\n     * Compress leaderboard for display when >10 players (Story 9.5)\n     * Shows: top 5, separator, current player if not in top/bottom, separator, bottom 3\n     * @param {Array} players - Full leaderboard\n     * @param {string} currentPlayerName - Name of current player\n     * @returns {Array} Compressed display list\n     */\n    function compressLeaderboard(players, currentPlayerName) {\n        if (players.length <= 10) return players;\n\n        var top5 = players.slice(0, 5);\n        var bottom3 = players.slice(-3);\n        var currentIdx = -1;\n\n        // Find current player index\n        for (var i = 0; i < players.length; i++) {\n            if (players[i].name === currentPlayerName) {\n                currentIdx = i;\n                break;\n            }\n        }\n\n        // If current player in top 5 or bottom 3, no middle section needed\n        if (currentIdx < 5 || currentIdx >= players.length - 3) {\n            return [].concat(top5, [{ separator: true }], bottom3);\n        }\n\n        // Show current player in middle\n        return [].concat(\n            top5,\n            [{ separator: true }],\n            [players[currentIdx]],\n            [{ separator: true }],\n            bottom3\n        );\n    }\n\n    /**\n     * Scroll leaderboard to show current player\n     * @param {Element} listEl - Leaderboard list element\n     */\n    function scrollToCurrentPlayer(listEl) {\n        var currentEntry = listEl.querySelector('.leaderboard-entry.is-current');\n        if (currentEntry) {\n            currentEntry.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        }\n    }\n\n    /**\n     * Update \"You: #X\" quick indicator\n     * @param {Array} leaderboard - Leaderboard entries\n     */\n    function updateYouIndicator(leaderboard) {\n        var youEl = document.getElementById('leaderboard-you');\n        var currentPlayer = leaderboard.find(function(e) { return e.is_current; });\n        if (youEl && currentPlayer) {\n            youEl.textContent = t('leaderboard.you') + ' #' + currentPlayer.rank;\n            youEl.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Setup leaderboard toggle behavior\n     */\n    function setupLeaderboardToggle() {\n        var toggle = document.getElementById('leaderboard-toggle');\n        var leaderboard = document.getElementById('game-leaderboard');\n        if (toggle && leaderboard) {\n            toggle.addEventListener('click', function() {\n                leaderboard.classList.toggle('is-expanded');\n                var icon = toggle.querySelector('.toggle-icon');\n                if (icon) {\n                    icon.textContent = leaderboard.classList.contains('is-expanded') ? '\u25B2' : '\u25BC';\n                }\n            });\n        }\n    }\n\n    // ============================================\n    // Year Selector & Submission (Story 4.3)\n    // ============================================\n\n    let hasSubmitted = false;\n    let betActive = false;  // Betting state (Story 5.3)\n    let currentRoundNumber = 0;  // Track round to detect new rounds\n    let hasStealAvailable = false;  // Steal power-up state (Story 15.3)\n\n    /**\n     * Initialize year selector interaction\n     */\n    function initYearSelector() {\n        var slider = document.getElementById('year-slider');\n        var yearDisplay = document.getElementById('selected-year');\n\n        if (!slider || !yearDisplay) return;\n\n        // Update display on slider change\n        slider.addEventListener('input', function() {\n            yearDisplay.textContent = this.value;\n        });\n\n        // Bet toggle handler (Story 5.3)\n        var betToggle = document.getElementById('bet-toggle');\n        if (betToggle) {\n            betToggle.addEventListener('click', function() {\n                if (hasSubmitted) return;\n                betActive = !betActive;\n                betToggle.classList.toggle('is-active', betActive);\n            });\n        }\n\n        // Submit button handler\n        var submitBtn = document.getElementById('submit-btn');\n        if (submitBtn) {\n            submitBtn.addEventListener('click', handleSubmitGuess);\n        }\n\n        // Steal button handler (Story 15.3)\n        var stealBtn = document.getElementById('steal-btn');\n        if (stealBtn) {\n            stealBtn.addEventListener('click', handleStealClick);\n        }\n\n        // Steal modal close handler\n        var stealModalClose = document.getElementById('steal-modal-close');\n        if (stealModalClose) {\n            stealModalClose.addEventListener('click', closeStealModal);\n        }\n\n        // Steal modal backdrop click to close\n        var stealModal = document.getElementById('steal-modal');\n        if (stealModal) {\n            var backdrop = stealModal.querySelector('.steal-modal-backdrop');\n            if (backdrop) {\n                backdrop.addEventListener('click', closeStealModal);\n            }\n        }\n    }\n\n    /**\n     * Handle guess submission\n     */\n    function handleSubmitGuess() {\n        if (hasSubmitted) return;\n\n        var slider = document.getElementById('year-slider');\n        var submitBtn = document.getElementById('submit-btn');\n\n        if (!slider || !submitBtn) return;\n\n        var year = parseInt(slider.value, 10);\n\n        // Disable and show loading\n        submitBtn.disabled = true;\n        submitBtn.classList.add('is-loading');\n\n        // Send submission via WebSocket (with bet flag - Story 5.3)\n        if (ws && ws.readyState === WebSocket.OPEN) {\n            ws.send(JSON.stringify({\n                type: 'submit',\n                year: year,\n                bet: betActive\n            }));\n        } else {\n            // WebSocket not connected\n            showSubmitError('Connection lost. Please refresh.');\n            submitBtn.disabled = false;\n            submitBtn.classList.remove('is-loading');\n        }\n    }\n\n    /**\n     * Handle server acknowledgment of submission\n     */\n    function handleSubmitAck() {\n        hasSubmitted = true;\n\n        var yearSelector = document.getElementById('year-selector');\n        var submitBtn = document.getElementById('submit-btn');\n        var confirmation = document.getElementById('submitted-confirmation');\n        var betToggle = document.getElementById('bet-toggle');\n\n        if (yearSelector) {\n            yearSelector.classList.add('is-submitted');\n        }\n\n        if (submitBtn) {\n            submitBtn.classList.add('hidden');\n        }\n\n        // Hide bet toggle after submission (Story 5.3)\n        if (betToggle) {\n            betToggle.classList.add('hidden');\n        }\n\n        if (confirmation) {\n            confirmation.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Handle submission error\n     * @param {Object} data - Error data from server\n     */\n    function handleSubmitError(data) {\n        var submitBtn = document.getElementById('submit-btn');\n\n        if (submitBtn) {\n            submitBtn.disabled = false;\n            submitBtn.classList.remove('is-loading');\n        }\n\n        if (data.code === 'ROUND_EXPIRED') {\n            showSubmitError(\"Time's up!\");\n            // Disable further attempts\n            hasSubmitted = true;\n            if (submitBtn) submitBtn.disabled = true;\n        } else if (data.code === 'ALREADY_SUBMITTED') {\n            // Already submitted, update UI\n            handleSubmitAck();\n        } else {\n            showSubmitError(data.message || 'Submission failed');\n        }\n    }\n\n    /**\n     * Show error on submit button\n     * @param {string} message - Error message\n     */\n    function showSubmitError(message) {\n        var submitBtn = document.getElementById('submit-btn');\n        if (submitBtn) {\n            submitBtn.textContent = message;\n            submitBtn.classList.add('is-error');\n            setTimeout(function() {\n                submitBtn.textContent = t('game.submitGuess');\n                submitBtn.classList.remove('is-error');\n            }, 2000);\n        }\n    }\n\n    /**\n     * Reset submission state for new round\n     */\n    function resetSubmissionState() {\n        hasSubmitted = false;\n        betActive = false;  // Reset bet (Story 5.3)\n\n        var yearSelector = document.getElementById('year-selector');\n        var submitBtn = document.getElementById('submit-btn');\n        var confirmation = document.getElementById('submitted-confirmation');\n        var slider = document.getElementById('year-slider');\n        var betToggle = document.getElementById('bet-toggle');\n\n        if (yearSelector) {\n            yearSelector.classList.remove('is-submitted');\n        }\n\n        if (submitBtn) {\n            submitBtn.disabled = false;\n            submitBtn.classList.remove('hidden', 'is-loading', 'is-error');\n            submitBtn.textContent = t('game.submitGuess');\n        }\n\n        // Reset bet toggle (Story 5.3)\n        if (betToggle) {\n            betToggle.classList.remove('hidden', 'is-active');\n        }\n\n        if (confirmation) {\n            confirmation.classList.add('hidden');\n        }\n\n        // Reset slider to middle value\n        if (slider) {\n            slider.value = 1990;\n            var yearDisplay = document.getElementById('selected-year');\n            if (yearDisplay) yearDisplay.textContent = '1990';\n        }\n\n        // Reset steal UI (Story 15.3)\n        hasStealAvailable = false;\n        hideStealUI();\n    }\n\n    // ============================================\n    // Steal Power-up (Story 15.3)\n    // ============================================\n\n    /**\n     * Update steal UI based on player state\n     * @param {Array} players - Array of player objects\n     */\n    function updateStealUI(players) {\n        if (!playerName || !players) return;\n\n        // Find current player's data\n        var currentPlayer = players.find(function(p) {\n            return p.name === playerName;\n        });\n\n        if (!currentPlayer) return;\n\n        hasStealAvailable = currentPlayer.steal_available && !hasSubmitted;\n\n        var stealIndicator = document.getElementById('steal-indicator');\n        var stealBtn = document.getElementById('steal-btn');\n\n        if (hasStealAvailable) {\n            // Show steal indicator and button\n            if (stealIndicator) stealIndicator.classList.remove('hidden');\n            if (stealBtn) stealBtn.classList.remove('hidden');\n        } else {\n            // Hide steal UI\n            hideStealUI();\n        }\n    }\n\n    /**\n     * Hide all steal UI elements\n     */\n    function hideStealUI() {\n        var stealIndicator = document.getElementById('steal-indicator');\n        var stealBtn = document.getElementById('steal-btn');\n\n        if (stealIndicator) stealIndicator.classList.add('hidden');\n        if (stealBtn) stealBtn.classList.add('hidden');\n    }\n\n    /**\n     * Handle steal button click - request targets and open modal\n     */\n    function handleStealClick() {\n        if (!hasStealAvailable || hasSubmitted) return;\n\n        // Request available steal targets from server\n        if (ws && ws.readyState === WebSocket.OPEN) {\n            ws.send(JSON.stringify({ type: 'get_steal_targets' }));\n        }\n    }\n\n    /**\n     * Open steal modal with available targets\n     * @param {Array} targets - Array of player names who have submitted\n     */\n    function openStealModal(targets) {\n        var modal = document.getElementById('steal-modal');\n        var targetList = document.getElementById('steal-target-list');\n\n        if (!modal || !targetList) return;\n\n        // Clear previous targets\n        targetList.innerHTML = '';\n\n        if (!targets || targets.length === 0) {\n            // No valid targets - show waiting message\n            var noTargets = document.createElement('p');\n            noTargets.className = 'steal-no-targets';\n            noTargets.textContent = t('steal.waitForSubmit');\n            targetList.appendChild(noTargets);\n        } else {\n            // Render target buttons\n            targets.forEach(function(target) {\n                var btn = document.createElement('button');\n                btn.className = 'steal-target-btn';\n                btn.textContent = target;\n                btn.addEventListener('click', function() {\n                    selectStealTarget(target);\n                });\n                targetList.appendChild(btn);\n            });\n        }\n\n        modal.classList.remove('hidden');\n    }\n\n    /**\n     * Close steal modal\n     */\n    function closeStealModal() {\n        var modal = document.getElementById('steal-modal');\n        if (modal) modal.classList.add('hidden');\n    }\n\n    /**\n     * Select a steal target and confirm\n     * @param {string} targetName - Name of player to steal from\n     */\n    function selectStealTarget(targetName) {\n        // Show confirmation dialog\n        var confirmMsg = t('steal.confirm').replace('{name}', targetName);\n        if (!confirm(confirmMsg)) {\n            return;\n        }\n\n        // Send steal request to server\n        if (ws && ws.readyState === WebSocket.OPEN) {\n            ws.send(JSON.stringify({\n                type: 'steal',\n                target: targetName\n            }));\n        }\n\n        // Close modal\n        closeStealModal();\n    }\n\n    /**\n     * Handle steal acknowledgment from server\n     * @param {Object} data - Response data with target and year\n     */\n    function handleStealAck(data) {\n        if (data.success) {\n            // Update local state\n            hasStealAvailable = false;\n            hasSubmitted = true;\n\n            // Hide steal UI\n            hideStealUI();\n\n            // Show submit confirmation\n            var yearSelector = document.getElementById('year-selector');\n            var submitBtn = document.getElementById('submit-btn');\n            var confirmation = document.getElementById('submitted-confirmation');\n\n            if (yearSelector) yearSelector.classList.add('is-submitted');\n            if (submitBtn) submitBtn.classList.add('hidden');\n            if (confirmation) confirmation.classList.remove('hidden');\n\n            // Show steal-specific confirmation toast\n            showStealConfirmation(data.target, data.year);\n\n            // Update year display to show stolen year\n            var yearDisplay = document.getElementById('selected-year');\n            var slider = document.getElementById('year-slider');\n            if (yearDisplay) yearDisplay.textContent = data.year;\n            if (slider) slider.value = data.year;\n        }\n    }\n\n    /**\n     * Handle steal targets response from server\n     * @param {Object} data - Response data with targets array\n     */\n    function handleStealTargets(data) {\n        openStealModal(data.targets || []);\n    }\n\n    /**\n     * Show steal confirmation toast\n     * @param {string} target - Name of player stolen from\n     * @param {number} year - The stolen year guess\n     */\n    function showStealConfirmation(target, year) {\n        var toast = document.getElementById('steal-confirmation');\n        var text = document.getElementById('steal-confirmation-text');\n\n        if (!toast || !text) return;\n\n        // Set message\n        var msg = t('steal.success')\n            .replace('{name}', target)\n            .replace('{year}', year);\n        text.textContent = msg;\n\n        // Show toast\n        toast.classList.remove('hidden');\n\n        // Hide after 3 seconds\n        setTimeout(function() {\n            toast.classList.add('hidden');\n        }, 3000);\n    }\n\n    // ============================================\n    // Reveal View (Story 4.6)\n    // ============================================\n\n    /**\n     * Update reveal view with round results\n     * @param {Object} data - State data from server\n     */\n    function updateRevealView(data) {\n        var song = data.song || {};\n        var players = data.players || [];\n\n        // Update round info\n        var roundEl = document.getElementById('reveal-round');\n        var totalEl = document.getElementById('reveal-total');\n        if (roundEl) roundEl.textContent = data.round || 1;\n        if (totalEl) totalEl.textContent = data.total_rounds || 10;\n\n        // Update album cover\n        var albumCover = document.getElementById('reveal-album-cover');\n        if (albumCover) {\n            albumCover.src = song.album_art || '/beatify/static/img/no-artwork.svg';\n        }\n\n        // Update correct year\n        var correctYear = document.getElementById('correct-year');\n        if (correctYear) {\n            correctYear.textContent = song.year || '????';\n        }\n\n        // Update song info\n        var titleEl = document.getElementById('song-title');\n        var artistEl = document.getElementById('song-artist');\n        if (titleEl) titleEl.textContent = song.title || 'Unknown Song';\n        if (artistEl) artistEl.textContent = song.artist || 'Unknown Artist';\n\n        // Update fun fact and rich song info (Story 14.3, 16.1, 16.3)\n        var funFactContainer = document.getElementById('fun-fact-container');\n        var funFactText = document.getElementById('fun-fact');\n        var funFactHeader = funFactContainer ? funFactContainer.querySelector('.fun-fact-header') : null;\n\n        // Get localized fun fact (Story 16.1, 16.3)\n        var localizedFunFact = getLocalizedSongField(song, 'fun_fact');\n\n        // Set fun fact text\n        if (funFactText) {\n            funFactText.textContent = localizedFunFact || '';\n        }\n\n        // Show/hide fun fact header based on whether there's a fun fact\n        if (funFactHeader) {\n            funFactHeader.style.display = localizedFunFact ? 'flex' : 'none';\n        }\n\n        // Render rich song info (Story 14.3)\n        renderRichSongInfo(song);\n\n        // Render song difficulty rating (Story 15.1)\n        renderSongDifficulty(data.song_difficulty);\n\n        // Show container if there's fun fact OR rich info\n        if (funFactContainer) {\n            var richInfo = document.getElementById('song-rich-info');\n            var hasRichInfo = richInfo && richInfo.innerHTML.trim() !== '';\n            var hasFunFact = localizedFunFact && localizedFunFact.trim() !== '';\n            funFactContainer.classList.toggle('hidden', !hasFunFact && !hasRichInfo);\n        }\n\n        // Find current player's result\n        var currentPlayer = null;\n        for (var i = 0; i < players.length; i++) {\n            if (players[i].name === playerName) {\n                currentPlayer = players[i];\n                break;\n            }\n        }\n\n        // Show celebration-first reveal (Story 9.4)\n        showRevealEmotion(currentPlayer, song.year);\n        renderPersonalResult(currentPlayer, song.year);\n\n        // Story 14.5: Check for new record and trigger rainbow confetti (AC2)\n        if (data.game_performance && data.game_performance.is_new_record) {\n            triggerConfetti('record');\n        }\n\n        // Render player result cards (Story 9.10)\n        renderPlayerResultCards(players);\n\n        // Render round analytics (Story 13.3)\n        if (data.round_analytics) {\n            renderRoundAnalytics(data.round_analytics, song.year);\n        }\n\n        // Update leaderboard (Story 5.5) with score animations (Story 13.2)\n        if (data.leaderboard) {\n            updateLeaderboard(data, 'reveal-leaderboard-list', true);\n        }\n\n        // Show admin controls if admin\n        var adminControls = document.getElementById('reveal-admin-controls');\n        var nextRoundBtn = document.getElementById('next-round-btn');\n        if (adminControls && currentPlayer && currentPlayer.is_admin) {\n            adminControls.classList.remove('hidden');\n\n            // Update button text for last round\n            if (nextRoundBtn) {\n                if (data.last_round) {\n                    nextRoundBtn.textContent = t('leaderboard.finalResults');\n                    nextRoundBtn.classList.add('is-final');\n                } else {\n                    nextRoundBtn.textContent = t('admin.nextRound');\n                    nextRoundBtn.classList.remove('is-final');\n                }\n                nextRoundBtn.disabled = false;\n            }\n        } else if (adminControls) {\n            adminControls.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Render round analytics section (Story 13.3)\n     * @param {Object} analytics - Round analytics data from server\n     * @param {number} correctYear - The correct year for comparison\n     */\n    function renderRoundAnalytics(analytics, correctYear) {\n        var container = document.getElementById('round-analytics');\n        if (!container || !analytics) {\n            if (container) container.classList.add('hidden');\n            return;\n        }\n\n        // Handle empty state (AC11)\n        if (analytics.total_submitted === 0) {\n            container.innerHTML = '<div class=\"analytics-empty\">' + t('analytics.noSubmissions') + '</div>';\n            container.classList.remove('hidden');\n            return;\n        }\n\n        // Average comparison (AC7)\n        var avgComparison = '';\n        if (analytics.average_guess !== null && correctYear) {\n            var diff = Math.round(analytics.average_guess - correctYear);\n            if (diff === 0) {\n                avgComparison = t('analytics.onTarget');\n            } else if (diff > 0) {\n                avgComparison = t('analytics.yearsLate', { years: diff });\n            } else {\n                avgComparison = t('analytics.yearsEarly', { years: Math.abs(diff) });\n            }\n        }\n\n        // Render histogram with 7 dynamic year bins based on actual guesses\n        var histogramHtml = renderHistogram(analytics.all_guesses, correctYear);\n\n        // Build achievements HTML (AC9, AC10)\n        var achievementsHtml = '';\n\n        // Exact matches\n        if (analytics.exact_match_players && analytics.exact_match_players.length > 0) {\n            achievementsHtml += '<div class=\"achievement-item\">' +\n                '<span class=\"achievement-emoji\">&#127919;</span>' +\n                '<span class=\"achievement-label\">' + t('analytics.exactMatches') + ':</span>' +\n                '<span class=\"achievement-names\">' + analytics.exact_match_players.join(', ') + '</span>' +\n                '</div>';\n        }\n\n        // Speed champion\n        if (analytics.speed_champion && analytics.speed_champion.names) {\n            var names = analytics.speed_champion.names.join(', ');\n            achievementsHtml += '<div class=\"achievement-item\">' +\n                '<span class=\"achievement-emoji\">&#9889;</span>' +\n                '<span class=\"achievement-label\">' + t('analytics.speedChampion') + ':</span>' +\n                '<span class=\"achievement-names\">' + names + '</span>' +\n                '<span class=\"achievement-value\">(' + analytics.speed_champion.time + 's)</span>' +\n                '</div>';\n        }\n\n        // Furthest guess (for fun)\n        if (analytics.furthest_players && analytics.furthest_players.length > 0 && analytics.all_guesses && analytics.all_guesses.length > 0) {\n            var furthestOff = analytics.all_guesses[analytics.all_guesses.length - 1].years_off;\n            if (furthestOff > 0) {\n                achievementsHtml += '<div class=\"achievement-item\">' +\n                    '<span class=\"achievement-emoji\">&#128517;</span>' +\n                    '<span class=\"achievement-label\">' + t('analytics.furthestGuess') + ':</span>' +\n                    '<span class=\"achievement-names\">' + analytics.furthest_players.join(', ') + '</span>' +\n                    '<span class=\"achievement-value\">(' + furthestOff + ' years)</span>' +\n                    '</div>';\n            }\n        }\n\n        // Build full HTML - stats in single row\n        var avgDisplay = analytics.average_guess !== null ? Math.round(analytics.average_guess) : '?';\n        container.innerHTML = '<h3 class=\"analytics-title\">' + t('analytics.title') + '</h3>' +\n            '<div class=\"analytics-stats-row\">' +\n            '<div class=\"stat-primary\">' +\n            '<span class=\"stat-label\">' + t('analytics.averageGuess') + '</span>' +\n            '<span class=\"stat-value\">' + avgDisplay + '</span>' +\n            '</div>' +\n            '<div class=\"stat-secondary\">' +\n            '<span class=\"stat-value\">' + analytics.accuracy_percentage + '%</span>' +\n            '<span class=\"stat-label\">' + t('analytics.accuracy', { percent: '' }).replace('%', '') + '</span>' +\n            '</div>' +\n            '</div>' +\n            '<div class=\"stat-comparison-line\">' + avgComparison + '</div>' +\n            '<div class=\"analytics-histogram\">' +\n            '<h4 class=\"histogram-title\">' + t('analytics.histogram') + '</h4>' +\n            histogramHtml +\n            '</div>' +\n            (achievementsHtml ? '<div class=\"analytics-achievements\">' + achievementsHtml + '</div>' : '');\n\n        container.classList.remove('hidden');\n    }\n\n    /**\n     * Render histogram with 7 dynamic year bins based on actual guesses\n     * @param {Array} allGuesses - Array of {name, guess, years_off} sorted by years_off\n     * @param {number} correctYear - The correct year for highlighting\n     * @returns {string} HTML string for histogram\n     */\n    function renderHistogram(allGuesses, correctYear) {\n        var NUM_BINS = 7;\n\n        // Handle empty or invalid data\n        if (!allGuesses || allGuesses.length === 0) {\n            return '<div class=\"histogram-empty\">' + t('analytics.noGuesses') + '</div>';\n        }\n\n        // Extract guess years\n        var guesses = allGuesses.map(function(g) { return g.guess; });\n        var minGuess = Math.min.apply(null, guesses);\n        var maxGuess = Math.max.apply(null, guesses);\n        var range = maxGuess - minGuess;\n\n        // Calculate years per bin (minimum 1 year per bin)\n        var yearsPerBin = Math.max(1, Math.ceil(range / NUM_BINS));\n\n        // Adjust range to fit exactly 7 bins, centered on guesses\n        var totalYears = yearsPerBin * NUM_BINS;\n        var extraYears = totalYears - range - 1;\n        var startYear = minGuess - Math.floor(extraYears / 2);\n\n        // Build bins\n        var bins = [];\n        for (var i = 0; i < NUM_BINS; i++) {\n            var binStart = startYear + (i * yearsPerBin);\n            var binEnd = binStart + yearsPerBin - 1;\n            bins.push({\n                start: binStart,\n                end: binEnd,\n                count: 0,\n                containsCorrect: correctYear >= binStart && correctYear <= binEnd\n            });\n        }\n\n        // Count guesses per bin\n        for (var j = 0; j < guesses.length; j++) {\n            var guess = guesses[j];\n            for (var k = 0; k < bins.length; k++) {\n                if (guess >= bins[k].start && guess <= bins[k].end) {\n                    bins[k].count++;\n                    break;\n                }\n            }\n        }\n\n        // Find max count for proportional heights\n        var maxCount = 1;\n        for (var m = 0; m < bins.length; m++) {\n            if (bins[m].count > maxCount) maxCount = bins[m].count;\n        }\n\n        // Render bars\n        var barsHtml = '';\n        for (var n = 0; n < bins.length; n++) {\n            var bin = bins[n];\n            var heightPercent = (bin.count / maxCount) * 100;\n            var delay = n * 0.05;\n\n            var barClass = 'histogram-bar' + (bin.containsCorrect ? ' is-correct' : '');\n            var barHeight = bin.count > 0 ? Math.max(heightPercent, 10) : 0;\n            var countHtml = bin.count > 0 ? '<span class=\"bar-count\">' + bin.count + '</span>' : '';\n\n            // Label: single year or range\n            var label = yearsPerBin === 1 ? String(bin.start) : bin.start + '-' + String(bin.end).slice(-2);\n\n            barsHtml += '<div class=\"histogram-bar-wrapper\" style=\"animation-delay: ' + delay + 's\">' +\n                '<div class=\"' + barClass + '\" style=\"height: ' + barHeight + '%\">' +\n                countHtml +\n                '</div>' +\n                '<span class=\"histogram-label\">' + label + '</span>' +\n                '</div>';\n        }\n\n        return '<div class=\"histogram-bars\">' + barsHtml + '</div>';\n    }\n\n    // ============================================\n    // Rich Song Info (Story 14.3)\n    // ============================================\n\n    /**\n     * Render superlatives / fun awards (Story 15.2)\n     * @param {Array|null} superlatives - Array of award objects from state\n     */\n    function renderSuperlatives(superlatives) {\n        var container = document.getElementById('superlatives-container');\n        if (!container) return;\n\n        // Hide if no superlatives\n        if (!superlatives || superlatives.length === 0) {\n            container.classList.add('hidden');\n            return;\n        }\n\n        var html = '';\n        superlatives.forEach(function(award, index) {\n            var valueText = '';\n            switch (award.value_label) {\n                case 'avg_time':\n                    valueText = award.value + 's ' + t('superlatives.avgTime');\n                    break;\n                case 'streak':\n                    valueText = award.value + ' ' + t('superlatives.streak');\n                    break;\n                case 'bets':\n                    valueText = award.value + ' ' + t('superlatives.bets');\n                    break;\n                case 'points':\n                    valueText = award.value + ' ' + t('superlatives.points');\n                    break;\n                case 'close_guesses':\n                    valueText = award.value + ' ' + t('superlatives.closeGuesses');\n                    break;\n                default:\n                    valueText = award.value;\n            }\n\n            html += '<div class=\"superlative-card superlative-card--' + award.id + '\" style=\"animation-delay: ' + (index * 0.2) + 's\">' +\n                '<div class=\"superlative-emoji\">' + award.emoji + '</div>' +\n                '<div class=\"superlative-title\">' + t('superlatives.' + award.title) + '</div>' +\n                '<div class=\"superlative-player\">' + escapeHtml(award.player_name) + '</div>' +\n                '<div class=\"superlative-value\">' + valueText + '</div>' +\n            '</div>';\n        });\n\n        container.innerHTML = html;\n        container.classList.remove('hidden');\n    }\n\n    /**\n     * Render song difficulty rating (Story 15.1)\n     * @param {Object|null} difficulty - Difficulty data with stars, label, accuracy, times_played\n     */\n    function renderSongDifficulty(difficulty) {\n        var el = document.getElementById('song-difficulty');\n        if (!el) return;\n\n        // Hide if no difficulty data (AC4: insufficient plays)\n        if (!difficulty) {\n            el.classList.add('hidden');\n            return;\n        }\n\n        // Build stars string\n        var stars = '';\n        for (var i = 0; i < difficulty.stars; i++) {\n            stars += '<span class=\"star\">&#9733;</span>';\n        }\n\n        // Render difficulty display\n        el.innerHTML =\n            '<div class=\"difficulty-stars difficulty-' + difficulty.stars + '\">' + stars + '</div>' +\n            '<span class=\"difficulty-label\">' + t('difficulty.' + difficulty.label) + '</span>' +\n            '<span class=\"difficulty-accuracy\">' + difficulty.accuracy + '% ' + t('difficulty.accuracy') + '</span>';\n\n        el.classList.remove('hidden');\n    }\n\n    /**\n     * Render rich song info (chart position, certifications, awards)\n     * Uses unified badge design - all centered with consistent styling\n     * @param {Object} song - Song data with optional chart_info, certifications, awards\n     */\n    function renderRichSongInfo(song) {\n        var container = document.getElementById('song-rich-info');\n        if (!container) return;\n\n        var badges = [];\n\n        // Collect chart badges\n        var chartBadges = renderChartBadges(song.chart_info || {});\n        if (chartBadges.length > 0) badges = badges.concat(chartBadges);\n\n        // Collect certification badges\n        var certBadges = renderCertificationBadges(song.certifications || []);\n        if (certBadges.length > 0) badges = badges.concat(certBadges);\n\n        // Collect award badges (Story 16.1, 16.3 - use localized awards)\n        var localizedAwards = getLocalizedSongField(song, 'awards') || [];\n        var awardBadges = renderAwardBadges(localizedAwards);\n        if (awardBadges.length > 0) badges = badges.concat(awardBadges);\n\n        // Render all badges in a single centered row\n        if (badges.length > 0) {\n            container.innerHTML = '<div class=\"song-badges-row\">' + badges.join('') + '</div>';\n        } else {\n            container.innerHTML = '';\n        }\n    }\n\n    /**\n     * Render chart info as badges\n     * @param {Object} chartInfo - Chart info data\n     * @returns {Array} Array of badge HTML strings\n     */\n    function renderChartBadges(chartInfo) {\n        if (!chartInfo) return [];\n\n        var badges = [];\n\n        // Billboard chart\n        if (chartInfo.billboard_peak && chartInfo.billboard_peak > 0) {\n            var weeksText = chartInfo.weeks_on_chart\n                ? ' <span class=\"chart-weeks\">\u00B7 ' + chartInfo.weeks_on_chart + ' ' + t('reveal.weeksShort') + '</span>'\n                : '';\n            badges.push(\n                '<span class=\"song-badge song-badge--chart\">' +\n                '<span class=\"song-badge-icon\">\uD83D\uDCCA</span>' +\n                '#' + chartInfo.billboard_peak + ' ' + t('reveal.chartBillboard') + weeksText +\n                '</span>'\n            );\n        }\n\n        // German chart (if no Billboard)\n        if (chartInfo.german_peak && chartInfo.german_peak > 0 && !chartInfo.billboard_peak) {\n            badges.push(\n                '<span class=\"song-badge song-badge--chart\">' +\n                '<span class=\"song-badge-icon\">\uD83D\uDCCA</span>' +\n                '#' + chartInfo.german_peak + ' ' + t('reveal.chartGerman') +\n                '</span>'\n            );\n        }\n\n        // UK chart (if no Billboard)\n        if (chartInfo.uk_peak && chartInfo.uk_peak > 0 && !chartInfo.billboard_peak) {\n            badges.push(\n                '<span class=\"song-badge song-badge--chart\">' +\n                '<span class=\"song-badge-icon\">\uD83D\uDCCA</span>' +\n                '#' + chartInfo.uk_peak + ' ' + t('reveal.chartUK') +\n                '</span>'\n            );\n        }\n\n        return badges;\n    }\n\n    /**\n     * Render certifications as badges\n     * @param {Array} certifications - Array of certification strings\n     * @returns {Array} Array of badge HTML strings\n     */\n    function renderCertificationBadges(certifications) {\n        if (!certifications || certifications.length === 0) return [];\n\n        var badges = [];\n        for (var i = 0; i < certifications.length; i++) {\n            var cert = certifications[i];\n            var badgeClass = getCertificationBadgeClass(cert);\n            var icon = getCertificationIcon(cert);\n            badges.push(\n                '<span class=\"song-badge ' + badgeClass + '\">' +\n                '<span class=\"song-badge-icon\">' + icon + '</span>' +\n                escapeHtml(cert) +\n                '</span>'\n            );\n        }\n        return badges;\n    }\n\n    /**\n     * Get CSS class for certification type\n     * @param {string} cert - Certification string\n     * @returns {string} CSS class name\n     */\n    function getCertificationBadgeClass(cert) {\n        var certLower = cert.toLowerCase();\n        if (certLower.indexOf('diamond') !== -1) return 'song-badge--diamond';\n        if (certLower.indexOf('platinum') !== -1) return 'song-badge--platinum';\n        if (certLower.indexOf('gold') !== -1) return 'song-badge--gold';\n        return 'song-badge--platinum';\n    }\n\n    /**\n     * Get icon for certification type\n     * @param {string} cert - Certification string\n     * @returns {string} Emoji icon\n     */\n    function getCertificationIcon(cert) {\n        var certLower = cert.toLowerCase();\n        if (certLower.indexOf('diamond') !== -1) return '\uD83D\uDC8E';\n        if (certLower.indexOf('platinum') !== -1) return '\uD83D\uDCBF';\n        if (certLower.indexOf('gold') !== -1) return '\uD83E\uDD47';\n        return '\uD83D\uDCBF';\n    }\n\n    /**\n     * Render awards as badges (max 3)\n     * @param {Array} awards - Array of award strings\n     * @returns {Array} Array of badge HTML strings\n     */\n    function renderAwardBadges(awards) {\n        if (!awards || awards.length === 0) return [];\n\n        var badges = [];\n        var displayAwards = awards.slice(0, 3);\n\n        for (var i = 0; i < displayAwards.length; i++) {\n            var award = displayAwards[i];\n            var badgeClass = getAwardBadgeClass(award);\n            var icon = getAwardIcon(award);\n            badges.push(\n                '<span class=\"song-badge ' + badgeClass + '\">' +\n                '<span class=\"song-badge-icon\">' + icon + '</span>' +\n                escapeHtml(award) +\n                '</span>'\n            );\n        }\n\n        if (awards.length > 3) {\n            badges.push('<span class=\"song-badges-more\">+' + (awards.length - 3) + ' more</span>');\n        }\n\n        return badges;\n    }\n\n    /**\n     * Get CSS class for award type\n     * @param {string} award - Award string\n     * @returns {string} CSS class name\n     */\n    function getAwardBadgeClass(award) {\n        var awardLower = award.toLowerCase();\n        if (awardLower.indexOf('grammy') !== -1) return 'song-badge--grammy';\n        if (awardLower.indexOf('eurovision') !== -1) return 'song-badge--eurovision';\n        if (awardLower.indexOf('oscar') !== -1 || awardLower.indexOf('academy award') !== -1) return 'song-badge--oscar';\n        if (awardLower.indexOf('hall of fame') !== -1) return 'song-badge--halloffame';\n        return 'song-badge--award';\n    }\n\n    /**\n     * Get icon for award type\n     * @param {string} award - Award string\n     * @returns {string} Emoji icon\n     */\n    function getAwardIcon(award) {\n        var awardLower = award.toLowerCase();\n        if (awardLower.indexOf('eurovision') !== -1) return '\uD83C\uDFA4';\n        if (awardLower.indexOf('grammy') !== -1) return '\uD83C\uDFC6';\n        if (awardLower.indexOf('hall of fame') !== -1) return '\u2B50';\n        return '\uD83C\uDFC6';\n    }\n\n    /**\n     * Show celebration-first emotion before data (Story 9.4)\n     * @param {Object} player - Current player data\n     * @param {number} correctYear - The correct year\n     */\n    function showRevealEmotion(player, correctYear) {\n        var emotionEl = document.getElementById('reveal-emotion');\n        var personalResult = document.getElementById('personal-result');\n        if (!emotionEl) return;\n\n        // Reset emotion element\n        emotionEl.className = 'reveal-emotion';\n        emotionEl.innerHTML = '';\n        emotionEl.classList.add('hidden');\n\n        // Reset personal result delay\n        if (personalResult) {\n            personalResult.classList.remove('is-delayed');\n        }\n\n        // Stop any existing confetti\n        stopConfetti();\n\n        // Get translated emotion arrays using i18n\n        var emotions = t('reveal.emotions');\n\n        // Helper to pick random from array\n        function randomFrom(arr) {\n            return arr[Math.floor(Math.random() * arr.length)];\n        }\n\n        // Helper for \"Off by X years\" text\n        function getOffByText(years) {\n            if (years === 1) {\n                return t('reveal.offByYear');\n            }\n            return t('reveal.offByYears', { years: years });\n        }\n\n        // Determine emotion category\n        var emotionType = 'missed';\n        var emotionText = randomFrom(emotions.missed);\n        var subtitle = randomFrom(emotions.missedSub);\n\n        if (player && !player.missed_round) {\n            var yearsOff = player.years_off || 0;\n\n            if (yearsOff === 0) {\n                emotionType = 'exact';\n                emotionText = randomFrom(emotions.exact);\n                subtitle = randomFrom(emotions.exactSub);\n            } else if (yearsOff <= 2) {\n                emotionType = 'close';\n                emotionText = randomFrom(emotions.close);\n                subtitle = randomFrom(emotions.closeSub) + ' ' + getOffByText(yearsOff);\n            } else if (yearsOff <= 5) {\n                emotionType = 'close';\n                emotionText = randomFrom(emotions.close);\n                subtitle = getOffByText(yearsOff);\n            } else {\n                emotionType = 'wrong';\n                emotionText = randomFrom(emotions.wrong);\n                subtitle = randomFrom(emotions.wrongSub) + ' ' + getOffByText(yearsOff);\n            }\n        } else if (player && player.missed_round) {\n            emotionType = 'missed';\n            emotionText = randomFrom(emotions.missed);\n            subtitle = randomFrom(emotions.missedSub);\n        }\n\n        // Build emotion HTML\n        var emotionHtml = '<span class=\"reveal-emotion-text\">' + emotionText + '</span>';\n        if (subtitle) {\n            emotionHtml += '<div class=\"reveal-emotion-subtitle\">' + subtitle + '</div>';\n        }\n        emotionEl.innerHTML = emotionHtml;\n\n        // Apply emotion class\n        emotionEl.classList.add('reveal-emotion--' + emotionType);\n        emotionEl.classList.remove('hidden');\n\n        // Trigger confetti for exact match\n        if (emotionType === 'exact') {\n            triggerConfetti();\n        }\n\n        // Add delay class to personal result for fade-in effect\n        if (personalResult && emotionType !== 'missed') {\n            personalResult.classList.add('is-delayed');\n        }\n    }\n\n    /**\n     * Render personal result in reveal view\n     * @param {Object} player - Current player data\n     * @param {number} correctYear - The correct year\n     */\n    function renderPersonalResult(player, correctYear) {\n        var resultContent = document.getElementById('result-content');\n        if (!resultContent) return;\n\n        if (!player) {\n            resultContent.innerHTML = '<div class=\"result-missed\">Player not found</div>';\n            return;\n        }\n\n        if (player.missed_round) {\n            // Enhanced missed round display (Story 5.4)\n            var missedHtml =\n                '<div class=\"result-missed-container\">' +\n                    '<div class=\"result-missed-icon\">\u23F0</div>' +\n                    '<div class=\"result-missed-text\">' + t('reveal.noSubmission') + '</div>' +\n                '</div>';\n\n            // Show broken streak if they had one (>= 2)\n            var previousStreak = player.previous_streak || 0;\n            if (previousStreak >= 2) {\n                missedHtml +=\n                    '<div class=\"streak-broken\">' +\n                        '<span class=\"streak-broken-icon\">\uD83D\uDC94</span>' +\n                        '<span class=\"streak-broken-text\">Lost ' + previousStreak + '-streak!</span>' +\n                    '</div>';\n            }\n\n            missedHtml += '<div class=\"result-score is-zero\">0 pts</div>';\n            resultContent.innerHTML = missedHtml;\n            return;\n        }\n\n        var yearsOff = player.years_off || 0;\n        var yearsOffText = yearsOff === 0 ? t('reveal.exact') :\n                           yearsOff === 1 ? t('reveal.yearOff', { years: 1 }) :\n                           t('reveal.yearsOff', { years: yearsOff });\n\n        var resultClass = yearsOff === 0 ? 'is-exact' :\n                          yearsOff <= 3 ? 'is-close' : 'is-far';\n\n        // Speed bonus display (Story 5.1)\n        var speedMultiplier = player.speed_multiplier || 1.0;\n        var baseScore = player.base_score || 0;\n        var hasSpeedBonus = speedMultiplier > 1.0;\n\n        // Streak bonus display (Story 5.2)\n        var streakBonus = player.streak_bonus || 0;\n\n        var scoreBreakdown = '';\n        if (hasSpeedBonus && baseScore > 0) {\n            scoreBreakdown =\n                '<div class=\"result-row\">' +\n                    '<span class=\"result-label\">' + t('reveal.baseScore') + '</span>' +\n                    '<span class=\"result-value\">' + baseScore + ' pts</span>' +\n                '</div>' +\n                '<div class=\"result-row\">' +\n                    '<span class=\"result-label\">' + t('reveal.speedBonus') + '</span>' +\n                    '<span class=\"result-value is-bonus\">' + speedMultiplier.toFixed(2) + 'x</span>' +\n                '</div>';\n        }\n\n        // Bet outcome row (Story 5.3)\n        var betOutcomeHtml = '';\n        if (player.bet_outcome === 'won') {\n            betOutcomeHtml =\n                '<div class=\"result-row bet-won-row\">' +\n                    '<span class=\"result-label\">\uD83C\uDFB2 ' + t('reveal.betWon').replace('! 2x points', '') + '</span>' +\n                    '<span class=\"result-value is-bet-won\">2x</span>' +\n                '</div>';\n        } else if (player.bet_outcome === 'lost') {\n            betOutcomeHtml =\n                '<div class=\"result-row bet-lost-row\">' +\n                    '<span class=\"result-label\">\uD83C\uDFB2 ' + t('reveal.betLost') + '</span>' +\n                    '<span class=\"result-value is-bet-lost\">-</span>' +\n                '</div>';\n        }\n\n        // Streak bonus row (Story 5.2)\n        var streakBonusHtml = '';\n        if (streakBonus > 0) {\n            streakBonusHtml =\n                '<div class=\"result-row streak-bonus-row\">' +\n                    '<span class=\"result-label\">' + player.streak + '-streak bonus!</span>' +\n                    '<span class=\"result-value is-streak\">+' + streakBonus + ' pts</span>' +\n                '</div>';\n        }\n\n        // Calculate total (round_score already includes bet + speed bonus, add streak separately)\n        var totalScore = player.round_score + streakBonus;\n\n        // Story 13.2: Determine animation effects\n        var isBigScore = player.round_score >= 20;\n        var prevPlayer = previousState.players[player.name];\n        var prevScore = prevPlayer ? prevPlayer.score : (player.score - totalScore);\n        var prevStreak = prevPlayer ? prevPlayer.streak : 0;\n        var streakMilestone = isStreakMilestone(prevStreak, player.streak || 0);\n\n        resultContent.innerHTML =\n            '<div class=\"result-row\">' +\n                '<span class=\"result-label\">' + t('reveal.yourGuess') + '</span>' +\n                '<span class=\"result-value\">' + player.guess + '</span>' +\n            '</div>' +\n            '<div class=\"result-row\">' +\n                '<span class=\"result-label\">' + t('reveal.correctYear') + '</span>' +\n                '<span class=\"result-value\">' + correctYear + '</span>' +\n            '</div>' +\n            '<div class=\"result-row\">' +\n                '<span class=\"result-label\">' + t('reveal.accuracy') + '</span>' +\n                '<span class=\"result-value ' + resultClass + '\">' + yearsOffText + '</span>' +\n            '</div>' +\n            scoreBreakdown +\n            betOutcomeHtml +\n            '<div class=\"result-score\" id=\"personal-result-score\">+<span class=\"score-value\">0</span> pts</div>' +\n            streakBonusHtml +\n            (streakBonus > 0 ? '<div class=\"result-total\">' + t('reveal.total') + ': +<span class=\"total-value\">0</span> pts</div>' : '');\n\n        // Story 13.2: Animate personal score with visual effects\n        var scoreValueEl = resultContent.querySelector('.score-value');\n        if (scoreValueEl) {\n            animateScoreChange(scoreValueEl, 0, player.round_score, {\n                betWon: player.bet_outcome === 'won',\n                betLost: player.bet_outcome === 'lost',\n                streakMilestone: streakMilestone,\n                isBigScore: isBigScore\n            });\n\n            // Show floating popup for bet win\n            if (player.bet_outcome === 'won' && player.round_score > 0) {\n                setTimeout(function() {\n                    var scoreEl = document.getElementById('personal-result-score');\n                    if (scoreEl) {\n                        showPointsPopup(scoreEl, player.round_score, { isBetWin: true });\n                    }\n                }, 200);\n            }\n        }\n\n        // Story 13.2: Animate total score and show streak popup\n        var totalValueEl = resultContent.querySelector('.total-value');\n        if (totalValueEl && streakBonus > 0) {\n            // Slight delay for total to start after round score\n            setTimeout(function() {\n                animateValue(totalValueEl, 0, totalScore, 600);\n            }, 300);\n\n            // Show streak milestone popup\n            if (streakMilestone) {\n                setTimeout(function() {\n                    var totalEl = resultContent.querySelector('.result-total');\n                    if (totalEl) {\n                        var milestoneBonus = {3: 20, 5: 50, 10: 100}[streakMilestone] || 0;\n                        showPointsPopup(totalEl, milestoneBonus, {\n                            isStreak: true,\n                            text: '+' + milestoneBonus + ' ' + streakMilestone + '-Streak!'\n                        });\n                    }\n                }, 500);\n            }\n        }\n    }\n\n    /**\n     * Render player result cards on reveal (Story 9.10)\n     * Shows all players' guesses, years off, and points in horizontal scroll\n     * @param {Array} players - All players from state\n     */\n    function renderPlayerResultCards(players) {\n        var container = document.getElementById('reveal-results-cards');\n        if (!container) return;\n\n        if (!players || players.length === 0) {\n            container.innerHTML = '';\n            return;\n        }\n\n        // Sort players by round_score descending (best first)\n        var sorted = players.slice().sort(function(a, b) {\n            return (b.round_score || 0) - (a.round_score || 0);\n        });\n\n        var html = '<div class=\"results-cards-header\">' + t('reveal.allPlayers') + '</div>';\n        html += '<div class=\"results-cards-scroll\">';\n\n        sorted.forEach(function(player) {\n            var isCurrentPlayer = player.name === playerName;\n            var isMissed = player.missed_round === true;\n            var yearsOff = player.years_off || 0;\n            var roundScore = player.round_score || 0;\n\n            // Determine score-based class per AC #13 (Code Review fix)\n            var scoreClass = isMissed ? 'is-score-zero' :\n                             roundScore >= 10 ? 'is-score-high' :\n                             roundScore >= 1 ? 'is-score-medium' : 'is-score-zero';\n\n            // Guess display\n            var guessDisplay = isMissed ? '\u2014' : player.guess;\n            var yearsOffDisplay = isMissed ? t('reveal.noGuessShort') :\n                                  yearsOff === 0 ? t('reveal.exact') :\n                                  t('reveal.shortOff', { years: yearsOff });\n\n            // Bet indicator\n            var betIndicator = player.bet ? '<span class=\"card-bet\">\uD83C\uDFB2</span>' : '';\n\n            // Steal indicator (Story 15.3 AC4)\n            var stealIndicator = '';\n            if (player.stole_from) {\n                stealIndicator = '<div class=\"steal-badge\"><span class=\"steal-badge-icon\">\uD83E\uDD77</span>' +\n                    t('steal.stolenFrom', { name: escapeHtml(player.stole_from) }) + '</div>';\n            } else if (player.was_stolen_by && player.was_stolen_by.length > 0) {\n                var stealerNames = player.was_stolen_by.map(escapeHtml).join(', ');\n                stealIndicator = '<div class=\"steal-badge steal-badge-victim\"><span class=\"steal-badge-icon\">\uD83C\uDFAF</span>' +\n                    t('steal.stolenBy', { name: stealerNames }) + '</div>';\n            }\n\n            html += '<div class=\"result-card ' + scoreClass + (isCurrentPlayer ? ' is-current' : '') + '\">' +\n                '<div class=\"card-name\">' + escapeHtml(player.name) + betIndicator + '</div>' +\n                '<div class=\"card-guess\">' + guessDisplay + '</div>' +\n                '<div class=\"card-accuracy\">' + yearsOffDisplay + '</div>' +\n                stealIndicator +\n                '<div class=\"card-score\">+' + roundScore + '</div>' +\n            '</div>';\n        });\n\n        html += '</div>';\n        container.innerHTML = html;\n    }\n\n    // ============================================\n    // End View (Story 5.6)\n    // ============================================\n\n    /**\n     * Update end view with final standings and stats\n     * @param {Object} data - State data with leaderboard and game_stats\n     */\n    function updateEndView(data) {\n        var leaderboard = data.leaderboard || [];\n\n        // Mark is_current client-side\n        leaderboard.forEach(function(entry) {\n            entry.is_current = (entry.name === playerName);\n        });\n\n        // Update podium (positions 1, 2, 3)\n        [1, 2, 3].forEach(function(place) {\n            var player = leaderboard.find(function(p) { return p.rank === place; });\n            var nameEl = document.getElementById('podium-' + place + '-name');\n            var scoreEl = document.getElementById('podium-' + place + '-score');\n            if (nameEl) nameEl.textContent = player ? escapeHtml(player.name) : '---';\n            if (scoreEl) scoreEl.textContent = player ? player.score : '0';\n        });\n\n        // Find current player's stats\n        var currentPlayer = leaderboard.find(function(p) { return p.is_current; });\n\n        // Update your result\n        var rankEl = document.getElementById('your-final-rank');\n        var scoreEl = document.getElementById('your-final-score');\n        var bestStreakEl = document.getElementById('stat-best-streak');\n        var roundsEl = document.getElementById('stat-rounds');\n        var betsEl = document.getElementById('stat-bets');\n\n        if (currentPlayer) {\n            if (rankEl) rankEl.textContent = '#' + currentPlayer.rank;\n            if (scoreEl) scoreEl.textContent = currentPlayer.score + ' ' + t('leaderboard.points');\n            if (bestStreakEl) bestStreakEl.textContent = currentPlayer.best_streak || 0;\n            if (roundsEl) roundsEl.textContent = currentPlayer.rounds_played || 0;\n            if (betsEl) betsEl.textContent = currentPlayer.bets_won || 0;\n        }\n\n        // Update full leaderboard (Story 11.4: disconnected styling)\n        var listEl = document.getElementById('final-leaderboard-list');\n        if (listEl) {\n            listEl.innerHTML = leaderboard.map(function(entry) {\n                var currentClass = entry.is_current ? 'is-current' : '';\n                var disconnectedClass = entry.connected === false ? 'final-entry--disconnected' : '';\n                var awayBadge = entry.connected === false ? '<span class=\"away-badge\">(away)</span>' : '';\n                return '<div class=\"final-entry ' + currentClass + ' ' + disconnectedClass + '\">' +\n                    '<span class=\"final-rank\">#' + entry.rank + '</span>' +\n                    '<span class=\"final-name\">' + escapeHtml(entry.name) + awayBadge + '</span>' +\n                    '<span class=\"final-score\">' + entry.score + '</span>' +\n                '</div>';\n            }).join('');\n        }\n\n        // Render superlatives / fun awards (Story 15.2)\n        renderSuperlatives(data.superlatives);\n\n        // Show admin or player controls\n        var adminControls = document.getElementById('end-admin-controls');\n        var playerMessage = document.getElementById('end-player-message');\n\n        if (currentPlayer && currentPlayer.is_admin) {\n            if (adminControls) adminControls.classList.remove('hidden');\n            if (playerMessage) playerMessage.classList.add('hidden');\n            // Wire up new game button\n            var newGameBtn = document.getElementById('new-game-btn');\n            if (newGameBtn) {\n                newGameBtn.onclick = handleNewGame;\n            }\n        } else {\n            if (adminControls) adminControls.classList.add('hidden');\n            if (playerMessage) playerMessage.classList.remove('hidden');\n        }\n\n        // Story 14.5: Trigger end-game celebrations (AC3, AC4)\n        if (currentPlayer) {\n            var totalRounds = data.total_rounds || 10;\n            // H3 fix: Use best_streak === totalRounds as reliable perfect game indicator\n            // (correct_guesses field doesn't exist in backend)\n            var bestStreak = currentPlayer.best_streak || 0;\n            var isPerfectGame = bestStreak === totalRounds && totalRounds > 0;\n\n            if (isPerfectGame) {\n                // AC4: Perfect game - epic celebration\n                triggerConfetti('perfect');\n            } else if (currentPlayer.rank === 1) {\n                // AC3: Winner - fireworks celebration\n                triggerConfetti('winner');\n            }\n        }\n    }\n\n    // ============================================\n    // Paused View (Story 7-1)\n    // ============================================\n\n    /**\n     * Update paused view based on pause reason\n     * @param {Object} data - State data with pause_reason\n     */\n    function updatePausedView(data) {\n        var messageEl = document.getElementById('pause-message');\n        if (messageEl) {\n            if (data.pause_reason === 'admin_disconnected') {\n                messageEl.textContent = 'Waiting for host to reconnect...';\n            } else if (data.pause_reason === 'media_player_error') {\n                messageEl.textContent = 'Speaker unavailable. Please check your media player and try again.';\n            } else {\n                messageEl.textContent = 'Game paused. Please wait...';\n            }\n        }\n    }\n\n    /**\n     * Handle new game button click (Story 6.6)\n     */\n    function handleNewGame() {\n        if (!confirm('Start a new game?')) {\n            return;\n        }\n\n        var btn = document.getElementById('new-game-btn');\n        if (btn) {\n            btn.disabled = true;\n            btn.textContent = 'Redirecting...';\n        }\n\n        // Clear admin session storage\n        try {\n            sessionStorage.removeItem('beatify_admin_name');\n            sessionStorage.removeItem('beatify_is_admin');\n        } catch (e) {\n            // Ignore storage errors\n        }\n\n        // Redirect to admin page for new game setup\n        window.location.href = '/beatify/admin';\n    }\n\n    // Debounce state to prevent rapid clicks\n    var nextRoundPending = false;\n    var NEXT_ROUND_DEBOUNCE_MS = 2000;\n\n    /**\n     * Handle next round button click\n     */\n    function handleNextRound() {\n        // Prevent rapid clicks\n        if (nextRoundPending) {\n            return;\n        }\n\n        if (ws && ws.readyState === WebSocket.OPEN) {\n            nextRoundPending = true;\n\n            // Update both buttons (reveal-view and control bar) - Story 6.3\n            var revealBtn = document.getElementById('next-round-btn');\n            var barBtn = document.getElementById('next-round-admin-btn');\n\n            if (revealBtn) {\n                revealBtn.disabled = true;\n                revealBtn.textContent = 'Loading...';\n            }\n            if (barBtn) {\n                barBtn.disabled = true;\n                var labelEl = barBtn.querySelector('.control-label');\n                if (labelEl) labelEl.textContent = 'Wait...';\n            }\n\n            ws.send(JSON.stringify({\n                type: 'admin',\n                action: 'next_round'\n            }));\n\n            // Reset after debounce period (server state change will also update UI)\n            setTimeout(function() {\n                nextRoundPending = false;\n                if (revealBtn) revealBtn.disabled = false;\n                if (barBtn) barBtn.disabled = false;\n            }, NEXT_ROUND_DEBOUNCE_MS);\n        }\n    }\n\n    // ============================================\n    // Admin Control Bar (Story 6.1)\n    // ============================================\n\n    // Debounce state for admin actions\n    let adminActionPending = false;\n    var ADMIN_ACTION_DEBOUNCE_MS = 500;\n\n    // Song stopped state (Story 6.2)\n    let songStopped = false;\n\n    // Volume state (Story 6.4)\n    let currentVolume = 0.5;\n\n    /**\n     * Debounce admin actions to prevent rapid repeated clicks\n     * @returns {boolean} True if action can proceed, false if debounced\n     */\n    function debounceAdminAction() {\n        if (adminActionPending) return false;\n        adminActionPending = true;\n        setTimeout(function() { adminActionPending = false; }, ADMIN_ACTION_DEBOUNCE_MS);\n        return true;\n    }\n\n    /**\n     * Show admin control bar for admin players\n     */\n    function showAdminControlBar() {\n        if (!isAdmin) return;\n        var bar = document.getElementById('admin-control-bar');\n        if (bar) {\n            bar.classList.remove('hidden');\n            document.body.classList.add('has-control-bar'); // M3 fix\n        }\n    }\n\n    /**\n     * Hide admin control bar\n     */\n    function hideAdminControlBar() {\n        var bar = document.getElementById('admin-control-bar');\n        if (bar) {\n            bar.classList.add('hidden');\n            document.body.classList.remove('has-control-bar'); // M3 fix\n        }\n    }\n\n    /**\n     * Update control bar button states based on phase\n     * @param {string} phase - Current game phase\n     */\n    function updateControlBarState(phase) {\n        var stopBtn = document.getElementById('stop-song-btn');\n        var nextBtn = document.getElementById('next-round-admin-btn');\n\n        if (phase === 'PLAYING') {\n            // Reset song stopped state for new round (Story 6.2)\n            resetSongStoppedState();\n            // Stop Song enabled (unless already stopped)\n            if (stopBtn && !songStopped) {\n                stopBtn.classList.remove('is-disabled');\n                stopBtn.disabled = false;\n            }\n            // Next Round enabled for \"Skip\" functionality (Story 6.3)\n            if (nextBtn) {\n                nextBtn.classList.remove('is-disabled');\n                nextBtn.disabled = false;\n                var labelEl = nextBtn.querySelector('.control-label');\n                if (labelEl) labelEl.textContent = 'Skip';\n            }\n        } else if (phase === 'REVEAL') {\n            // Stop Song still enabled (song may continue during reveal), Next Round enabled\n            if (stopBtn && !songStopped) {\n                stopBtn.classList.remove('is-disabled');\n                stopBtn.disabled = false;\n            }\n            if (nextBtn) {\n                nextBtn.classList.remove('is-disabled');\n                nextBtn.disabled = false;\n                var labelEl = nextBtn.querySelector('.control-label');\n                if (labelEl) labelEl.textContent = 'Next';\n            }\n        } else {\n            // LOBBY or END: disable Next Round (Story 6.3)\n            if (nextBtn) {\n                nextBtn.classList.add('is-disabled');\n                nextBtn.disabled = true;\n                var labelEl = nextBtn.querySelector('.control-label');\n                if (labelEl) labelEl.textContent = 'Next';\n            }\n        }\n        // Volume and End Game always enabled (no changes needed)\n    }\n\n    /**\n     * Handle Stop Song button (Story 16.6)\n     */\n    function handleStopSong() {\n        // Check if already stopped (prevent redundant clicks)\n        if (songStopped) return;\n\n        if (!debounceAdminAction()) return;\n\n        if (!ws || ws.readyState !== WebSocket.OPEN) {\n            console.warn('[Beatify] Cannot stop song: WebSocket not connected');\n            return;\n        }\n\n        // Immediate visual feedback (AC1, AC3)\n        var stopBtn = document.getElementById('stop-song-btn');\n        if (stopBtn) {\n            stopBtn.classList.add('is-disabled');\n            stopBtn.disabled = true;\n            var labelEl = stopBtn.querySelector('.control-label');\n            if (labelEl) labelEl.textContent = 'Stopping...';\n        }\n\n        ws.send(JSON.stringify({\n            type: 'admin',\n            action: 'stop_song'\n        }));\n    }\n\n    /**\n     * Handle Volume Up button\n     */\n    function handleVolumeUp() {\n        // Check limit before debounce (M2 fix)\n        if (currentVolume >= 1.0) {\n            showVolumeLimitFeedback('max');\n            return;\n        }\n        if (!debounceAdminAction()) return;\n        if (!ws || ws.readyState !== WebSocket.OPEN) return;\n\n        ws.send(JSON.stringify({\n            type: 'admin',\n            action: 'set_volume',\n            direction: 'up'\n        }));\n    }\n\n    /**\n     * Handle Volume Down button\n     */\n    function handleVolumeDown() {\n        // Check limit before debounce (M2 fix)\n        if (currentVolume <= 0.0) {\n            showVolumeLimitFeedback('min');\n            return;\n        }\n        if (!debounceAdminAction()) return;\n        if (!ws || ws.readyState !== WebSocket.OPEN) return;\n\n        ws.send(JSON.stringify({\n            type: 'admin',\n            action: 'set_volume',\n            direction: 'down'\n        }));\n    }\n\n    /**\n     * Show feedback when volume is at limit (M2 fix)\n     * @param {string} limit - 'max' or 'min'\n     */\n    function showVolumeLimitFeedback(limit) {\n        var indicator = document.getElementById('volume-indicator');\n        if (!indicator) return;\n\n        indicator.textContent = limit === 'max' ? '\uD83D\uDD0A Max' : '\uD83D\uDD07 Min';\n        indicator.classList.remove('hidden');\n        indicator.classList.add('is-visible');\n\n        // Fade out after 1s (shorter than normal feedback)\n        setTimeout(function() {\n            indicator.classList.remove('is-visible');\n            setTimeout(function() {\n                indicator.classList.add('hidden');\n            }, 300);\n        }, 1000);\n    }\n\n    /**\n     * Handle End Game button\n     */\n    function handleEndGame() {\n        if (!confirm(t('admin.endGameConfirmFull'))) return;\n        if (!debounceAdminAction()) return;\n        if (!ws || ws.readyState !== WebSocket.OPEN) {\n            alert(t('errors.CONNECTION_LOST'));\n            return;\n        }\n\n        // Update button state (Story 6.5)\n        var endBtn = document.getElementById('end-game-btn');\n        if (endBtn) {\n            endBtn.disabled = true;\n            var labelEl = endBtn.querySelector('.control-label');\n            if (labelEl) labelEl.textContent = 'Ending...';\n        }\n\n        ws.send(JSON.stringify({\n            type: 'admin',\n            action: 'end_game'\n        }));\n    }\n\n    /**\n     * Handle Next Round from control bar (reuse reveal logic)\n     */\n    function handleNextRoundFromBar() {\n        handleNextRound();\n    }\n\n    /**\n     * Setup admin control bar event handlers\n     */\n    function setupAdminControlBar() {\n        var stopBtn = document.getElementById('stop-song-btn');\n        var volUpBtn = document.getElementById('volume-up-btn');\n        var volDownBtn = document.getElementById('volume-down-btn');\n        var nextBtn = document.getElementById('next-round-admin-btn');\n        var endBtn = document.getElementById('end-game-btn');\n\n        if (stopBtn) stopBtn.addEventListener('click', handleStopSong);\n        if (volUpBtn) volUpBtn.addEventListener('click', handleVolumeUp);\n        if (volDownBtn) volDownBtn.addEventListener('click', handleVolumeDown);\n        if (nextBtn) nextBtn.addEventListener('click', handleNextRoundFromBar);\n        if (endBtn) endBtn.addEventListener('click', handleEndGame);\n    }\n\n    /**\n     * Handle song stopped notification from server (Story 6.2)\n     */\n    function handleSongStopped() {\n        songStopped = true;\n        var stopBtn = document.getElementById('stop-song-btn');\n        if (stopBtn) {\n            stopBtn.classList.add('is-stopped');\n            stopBtn.classList.add('is-disabled');\n            stopBtn.disabled = true;\n            var iconEl = stopBtn.querySelector('.control-icon');\n            var labelEl = stopBtn.querySelector('.control-label');\n            if (iconEl) iconEl.textContent = '\u2713';\n            if (labelEl) labelEl.textContent = 'Stopped';\n        }\n    }\n\n    /**\n     * Reset song stopped state for new round (Story 6.2)\n     */\n    function resetSongStoppedState() {\n        songStopped = false;\n        var stopBtn = document.getElementById('stop-song-btn');\n        if (stopBtn) {\n            stopBtn.classList.remove('is-stopped');\n            stopBtn.classList.remove('is-disabled');\n            stopBtn.disabled = false;\n            var iconEl = stopBtn.querySelector('.control-icon');\n            var labelEl = stopBtn.querySelector('.control-label');\n            if (iconEl) iconEl.textContent = '\u23F9\uFE0F';\n            if (labelEl) labelEl.textContent = 'Stop';\n        }\n    }\n\n    /**\n     * Handle volume changed response from server (Story 6.4)\n     * @param {number} level - New volume level (0.0 to 1.0)\n     */\n    function handleVolumeChanged(level) {\n        currentVolume = level;\n        showVolumeIndicator(level);\n        updateVolumeLimitStates(level);\n    }\n\n    /**\n     * Show brief volume indicator popup (Story 6.4)\n     * @param {number} level - Volume level\n     */\n    function showVolumeIndicator(level) {\n        var indicator = document.getElementById('volume-indicator');\n        if (!indicator) return;\n\n        var percentage = Math.round(level * 100);\n        indicator.textContent = '\uD83D\uDD0A ' + percentage + '%';\n        indicator.classList.remove('hidden');\n        indicator.classList.add('is-visible');\n\n        // Fade out after 1.5s\n        setTimeout(function() {\n            indicator.classList.remove('is-visible');\n            setTimeout(function() {\n                indicator.classList.add('hidden');\n            }, 300);\n        }, 1500);\n    }\n\n    /**\n     * Update volume buttons when at limits (Story 6.4)\n     * @param {number} level - Current volume level\n     */\n    function updateVolumeLimitStates(level) {\n        var upBtn = document.getElementById('volume-up-btn');\n        var downBtn = document.getElementById('volume-down-btn');\n\n        if (upBtn) {\n            upBtn.classList.toggle('is-at-limit', level >= 1.0);\n        }\n        if (downBtn) {\n            downBtn.classList.toggle('is-at-limit', level <= 0.0);\n        }\n    }\n\n    // ============================================\n    // Admin Controls (Story 3.5)\n    // ============================================\n\n    let isAdmin = false;\n\n    /**\n     * Check if user is admin (from sessionStorage on redirect from admin page)\n     * @returns {boolean}\n     */\n    function checkAdminStatus() {\n        const storedAdmin = sessionStorage.getItem('beatify_is_admin');\n        const storedName = sessionStorage.getItem('beatify_admin_name');\n\n        if (storedAdmin === 'true' && storedName) {\n            isAdmin = true;\n            playerName = storedName;\n            // Clear storage after reading (keep name for reconnection)\n            sessionStorage.removeItem('beatify_is_admin');\n        }\n        return isAdmin;\n    }\n\n    /**\n     * Update admin controls visibility based on player state\n     * @param {Array} players - Players from state\n     */\n    function updateAdminControls(players) {\n        const adminControls = document.getElementById('admin-controls');\n        const lobbyStatus = document.getElementById('lobby-status');\n        const leaveGameContainer = document.getElementById('leave-game-container');\n        if (!adminControls) return;\n\n        // Find if current player is admin from state\n        const currentPlayer = players.find(function(p) { return p.name === playerName; });\n        const playerIsAdmin = currentPlayer?.is_admin === true;\n\n        if (playerIsAdmin) {\n            adminControls.classList.remove('hidden');\n            if (lobbyStatus) lobbyStatus.classList.add('hidden');\n            // Story 11.5: Admin cannot leave, hide button\n            if (leaveGameContainer) leaveGameContainer.classList.add('hidden');\n        } else {\n            adminControls.classList.add('hidden');\n            if (lobbyStatus) lobbyStatus.classList.remove('hidden');\n            // Story 11.5: Non-admin can leave\n            if (leaveGameContainer) leaveGameContainer.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Setup admin control event handlers\n     */\n    function setupAdminControls() {\n        const startBtn = document.getElementById('start-game-btn');\n\n        startBtn?.addEventListener('click', function() {\n            if (!ws || ws.readyState !== WebSocket.OPEN) return;\n\n            startBtn.disabled = true;\n            startBtn.textContent = 'Starting...';\n\n            ws.send(JSON.stringify({\n                type: 'admin',\n                action: 'start_game'\n            }));\n        });\n\n        // Story 11.5: Leave Game button\n        const leaveBtn = document.getElementById('leave-game-btn');\n        leaveBtn?.addEventListener('click', function() {\n            handleLeaveGame();\n        });\n    }\n\n    // ============================================\n    // WebSocket Client (Story 3.2)\n    // ============================================\n\n    let ws = null;\n    let playerName = null;\n    let reconnectAttempts = 0;\n    const MAX_RECONNECT_ATTEMPTS = 10;  // Story 7-3: Increased for resilience\n    const MAX_RECONNECT_DELAY_MS = 30000;\n    const STORAGE_KEY_NAME = 'beatify_player_name';\n    const STORAGE_KEY_GAME_ID = 'beatify_game_id';\n    const STORAGE_KEY_LANGUAGE = 'beatify_language';\n\n    // Reconnection state (Story 7-3)\n    let isReconnecting = false;\n\n    // Intentional leave flag (Story 11.5) - prevents auto-reconnect after Leave Game\n    let intentionalLeave = false;\n\n    /**\n     * Get reconnection delay with exponential backoff\n     * @returns {number} Delay in milliseconds\n     */\n    function getReconnectDelay() {\n        // Exponential backoff: 1s, 2s, 4s, 8s, 16s, 30s max\n        return Math.min(1000 * Math.pow(2, reconnectAttempts), MAX_RECONNECT_DELAY_MS);\n    }\n\n    /**\n     * Get stored player name for this game (Story 7-3)\n     * @returns {string|null} Stored name or null\n     */\n    function getStoredPlayerName() {\n        try {\n            var storedGameId = localStorage.getItem(STORAGE_KEY_GAME_ID);\n            var storedName = localStorage.getItem(STORAGE_KEY_NAME);\n            console.log('[Beatify] Checking localStorage - storedGameId:', storedGameId, 'currentGameId:', gameId, 'storedName:', storedName);\n\n            if (storedGameId && storedGameId === gameId) {\n                console.log('[Beatify] Game ID match, returning stored name:', storedName);\n                return storedName;\n            }\n\n            if (storedGameId && storedGameId !== gameId) {\n                // Different game, clear stored name\n                console.log('[Beatify] Different game ID, clearing stored data');\n                localStorage.removeItem(STORAGE_KEY_NAME);\n                localStorage.removeItem(STORAGE_KEY_GAME_ID);\n            }\n        } catch (e) {\n            console.error('[Beatify] localStorage error:', e);\n        }\n        return null;\n    }\n\n    /**\n     * Store player name for reconnection (Story 7-3)\n     * @param {string} name - Player name to store\n     */\n    function storePlayerName(name) {\n        try {\n            localStorage.setItem(STORAGE_KEY_NAME, name);\n            localStorage.setItem(STORAGE_KEY_GAME_ID, gameId);\n            console.log('[Beatify] Stored player name:', name, 'for game:', gameId);\n        } catch (e) {\n            console.error('[Beatify] Failed to store player name:', e);\n        }\n    }\n\n    /**\n     * Clear stored player name (Story 7-3)\n     */\n    function clearStoredPlayerName() {\n        try {\n            localStorage.removeItem(STORAGE_KEY_NAME);\n            localStorage.removeItem(STORAGE_KEY_GAME_ID);\n        } catch (e) {\n            // localStorage unavailable\n        }\n    }\n\n    /**\n     * Store game language in localStorage for consistent UI on reload\n     * @param {string} lang - Language code ('en' or 'de')\n     */\n    function storeGameLanguage(lang) {\n        try {\n            localStorage.setItem(STORAGE_KEY_LANGUAGE, lang);\n        } catch (e) {\n            // localStorage unavailable\n        }\n    }\n\n    /**\n     * Get stored game language from localStorage\n     * @returns {string|null} Language code or null\n     */\n    function getStoredLanguage() {\n        try {\n            return localStorage.getItem(STORAGE_KEY_LANGUAGE);\n        } catch (e) {\n            return null;\n        }\n    }\n\n    /**\n     * Show reconnecting overlay (Story 7-3)\n     */\n    function showReconnectingOverlay() {\n        var overlay = document.getElementById('reconnecting-overlay');\n        if (overlay) {\n            overlay.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Hide reconnecting overlay (Story 7-3)\n     */\n    function hideReconnectingOverlay() {\n        var overlay = document.getElementById('reconnecting-overlay');\n        if (overlay) {\n            overlay.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Update reconnecting overlay status (Story 7-3)\n     * @param {number} attempt - Current attempt number\n     */\n    function updateReconnectStatus(attempt) {\n        var statusEl = document.getElementById('reconnect-status');\n        if (statusEl) {\n            statusEl.textContent = 'Reconnecting... (Attempt ' + attempt + '/' + MAX_RECONNECT_ATTEMPTS + ')';\n        }\n    }\n\n    /**\n     * Show connection lost view (Story 7-4)\n     */\n    function showConnectionLostView() {\n        showView('connection-lost-view');\n    }\n\n    /**\n     * Setup retry connection button (Story 7-4)\n     */\n    function setupRetryConnection() {\n        var retryBtn = document.getElementById('retry-connection-btn');\n        if (retryBtn) {\n            retryBtn.addEventListener('click', function() {\n                if (playerName) {\n                    reconnectAttempts = 0;\n                    showView('loading-view');\n                    connectWebSocket(playerName);\n                } else {\n                    // No player name - go back to join view\n                    checkGameStatus();\n                }\n            });\n        }\n    }\n\n    /**\n     * Connect to WebSocket and send join message\n     * @param {string} name - Player name\n     */\n    function connectWebSocket(name) {\n        playerName = name;\n        // Store name for reconnection (Story 7-3)\n        storePlayerName(name);\n\n        const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n        const wsUrl = wsProtocol + '//' + window.location.host + '/beatify/ws';\n\n        ws = new WebSocket(wsUrl);\n\n        ws.onopen = function() {\n            reconnectAttempts = 0;\n            isReconnecting = false;\n            hideReconnectingOverlay();\n\n            var joinMsg = { type: 'join', name: name };\n            if (isAdmin) {\n                joinMsg.is_admin = true;\n            }\n            ws.send(JSON.stringify(joinMsg));\n        };\n\n        ws.onmessage = function(event) {\n            try {\n                const data = JSON.parse(event.data);\n                handleServerMessage(data);\n            } catch (e) {\n                console.error('Failed to parse WebSocket message:', e);\n            }\n        };\n\n        ws.onclose = function() {\n            // Story 11.5: Skip auto-reconnect if user intentionally left\n            if (intentionalLeave) {\n                intentionalLeave = false;  // Reset flag\n                return;\n            }\n            // Attempt reconnection if we were connected and have a name\n            if (playerName && reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {\n                isReconnecting = true;\n                reconnectAttempts++;\n                showReconnectingOverlay();\n                updateReconnectStatus(reconnectAttempts);\n\n                const delay = getReconnectDelay();\n                console.log('WebSocket closed. Reconnecting in ' + delay + 'ms... (attempt ' + reconnectAttempts + ')');\n                setTimeout(function() { connectWebSocket(playerName); }, delay);\n            } else if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                // Max attempts reached - show connection lost view (Story 7-4)\n                isReconnecting = false;\n                hideReconnectingOverlay();\n                showConnectionLostView();\n            }\n        };\n\n        ws.onerror = function(err) {\n            console.error('WebSocket error:', err);\n        };\n    }\n\n    /**\n     * Handle messages from server\n     * @param {Object} data - Parsed message data\n     */\n    function handleServerMessage(data) {\n        const joinBtn = document.getElementById('join-btn');\n        const nameInput = document.getElementById('name-input');\n\n        if (data.type === 'state') {\n            // Update isAdmin from players list (Story 6.1)\n            var players = data.players || [];\n            var currentPlayer = players.find(function(p) { return p.name === playerName; });\n            if (currentPlayer) {\n                isAdmin = currentPlayer.is_admin === true;\n            }\n\n            // Apply language from game state (Story 12.4, 16.3)\n            // Must re-render dynamic content after language loads\n            if (data.language) {\n                // Store language for future page loads\n                storeGameLanguage(data.language);\n                // Apply if different from current (guard: skip if i18n unavailable)\n                if (typeof BeatifyI18n !== 'undefined' && data.language !== BeatifyI18n.getLanguage()) {\n                    BeatifyI18n.setLanguage(data.language).then(function() {\n                        BeatifyI18n.initPageTranslations();\n                        // Re-render dynamic content with new language\n                        renderPlayerList(players);\n                        if (data.difficulty) {\n                            renderDifficultyBadge(data.difficulty);\n                        }\n                        // Re-render reveal view for localized fun facts (Story 16.3)\n                        if (data.phase === 'REVEAL') {\n                            updateRevealView(data);\n                        }\n                    });\n                }\n            }\n\n            if (data.phase === 'LOBBY') {\n                stopCountdown();\n                hideAdminControlBar();  // Story 6.1\n                currentRoundNumber = 0;  // Reset for new game\n                setEnergyLevel('warmup');  // Story 9.9\n                showView('lobby-view');\n                renderPlayerList(players);\n                // Render difficulty badge (Story 14.1)\n                if (data.difficulty) {\n                    renderDifficultyBadge(data.difficulty);\n                }\n                // Render QR code with join URL\n                if (data.join_url) {\n                    renderQRCode(data.join_url);\n                }\n                // Update admin controls visibility\n                updateAdminControls(players);\n            } else if (data.phase === 'PLAYING') {\n                // Only reset submission state when round actually changes\n                var newRound = data.round || 1;\n                if (newRound !== currentRoundNumber) {\n                    currentRoundNumber = newRound;\n                    resetSubmissionState();  // Reset for new round\n                }\n                setEnergyLevel('party');  // Story 9.9\n                showView('game-view');\n                closeInviteModal();  // Story 16.5 - auto-close invite modal when round starts\n                updateGameView(data);\n                // Render difficulty badge (Story 14.1)\n                if (data.difficulty) {\n                    renderDifficultyBadge(data.difficulty);\n                }\n                if (data.deadline) {\n                    startCountdown(data.deadline);\n                }\n                initYearSelector();\n                setupLeaderboardToggle();  // Story 5.5\n                // Show admin control bar (Story 6.1)\n                showAdminControlBar();\n                updateControlBarState('PLAYING');\n            } else if (data.phase === 'REVEAL') {\n                stopCountdown();\n                setEnergyLevel('party');  // Story 9.9 - maintain party for reveal\n                showView('reveal-view');\n                updateRevealView(data);\n                // Show admin control bar (Story 6.1)\n                showAdminControlBar();\n                updateControlBarState('REVEAL');\n            } else if (data.phase === 'PAUSED') {\n                // Story 7-1: Show paused view\n                stopCountdown();\n                hideAdminControlBar();\n                setEnergyLevel('warmup');  // Story 9.9 - lower energy during pause\n                showView('paused-view');\n                updatePausedView(data);\n            } else if (data.phase === 'END') {\n                stopCountdown();\n                hideAdminControlBar();  // Story 6.1\n                currentRoundNumber = 0;  // Reset for potential new game\n                setEnergyLevel('warmup');  // Story 9.9 - final standings, lower energy\n                showView('end-view');\n                updateEndView(data);  // Story 5.6\n                // Clear stored player name (game is over - Story 7-3)\n                clearStoredPlayerName();\n            }\n        } else if (data.type === 'join_ack') {\n            // Handle join acknowledgment with session_id (Story 11.1)\n            if (data.session_id) {\n                setSessionCookie(data.session_id);\n            }\n            // Clear admin redirect storage - connection established, session cookie handles reconnect\n            try {\n                sessionStorage.removeItem('beatify_admin_name');\n                sessionStorage.removeItem('beatify_is_admin');\n            } catch (e) {\n                // Ignore storage errors\n            }\n        } else if (data.type === 'reconnect_ack') {\n            // Handle session-based reconnect acknowledgment (Story 11.2)\n            if (data.success && data.name) {\n                playerName = data.name;\n                storePlayerName(data.name);\n                showWelcomeBackToast(data.name);\n                // State message will follow with full game state\n            } else {\n                // Reconnect failed - clear session and show join form\n                clearSessionCookie();\n                clearStoredPlayerName();\n                playerName = null;\n                showView('join-view');\n            }\n        } else if (data.type === 'submit_ack') {\n            // Handle successful guess submission\n            handleSubmitAck();\n        } else if (data.type === 'error') {\n            // Handle submission-related errors\n            if (data.code === 'ROUND_EXPIRED' || data.code === 'ALREADY_SUBMITTED') {\n                handleSubmitError(data);\n                return;\n            }\n            // Handle GAME_ENDED error specially\n            if (data.code === 'GAME_ENDED') {\n                showView('end-view');\n                return;\n            }\n            // Handle NOT_ADMIN error (Story 6.1)\n            if (data.code === 'NOT_ADMIN') {\n                isAdmin = false;\n                hideAdminControlBar();\n                console.warn('Admin action rejected: not admin');\n                return;\n            }\n            // Handle SESSION_TAKEOVER - another tab took over (Story 11.2)\n            if (data.code === 'SESSION_TAKEOVER') {\n                isReconnecting = false;\n                hideReconnectingOverlay();\n                // Don't clear session cookie - other tab is using it\n                playerName = null;\n                showConnectionLostView();\n                console.warn('Session taken over by another tab');\n                return;\n            }\n            // Handle SESSION_NOT_FOUND - session expired or game reset (Story 11.2)\n            if (data.code === 'SESSION_NOT_FOUND') {\n                clearSessionCookie();\n                // Prevent reconnect attempts by reusing intentionalLeave flag\n                intentionalLeave = true;\n                // Close WebSocket cleanly to prevent onclose reconnect\n                if (ws) {\n                    ws.close();\n                }\n                // Fall back to join form\n                showView('join-view');\n                return;\n            }\n            // Handle ADMIN_CANNOT_LEAVE - host tried to leave (Story 11.5)\n            if (data.code === 'ADMIN_CANNOT_LEAVE') {\n                // Reset intentional leave flag since action was blocked\n                intentionalLeave = false;\n                // Show user-friendly error message\n                alert(data.message || 'Host cannot leave. End the game instead.');\n                return;\n            }\n            // Handle INVALID_ACTION for stop_song - restore button state (Story 16.6)\n            if (data.code === 'INVALID_ACTION' && data.message === 'No song playing') {\n                // Restore stop button state if action failed\n                resetSongStoppedState();\n                console.warn('[Beatify] Stop song failed: No song playing');\n                return;\n            }\n            // Show join view first (user may be on loading-view from auto-reconnect)\n            showView('join-view');\n            // Show error, re-enable form\n            showJoinError(data.message);\n            if (joinBtn) {\n                joinBtn.disabled = false;\n                joinBtn.textContent = t('join.joinButton');\n            }\n            if (nameInput) {\n                nameInput.focus();\n            }\n            // Clear stored name on join error\n            playerName = null;\n            // Clear localStorage to prevent repeated auto-reconnect failures\n            clearStoredPlayerName();\n        } else if (data.type === 'song_stopped') {\n            // Story 6.2 - handle song stopped notification\n            handleSongStopped();\n        } else if (data.type === 'volume_changed') {\n            // Story 6.4 - handle volume changed response\n            handleVolumeChanged(data.level);\n        } else if (data.type === 'game_ended') {\n            // Story 7-5 - game has fully ended\n            handleGameEnded();\n        } else if (data.type === 'left') {\n            // Story 11.5 - player left game successfully\n            handleLeftGame();\n        } else if (data.type === 'steal_targets') {\n            // Story 15.3 - handle steal targets response\n            handleStealTargets(data);\n        } else if (data.type === 'steal_ack') {\n            // Story 15.3 - handle steal acknowledgment\n            handleStealAck(data);\n        }\n    }\n\n    /**\n     * Handle successful leave game response (Story 11.5)\n     */\n    function handleLeftGame() {\n        // Clear all stored session data\n        clearStoredPlayerName();\n        clearSessionCookie();\n\n        // Reset local state\n        playerName = null;\n        isAdmin = false;\n\n        // Show join view for potential rejoin\n        showView('join-view');\n    }\n\n    /**\n     * Handle leave game button click (Story 11.5)\n     */\n    function handleLeaveGame() {\n        if (!ws || ws.readyState !== WebSocket.OPEN) {\n            return;\n        }\n\n        // Safety check - admin shouldn't see button, but double-check\n        if (isAdmin) {\n            alert('Host cannot leave. End the game instead.');\n            return;\n        }\n\n        // Confirmation dialog per AC #1\n        if (!confirm('Leave the game? Your score will be lost.')) {\n            return;\n        }\n\n        // Set intentional leave flag to prevent auto-reconnect\n        intentionalLeave = true;\n\n        // Send leave message to server\n        ws.send(JSON.stringify({ type: 'leave' }));\n    }\n\n    /**\n     * Handle game ended notification (Story 7-5)\n     */\n    function handleGameEnded() {\n        // Clear all stored session data\n        clearStoredPlayerName();\n        clearSessionCookie();  // Story 11.1 - clear session cookie on game end\n        try {\n            sessionStorage.removeItem('beatify_admin_name');\n            sessionStorage.removeItem('beatify_is_admin');\n        } catch (e) {\n            // Ignore storage errors\n        }\n\n        // Story 18.1: Clean up lazy loading observer to prevent memory leak\n        cleanupLeaderboardObserver();\n\n        // Story 18.2: Clean up virtual player list\n        cleanupVirtualPlayerList();\n\n        // Story 18.3: Clear animation queue and stop confetti\n        AnimationQueue.clear();\n        stopConfetti();\n\n        // Reset local state\n        playerName = null;\n        isAdmin = false;\n\n        // Close WebSocket to prevent stale connections\n        if (ws && ws.readyState === WebSocket.OPEN) {\n            ws.close();\n        }\n        ws = null;\n\n        // If already showing end view, just update the message\n        if (!endView || !endView.classList.contains('hidden')) {\n            return;\n        }\n\n        // Update end message with rejoin hint\n        var endMessage = document.getElementById('end-player-message');\n        if (endMessage) {\n            endMessage.innerHTML =\n                '<p>Thanks for playing!</p>' +\n                '<p class=\"rejoin-hint\">Scan the QR code again to join the next game.</p>';\n            endMessage.classList.remove('hidden');\n        }\n\n        showView('end-view');\n    }\n\n    /**\n     * Show join error message\n     * @param {string} message - Error message to display\n     */\n    function showJoinError(message) {\n        const validationMsg = document.getElementById('name-validation-msg');\n        if (validationMsg) {\n            validationMsg.textContent = message;\n            validationMsg.classList.remove('hidden');\n        }\n    }\n\n    /**\n     * Validate player name\n     * @param {string} name - Name to validate\n     * @returns {{valid: boolean, name?: string, error?: string}}\n     */\n    function validateName(name) {\n        const trimmed = (name || '').trim();\n        if (!trimmed) {\n            return { valid: false, error: 'Please enter a name' };\n        }\n        if (trimmed.length > MAX_NAME_LENGTH) {\n            return { valid: false, error: 'Name too long (max 20 characters)' };\n        }\n        return { valid: true, name: trimmed };\n    }\n\n    /**\n     * Handle join button click\n     */\n    function handleJoinClick() {\n        const nameInput = document.getElementById('name-input');\n        const joinBtn = document.getElementById('join-btn');\n        const validationMsg = document.getElementById('name-validation-msg');\n        if (!nameInput || !joinBtn) return;\n\n        const result = validateName(nameInput.value);\n        if (!result.valid) return;\n\n        joinBtn.disabled = true;\n        joinBtn.textContent = 'Joining...';\n\n        // Clear any previous error\n        if (validationMsg) {\n            validationMsg.classList.add('hidden');\n        }\n\n        connectWebSocket(result.name);\n    }\n\n    /**\n     * Setup join form event handlers\n     */\n    function setupJoinForm() {\n        const nameInput = document.getElementById('name-input');\n        const joinBtn = document.getElementById('join-btn');\n        const validationMsg = document.getElementById('name-validation-msg');\n        if (!nameInput || !joinBtn) return;\n\n        nameInput.addEventListener('input', function() {\n            const result = validateName(this.value);\n            joinBtn.disabled = !result.valid;\n            if (validationMsg) {\n                validationMsg.textContent = (!result.valid && this.value) ? result.error : '';\n                validationMsg.classList.toggle('hidden', result.valid || !this.value);\n            }\n        });\n\n        joinBtn.addEventListener('click', handleJoinClick);\n        nameInput.addEventListener('keypress', function(e) {\n            if (e.key === 'Enter' && !joinBtn.disabled) {\n                handleJoinClick();\n            }\n        });\n    }\n\n    // Wrap showView to auto-focus name input and set energy level (Story 9.9)\n    const originalShowView = showView;\n    showView = function(viewId) {\n        originalShowView(viewId);\n\n        // Set calm energy for entry screens (Story 9.9)\n        if (viewId === 'join-view' || viewId === 'loading-view' ||\n            viewId === 'not-found-view' || viewId === 'ended-view' ||\n            viewId === 'in-progress-view' || viewId === 'connection-lost-view') {\n            setEnergyLevel('calm');\n        }\n\n        if (viewId === 'join-view') {\n            setTimeout(function() {\n                var nameInput = document.getElementById('name-input');\n                if (nameInput) nameInput.focus();\n            }, 100);\n        }\n    };\n\n    // ============================================\n    // Energy Escalation System (Story 9.9)\n    // ============================================\n\n    /**\n     * Set energy level class on body based on game phase\n     * @param {string} level - 'calm', 'warmup', or 'party'\n     */\n    function setEnergyLevel(level) {\n        document.body.classList.remove('energy-calm', 'energy-warmup', 'energy-party');\n        document.body.classList.add('energy-' + level);\n    }\n\n    // ============================================\n    // Confetti System (Story 14.5 - canvas-confetti library)\n    // ============================================\n\n    // Track active animations for cleanup (M3 fix)\n    var confettiAnimationId = null;\n    var confettiIntervalId = null;\n\n    /**\n     * Trigger confetti celebration animation (Story 14.5)\n     * Uses canvas-confetti library for various celebration types\n     * Story 18.3: Now device-aware with reduced particle counts on low-end devices\n     * @param {string} type - 'exact', 'record', 'winner', or 'perfect'\n     */\n    function triggerConfetti(type) {\n        // AC5: Respect accessibility preference (Story 18.3: use cached value)\n        if (AnimationUtils.prefersReducedMotion()) {\n            showStaticCelebration();\n            return;\n        }\n\n        // Check if confetti library is loaded\n        if (typeof confetti === 'undefined') {\n            console.warn('[Confetti] Library not loaded');\n            return;\n        }\n\n        // Stop any existing animation before starting new one (M3 fix)\n        stopConfetti();\n\n        // Story 18.3: Get device-aware particle count\n        var quality = AnimationUtils.getQualitySettings();\n        var baseParticles = quality.confettiParticles;\n\n        // Skip confetti entirely for low-end devices with 0 particles\n        if (baseParticles === 0) {\n            showStaticCelebration();\n            return;\n        }\n\n        // Story 18.3: Scale durations for low-end devices\n        var tier = AnimationUtils.getDeviceTier();\n        var durationMultiplier = tier === 'low' ? 0.5 : (tier === 'medium' ? 0.75 : 1);\n\n        // Default to 'exact' for backward compatibility\n        type = type || 'exact';\n\n        switch (type) {\n            case 'exact':\n                // AC1: Gold burst for exact guess, 2 seconds (scaled by device tier)\n                var exactDuration = Math.round(2000 * durationMultiplier);\n                var exactEnd = Date.now() + exactDuration;\n                (function exactFrame() {\n                    confetti({\n                        particleCount: baseParticles,\n                        spread: 70,\n                        origin: { y: 0.6 },\n                        colors: ['#FFD700', '#FFA500', '#FFEC8B']\n                    });\n                    if (Date.now() < exactEnd) {\n                        confettiAnimationId = requestAnimationFrame(exactFrame);\n                    }\n                }());\n                break;\n\n            case 'record':\n                // AC2: Rainbow shower for new record, 3 seconds (scaled)\n                var recordDuration = Math.round(3000 * durationMultiplier);\n                var recordEnd = Date.now() + recordDuration;\n                (function recordFrame() {\n                    confetti({\n                        particleCount: Math.round(baseParticles * 0.67),\n                        spread: 180,\n                        origin: { y: 0.3, x: Math.random() },\n                        colors: ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#8b00ff']\n                    });\n                    if (Date.now() < recordEnd) {\n                        confettiAnimationId = requestAnimationFrame(recordFrame);\n                    }\n                }());\n                break;\n\n            case 'winner':\n                // AC3: Dual-side fireworks for winner, 4 seconds (scaled)\n                var winnerDuration = Math.round(4000 * durationMultiplier);\n                var winnerEnd = Date.now() + winnerDuration;\n                (function winnerFrame() {\n                    confetti({\n                        particleCount: Math.round(baseParticles * 0.67),\n                        angle: 60,\n                        spread: 55,\n                        origin: { x: 0 },\n                        colors: ['#ff2d6a', '#00f5ff', '#00ff88', '#ffdd00']\n                    });\n                    confetti({\n                        particleCount: Math.round(baseParticles * 0.67),\n                        angle: 120,\n                        spread: 55,\n                        origin: { x: 1 },\n                        colors: ['#ff2d6a', '#00f5ff', '#00ff88', '#ffdd00']\n                    });\n                    if (Date.now() < winnerEnd) {\n                        confettiAnimationId = requestAnimationFrame(winnerFrame);\n                    }\n                }());\n                break;\n\n            case 'perfect':\n                // AC4: Epic celebration for perfect game, 5 seconds (scaled)\n                var perfectDuration = Math.round(5000 * durationMultiplier);\n                var perfectEnd = Date.now() + perfectDuration;\n\n                // M4 fix: Use setInterval for reliable center bursts\n                confettiIntervalId = setInterval(function() {\n                    confetti({\n                        particleCount: baseParticles * 2,\n                        spread: 100,\n                        origin: { y: 0.6 },\n                        colors: ['#FFD700', '#FFA500', '#FFEC8B']\n                    });\n                }, tier === 'low' ? 750 : 500);\n\n                // Clear interval when duration ends\n                setTimeout(function() {\n                    if (confettiIntervalId) {\n                        clearInterval(confettiIntervalId);\n                        confettiIntervalId = null;\n                    }\n                }, perfectDuration);\n\n                (function perfectFrame() {\n                    confetti({\n                        particleCount: Math.round(baseParticles * 0.5),\n                        angle: 60,\n                        spread: 55,\n                        origin: { x: 0 },\n                        colors: ['#FFD700', '#ff2d6a', '#00f5ff', '#00ff88']\n                    });\n                    confetti({\n                        particleCount: Math.round(baseParticles * 0.5),\n                        angle: 120,\n                        spread: 55,\n                        origin: { x: 1 },\n                        colors: ['#FFD700', '#ff2d6a', '#00f5ff', '#00ff88']\n                    });\n                    if (Date.now() < perfectEnd) {\n                        confettiAnimationId = requestAnimationFrame(perfectFrame);\n                    }\n                }());\n                break;\n\n            default:\n                console.warn('[Confetti] Unknown type:', type);\n        }\n    }\n\n    /**\n     * Stop any ongoing confetti animations (M3 fix - proper cleanup)\n     */\n    function stopConfetti() {\n        // Cancel animation frame\n        if (confettiAnimationId) {\n            cancelAnimationFrame(confettiAnimationId);\n            confettiAnimationId = null;\n        }\n        // Clear interval\n        if (confettiIntervalId) {\n            clearInterval(confettiIntervalId);\n            confettiIntervalId = null;\n        }\n        // Reset library canvas\n        if (typeof confetti !== 'undefined' && confetti.reset) {\n            confetti.reset();\n        }\n    }\n\n    /**\n     * Show static celebration for reduced motion users (AC5)\n     */\n    function showStaticCelebration() {\n        var emotionEl = document.getElementById('reveal-emotion');\n        if (emotionEl) {\n            var existingIcon = emotionEl.querySelector('.celebration-icon');\n            if (!existingIcon) {\n                var icon = document.createElement('span');\n                icon.className = 'celebration-icon';\n                icon.textContent = ' \uD83C\uDF89';\n                emotionEl.appendChild(icon);\n            }\n        }\n    }\n\n    /**\n     * Setup reveal view event handlers\n     * Story 18.3: Added tap-to-skip animations (AC4)\n     */\n    function setupRevealControls() {\n        var nextRoundBtn = document.getElementById('next-round-btn');\n        if (nextRoundBtn) {\n            nextRoundBtn.addEventListener('click', handleNextRound);\n        }\n\n        // Story 18.3: Add tap-to-skip for reveal animations (AC4)\n        var revealViewEl = document.getElementById('reveal-view');\n        if (revealViewEl) {\n            revealViewEl.addEventListener('click', function(e) {\n                // Don't skip if clicking on buttons\n                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {\n                    return;\n                }\n                // Skip all queued animations and stop confetti\n                if (AnimationQueue.isRunning()) {\n                    AnimationQueue.skipAll();\n                }\n                stopConfetti();\n            });\n        }\n    }\n\n    // Initialize form, QR modal, and admin controls when DOM ready\n    async function initAll() {\n        // Story 18.3: Apply device tier class for CSS-based optimizations\n        var deviceTier = AnimationUtils.getDeviceTier();\n        document.body.classList.add('device-tier-' + deviceTier);\n\n        // Initialize i18n with stored language preference (Story 12.4)\n        // This ensures consistent UI language on page reload before WebSocket connects\n        // Guard clause: wait for BeatifyI18n in case fallback script is loading\n        var i18nAvailable = await waitForI18n();\n        if (!i18nAvailable) {\n            console.error('[Player] BeatifyI18n module failed to load - UI will use fallback text');\n        } else {\n            var storedLang = getStoredLanguage();\n            await BeatifyI18n.init(storedLang);\n            BeatifyI18n.initPageTranslations();\n        }\n\n        // Set dashboard hint URL with full address (Story 16.4)\n        var dashboardHintEl = document.getElementById('dashboard-hint-url');\n        if (dashboardHintEl) {\n            dashboardHintEl.textContent = window.location.origin + '/beatify/dashboard';\n        }\n\n        setupJoinForm();\n        setupQRModal();\n        setupInviteModal();  // Story 16.5\n        setupAdminControls();\n        setupRevealControls();\n        setupAdminControlBar();  // Story 6.1\n        setupRetryConnection();  // Story 7-4\n        setupLeaderboardResizeHandler();  // Story 18.1\n        // Note: canvas-confetti library (Story 14.5) needs no initialization\n\n        // Check if this is an admin redirect\n        if (checkAdminStatus() && playerName) {\n            // Auto-connect as admin\n            connectWebSocket(playerName);\n            return;\n        }\n\n        // Auto-reconnect from localStorage on page reload (Story 7-3)\n        var storedName = getStoredPlayerName();\n        if (storedName && gameId) {\n            console.log('[Beatify] Auto-reconnecting as:', storedName);\n            // Auto-connect with stored name\n            connectWebSocket(storedName);\n            return;\n        }\n\n        // No stored name - prefill form if we have a partial match\n        if (storedName) {\n            var nameInput = document.getElementById('name-input');\n            var joinBtn = document.getElementById('join-btn');\n            if (nameInput) {\n                nameInput.value = storedName;\n                if (joinBtn) {\n                    var result = validateName(storedName);\n                    joinBtn.disabled = !result.valid;\n                }\n            }\n        }\n    }\n\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initAll);\n    } else {\n        initAll();\n    }\n\n    // ============================================\n    // Service Worker Registration (Story 18.5)\n    // ============================================\n\n    /**\n     * Register service worker for asset caching\n     * AC1: Register on first visit to cache critical assets\n     */\n    if ('serviceWorker' in navigator) {\n        window.addEventListener('load', function() {\n            navigator.serviceWorker.register('/beatify/static/sw.js', {\n                scope: '/beatify/'\n            }).then(function(registration) {\n                console.log('[Beatify] SW registered:', registration.scope);\n            }).catch(function(error) {\n                console.warn('[Beatify] SW registration failed:', error);\n            });\n        });\n    }\n\n})();\n"],
  "mappings": "gOAIC,UAAW,CACR,aALJ,IAAAA,GAAAC,GASI,MAAMC,EADY,IAAI,gBAAgB,OAAO,SAAS,MAAM,EACnC,IAAI,MAAM,EAG7BC,EAAc,SAAS,eAAe,cAAc,EACpDC,GAAe,SAAS,eAAe,gBAAgB,EACvDC,GAAY,SAAS,eAAe,YAAY,EAChDC,GAAiB,SAAS,eAAe,kBAAkB,EAC3DC,GAAW,SAAS,eAAe,WAAW,EAC9CC,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAW,SAAS,eAAe,WAAW,EAC9CC,EAAa,SAAS,eAAe,aAAa,EAClDC,GAAa,SAAS,eAAe,aAAa,EAClDC,GAAU,SAAS,eAAe,UAAU,EAC5CC,GAAqB,SAAS,eAAe,sBAAsB,EAMzE,SAASC,EAASC,EAAQ,CACtB,CAACZ,EAAaC,GAAcC,GAAWC,GAAgBC,GAAUC,EAAWC,EAAUC,EAAYC,GAAYC,GAASC,EAAkB,EAAE,QAAQ,SAASG,EAAG,CACvJA,GACAA,EAAE,UAAU,IAAI,QAAQ,CAEhC,CAAC,EACD,MAAMC,EAAO,SAAS,eAAeF,CAAM,EACvCE,GACAA,EAAK,UAAU,OAAO,QAAQ,CAEtC,CAOA,SAASC,GAAoBC,EAAI,CAC7B,MAAI,CAACA,GAAM,OAAOA,GAAO,SACd,GAIJ,wBAAwB,KAAKA,CAAE,CAC1C,CAQA,SAAeC,GAAYC,EAASC,EAAU,QAAAC,GAAA,sBAC1CF,EAAUA,GAAW,IACrBC,EAAWA,GAAY,GAEvB,QADIE,EAAQ,KAAK,IAAI,EACd,OAAO,aAAgB,aAAa,CACvC,GAAI,KAAK,IAAI,EAAIA,EAAQH,EACrB,MAAO,GAEX,MAAM,IAAI,QAAQ,SAASI,EAAS,CAAE,WAAWA,EAASH,CAAQ,CAAG,CAAC,CAC1E,CACA,MAAO,EACX,GASA,SAASI,EAAEC,EAAKC,EAAQ,CAEpB,GAAI,OAAO,aAAgB,aAAe,YAAY,EAClD,OAAO,YAAY,EAAED,EAAKC,CAAM,EAIpC,IAAIC,EAAWF,EAAI,MAAM,GAAG,EAAE,IAAI,EAC7B,QAAQ,WAAY,KAAK,EACzB,QAAQ,KAAM,SAASG,EAAK,CAAE,OAAOA,EAAI,YAAY,CAAG,CAAC,EACzD,KAAK,EAEV,OAAIF,GAAU,OAAOA,GAAW,UAC5B,OAAO,KAAKA,CAAM,EAAE,QAAQ,SAASG,EAAO,CACxCF,EAAWA,EAAS,QAAQ,IAAI,OAAO,MAAQE,EAAQ,MAAO,GAAG,EAAGH,EAAOG,CAAK,CAAC,CACrF,CAAC,EAEEF,CACX,CAQA,SAASG,GAAsBC,EAAMC,EAAO,CACxC,GAAI,CAACD,EAAM,OAAO,KAElB,IAAIE,EAAQ,OAAO,aAAgB,YAAe,YAAY,YAAY,EAAI,KAE9E,GAAIA,GAAQA,IAAS,KAAM,CACvB,IAAIC,EAAeF,EAAQ,IAAMC,EACjC,GAAIF,EAAKG,CAAY,EACjB,OAAOH,EAAKG,CAAY,CAEhC,CAEA,OAAOH,EAAKC,CAAK,GAAK,IAC1B,CAKA,SAAeG,IAAkB,QAAAd,GAAA,sBAE7B,GAAI,CAACrB,EAAQ,CACTY,EAAS,gBAAgB,EACzB,MACJ,CAGA,GAAI,CAACI,GAAoBhB,CAAM,EAAG,CAC9BY,EAAS,gBAAgB,EACzB,MACJ,CAEA,GAAI,CAEA,MAAMwB,EAAO,MADI,MAAM,MAAM,iCAAiC,mBAAmBpC,CAAM,CAAC,EAAE,GAC9D,KAAK,EAEjC,GAAI,CAACoC,EAAK,OAAQ,CACdxB,EAAS,gBAAgB,EACzB,MACJ,CAEA,GAAIwB,EAAK,QAAU,MAAO,CACtBxB,EAAS,YAAY,EACrB,MACJ,CAKA,IAAIyB,EAAY,eAAe,QAAQ,oBAAoB,EAC3D,GAAIA,EAEA,OAMJ,IAAIC,EAAgBC,GAAiB,EACrC,GAAID,EAAe,CAEfE,GAAmB,EACnB,MACJ,CAGIJ,EAAK,SACLxB,EAAS,WAAW,EAGpBA,EAAS,kBAAkB,CAGnC,OAAS6B,EAAK,CACV,QAAQ,MAAM,+BAAgCA,CAAG,EACjD7B,EAAS,gBAAgB,CAC7B,CACJ,GAGAuB,GAAgB,GAGhBrC,GAAA,SAAS,eAAe,aAAa,IAArC,MAAAA,GAAwC,iBAAiB,QAAS,IAAM,CACpEc,EAAS,cAAc,EACvBuB,GAAgB,CACpB,IAEApC,GAAA,SAAS,eAAe,WAAW,IAAnC,MAAAA,GAAsC,iBAAiB,QAAS,IAAM,CAClEa,EAAS,cAAc,EACvBuB,GAAgB,CACpB,GAMA,IAAIO,GAAsB,kBAM1B,SAASC,GAAiBC,EAAW,CAEjC,IAAIC,EAAa,SAAS,WAAa,SAAW,WAAa,GAC/D,SAAS,OAASH,GAAsB,IAAME,EAC1C,kDAAoDC,CAC5D,CAMA,SAASN,IAAmB,CAExB,QADIO,EAAU,SAAS,OAAO,MAAM,GAAG,EAC9BC,EAAI,EAAGA,EAAID,EAAQ,OAAQC,IAAK,CACrC,IAAIC,EAASF,EAAQC,CAAC,EAAE,KAAK,EAC7B,GAAIC,EAAO,QAAQN,GAAsB,GAAG,IAAM,EAC9C,OAAOM,EAAO,UAAUN,GAAoB,OAAS,CAAC,CAE9D,CACA,OAAO,IACX,CAKA,SAASO,GAAqB,CAC1B,SAAS,OAASP,GAAsB,6BAC5C,CAUA,SAASQ,IAAuB,CAC5B,OAAO,OAAO,WAAW,kCAAkC,EAAE,OACjE,CAOA,SAASC,GAAa3B,EAAG,CACrB,MAAO,GAAI,KAAK,IAAI,EAAIA,EAAG,CAAC,CAChC,CAYA,SAAS4B,GAAaC,EAAS/B,EAAOgC,EAAKC,EAAUC,EAAQ,CAEzD,GAAIN,GAAqB,GAAK5B,IAAUgC,EACpC,OAAAD,EAAQ,YAAcC,EACf,CAAE,OAAQ,UAAW,CAAC,EAAG,UAAW,UAAW,CAAED,EAAQ,YAAcC,CAAK,CAAE,EAIzF,IAAIG,EAAUC,EAAe,mBAAmB,EAChD,GAAID,EAAQ,gBAAkB,EAE1B,OAAAJ,EAAQ,YAAcC,EACf,CAAE,OAAQ,UAAW,CAAC,EAAG,UAAW,UAAW,CAAED,EAAQ,YAAcC,CAAK,CAAE,EAIzF,IAAIK,EAAmB,KAAK,IAAIJ,EAAUE,EAAQ,eAAiBF,CAAQ,EAE3EC,EAASA,GAAUL,GACnB,IAAIS,EAAY,KACZC,EAAc,KACdC,EAAY,GACZC,EAAaT,EAEjB,SAASU,EAAKC,EAAW,CACrB,GAAI,CAAAH,EAEJ,CAAKF,IAAWA,EAAYK,GAC5B,IAAIC,EAAUD,EAAYL,EACtBO,EAAW,KAAK,IAAID,EAAUP,EAAkB,CAAC,EACjDS,EAAgBZ,EAAOW,CAAQ,EAE/BE,EAAe,KAAK,MAAM/C,GAASyC,EAAazC,GAAS8C,CAAa,EAC1Ef,EAAQ,YAAcgB,EAElBF,EAAW,IACXN,EAAc,sBAAsBG,CAAI,GAEhD,CAEA,OAAAH,EAAc,sBAAsBG,CAAI,EAEjC,CACH,OAAQ,UAAW,CACfF,EAAY,GACRD,GACA,qBAAqBA,CAAW,CAExC,EACA,UAAW,UAAW,CAClBC,EAAY,GACRD,GACA,qBAAqBA,CAAW,EAEpCR,EAAQ,YAAcU,CAC1B,CACJ,CACJ,CASA,SAASO,GAAmBjB,EAASkB,EAAUC,EAAUC,EAAS,CAC9DA,EAAUA,GAAW,CAAC,EAGtB,IAAIlB,EAAW,IACXkB,EAAQ,OACRlB,EAAW,IACJkB,EAAQ,WACflB,EAAW,IACJkB,EAAQ,UACflB,EAAW,KAIfF,EAAQ,UAAU,IAAI,iBAAiB,EAGvC,IAAIqB,EAAiB,KACjBD,EAAQ,OACRC,EAAiB,kBACVD,EAAQ,SACfC,EAAiB,cACjBrB,EAAQ,UAAU,IAAI,iBAAiB,GAChCoB,EAAQ,gBACfC,EAAiB,cACVD,EAAQ,aACfC,EAAiB,aAGjBA,GAAkB,CAACxB,GAAqB,GACxCG,EAAQ,UAAU,IAAIqB,CAAc,EAIxCtB,GAAaC,EAASkB,EAAUC,EAAUjB,CAAQ,EAGlD,SAASoB,GAAU,CACftB,EAAQ,UAAU,OAAO,iBAAiB,EACtCqB,GACArB,EAAQ,UAAU,OAAOqB,CAAc,EAE3CrB,EAAQ,UAAU,OAAO,iBAAiB,CAC9C,CAGIqB,GAAkB,CAACxB,GAAqB,EACxCG,EAAQ,iBAAiB,eAAgB,SAASuB,GAAQ,CACtDvB,EAAQ,oBAAoB,eAAgBuB,CAAK,EACjDD,EAAQ,CACZ,CAAC,EAED,WAAWA,EAASpB,EAAW,EAAE,CAEzC,CAQA,SAASsB,GAAgBC,EAAeC,EAAQN,EAAS,CAIrD,GAHAA,EAAUA,GAAW,CAAC,EAGlB,CAAAvB,GAAqB,EAIzB,KAAI8B,EAAQ,SAAS,cAAc,KAAK,EACxCA,EAAM,UAAY,eAClBA,EAAM,YAAcP,EAAQ,MAAS,IAAMM,EAEvCN,EAAQ,SACRO,EAAM,UAAU,IAAI,sBAAsB,EACnCP,EAAQ,UACfO,EAAM,UAAU,IAAI,oBAAoB,EAI5C,IAAIC,EAAOH,EAAc,sBAAsB,EAC/CE,EAAM,MAAM,KAAQC,EAAK,KAAOA,EAAK,MAAQ,EAAK,KAClDD,EAAM,MAAM,IAAMC,EAAK,IAAM,KAE7B,SAAS,KAAK,YAAYD,CAAK,EAG/BA,EAAM,iBAAiB,eAAgB,UAAW,CAC1CA,EAAM,YACNA,EAAM,WAAW,YAAYA,CAAK,CAE1C,CAAC,EAGD,WAAW,UAAW,CACdA,EAAM,YACNA,EAAM,WAAW,YAAYA,CAAK,CAE1C,EAAG,IAAI,EACX,CAGA,IAAIE,EAAgB,CAChB,QAAS,CAAC,EACV,YAAa,CAAC,EACd,YAAa,EACjB,EAOA,SAASC,IAA6B,CAClC,OAAOD,EAAc,WACzB,CAGA,IAAIE,GAAoB,CAAC,EAAG,EAAG,EAAE,EAS7B1B,EAAkB,UAAW,CAE7B,IAAI2B,EAAqB,OAAO,WAAW,kCAAkC,EACzEC,EAAwBD,EAAmB,QAG/CA,EAAmB,iBAAiB,SAAU,SAASE,EAAG,CACtDD,EAAwBC,EAAE,OAC9B,CAAC,EAGD,IAAIC,EAAc,KAMlB,SAASC,GAAgB,CACrB,GAAID,IAAgB,KAAM,OAAOA,EAEjC,IAAIE,EAAQ,UAAU,qBAAuB,EACzCC,EAAS,UAAU,cAAgB,EAGnCC,EAAc,mBAAmB,KAAK,UAAU,SAAS,GAAK,CAAC,OAAO,SAE1E,OAAIF,GAAS,GAAKC,GAAU,EACxBH,EAAc,MACPE,GAAS,GAAKC,GAAU,GAAKC,EACpCJ,EAAc,SAEdA,EAAc,OAGXA,CACX,CAGA,OAAAC,EAAc,EAEP,CAKH,qBAAsB,UAAW,CAC7B,OAAOH,CACX,EAMA,cAAeG,EAMf,mBAAoB,UAAW,CAC3B,IAAII,EAAOJ,EAAc,EACzB,GAAIH,EACA,MAAO,CACH,kBAAmB,EACnB,cAAe,EACf,qBAAsB,OACtB,SAAU,GACV,iBAAkB,EACtB,EAEJ,OAAQO,EAAM,CACV,IAAK,MACD,MAAO,CACH,kBAAmB,EACnB,cAAe,EACf,qBAAsB,OACtB,SAAU,GACV,iBAAkB,EACtB,EACJ,IAAK,SACD,MAAO,CACH,kBAAmB,GACnB,cAAe,IACf,qBAAsB,aACtB,SAAU,GACV,iBAAkB,EACtB,EACJ,QACI,MAAO,CACH,kBAAmB,GACnB,cAAe,IACf,qBAAsB,OACtB,SAAU,GACV,iBAAkB,EACtB,CACR,CACJ,EAOA,gBAAiB,SAASC,EAAaC,EAAY,CAC3CT,EACIS,GAAYA,EAAW,EAE3BD,EAAY,CAEpB,EAQA,eAAgB,SAASzC,EAAS2C,EAAYC,EAAY,CACjD5C,IACLA,EAAQ,MAAM,WAAa2C,EAE3B,WAAW,UAAW,CACd3C,GAAWA,EAAQ,QACnBA,EAAQ,MAAM,WAAa,OAEnC,GAAI4C,GAAc,KAAO,GAAG,EAChC,CACJ,CACJ,EAAG,EAMCC,GAAkB,UAAW,CAC7B,IAAIC,EAAQ,CAAC,EACTC,EAAU,GACVC,EAAmB,KACnBC,EAAqB,KACrBC,EAAyB,IAE7B,SAASC,GAAc,CAOnB,GALIF,IACA,aAAaA,CAAkB,EAC/BA,EAAqB,MAGrBH,EAAM,SAAW,EAAG,CACpBC,EAAU,GACVC,EAAmB,KACnB,MACJ,CACAA,EAAmBF,EAAM,MAAM,EAG/BG,EAAqB,WAAW,UAAW,CACnCD,GAAoBA,EAAiB,WACrCA,EAAiB,UAAU,EAE/BG,EAAY,CAChB,EAAGD,CAAsB,EAEzBF,EAAiB,IAAI,UAAW,CAExBC,IACA,aAAaA,CAAkB,EAC/BA,EAAqB,MAEzBE,EAAY,CAChB,CAAC,CACL,CAEA,MAAO,CAKH,IAAK,SAASC,EAAW,CACrBN,EAAM,KAAKM,CAAS,EACfL,IACDA,EAAU,GACVI,EAAY,EAEpB,EAKA,QAAS,UAAW,CAEZF,IACA,aAAaA,CAAkB,EAC/BA,EAAqB,MAGrBD,GAAoBA,EAAiB,WACrCA,EAAiB,UAAU,EAG/BF,EAAM,QAAQ,SAASO,EAAM,CACrBA,EAAK,WAAWA,EAAK,UAAU,CACvC,CAAC,EACDP,EAAQ,CAAC,EACTC,EAAU,GACVC,EAAmB,IACvB,EAKA,MAAO,UAAW,CAEVC,IACA,aAAaA,CAAkB,EAC/BA,EAAqB,MAEzBH,EAAQ,CAAC,EACTC,EAAU,GACVC,EAAmB,IACvB,EAMA,UAAW,UAAW,CAClB,OAAOD,CACX,EAMA,eAAgB,UAAW,CACvB,OAAO,WACX,CACJ,CACJ,EAAG,EAMCO,EAA0B,CAC1B,eAAgB,EAChB,aAAc,GACd,qBAAsB,GACtB,YAAa,WACb,wBAAyB,GAC7B,EAGIC,EAAuB,CACvB,SAAU,KACV,SAAU,CAAC,EACX,aAAc,CAAE,MAAO,EAAG,IAAK,EAAG,EAClC,OAAQ,KACR,cAAe,EACnB,EAMA,SAASC,GAAwBC,EAAQ,CAChCA,IAGDF,EAAqB,UAAYA,EAAqB,SAAWE,IACjEF,EAAqB,SAAS,WAAW,EACzCA,EAAqB,SAAW,MAGhC,CAAAA,EAAqB,WAEzBA,EAAqB,OAASE,EAG9BF,EAAqB,SAAW,IAAI,qBAAqB,SAASG,EAAS,CACvEA,EAAQ,QAAQ,SAASC,EAAO,CAC5B,GAAI,GAACA,EAAM,gBAAkB,CAACJ,EAAqB,eAEnD,KAAIK,EAAWL,EAAqB,SAChCM,EAAQN,EAAqB,aAC7BO,EAASR,EAAwB,eAErC,GAAIK,EAAM,OAAO,UAAU,SAAS,2BAA2B,GAE3D,GAAIE,EAAM,MAAQ,EAAG,CACjB,IAAIE,EAAW,KAAK,IAAI,EAAGF,EAAM,MAAQC,CAAM,EAC/CP,EAAqB,aAAa,MAAQQ,EAC1CC,GAA2B,CAC/B,UACOL,EAAM,OAAO,UAAU,SAAS,8BAA8B,GAEjEE,EAAM,IAAMD,EAAS,OAAQ,CAC7B,IAAIK,EAAS,KAAK,IAAIL,EAAS,OAAQC,EAAM,IAAMC,CAAM,EACzDP,EAAqB,aAAa,IAAMU,EACxCD,GAA2B,CAC/B,EAER,CAAC,CACL,EAAG,CACC,KAAMP,EACN,WAAYH,EAAwB,YACpC,UAAW,CACf,CAAC,GACL,CAKA,SAASU,IAA6B,CAClC,IAAIP,EAASF,EAAqB,OAC9BK,EAAWL,EAAqB,SAChCM,EAAQN,EAAqB,aAEjC,GAAI,GAACE,GAAU,CAACG,EAAS,QAEzB,KAAIM,EAAcZ,EAAwB,aACtCa,EAAkBN,EAAM,MAAQK,EAChCE,GAAsBR,EAAS,OAASC,EAAM,KAAOK,EAGrDG,EAAYZ,EAAO,UAGnBa,EAAO,GAGPH,EAAkB,IAClBG,GAAQ,sDAAwDH,EAAkB,eAItFG,GAAQ,0FAGR,QAAS5E,EAAImE,EAAM,MAAOnE,EAAImE,EAAM,KAAOnE,EAAIkE,EAAS,OAAQlE,IAC5D4E,GAAQC,GAAuBX,EAASlE,CAAC,CAAC,EAiB9C,GAbA4E,GAAQ,6FAGJF,EAAqB,IACrBE,GAAQ,yDAA2DF,EAAqB,eAG5FX,EAAO,UAAYa,EAGnBb,EAAO,UAAYY,EAGfd,EAAqB,SAAU,CAC/B,IAAIiB,EAAYf,EAAO,iBAAiB,uBAAuB,EAC/De,EAAU,QAAQ,SAASC,EAAU,CACjClB,EAAqB,SAAS,QAAQkB,CAAQ,CAClD,CAAC,CACL,EACJ,CAOA,SAASF,GAAuBZ,EAAO,CAEnC,GAAI,CAACA,EAAO,MAAO,GAEnB,GAAIA,EAAM,UACN,MAAO,+CAIX,IAAIe,EAAOf,EAAM,MAAQ,UACrBgB,EAAOhB,EAAM,MAAQ,EACrBiB,EAAQjB,EAAM,OAAS,EAEvBkB,EAAYF,GAAQ,EAAI,UAAYA,EAAO,GAC3CG,EAAenB,EAAM,WAAa,aAAe,GAGjDtC,EAAiB,GACjBsC,EAAM,YAAc,GAAKA,EAAM,cAAgB,KAC/CtC,EAAiB,2DACVsC,EAAM,YAAc,GAAKA,EAAM,cAAgB,UACtDtC,EAAiB,4DAIrB,IAAI0D,EAAkB,GAClBpB,EAAM,YAAc,EACpBoB,EAAkB,+BAA4BpB,EAAM,YAAc,UAC3DA,EAAM,YAAc,IAC3BoB,EAAkB,iCAA8B,KAAK,IAAIpB,EAAM,WAAW,EAAI,WAIlF,IAAIqB,EAAkB,GACtB,GAAIrB,EAAM,QAAU,EAAG,CACnB,IAAIsB,EAAWtB,EAAM,QAAU,EAAI,wBAA0B,GAC7DqB,EAAkB,iCAAmCC,EAAW,cAAStB,EAAM,OAAS,SAC5F,CAGA,IAAIuB,EAAoBvB,EAAM,YAAc,GAAQ,kCAAoC,GACpFwB,EAAYxB,EAAM,YAAc,GAAQ,yCAA2C,GAGnFyB,EAAezB,EAAM,gBAAkB,OAAYA,EAAM,cAAgBiB,EAE7E,MAAO,iCAAmCC,EAAY,IAAMC,EAAe,IAAMzD,EAAiB,IAAM6D,EAAoB,gBAAkBP,EAAO,gBAAkBU,EAAWX,CAAI,EAAI,+BACvJC,EAAO,mCACRU,EAAWX,CAAI,EAAIS,EAAY,mCAEzDH,EACAD,EACJ,sDACiDpB,EAAM,YAAciB,GAAS,KAAOQ,EAAe,eAE5G,CAQA,SAASE,GAA6BC,EAAaC,EAAmB,CAWlE,QAVIC,EAASnC,EAEToC,EAAiBnC,EAAqB,QACpCA,EAAqB,OAAO,cAAgBkC,EAAO,wBAErDE,EAAkB,KAAK,KAAKD,EAAiBD,EAAO,YAAY,EAChE3B,EAAS2B,EAAO,eAGhBG,EAAa,GACRlG,EAAI,EAAGA,EAAI6F,EAAY,OAAQ7F,IACpC,GAAI6F,EAAY7F,CAAC,EAAE,OAAS8F,EAAmB,CAC3CI,EAAalG,EACb,KACJ,CAGJ,IAAIzB,EAAOgC,EACX,OAAI2F,IAAe,IAAMA,EAAaD,GAElC1H,EAAQ,EACRgC,EAAM,KAAK,IAAIsF,EAAY,OAAQI,EAAkB7B,EAAS,CAAC,GACxD8B,GAAcL,EAAY,OAASI,GAE1C1H,EAAQ,KAAK,IAAI,EAAGsH,EAAY,OAASI,EAAkB7B,CAAM,EACjE7D,EAAMsF,EAAY,SAGlBtH,EAAQ,KAAK,IAAI,EAAG2H,EAAa,KAAK,MAAMD,EAAkB,CAAC,EAAI7B,CAAM,EACzE7D,EAAM,KAAK,IAAIsF,EAAY,OAAQK,EAAa,KAAK,KAAKD,EAAkB,CAAC,EAAI7B,CAAM,GAGpF,CAAE,MAAO7F,EAAO,IAAKgC,CAAI,CACpC,CAKA,SAAS4F,IAA6B,CAC9BtC,EAAqB,WACrBA,EAAqB,SAAS,WAAW,EACzCA,EAAqB,SAAW,MAEpCA,EAAqB,cAAgB,GACrCA,EAAqB,SAAW,CAAC,CACrC,CAMA,SAASuC,IAAgC,CACrC,IAAIC,EAEJ,SAASC,GAAe,CAEpB,aAAaD,CAAa,EAC1BA,EAAgB,WAAW,UAAW,CAC9BxC,EAAqB,eAAiBA,EAAqB,SAAS,OAAS,IAE7EA,EAAqB,aAAe+B,GAChC/B,EAAqB,SACrB0C,CACJ,EACAjC,GAA2B,EAEnC,EAAG,GAAG,CACV,CAEA,OAAO,iBAAiB,SAAUgC,CAAY,EAC9C,OAAO,iBAAiB,oBAAqBA,CAAY,CAC7D,CAMA,IAAIE,GAAsB,CACtB,YAAa,GACb,SAAU,EACV,UAAW,GACX,iBAAkB,GACtB,EAGIC,EAAoB,CACpB,UAAW,KACX,MAAO,CAAC,EACR,UAAW,EACX,UAAW,GACX,UAAW,KACX,aAAc,KACd,eAAgB,KAChB,cAAe,KACf,cAAe,IACnB,EAMA,SAASC,GAAsBC,EAAW,CACtC,GAAKA,EAEL,CAAAF,EAAkB,UAAYE,EAG9B,IAAIC,EAAU,GACdH,EAAkB,cAAgB,UAAW,CACzCA,EAAkB,UAAYE,EAAU,UACnCC,IACD,sBAAsB,UAAW,CAC7BC,GAAwB,EACxBD,EAAU,EACd,CAAC,EACDA,EAAU,GAElB,EAGA,IAAIP,EACJI,EAAkB,cAAgB,UAAW,CACzC,aAAaJ,CAAa,EAC1BA,EAAgB,WAAW,UAAW,CAC9BI,EAAkB,WAClBI,GAAwB,CAEhC,EAAG,GAAG,CACV,EAEAF,EAAU,iBAAiB,SAAUF,EAAkB,cAAe,CAAE,QAAS,EAAK,CAAC,EACvF,OAAO,iBAAiB,SAAUA,EAAkB,aAAa,EACrE,CAOA,SAASK,GAA0BC,EAAOC,EAAc,CACpDP,EAAkB,MAAQM,EAC1BN,EAAkB,WAAaO,EAE/B,IAAIL,EAAYF,EAAkB,UAClC,GAAKE,EAGL,KAAIM,EAAgBN,EAAU,UAC1BO,EAAaT,EAAkB,UAE/BM,EAAM,OAASP,GAAoB,WAEnCC,EAAkB,UAAY,GAC9BE,EAAU,UAAU,OAAO,sBAAsB,EACjDQ,GAAqBJ,EAAOC,CAAY,IAGxCP,EAAkB,UAAY,GAC9BE,EAAU,UAAU,IAAI,sBAAsB,EAC9CS,GAAsB,EACtBP,GAAwB,GAIxBK,IAAeT,EAAkB,WAAaQ,EAAgB,IAC9DN,EAAU,UAAYM,EACtBR,EAAkB,UAAYQ,GAEtC,CAKA,SAASG,IAAwB,CAC7B,IAAIT,EAAYF,EAAkB,UAClC,GAAKE,EAGL,CAAAA,EAAU,UAAY,GAGtB,IAAIU,EAAY,SAAS,cAAc,KAAK,EAC5CA,EAAU,UAAY,qBACtBZ,EAAkB,UAAYY,EAG9B,IAAIC,EAAiB,SAAS,cAAc,KAAK,EACjDA,EAAe,UAAY,0BAC3Bb,EAAkB,eAAiBa,EAGnC,IAAIC,EAAe,SAAS,cAAc,KAAK,EAC/CA,EAAa,UAAY,wBACzBd,EAAkB,aAAec,EAEjCZ,EAAU,YAAYU,CAAS,EAC/BV,EAAU,YAAYW,CAAc,EACpCX,EAAU,YAAYY,CAAY,EACtC,CAKA,SAASV,IAA0B,CAC/B,IAAId,EAASS,GACTO,EAAQN,EAAkB,MAC1BE,EAAYF,EAAkB,UAC9Ba,EAAiBb,EAAkB,eAEvC,GAAI,GAACE,GAAa,CAACW,GAAkB,CAACP,EAAM,QAE5C,KAAIS,EAAkBb,EAAU,cAAgBZ,EAAO,iBACnDpB,EAAY8B,EAAkB,UAC9BgB,EAAa1B,EAAO,YACpB2B,EAAW3B,EAAO,SAGlB4B,EAAW,KAAK,IAAI,EAAG,KAAK,MAAMhD,EAAY8C,CAAU,EAAIC,CAAQ,EACpEE,EAAS,KAAK,IACdb,EAAM,OACN,KAAK,MAAMpC,EAAY6C,GAAmBC,CAAU,EAAIC,CAC5D,EAGIjB,EAAkB,YAClBA,EAAkB,UAAU,MAAM,OAAUkB,EAAWF,EAAc,MAErEhB,EAAkB,eAClBA,EAAkB,aAAa,MAAM,QAAWM,EAAM,OAASa,GAAUH,EAAc,MAK3F,QADI7C,EAAO,GACF5E,EAAI2H,EAAU3H,EAAI4H,EAAQ5H,IAC/B4E,GAAQ6B,EAAkB,WAAWM,EAAM/G,CAAC,EAAGA,CAAC,EAGpDsH,EAAe,UAAY1C,EAC/B,CAOA,SAASuC,GAAqBJ,EAAOC,EAAc,CAC/C,IAAIL,EAAYF,EAAkB,UAClC,GAAKE,EAGL,SADI/B,EAAO,GACF5E,EAAI,EAAGA,EAAI+G,EAAM,OAAQ/G,IAC9B4E,GAAQoC,EAAaD,EAAM/G,CAAC,EAAGA,CAAC,EAEpC2G,EAAU,UAAY/B,EAC1B,CAKA,SAASiD,IAA2B,CAChC,IAAIlB,EAAYF,EAAkB,UAC9BE,GAAaF,EAAkB,eAC/BE,EAAU,oBAAoB,SAAUF,EAAkB,aAAa,EAEvEA,EAAkB,eAClB,OAAO,oBAAoB,SAAUA,EAAkB,aAAa,EAExEA,EAAkB,UAAY,KAC9BA,EAAkB,MAAQ,CAAC,EAC3BA,EAAkB,UAAY,GAC9BA,EAAkB,UAAY,KAC9BA,EAAkB,aAAe,KACjCA,EAAkB,eAAiB,IACvC,CAQA,SAASqB,GAAkBC,EAAWC,EAAW,CAC7C,QAAShI,EAAI,EAAGA,EAAIqC,GAAkB,OAAQrC,IAAK,CAC/C,IAAIiI,EAAY5F,GAAkBrC,CAAC,EACnC,GAAI+H,EAAYE,GAAaD,GAAaC,EACtC,OAAOA,CAEf,CACA,OAAO,IACX,CAOA,SAASC,GAAkBC,EAAgB,CACvC,IAAIC,EAAWD,EAAe,IAAI,SAASlE,EAAO,CAAE,OAAOA,EAAM,IAAM,CAAC,EACpEoE,EAAU,CAAC,EAEf,OAAAD,EAAS,QAAQ,SAASpD,EAAMsD,EAAS,CACrC,IAAIC,EAAUpG,EAAc,YAAY,QAAQ6C,CAAI,EAChDuD,IAAY,GACZF,EAAQrD,CAAI,EAAI,MACTsD,EAAUC,EACjBF,EAAQrD,CAAI,EAAI,KACTsD,EAAUC,IACjBF,EAAQrD,CAAI,EAAI,OAExB,CAAC,EAEMqD,CACX,CAOA,SAASG,GAAoBC,EAASC,EAAa,CAE/CvG,EAAc,QAAU,CAAC,EACzBsG,EAAQ,QAAQ,SAASE,EAAQ,CAC7BxG,EAAc,QAAQwG,EAAO,IAAI,EAAI,CACjC,MAAOA,EAAO,MACd,KAAMA,EAAO,MAAQ,EACrB,OAAQA,EAAO,QAAU,CAC7B,CACJ,CAAC,EAGGD,IACAvG,EAAc,YAAcuG,EAAY,IAAI,SAASzE,EAAO,CACxD,OAAOA,EAAM,IACjB,CAAC,GAIL9B,EAAc,YAAc,EAChC,CAKA,SAASyG,IAAqB,CAC1BzG,EAAc,QAAU,CAAC,EACzBA,EAAc,YAAc,CAAC,EAC7BA,EAAc,YAAc,EAChC,CAOA,SAAS0G,GAAYhK,EAAK,CACtB,MAAI,CAACA,GAAO,OAAOA,GAAQ,SAAiB,GAIrC,kEAAkE,KAAKA,CAAG,GAC1E,kBAAkB,KAAKA,CAAG,CACrC,CAMA,SAASY,IAAqB,CAC1B,IAAII,EAAYL,GAAiB,EACjC,GAAI,CAACK,GAAa,CAACgJ,GAAYhJ,CAAS,EAAG,CAEnCA,GAAWK,EAAmB,EAClCrC,EAAS,WAAW,EACpB,MACJ,CAEA,IAAIiL,EAAa,OAAO,SAAS,WAAa,SAAW,OAAS,MAC9DC,EAAQD,EAAa,KAAO,OAAO,SAAS,KAAO,cAEvDE,EAAK,IAAI,UAAUD,CAAK,EAExBC,EAAG,OAAS,UAAW,CACnBC,EAAoB,EACpBC,EAAiB,GACjBC,GAAwB,EAGxBH,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,YACN,WAAYnJ,CAChB,CAAC,CAAC,CACN,EAEAmJ,EAAG,UAAY,SAASI,EAAO,CAC3B,GAAI,CACA,IAAI/J,EAAO,KAAK,MAAM+J,EAAM,IAAI,EAChCC,GAAoBhK,CAAI,CAC5B,OAASmD,EAAG,CACR,QAAQ,MAAM,qCAAsCA,CAAC,CACzD,CACJ,EAEAwG,EAAG,QAAU,UAAW,CAEpB,GAAIzC,GAAc0C,EAAoBK,EAAwB,CAC1DJ,EAAiB,GACjBD,IACAM,GAAwB,EACxBC,GAAsBP,CAAiB,EAEvC,IAAIQ,EAAQC,GAAkB,EAC9B,QAAQ,IAAI,qCAAuCD,EAAQ,kBAAoBR,EAAoB,GAAG,EACtG,WAAW,UAAW,CAAExJ,GAAmB,CAAG,EAAGgK,CAAK,CAC1D,MAAWR,GAAqBK,GAC5BJ,EAAiB,GACjBC,GAAwB,EACxBQ,GAAuB,GAGvB9L,EAAS,WAAW,CAE5B,EAEAmL,EAAG,QAAU,SAAStJ,EAAK,CACvB,QAAQ,MAAM,mBAAoBA,CAAG,CACzC,CACJ,CAMA,SAASkK,GAAqB5E,EAAM,CAChC,IAAI6E,EAAY,SAAS,eAAe,kBAAkB,EACtDA,IACAA,EAAU,YAAc,iBAAmB7E,EAAO,IAClD6E,EAAU,UAAU,OAAO,QAAQ,EACnCA,EAAU,UAAU,IAAI,YAAY,EACpC,WAAW,UAAW,CAClBA,EAAU,UAAU,OAAO,YAAY,EACvC,WAAW,UAAW,CAClBA,EAAU,UAAU,IAAI,QAAQ,CACpC,EAAG,GAAG,CACV,EAAG,GAAI,EAEf,CAMA,MAAMC,GAAkB,GAMxB,IAAIC,GAAkB,CAAC,EAOvB,SAASpE,EAAWqE,EAAM,CACtB,MAAMC,EAAM,SAAS,cAAc,KAAK,EACxC,OAAAA,EAAI,YAAcD,EACXC,EAAI,SACf,CAMA,SAASC,GAAiBzB,EAAS,CAC/B,MAAM1E,EAAS,SAAS,eAAe,aAAa,EAC9CoG,EAAU,SAAS,eAAe,cAAc,EACtD,GAAI,CAACpG,EAAQ,OAGb,GAAIoG,EAAS,CACT,MAAMC,EAAQ3B,EAAQ,OACtB0B,EAAQ,YAAcC,IAAU,EAC1B3L,EAAE,oBAAoB,EACtBA,EAAE,sBAAuB,CAAE,MAAO2L,CAAM,CAAC,CACnD,CAGA,IAAIC,EAAgB5B,EAAQ,MAAM,EAAE,KAAK,SAAS6B,EAAGC,EAAG,CACpD,OAAID,EAAE,YAAcC,EAAE,UACXD,EAAE,UAAY,GAAK,EAEvB,CACX,CAAC,EAGD,MAAME,EAAgBT,GAAgB,IAAI,SAASU,EAAG,CAAE,OAAOA,EAAE,IAAM,CAAC,EAClEC,EAAWL,EACZ,OAAO,SAASI,EAAG,CAAE,OAAOD,EAAc,QAAQC,EAAE,IAAI,IAAM,EAAI,CAAC,EACnE,IAAI,SAASA,EAAG,CAAE,OAAOA,EAAE,IAAM,CAAC,EAGlChE,EAAkB,WACnBC,GAAsB3C,CAAM,EAIhC,IAAI4G,EAAmB,SAAShC,EAAQ,CACpC,IAAIiC,EAAQF,EAAS,QAAQ/B,EAAO,IAAI,IAAM,GAC1CkC,EAAQlC,EAAO,OAASpC,EACxBuE,EAAiBnC,EAAO,YAAc,GACtCoC,EAAU,CACV,cACAH,EAAQ,SAAW,GACnBC,EAAQ,mBAAqB,GAC7BC,EAAiB,4BAA8B,EACnD,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,EAGtBrF,EAAYqF,EAAiB,yCAA2C,GAE5E,MAAO,eAAiBC,EAAU,kBAAoBpF,EAAWgD,EAAO,IAAI,EAAI,+BAExEhD,EAAWgD,EAAO,IAAI,GACrBkC,EAAQ,2BAA6BpM,EAAE,iBAAiB,EAAI,UAAY,IACzEgH,EACJ,eAER,EAGAqB,GAA0BuD,EAAeM,CAAgB,EAGzD,WAAW,UAAW,CAClB,IAAIhE,EAAYF,EAAkB,UAAYA,EAAkB,eAAiB1C,EACjF,GAAI,CAAC4C,EAAW,OAChB,MAAMqE,EAAWrE,EAAU,iBAAiB,SAAS,EACrD,QAAS3G,EAAI,EAAGA,EAAIgL,EAAS,OAAQhL,IACjCgL,EAAShL,CAAC,EAAE,UAAU,OAAO,QAAQ,CAE7C,EAAG,GAAI,EAEP+J,GAAkBtB,EAAQ,MAAM,CACpC,CAUA,SAASwC,GAAsBC,EAAY,CACvC,IAAIC,EAAW,CACX,KAAM,sBACN,OAAQ,wBACR,KAAM,qBACV,EAAED,CAAU,GAAK,wBAEbE,EAAQ3M,EAAE0M,CAAQ,EAGlBE,EAAa,SAAS,eAAe,wBAAwB,EAC7DC,EAAY,SAAS,eAAe,uBAAuB,EAE3DD,IACAA,EAAW,YAAcD,EACzBC,EAAW,UAAY,uCAAyCH,GAAc,WAG9EI,IACAA,EAAU,YAAcF,EACxBE,EAAU,UAAY,uCAAyCJ,GAAc,UAErF,CAMA,IAAIK,EAAiB,KAMrB,SAASC,GAAaC,EAAS,CAC3B,GAAKA,EACL,CAAAF,EAAiBE,EAEjB,IAAI9E,EAAY,SAAS,eAAe,gBAAgB,EACnDA,IAGLA,EAAU,UAAY,GAGlB,OAAO,QAAW,YAClB,IAAI,OAAOA,EAAW,CAClB,KAAM8E,EACN,MAAO,IACP,OAAQ,IACR,UAAW,UACX,WAAY,UACZ,aAAc,OAAO,aAAa,CACtC,CAAC,EAED9E,EAAU,UAAY,yDAI1BA,EAAU,QAAU+E,GACpB/E,EAAU,UAAY,SAASnE,EAAG,EAC1BA,EAAE,MAAQ,SAAWA,EAAE,MAAQ,OAC/BA,EAAE,eAAe,EACjBkJ,GAAY,EAEpB,GACJ,CAKA,SAASA,IAAc,CACnB,GAAKH,EAEL,KAAII,EAAQ,SAAS,eAAe,UAAU,EAC1CC,EAAY,SAAS,eAAe,eAAe,EACvD,GAAI,GAACD,GAAS,CAACC,GAGf,CAAAA,EAAU,UAAY,GAGlB,OAAO,QAAW,YAClB,IAAI,OAAOA,EAAW,CAClB,KAAML,EACN,MAAO,IACP,OAAQ,IACR,UAAW,UACX,WAAY,UACZ,aAAc,OAAO,aAAa,CACtC,CAAC,EAEDK,EAAU,UAAY,yDAG1BD,EAAM,UAAU,OAAO,QAAQ,EAC/B,SAAS,KAAK,MAAM,SAAW,SAG/B,IAAIE,EAAW,SAAS,eAAe,gBAAgB,EACnDA,GAAUA,EAAS,MAAM,GACjC,CAKA,SAASC,IAAe,CACpB,IAAIH,EAAQ,SAAS,eAAe,UAAU,EAC1CA,IACAA,EAAM,UAAU,IAAI,QAAQ,EAC5B,SAAS,KAAK,MAAM,SAAW,GAEvC,CAKA,SAASI,IAAe,CACpB,IAAIJ,EAAQ,SAAS,eAAe,UAAU,EAC1CK,EAAWL,EAAQA,EAAM,cAAc,oBAAoB,EAAI,KAC/DE,EAAW,SAAS,eAAe,gBAAgB,EAEnDG,GACAA,EAAS,iBAAiB,QAASF,EAAY,EAE/CD,GACAA,EAAS,iBAAiB,QAASC,EAAY,EAInD,SAAS,iBAAiB,UAAW,SAAStJ,EAAG,CACzCA,EAAE,MAAQ,UAAYmJ,GAAS,CAACA,EAAM,UAAU,SAAS,QAAQ,GACjEG,GAAa,CAErB,CAAC,CACL,CASA,SAASG,IAAkB,CACvB,GAAKV,EAEL,KAAII,EAAQ,SAAS,eAAe,cAAc,EAC9CC,EAAY,SAAS,eAAe,mBAAmB,EACvDM,EAAW,SAAS,eAAe,kBAAkB,EACzD,GAAI,GAACP,GAAS,CAACC,GAGf,CAAAA,EAAU,UAAY,GAElB,OAAO,QAAW,YAClB,IAAI,OAAOA,EAAW,CAClB,KAAML,EACN,MAAO,IACP,OAAQ,IACR,UAAW,UACX,WAAY,UACZ,aAAc,OAAO,aAAa,CACtC,CAAC,EAEDK,EAAU,UAAY,yDAItBM,IACAA,EAAS,MAAQX,GAGrBI,EAAM,UAAU,OAAO,QAAQ,EAC/B,SAAS,KAAK,MAAM,SAAW,SAG/B,IAAIE,EAAW,SAAS,eAAe,oBAAoB,EACvDA,GAAUA,EAAS,MAAM,GACjC,CAKA,SAASM,IAAmB,CACxB,IAAIR,EAAQ,SAAS,eAAe,cAAc,EAC9CA,IACAA,EAAM,UAAU,IAAI,QAAQ,EAC5B,SAAS,KAAK,MAAM,SAAW,IAGnC,IAAIS,EAAW,SAAS,eAAe,sBAAsB,EACzDA,GAAUA,EAAS,UAAU,IAAI,QAAQ,CACjD,CAKA,SAASC,IAAc,CACnB,IAAIH,EAAW,SAAS,eAAe,kBAAkB,EACrDE,EAAW,SAAS,eAAe,sBAAsB,EACzD,CAACF,GAAY,CAACX,IAGd,UAAU,WAAa,UAAU,UAAU,UAC3C,UAAU,UAAU,UAAUA,CAAc,EAAE,KAAK,UAAW,CAC1De,GAAiBF,CAAQ,CAC7B,CAAC,EAAE,MAAM,UAAW,CAChBG,GAAaL,EAAUE,CAAQ,CACnC,CAAC,EAEDG,GAAaL,EAAUE,CAAQ,EAEvC,CAOA,SAASG,GAAaL,EAAUE,EAAU,CACtCF,EAAS,OAAO,EAChBA,EAAS,kBAAkB,EAAG,KAAK,EACnC,GAAI,CACA,SAAS,YAAY,MAAM,EAC3BI,GAAiBF,CAAQ,CAC7B,OAAS5J,EAAG,CACR,QAAQ,KAAK,yBAA0BA,CAAC,CAC5C,CACJ,CAMA,SAAS8J,GAAiBF,EAAU,CAC3BA,IACLA,EAAS,UAAU,OAAO,QAAQ,EAElC,WAAW,UAAW,CAClBA,EAAS,UAAU,IAAI,QAAQ,CACnC,EAAG,GAAI,EACX,CAKA,SAASI,IAAmB,CACxB,IAAIb,EAAQ,SAAS,eAAe,cAAc,EAC9CK,EAAWL,EAAQA,EAAM,cAAc,wBAAwB,EAAI,KACnEE,EAAW,SAAS,eAAe,oBAAoB,EACvDY,EAAY,SAAS,eAAe,oBAAoB,EACxDC,EAAU,SAAS,eAAe,iBAAiB,EAEnDV,GACAA,EAAS,iBAAiB,QAASG,EAAgB,EAEnDN,GACAA,EAAS,iBAAiB,QAASM,EAAgB,EAEnDM,GACAA,EAAU,iBAAiB,QAASR,EAAe,EAEnDS,GACAA,EAAQ,iBAAiB,QAASL,EAAW,EAIjD,SAAS,iBAAiB,UAAW,SAAS7J,EAAG,CACzCA,EAAE,MAAQ,UAAYmJ,GAAS,CAACA,EAAM,UAAU,SAAS,QAAQ,GACjEQ,GAAiB,CAEzB,CAAC,CACL,CAMA,IAAIQ,GAAoB,KAMxB,SAASC,GAAeC,EAAU,CAE9BC,EAAc,EAEd,IAAIC,EAAe,SAAS,eAAe,OAAO,EAClD,GAAI,CAACA,EAAc,OAGnBA,EAAa,UAAU,OAAO,iBAAkB,iBAAiB,EAEjE,SAASC,GAAkB,CACvB,IAAIC,EAAM,KAAK,IAAI,EACfC,EAAY,KAAK,IAAI,EAAG,KAAK,MAAML,EAAWI,GAAO,GAAI,CAAC,EAE9DF,EAAa,YAAcG,EAGvBA,GAAa,GACbH,EAAa,UAAU,OAAO,gBAAgB,EAC9CA,EAAa,UAAU,IAAI,iBAAiB,GACrCG,GAAa,IACpBH,EAAa,UAAU,OAAO,iBAAiB,EAC/CA,EAAa,UAAU,IAAI,gBAAgB,GAE3CA,EAAa,UAAU,OAAO,iBAAkB,iBAAiB,EAIjEG,IAAc,GACdH,EAAa,aAAa,aAAc,sBAAsB,EACvDG,IAAc,EACrBH,EAAa,aAAa,aAAc,YAAY,EAC7CG,IAAc,EACrBH,EAAa,aAAa,aAAc,aAAa,EAErDA,EAAa,aAAa,aAAc,mBAAqBG,EAAY,UAAU,EAInFA,GAAa,GACbJ,EAAc,CAEtB,CAGAE,EAAgB,EAGhBL,GAAoB,YAAYK,EAAiB,GAAI,CACzD,CAKA,SAASF,GAAgB,CACjBH,KACA,cAAcA,EAAiB,EAC/BA,GAAoB,KAE5B,CAMA,SAASQ,GAAe9N,EAAM,CAE1B,IAAI+N,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAkB,SAAS,eAAe,mBAAmB,EAE7DF,IAAcA,EAAa,YAAc/N,EAAK,OAAS,GACvDgO,IAAaA,EAAY,YAAchO,EAAK,cAAgB,IAG5DiO,IACIjO,EAAK,WACLiO,EAAgB,UAAU,OAAO,QAAQ,EAEzCA,EAAgB,UAAU,IAAI,QAAQ,GAK9C,IAAIC,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAe,SAAS,eAAe,eAAe,EAE1D,GAAID,GAAclO,EAAK,KAAM,CAErBmO,GAAcA,EAAa,UAAU,OAAO,QAAQ,EAExD,IAAIC,EAASpO,EAAK,KAAK,WAAa,qCAGpCkO,EAAW,OAAS,UAAW,CACvBC,GAAcA,EAAa,UAAU,IAAI,QAAQ,CACzD,EAGAD,EAAW,QAAU,UAAW,CAC5BA,EAAW,IAAM,qCACbC,GAAcA,EAAa,UAAU,IAAI,QAAQ,CACzD,EAEAD,EAAW,IAAME,CACrB,CAGAC,GAAwBrO,EAAK,OAAO,EAGhCA,EAAK,aACLsO,GAAkBtO,EAAM,kBAAkB,EAI9CuO,GAAcvO,EAAK,OAAO,CAC9B,CAWA,SAASwO,GAAY7I,EAAM,CACvB,GAAI,CAACA,EAAM,MAAO,IAClB,IAAI8I,EAAU9I,EAAK,KAAK,EACxB,GAAI,CAAC8I,EAAS,MAAO,IAGrB,IAAIC,EAAQD,EAAQ,MAAM,QAAQ,EAAE,OAAO,OAAO,EAClD,OAAIC,EAAM,QAAU,GACRA,EAAM,CAAC,EAAE,CAAC,EAAIA,EAAM,CAAC,EAAE,CAAC,GAAG,YAAY,EAG5CD,EAAQ,MAAM,EAAG,KAAK,IAAI,EAAGA,EAAQ,MAAM,CAAC,EAAE,YAAY,CACrE,CAMA,SAASJ,GAAwBjF,EAAS,CACtC,IAAIuF,EAAU,SAAS,eAAe,oBAAoB,EACtDrH,EAAY,SAAS,eAAe,mBAAmB,EACvDwD,EAAU,SAAS,eAAe,kBAAkB,EAExD,GAAI,GAAC6D,GAAW,CAACrH,GAAa,CAACwD,GAE/B,KAAI8D,EAAaxF,GAAW,CAAC,EACzByF,EAAiBD,EAAW,OAAO,SAASxD,EAAG,CAC/C,OAAOA,EAAE,SACb,CAAC,EAAE,OACC0D,EAAaF,EAAW,OAG5B9D,EAAQ,YAAc1L,EAAE,sBAAuB,CAAE,MAAOyP,EAAgB,MAAOC,CAAW,CAAC,EAG3F,IAAIC,EAAeF,IAAmBC,GAAcA,EAAa,EACjEH,EAAQ,UAAU,OAAO,gBAAiBI,CAAY,EAGtD,IAAIC,EAAYJ,EAAW,OAAS,GAGpC,GAFAD,EAAQ,UAAU,OAAO,aAAcK,CAAS,EAE5CA,EAAW,CACX1H,EAAU,UAAY,GACtB,MACJ,CAGAA,EAAU,UAAYsH,EAAW,IAAI,SAAStF,EAAQ,CAClD,IAAI2F,EAAWT,GAAYlF,EAAO,IAAI,EAClC4F,EAAkB5F,EAAO,OAASpC,EAClCuE,EAAiBnC,EAAO,YAAc,GACtCoC,EAAU,CACV,mBACApC,EAAO,UAAY,eAAiB,GACpC4F,EAAkB,oBAAsB,GACxC5F,EAAO,IAAM,aAAe,GAC5BmC,EAAiB,iCAAmC,EACxD,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,EAE1B,MAAO,eAAiBC,EAAU,8DAESpF,EAAW2I,CAAQ,EAAI,0CAE/B3I,EAAWgD,EAAO,IAAI,EAAI,eAEjE,CAAC,EAAE,KAAK,EAAE,EACd,CAYA,SAASgF,GAAkBtO,EAAMmP,EAAcC,EAAe,CAC1D,IAAI/F,EAAcrJ,EAAK,aAAe,CAAC,EACnC0E,EAAS,SAAS,eAAeyK,GAAgB,kBAAkB,EACvE,GAAKzK,EAGL,KAAI2K,EAAgBD,GAAiBrM,GAA2B,EAG5DuM,EAAcD,EAAgBxG,GAAkBQ,CAAW,EAAI,CAAC,EAGpEA,EAAY,QAAQ,SAASzE,EAAO,CAChCA,EAAM,WAAcA,EAAM,OAASsC,EAGnC,IAAIqI,EAAaD,EAAY1K,EAAM,IAAI,EACnC2K,IACA3K,EAAM,YAAc2K,GAIxB,IAAIC,EAAa1M,EAAc,QAAQ8B,EAAM,IAAI,EAC7C6K,EAAYD,EAAaA,EAAW,MAAQ5K,EAAM,MACtDA,EAAM,WAAa6K,EACnB7K,EAAM,cAAgBwK,EAAgBK,EAAY7K,EAAM,KAC5D,CAAC,EAGD,IAAI4B,EAAckJ,GAAoBrG,EAAanC,CAAU,EAGzDyI,EAAiBtG,EAAY,QAAU9E,EAAwB,qBAEnE,GAAIoL,EAEKnL,EAAqB,UACtBC,GAAwBC,CAAM,EAIlCF,EAAqB,SAAWgC,EAChChC,EAAqB,cAAgB,GACrCA,EAAqB,OAASE,EAG9BF,EAAqB,aAAe+B,GAA6BC,EAAaU,CAAU,EAGxFjC,GAA2B,MACxB,CAEHT,EAAqB,cAAgB,GAGrC,IAAIe,EAAO,GACXiB,EAAY,QAAQ,SAAS5B,EAAO,CAChCW,GAAQC,GAAuBZ,CAAK,CACxC,CAAC,EAEDF,EAAO,UAAYa,CACvB,CAGA,IAAIqK,EAAkB,CAAC,EACnBP,GACA7I,EAAY,QAAQ,SAAS5B,EAAO,CAC5B,CAACA,EAAM,WAAaA,EAAM,aAAeA,EAAM,OAC/CgL,EAAgB,KAAK,CACjB,KAAMhL,EAAM,KACZ,UAAWA,EAAM,WACjB,SAAUA,EAAM,KACpB,CAAC,CAET,CAAC,EAIDyK,GAAiBO,EAAgB,OAAS,GAE1C,sBAAsB,UAAW,CAI7B,QAFIC,EAAW,CAAC,EACZlL,EAAUD,EAAO,iBAAiB,+BAA+B,EAC5D/D,EAAI,EAAGA,EAAIgE,EAAQ,OAAQhE,IAAK,CACrC,IAAIiE,EAAQD,EAAQhE,CAAC,EACjBgF,EAAOf,EAAM,aAAa,WAAW,EACrCe,IACAkK,EAASlK,CAAI,EAAIf,EAEzB,CAEAgL,EAAgB,QAAQ,SAAStL,EAAM,CACnC,IAAIwL,EAAUD,EAASvL,EAAK,IAAI,EAChC,GAAIwL,EAAS,CACT,IAAIC,EAAUD,EAAQ,cAAc,cAAc,EAC9CC,GACA/O,GAAa+O,EAASzL,EAAK,UAAWA,EAAK,SAAU,GAAG,CAEhE,CACJ,CAAC,CACL,CAAC,EAID+E,EAAY,OAAS,GACrB2G,GAAsBtL,CAAM,EAIhCuL,GAAmB5G,CAAW,EAG9BF,GAAoBnJ,EAAK,SAAW,CAAC,EAAGqJ,CAAW,EACvD,CASA,SAASqG,GAAoBtG,EAAS3C,EAAmB,CACrD,GAAI2C,EAAQ,QAAU,GAAI,OAAOA,EAOjC,QALI8G,EAAO9G,EAAQ,MAAM,EAAG,CAAC,EACzB+G,EAAU/G,EAAQ,MAAM,EAAE,EAC1BvC,EAAa,GAGR,EAAI,EAAG,EAAIuC,EAAQ,OAAQ,IAChC,GAAIA,EAAQ,CAAC,EAAE,OAAS3C,EAAmB,CACvCI,EAAa,EACb,KACJ,CAIJ,OAAIA,EAAa,GAAKA,GAAcuC,EAAQ,OAAS,EAC1C,CAAC,EAAE,OAAO8G,EAAM,CAAC,CAAE,UAAW,EAAK,CAAC,EAAGC,CAAO,EAIlD,CAAC,EAAE,OACND,EACA,CAAC,CAAE,UAAW,EAAK,CAAC,EACpB,CAAC9G,EAAQvC,CAAU,CAAC,EACpB,CAAC,CAAE,UAAW,EAAK,CAAC,EACpBsJ,CACJ,CACJ,CAMA,SAASH,GAAsBtL,EAAQ,CACnC,IAAI0L,EAAe1L,EAAO,cAAc,+BAA+B,EACnE0L,GACAA,EAAa,eAAe,CAAE,SAAU,SAAU,MAAO,QAAS,CAAC,CAE3E,CAMA,SAASH,GAAmB5G,EAAa,CACrC,IAAIgH,EAAQ,SAAS,eAAe,iBAAiB,EACjDC,EAAgBjH,EAAY,KAAK,SAASlG,EAAG,CAAE,OAAOA,EAAE,UAAY,CAAC,EACrEkN,GAASC,IACTD,EAAM,YAAcjR,EAAE,iBAAiB,EAAI,KAAOkR,EAAc,KAChED,EAAM,UAAU,OAAO,QAAQ,EAEvC,CAKA,SAASE,IAAyB,CAC9B,IAAIC,EAAS,SAAS,eAAe,oBAAoB,EACrDnH,EAAc,SAAS,eAAe,kBAAkB,EACxDmH,GAAUnH,GACVmH,EAAO,iBAAiB,QAAS,UAAW,CACxCnH,EAAY,UAAU,OAAO,aAAa,EAC1C,IAAIoH,EAAOD,EAAO,cAAc,cAAc,EAC1CC,IACAA,EAAK,YAAcpH,EAAY,UAAU,SAAS,aAAa,EAAI,SAAM,SAEjF,CAAC,CAET,CAMA,IAAIqH,EAAe,GACfC,EAAY,GACZC,GAAqB,EACrBC,EAAoB,GAKxB,SAASC,IAAmB,CACxB,IAAIC,EAAS,SAAS,eAAe,aAAa,EAC9CC,EAAc,SAAS,eAAe,eAAe,EAEzD,GAAI,GAACD,GAAU,CAACC,GAGhB,CAAAD,EAAO,iBAAiB,QAAS,UAAW,CACxCC,EAAY,YAAc,KAAK,KACnC,CAAC,EAGD,IAAIC,EAAY,SAAS,eAAe,YAAY,EAChDA,GACAA,EAAU,iBAAiB,QAAS,UAAW,CACvCP,IACJC,EAAY,CAACA,EACbM,EAAU,UAAU,OAAO,YAAaN,CAAS,EACrD,CAAC,EAIL,IAAIO,EAAY,SAAS,eAAe,YAAY,EAChDA,GACAA,EAAU,iBAAiB,QAASC,EAAiB,EAIzD,IAAIC,EAAW,SAAS,eAAe,WAAW,EAC9CA,GACAA,EAAS,iBAAiB,QAASC,EAAgB,EAIvD,IAAIC,EAAkB,SAAS,eAAe,mBAAmB,EAC7DA,GACAA,EAAgB,iBAAiB,QAASC,EAAe,EAI7D,IAAIC,EAAa,SAAS,eAAe,aAAa,EACtD,GAAIA,EAAY,CACZ,IAAI7E,EAAW6E,EAAW,cAAc,uBAAuB,EAC3D7E,GACAA,EAAS,iBAAiB,QAAS4E,EAAe,CAE1D,EACJ,CAKA,SAASJ,IAAoB,CACzB,GAAI,CAAAT,EAEJ,KAAIK,EAAS,SAAS,eAAe,aAAa,EAC9CG,EAAY,SAAS,eAAe,YAAY,EAEpD,GAAI,GAACH,GAAU,CAACG,GAEhB,KAAIO,EAAO,SAASV,EAAO,MAAO,EAAE,EAGpCG,EAAU,SAAW,GACrBA,EAAU,UAAU,IAAI,YAAY,EAGhCvH,GAAMA,EAAG,aAAe,UAAU,KAClCA,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,SACN,KAAM8H,EACN,IAAKd,CACT,CAAC,CAAC,GAGFe,GAAgB,kCAAkC,EAClDR,EAAU,SAAW,GACrBA,EAAU,UAAU,OAAO,YAAY,IAE/C,CAKA,SAASS,IAAkB,CACvBjB,EAAe,GAEf,IAAIkB,EAAe,SAAS,eAAe,eAAe,EACtDV,EAAY,SAAS,eAAe,YAAY,EAChDW,EAAe,SAAS,eAAe,wBAAwB,EAC/DZ,EAAY,SAAS,eAAe,YAAY,EAEhDW,GACAA,EAAa,UAAU,IAAI,cAAc,EAGzCV,GACAA,EAAU,UAAU,IAAI,QAAQ,EAIhCD,GACAA,EAAU,UAAU,IAAI,QAAQ,EAGhCY,GACAA,EAAa,UAAU,OAAO,QAAQ,CAE9C,CAMA,SAASC,GAAkB9R,EAAM,CAC7B,IAAIkR,EAAY,SAAS,eAAe,YAAY,EAEhDA,IACAA,EAAU,SAAW,GACrBA,EAAU,UAAU,OAAO,YAAY,GAGvClR,EAAK,OAAS,iBACd0R,GAAgB,YAAY,EAE5BhB,EAAe,GACXQ,IAAWA,EAAU,SAAW,KAC7BlR,EAAK,OAAS,oBAErB2R,GAAgB,EAEhBD,GAAgB1R,EAAK,SAAW,mBAAmB,CAE3D,CAMA,SAAS0R,GAAgBK,EAAS,CAC9B,IAAIb,EAAY,SAAS,eAAe,YAAY,EAChDA,IACAA,EAAU,YAAca,EACxBb,EAAU,UAAU,IAAI,UAAU,EAClC,WAAW,UAAW,CAClBA,EAAU,YAAc9R,EAAE,kBAAkB,EAC5C8R,EAAU,UAAU,OAAO,UAAU,CACzC,EAAG,GAAI,EAEf,CAKA,SAASc,IAAuB,CAC5BtB,EAAe,GACfC,EAAY,GAEZ,IAAIiB,EAAe,SAAS,eAAe,eAAe,EACtDV,EAAY,SAAS,eAAe,YAAY,EAChDW,EAAe,SAAS,eAAe,wBAAwB,EAC/Dd,EAAS,SAAS,eAAe,aAAa,EAC9CE,EAAY,SAAS,eAAe,YAAY,EAsBpD,GApBIW,GACAA,EAAa,UAAU,OAAO,cAAc,EAG5CV,IACAA,EAAU,SAAW,GACrBA,EAAU,UAAU,OAAO,SAAU,aAAc,UAAU,EAC7DA,EAAU,YAAc9R,EAAE,kBAAkB,GAI5C6R,GACAA,EAAU,UAAU,OAAO,SAAU,WAAW,EAGhDY,GACAA,EAAa,UAAU,IAAI,QAAQ,EAInCd,EAAQ,CACRA,EAAO,MAAQ,KACf,IAAIC,EAAc,SAAS,eAAe,eAAe,EACrDA,IAAaA,EAAY,YAAc,OAC/C,CAGAH,EAAoB,GACpBoB,GAAY,CAChB,CAUA,SAAS1D,GAAcnF,EAAS,CAC5B,GAAI,GAAClC,GAAc,CAACkC,GAGpB,KAAIkH,EAAgBlH,EAAQ,KAAK,SAASgC,EAAG,CACzC,OAAOA,EAAE,OAASlE,CACtB,CAAC,EAED,GAAKoJ,EAEL,CAAAO,EAAoBP,EAAc,iBAAmB,CAACI,EAEtD,IAAIwB,EAAiB,SAAS,eAAe,iBAAiB,EAC1Dd,EAAW,SAAS,eAAe,WAAW,EAE9CP,GAEIqB,GAAgBA,EAAe,UAAU,OAAO,QAAQ,EACxDd,GAAUA,EAAS,UAAU,OAAO,QAAQ,GAGhDa,GAAY,GAEpB,CAKA,SAASA,IAAc,CACnB,IAAIC,EAAiB,SAAS,eAAe,iBAAiB,EAC1Dd,EAAW,SAAS,eAAe,WAAW,EAE9Cc,GAAgBA,EAAe,UAAU,IAAI,QAAQ,EACrDd,GAAUA,EAAS,UAAU,IAAI,QAAQ,CACjD,CAKA,SAASC,IAAmB,CACpB,CAACR,GAAqBH,GAGtB/G,GAAMA,EAAG,aAAe,UAAU,MAClCA,EAAG,KAAK,KAAK,UAAU,CAAE,KAAM,mBAAoB,CAAC,CAAC,CAE7D,CAMA,SAASwI,GAAeC,EAAS,CAC7B,IAAI9F,EAAQ,SAAS,eAAe,aAAa,EAC7C+F,EAAa,SAAS,eAAe,mBAAmB,EAE5D,GAAI,GAAC/F,GAAS,CAAC+F,GAKf,IAFAA,EAAW,UAAY,GAEnB,CAACD,GAAWA,EAAQ,SAAW,EAAG,CAElC,IAAIE,EAAY,SAAS,cAAc,GAAG,EAC1CA,EAAU,UAAY,mBACtBA,EAAU,YAAclT,EAAE,qBAAqB,EAC/CiT,EAAW,YAAYC,CAAS,CACpC,MAEIF,EAAQ,QAAQ,SAASG,EAAQ,CAC7B,IAAIC,EAAM,SAAS,cAAc,QAAQ,EACzCA,EAAI,UAAY,mBAChBA,EAAI,YAAcD,EAClBC,EAAI,iBAAiB,QAAS,UAAW,CACrCC,GAAkBF,CAAM,CAC5B,CAAC,EACDF,EAAW,YAAYG,CAAG,CAC9B,CAAC,EAGLlG,EAAM,UAAU,OAAO,QAAQ,EACnC,CAKA,SAASiF,IAAkB,CACvB,IAAIjF,EAAQ,SAAS,eAAe,aAAa,EAC7CA,GAAOA,EAAM,UAAU,IAAI,QAAQ,CAC3C,CAMA,SAASmG,GAAkBC,EAAY,CAEnC,IAAIC,EAAavT,EAAE,eAAe,EAAE,QAAQ,SAAUsT,CAAU,EAC3D,QAAQC,CAAU,IAKnBhJ,GAAMA,EAAG,aAAe,UAAU,MAClCA,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,QACN,OAAQ+I,CACZ,CAAC,CAAC,EAINnB,GAAgB,EACpB,CAMA,SAASqB,GAAe5S,EAAM,CAC1B,GAAIA,EAAK,QAAS,CAEd6Q,EAAoB,GACpBH,EAAe,GAGfuB,GAAY,EAGZ,IAAIL,EAAe,SAAS,eAAe,eAAe,EACtDV,EAAY,SAAS,eAAe,YAAY,EAChDW,EAAe,SAAS,eAAe,wBAAwB,EAE/DD,GAAcA,EAAa,UAAU,IAAI,cAAc,EACvDV,GAAWA,EAAU,UAAU,IAAI,QAAQ,EAC3CW,GAAcA,EAAa,UAAU,OAAO,QAAQ,EAGxDgB,GAAsB7S,EAAK,OAAQA,EAAK,IAAI,EAG5C,IAAIgR,EAAc,SAAS,eAAe,eAAe,EACrDD,EAAS,SAAS,eAAe,aAAa,EAC9CC,IAAaA,EAAY,YAAchR,EAAK,MAC5C+Q,IAAQA,EAAO,MAAQ/Q,EAAK,KACpC,CACJ,CAMA,SAAS8S,GAAmB9S,EAAM,CAC9BmS,GAAenS,EAAK,SAAW,CAAC,CAAC,CACrC,CAOA,SAAS6S,GAAsBN,EAAQd,EAAM,CACzC,IAAIsB,EAAQ,SAAS,eAAe,oBAAoB,EACpDpI,EAAO,SAAS,eAAe,yBAAyB,EAE5D,GAAI,GAACoI,GAAS,CAACpI,GAGf,KAAIqI,EAAM5T,EAAE,eAAe,EACtB,QAAQ,SAAUmT,CAAM,EACxB,QAAQ,SAAUd,CAAI,EAC3B9G,EAAK,YAAcqI,EAGnBD,EAAM,UAAU,OAAO,QAAQ,EAG/B,WAAW,UAAW,CAClBA,EAAM,UAAU,IAAI,QAAQ,CAChC,EAAG,GAAI,EACX,CAUA,SAASE,GAAiBjT,EAAM,CAC5B,IAAIL,EAAOK,EAAK,MAAQ,CAAC,EACrBoJ,EAAUpJ,EAAK,SAAW,CAAC,EAG3BkT,EAAU,SAAS,eAAe,cAAc,EAChDC,EAAU,SAAS,eAAe,cAAc,EAChDD,IAASA,EAAQ,YAAclT,EAAK,OAAS,GAC7CmT,IAASA,EAAQ,YAAcnT,EAAK,cAAgB,IAGxD,IAAIkO,EAAa,SAAS,eAAe,oBAAoB,EACzDA,IACAA,EAAW,IAAMvO,EAAK,WAAa,sCAIvC,IAAIyT,EAAc,SAAS,eAAe,cAAc,EACpDA,IACAA,EAAY,YAAczT,EAAK,MAAQ,QAI3C,IAAI0T,EAAU,SAAS,eAAe,YAAY,EAC9CC,EAAW,SAAS,eAAe,aAAa,EAChDD,IAASA,EAAQ,YAAc1T,EAAK,OAAS,gBAC7C2T,IAAUA,EAAS,YAAc3T,EAAK,QAAU,kBAGpD,IAAI4T,EAAmB,SAAS,eAAe,oBAAoB,EAC/DC,EAAc,SAAS,eAAe,UAAU,EAChDC,EAAgBF,EAAmBA,EAAiB,cAAc,kBAAkB,EAAI,KAGxFG,EAAmBhU,GAAsBC,EAAM,UAAU,EAmB7D,GAhBI6T,IACAA,EAAY,YAAcE,GAAoB,IAI9CD,IACAA,EAAc,MAAM,QAAUC,EAAmB,OAAS,QAI9DC,GAAmBhU,CAAI,EAGvBiU,GAAqB5T,EAAK,eAAe,EAGrCuT,EAAkB,CAClB,IAAIM,EAAW,SAAS,eAAe,gBAAgB,EACnDC,EAAcD,GAAYA,EAAS,UAAU,KAAK,IAAM,GACxDE,EAAaL,GAAoBA,EAAiB,KAAK,IAAM,GACjEH,EAAiB,UAAU,OAAO,SAAU,CAACQ,GAAc,CAACD,CAAW,CAC3E,CAIA,QADIxD,EAAgB,KACX3P,EAAI,EAAGA,EAAIyI,EAAQ,OAAQzI,IAChC,GAAIyI,EAAQzI,CAAC,EAAE,OAASuG,EAAY,CAChCoJ,EAAgBlH,EAAQzI,CAAC,EACzB,KACJ,CAIJqT,GAAkB1D,EAAe3Q,EAAK,IAAI,EAC1CsU,GAAqB3D,EAAe3Q,EAAK,IAAI,EAGzCK,EAAK,kBAAoBA,EAAK,iBAAiB,eAC/CkU,GAAgB,QAAQ,EAI5BC,GAAwB/K,CAAO,EAG3BpJ,EAAK,iBACLoU,GAAqBpU,EAAK,gBAAiBL,EAAK,IAAI,EAIpDK,EAAK,aACLsO,GAAkBtO,EAAM,0BAA2B,EAAI,EAI3D,IAAIqU,EAAgB,SAAS,eAAe,uBAAuB,EAC/DC,EAAe,SAAS,eAAe,gBAAgB,EACvDD,GAAiB/D,GAAiBA,EAAc,UAChD+D,EAAc,UAAU,OAAO,QAAQ,EAGnCC,IACItU,EAAK,YACLsU,EAAa,YAAclV,EAAE,0BAA0B,EACvDkV,EAAa,UAAU,IAAI,UAAU,IAErCA,EAAa,YAAclV,EAAE,iBAAiB,EAC9CkV,EAAa,UAAU,OAAO,UAAU,GAE5CA,EAAa,SAAW,KAErBD,GACPA,EAAc,UAAU,IAAI,QAAQ,CAE5C,CAOA,SAASD,GAAqBG,EAAWnB,EAAa,CAClD,IAAI9L,EAAY,SAAS,eAAe,iBAAiB,EACzD,GAAI,CAACA,GAAa,CAACiN,EAAW,CACtBjN,GAAWA,EAAU,UAAU,IAAI,QAAQ,EAC/C,MACJ,CAGA,GAAIiN,EAAU,kBAAoB,EAAG,CACjCjN,EAAU,UAAY,gCAAkClI,EAAE,yBAAyB,EAAI,SACvFkI,EAAU,UAAU,OAAO,QAAQ,EACnC,MACJ,CAGA,IAAIkN,EAAgB,GACpB,GAAID,EAAU,gBAAkB,MAAQnB,EAAa,CACjD,IAAIqB,EAAO,KAAK,MAAMF,EAAU,cAAgBnB,CAAW,EACvDqB,IAAS,EACTD,EAAgBpV,EAAE,oBAAoB,EAC/BqV,EAAO,EACdD,EAAgBpV,EAAE,sBAAuB,CAAE,MAAOqV,CAAK,CAAC,EAExDD,EAAgBpV,EAAE,uBAAwB,CAAE,MAAO,KAAK,IAAIqV,CAAI,CAAE,CAAC,CAE3E,CAGA,IAAIC,EAAgBC,GAAgBJ,EAAU,YAAanB,CAAW,EAGlEwB,EAAmB,GAYvB,GATIL,EAAU,qBAAuBA,EAAU,oBAAoB,OAAS,IACxEK,GAAoB,iHAEqBxV,EAAE,wBAAwB,EAAI,2CAC9BmV,EAAU,oBAAoB,KAAK,IAAI,EAAI,iBAKpFA,EAAU,gBAAkBA,EAAU,eAAe,MAAO,CAC5D,IAAIM,EAAQN,EAAU,eAAe,MAAM,KAAK,IAAI,EACpDK,GAAoB,+GAEqBxV,EAAE,yBAAyB,EAAI,2CAC/ByV,EAAQ,2CACPN,EAAU,eAAe,KAAO,iBAE9E,CAGA,GAAIA,EAAU,kBAAoBA,EAAU,iBAAiB,OAAS,GAAKA,EAAU,aAAeA,EAAU,YAAY,OAAS,EAAG,CAClI,IAAIO,EAAcP,EAAU,YAAYA,EAAU,YAAY,OAAS,CAAC,EAAE,UACtEO,EAAc,IACdF,GAAoB,iHAEqBxV,EAAE,yBAAyB,EAAI,2CAC/BmV,EAAU,iBAAiB,KAAK,IAAI,EAAI,2CACvCO,EAAc,uBAGhE,CAGA,IAAIC,EAAaR,EAAU,gBAAkB,KAAO,KAAK,MAAMA,EAAU,aAAa,EAAI,IAC1FjN,EAAU,UAAY,+BAAiClI,EAAE,iBAAiB,EAAI,4FAG5CA,EAAE,wBAAwB,EAAI,mCAC9B2V,EAAa,qEAGbR,EAAU,oBAAsB,oCAChCnV,EAAE,qBAAsB,CAAE,QAAS,EAAG,CAAC,EAAE,QAAQ,IAAK,EAAE,EAAI,wDAGnDoV,EAAgB,sEAEtBpV,EAAE,qBAAqB,EAAI,QAC5DsV,EACA,UACCE,EAAmB,uCAAyCA,EAAmB,SAAW,IAE/FtN,EAAU,UAAU,OAAO,QAAQ,CACvC,CAQA,SAASqN,GAAgBK,EAAY5B,EAAa,CAC9C,IAAI6B,EAAW,EAGf,GAAI,CAACD,GAAcA,EAAW,SAAW,EACrC,MAAO,gCAAkC5V,EAAE,qBAAqB,EAAI,SAmBxE,QAfI8V,EAAUF,EAAW,IAAI,SAASG,GAAG,CAAE,OAAOA,GAAE,KAAO,CAAC,EACxDC,EAAW,KAAK,IAAI,MAAM,KAAMF,CAAO,EACvCG,EAAW,KAAK,IAAI,MAAM,KAAMH,CAAO,EACvCpQ,EAAQuQ,EAAWD,EAGnBE,EAAc,KAAK,IAAI,EAAG,KAAK,KAAKxQ,EAAQmQ,CAAQ,CAAC,EAGrDM,EAAaD,EAAcL,EAC3BO,EAAaD,EAAazQ,EAAQ,EAClC2Q,EAAYL,EAAW,KAAK,MAAMI,EAAa,CAAC,EAGhDE,EAAO,CAAC,EACH/U,EAAI,EAAGA,EAAIsU,EAAUtU,IAAK,CAC/B,IAAIgV,EAAWF,EAAa9U,EAAI2U,EAC5BM,EAASD,EAAWL,EAAc,EACtCI,EAAK,KAAK,CACN,MAAOC,EACP,IAAKC,EACL,MAAO,EACP,gBAAiBxC,GAAeuC,GAAYvC,GAAewC,CAC/D,CAAC,CACL,CAGA,QAASC,EAAI,EAAGA,EAAIX,EAAQ,OAAQW,IAEhC,QADIC,EAAQZ,EAAQW,CAAC,EACZE,EAAI,EAAGA,EAAIL,EAAK,OAAQK,IAC7B,GAAID,GAASJ,EAAKK,CAAC,EAAE,OAASD,GAASJ,EAAKK,CAAC,EAAE,IAAK,CAChDL,EAAKK,CAAC,EAAE,QACR,KACJ,CAMR,QADIC,EAAW,EACNC,EAAI,EAAGA,EAAIP,EAAK,OAAQO,IACzBP,EAAKO,CAAC,EAAE,MAAQD,IAAUA,EAAWN,EAAKO,CAAC,EAAE,OAKrD,QADIC,EAAW,GACNC,EAAI,EAAGA,EAAIT,EAAK,OAAQS,IAAK,CAClC,IAAIC,EAAMV,EAAKS,CAAC,EACZE,EAAiBD,EAAI,MAAQJ,EAAY,IACzC5L,GAAQ+L,EAAI,IAEZG,GAAW,iBAAmBF,EAAI,gBAAkB,cAAgB,IACpEG,GAAYH,EAAI,MAAQ,EAAI,KAAK,IAAIC,EAAe,EAAE,EAAI,EAC1DG,GAAYJ,EAAI,MAAQ,EAAI,2BAA6BA,EAAI,MAAQ,UAAY,GAGjFrK,GAAQuJ,IAAgB,EAAI,OAAOc,EAAI,KAAK,EAAIA,EAAI,MAAQ,IAAM,OAAOA,EAAI,GAAG,EAAE,MAAM,EAAE,EAE9FF,GAAY,8DAAgE9L,GAAQ,kBAC/DkM,GAAW,oBAAsBC,GAAY,MAC9DC,GACA,uCACmCzK,GAAQ,eAEnD,CAEA,MAAO,+BAAiCmK,EAAW,QACvD,CAUA,SAASO,GAAmBC,EAAc,CACtC,IAAIpP,EAAY,SAAS,eAAe,wBAAwB,EAChE,GAAKA,EAGL,IAAI,CAACoP,GAAgBA,EAAa,SAAW,EAAG,CAC5CpP,EAAU,UAAU,IAAI,QAAQ,EAChC,MACJ,CAEA,IAAI/B,EAAO,GACXmR,EAAa,QAAQ,SAASC,EAAOC,EAAO,CACxC,IAAIC,EAAY,GAChB,OAAQF,EAAM,YAAa,CACvB,IAAK,WACDE,EAAYF,EAAM,MAAQ,KAAOvX,EAAE,sBAAsB,EACzD,MACJ,IAAK,SACDyX,EAAYF,EAAM,MAAQ,IAAMvX,EAAE,qBAAqB,EACvD,MACJ,IAAK,OACDyX,EAAYF,EAAM,MAAQ,IAAMvX,EAAE,mBAAmB,EACrD,MACJ,IAAK,SACDyX,EAAYF,EAAM,MAAQ,IAAMvX,EAAE,qBAAqB,EACvD,MACJ,IAAK,gBACDyX,EAAYF,EAAM,MAAQ,IAAMvX,EAAE,2BAA2B,EAC7D,MACJ,QACIyX,EAAYF,EAAM,KAC1B,CAEApR,GAAQ,kDAAoDoR,EAAM,GAAK,6BAAgCC,EAAQ,GAAO,qCAC9ED,EAAM,MAAQ,wCACdvX,EAAE,gBAAkBuX,EAAM,KAAK,EAAI,yCAClCrQ,EAAWqQ,EAAM,WAAW,EAAI,wCACjCE,EAAY,cAExD,CAAC,EAEDvP,EAAU,UAAY/B,EACtB+B,EAAU,UAAU,OAAO,QAAQ,EACvC,CAMA,SAASsM,GAAqB/H,EAAY,CACtC,IAAIiL,EAAK,SAAS,eAAe,iBAAiB,EAClD,GAAKA,EAGL,IAAI,CAACjL,EAAY,CACbiL,EAAG,UAAU,IAAI,QAAQ,EACzB,MACJ,CAIA,QADIC,EAAQ,GACHpW,EAAI,EAAGA,EAAIkL,EAAW,MAAOlL,IAClCoW,GAAS,oCAIbD,EAAG,UACC,2CAA6CjL,EAAW,MAAQ,KAAOkL,EAAQ,wCAC3C3X,EAAE,cAAgByM,EAAW,KAAK,EAAI,4CACnCA,EAAW,SAAW,KAAOzM,EAAE,qBAAqB,EAAI,UAEnG0X,EAAG,UAAU,OAAO,QAAQ,EAChC,CAOA,SAASnD,GAAmBhU,EAAM,CAC9B,IAAI2H,EAAY,SAAS,eAAe,gBAAgB,EACxD,GAAKA,EAEL,KAAI0P,EAAS,CAAC,EAGVC,EAAcC,GAAkBvX,EAAK,YAAc,CAAC,CAAC,EACrDsX,EAAY,OAAS,IAAGD,EAASA,EAAO,OAAOC,CAAW,GAG9D,IAAIE,EAAaC,GAA0BzX,EAAK,gBAAkB,CAAC,CAAC,EAChEwX,EAAW,OAAS,IAAGH,EAASA,EAAO,OAAOG,CAAU,GAG5D,IAAIE,EAAkB3X,GAAsBC,EAAM,QAAQ,GAAK,CAAC,EAC5D2X,EAAcC,GAAkBF,CAAe,EAC/CC,EAAY,OAAS,IAAGN,EAASA,EAAO,OAAOM,CAAW,GAG1DN,EAAO,OAAS,EAChB1P,EAAU,UAAY,gCAAkC0P,EAAO,KAAK,EAAE,EAAI,SAE1E1P,EAAU,UAAY,GAE9B,CAOA,SAAS4P,GAAkBM,EAAW,CAClC,GAAI,CAACA,EAAW,MAAO,CAAC,EAExB,IAAIR,EAAS,CAAC,EAGd,GAAIQ,EAAU,gBAAkBA,EAAU,eAAiB,EAAG,CAC1D,IAAIC,EAAYD,EAAU,eACpB,mCAAkCA,EAAU,eAAiB,IAAMpY,EAAE,mBAAmB,EAAI,UAC5F,GACN4X,EAAO,KACH,6FAEMQ,EAAU,eAAiB,IAAMpY,EAAE,uBAAuB,EAAIqY,EACpE,SACJ,CACJ,CAGA,OAAID,EAAU,aAAeA,EAAU,YAAc,GAAK,CAACA,EAAU,gBACjER,EAAO,KACH,6FAEMQ,EAAU,YAAc,IAAMpY,EAAE,oBAAoB,EAC1D,SACJ,EAIAoY,EAAU,SAAWA,EAAU,QAAU,GAAK,CAACA,EAAU,gBACzDR,EAAO,KACH,6FAEMQ,EAAU,QAAU,IAAMpY,EAAE,gBAAgB,EAClD,SACJ,EAGG4X,CACX,CAOA,SAASI,GAA0BM,EAAgB,CAC/C,GAAI,CAACA,GAAkBA,EAAe,SAAW,EAAG,MAAO,CAAC,EAG5D,QADIV,EAAS,CAAC,EACLrW,EAAI,EAAGA,EAAI+W,EAAe,OAAQ/W,IAAK,CAC5C,IAAIgX,EAAOD,EAAe/W,CAAC,EACvBiX,EAAaC,GAA2BF,CAAI,EAC5ClH,EAAOqH,GAAqBH,CAAI,EACpCX,EAAO,KACH,2BAA6BY,EAAa,mCACPnH,EAAO,UAC1CnK,EAAWqR,CAAI,EACf,SACJ,CACJ,CACA,OAAOX,CACX,CAOA,SAASa,GAA2BF,EAAM,CACtC,IAAII,EAAYJ,EAAK,YAAY,EACjC,OAAII,EAAU,QAAQ,SAAS,IAAM,GAAW,sBAC5CA,EAAU,QAAQ,UAAU,IAAM,GAAW,uBAC7CA,EAAU,QAAQ,MAAM,IAAM,GAAW,mBACtC,sBACX,CAOA,SAASD,GAAqBH,EAAM,CAChC,IAAII,EAAYJ,EAAK,YAAY,EACjC,OAAII,EAAU,QAAQ,SAAS,IAAM,GAAW,YAC5CA,EAAU,QAAQ,UAAU,IAAM,GAAW,YAC7CA,EAAU,QAAQ,MAAM,IAAM,GAAW,YACtC,WACX,CAOA,SAASR,GAAkBS,EAAQ,CAC/B,GAAI,CAACA,GAAUA,EAAO,SAAW,EAAG,MAAO,CAAC,EAK5C,QAHIhB,EAAS,CAAC,EACViB,EAAgBD,EAAO,MAAM,EAAG,CAAC,EAE5BrX,EAAI,EAAGA,EAAIsX,EAAc,OAAQtX,IAAK,CAC3C,IAAIgW,EAAQsB,EAActX,CAAC,EACvBiX,EAAaM,GAAmBvB,CAAK,EACrClG,EAAO0H,GAAaxB,CAAK,EAC7BK,EAAO,KACH,2BAA6BY,EAAa,mCACPnH,EAAO,UAC1CnK,EAAWqQ,CAAK,EAChB,SACJ,CACJ,CAEA,OAAIqB,EAAO,OAAS,GAChBhB,EAAO,KAAK,oCAAsCgB,EAAO,OAAS,GAAK,cAAc,EAGlFhB,CACX,CAOA,SAASkB,GAAmBvB,EAAO,CAC/B,IAAIyB,EAAazB,EAAM,YAAY,EACnC,OAAIyB,EAAW,QAAQ,QAAQ,IAAM,GAAW,qBAC5CA,EAAW,QAAQ,YAAY,IAAM,GAAW,yBAChDA,EAAW,QAAQ,OAAO,IAAM,IAAMA,EAAW,QAAQ,eAAe,IAAM,GAAW,oBACzFA,EAAW,QAAQ,cAAc,IAAM,GAAW,yBAC/C,mBACX,CAOA,SAASD,GAAaxB,EAAO,CACzB,IAAIyB,EAAazB,EAAM,YAAY,EACnC,OAAIyB,EAAW,QAAQ,YAAY,IAAM,GAAW,YAChDA,EAAW,QAAQ,QAAQ,IAAM,GAAW,YAC5CA,EAAW,QAAQ,cAAc,IAAM,GAAW,SAC/C,WACX,CAOA,SAASpE,GAAkB1K,EAAQ8J,EAAa,CAC5C,IAAIiF,EAAY,SAAS,eAAe,gBAAgB,EACpDC,EAAiB,SAAS,eAAe,iBAAiB,EAC9D,GAAI,CAACD,EAAW,OAGhBA,EAAU,UAAY,iBACtBA,EAAU,UAAY,GACtBA,EAAU,UAAU,IAAI,QAAQ,EAG5BC,GACAA,EAAe,UAAU,OAAO,YAAY,EAIhDC,GAAa,EAGb,IAAIC,EAAWpZ,EAAE,iBAAiB,EAGlC,SAASqZ,EAAWC,EAAK,CACrB,OAAOA,EAAI,KAAK,MAAM,KAAK,OAAO,EAAIA,EAAI,MAAM,CAAC,CACrD,CAGA,SAASC,EAAaC,EAAO,CACzB,OAAIA,IAAU,EACHxZ,EAAE,kBAAkB,EAExBA,EAAE,oBAAqB,CAAE,MAAOwZ,CAAM,CAAC,CAClD,CAGA,IAAIC,EAAc,SACdC,EAAcL,EAAWD,EAAS,MAAM,EACxCO,EAAWN,EAAWD,EAAS,SAAS,EAE5C,GAAIlP,GAAU,CAACA,EAAO,aAAc,CAChC,IAAI0P,EAAW1P,EAAO,WAAa,EAE/B0P,IAAa,GACbH,EAAc,QACdC,EAAcL,EAAWD,EAAS,KAAK,EACvCO,EAAWN,EAAWD,EAAS,QAAQ,GAChCQ,GAAY,GACnBH,EAAc,QACdC,EAAcL,EAAWD,EAAS,KAAK,EACvCO,EAAWN,EAAWD,EAAS,QAAQ,EAAI,IAAMG,EAAaK,CAAQ,GAC/DA,GAAY,GACnBH,EAAc,QACdC,EAAcL,EAAWD,EAAS,KAAK,EACvCO,EAAWJ,EAAaK,CAAQ,IAEhCH,EAAc,QACdC,EAAcL,EAAWD,EAAS,KAAK,EACvCO,EAAWN,EAAWD,EAAS,QAAQ,EAAI,IAAMG,EAAaK,CAAQ,EAE9E,MAAW1P,GAAUA,EAAO,eACxBuP,EAAc,SACdC,EAAcL,EAAWD,EAAS,MAAM,EACxCO,EAAWN,EAAWD,EAAS,SAAS,GAI5C,IAAIS,EAAc,qCAAuCH,EAAc,UACnEC,IACAE,GAAe,wCAA0CF,EAAW,UAExEV,EAAU,UAAYY,EAGtBZ,EAAU,UAAU,IAAI,mBAAqBQ,CAAW,EACxDR,EAAU,UAAU,OAAO,QAAQ,EAG/BQ,IAAgB,SAChB3E,GAAgB,EAIhBoE,GAAkBO,IAAgB,UAClCP,EAAe,UAAU,IAAI,YAAY,CAEjD,CAOA,SAASrE,GAAqB3K,EAAQ8J,EAAa,CAC/C,IAAI8F,EAAgB,SAAS,eAAe,gBAAgB,EAC5D,GAAKA,EAEL,IAAI,CAAC5P,EAAQ,CACT4P,EAAc,UAAY,oDAC1B,MACJ,CAEA,GAAI5P,EAAO,aAAc,CAErB,IAAI6P,EACA,oHAEyC/Z,EAAE,qBAAqB,EAAI,eAIpEga,EAAiB9P,EAAO,iBAAmB,EAC3C8P,GAAkB,IAClBD,GACI,qHAE+CC,EAAiB,yBAIxED,GAAc,gDACdD,EAAc,UAAYC,EAC1B,MACJ,CAEA,IAAIH,EAAW1P,EAAO,WAAa,EAC/B+P,EAAeL,IAAa,EAAI5Z,EAAE,cAAc,EACjC4Z,IAAa,EAAI5Z,EAAE,iBAAkB,CAAE,MAAO,CAAE,CAAC,EACjDA,EAAE,kBAAmB,CAAE,MAAO4Z,CAAS,CAAC,EAEvDM,EAAcN,IAAa,EAAI,WACjBA,GAAY,EAAI,WAAa,SAG3CO,EAAkBjQ,EAAO,kBAAoB,EAC7CkQ,EAAYlQ,EAAO,YAAc,EACjCmQ,EAAgBF,EAAkB,EAGlCG,EAAcpQ,EAAO,cAAgB,EAErCqQ,EAAiB,GACjBF,GAAiBD,EAAY,IAC7BG,EACI,sDACoCva,EAAE,kBAAkB,EAAI,qCACxBoa,EAAY,uEAGZpa,EAAE,mBAAmB,EAAI,8CAChBma,EAAgB,QAAQ,CAAC,EAAI,kBAKlF,IAAIK,EAAiB,GACjBtQ,EAAO,cAAgB,MACvBsQ,EACI,4EACuCxa,EAAE,eAAe,EAAE,QAAQ,cAAe,EAAE,EAAI,+DAGpFkK,EAAO,cAAgB,SAC9BsQ,EACI,6EACuCxa,EAAE,gBAAgB,EAAI,gEAMrE,IAAIya,EAAkB,GAClBH,EAAc,IACdG,EACI,uEACoCvQ,EAAO,OAAS,8DACLoQ,EAAc,qBAKrE,IAAII,EAAaxQ,EAAO,YAAcoQ,EAGlCK,EAAazQ,EAAO,aAAe,GACnCkG,EAAa1M,EAAc,QAAQwG,EAAO,IAAI,EAC9CmG,EAAYD,EAAaA,EAAW,MAASlG,EAAO,MAAQwQ,EAC5DE,EAAaxK,EAAaA,EAAW,OAAS,EAC9CyK,EAAkBxR,GAAkBuR,EAAY1Q,EAAO,QAAU,CAAC,EAEtE4P,EAAc,UACV,sDACoC9Z,EAAE,kBAAkB,EAAI,qCACxBkK,EAAO,MAAQ,mEAGflK,EAAE,oBAAoB,EAAI,qCAC1BgU,EAAc,mEAGdhU,EAAE,iBAAiB,EAAI,oCACxBka,EAAc,KAAOD,EAAe,gBAEvEM,EACAC,EACA,qGACAC,GACCH,EAAc,EAAI,6BAA+Bta,EAAE,cAAc,EAAI,kDAAoD,IAG9H,IAAI8a,EAAehB,EAAc,cAAc,cAAc,EACzDgB,IACAhY,GAAmBgY,EAAc,EAAG5Q,EAAO,YAAa,CACpD,OAAQA,EAAO,cAAgB,MAC/B,QAASA,EAAO,cAAgB,OAChC,gBAAiB2Q,EACjB,WAAYF,CAChB,CAAC,EAGGzQ,EAAO,cAAgB,OAASA,EAAO,YAAc,GACrD,WAAW,UAAW,CAClB,IAAIyG,EAAU,SAAS,eAAe,uBAAuB,EACzDA,GACAtN,GAAgBsN,EAASzG,EAAO,YAAa,CAAE,SAAU,EAAK,CAAC,CAEvE,EAAG,GAAG,GAKd,IAAI6Q,EAAejB,EAAc,cAAc,cAAc,EACzDiB,GAAgBT,EAAc,IAE9B,WAAW,UAAW,CAClB1Y,GAAamZ,EAAc,EAAGL,EAAY,GAAG,CACjD,EAAG,GAAG,EAGFG,GACA,WAAW,UAAW,CAClB,IAAI9G,EAAU+F,EAAc,cAAc,eAAe,EACzD,GAAI/F,EAAS,CACT,IAAIiH,GAAiB,CAAC,EAAG,GAAI,EAAG,GAAI,GAAI,GAAG,EAAEH,CAAe,GAAK,EACjExX,GAAgB0Q,EAASiH,GAAgB,CACrC,SAAU,GACV,KAAM,IAAMA,GAAiB,IAAMH,EAAkB,UACzD,CAAC,CACL,CACJ,EAAG,GAAG,GAGlB,CAOA,SAAS9F,GAAwB/K,EAAS,CACtC,IAAI9B,EAAY,SAAS,eAAe,sBAAsB,EAC9D,GAAKA,EAEL,IAAI,CAAC8B,GAAWA,EAAQ,SAAW,EAAG,CAClC9B,EAAU,UAAY,GACtB,MACJ,CAGA,IAAI+S,EAASjR,EAAQ,MAAM,EAAE,KAAK,SAAS6B,EAAGC,EAAG,CAC7C,OAAQA,EAAE,aAAe,IAAMD,EAAE,aAAe,EACpD,CAAC,EAEG1F,EAAO,qCAAuCnG,EAAE,mBAAmB,EAAI,SAC3EmG,GAAQ,qCAER8U,EAAO,QAAQ,SAAS/Q,EAAQ,CAC5B,IAAI4F,EAAkB5F,EAAO,OAASpC,EAClCoT,EAAWhR,EAAO,eAAiB,GACnC0P,EAAW1P,EAAO,WAAa,EAC/BiR,EAAajR,EAAO,aAAe,EAGnCkR,EAAaF,EAAW,gBACXC,GAAc,GAAK,gBACnBA,GAAc,EAAI,kBAAoB,gBAGnDE,EAAeH,EAAW,SAAMhR,EAAO,MACvCoR,EAAkBJ,EAAWlb,EAAE,qBAAqB,EAClC4Z,IAAa,EAAI5Z,EAAE,cAAc,EACjCA,EAAE,kBAAmB,CAAE,MAAO4Z,CAAS,CAAC,EAG1D2B,EAAerR,EAAO,IAAM,0CAAqC,GAGjE4I,EAAiB,GACrB,GAAI5I,EAAO,WACP4I,EAAiB,2EACb9S,EAAE,mBAAoB,CAAE,KAAMkH,EAAWgD,EAAO,UAAU,CAAE,CAAC,EAAI,iBAC9DA,EAAO,eAAiBA,EAAO,cAAc,OAAS,EAAG,CAChE,IAAIsR,EAAetR,EAAO,cAAc,IAAIhD,CAAU,EAAE,KAAK,IAAI,EACjE4L,EAAiB,8FACb9S,EAAE,iBAAkB,CAAE,KAAMwb,CAAa,CAAC,EAAI,QACtD,CAEArV,GAAQ,2BAA6BiV,GAActL,EAAkB,cAAgB,IAAM,4BAC3D5I,EAAWgD,EAAO,IAAI,EAAIqR,EAAe,iCACxCF,EAAe,oCACZC,EAAkB,SAClDxI,EACA,4BAA8BqI,EAAa,cAEnD,CAAC,EAEDhV,GAAQ,SACR+B,EAAU,UAAY/B,EAC1B,CAUA,SAASsV,GAAc7a,EAAM,CACzB,IAAIqJ,EAAcrJ,EAAK,aAAe,CAAC,EAGvCqJ,EAAY,QAAQ,SAASzE,EAAO,CAChCA,EAAM,WAAcA,EAAM,OAASsC,CACvC,CAAC,EAGD,CAAC,EAAG,EAAG,CAAC,EAAE,QAAQ,SAAS4T,EAAO,CAC9B,IAAIxR,EAASD,EAAY,KAAK,SAAS+B,EAAG,CAAE,OAAOA,EAAE,OAAS0P,CAAO,CAAC,EAClEC,EAAS,SAAS,eAAe,UAAYD,EAAQ,OAAO,EAC5D/K,EAAU,SAAS,eAAe,UAAY+K,EAAQ,QAAQ,EAC9DC,IAAQA,EAAO,YAAczR,EAAShD,EAAWgD,EAAO,IAAI,EAAI,OAChEyG,IAASA,EAAQ,YAAczG,EAASA,EAAO,MAAQ,IAC/D,CAAC,EAGD,IAAIgH,EAAgBjH,EAAY,KAAK,SAAS+B,EAAG,CAAE,OAAOA,EAAE,UAAY,CAAC,EAGrE4P,EAAS,SAAS,eAAe,iBAAiB,EAClDjL,EAAU,SAAS,eAAe,kBAAkB,EACpDkL,EAAe,SAAS,eAAe,kBAAkB,EACzDC,EAAW,SAAS,eAAe,aAAa,EAChDC,EAAS,SAAS,eAAe,WAAW,EAE5C7K,IACI0K,IAAQA,EAAO,YAAc,IAAM1K,EAAc,MACjDP,IAASA,EAAQ,YAAcO,EAAc,MAAQ,IAAMlR,EAAE,oBAAoB,GACjF6b,IAAcA,EAAa,YAAc3K,EAAc,aAAe,GACtE4K,IAAUA,EAAS,YAAc5K,EAAc,eAAiB,GAChE6K,IAAQA,EAAO,YAAc7K,EAAc,UAAY,IAI/D,IAAI5L,EAAS,SAAS,eAAe,wBAAwB,EACzDA,IACAA,EAAO,UAAY2E,EAAY,IAAI,SAASzE,EAAO,CAC/C,IAAImB,EAAenB,EAAM,WAAa,aAAe,GACjDuB,EAAoBvB,EAAM,YAAc,GAAQ,4BAA8B,GAC9EwB,EAAYxB,EAAM,YAAc,GAAQ,yCAA2C,GACvF,MAAO,2BAA6BmB,EAAe,IAAMI,EAAoB,+BAC1CvB,EAAM,KAAO,mCACd0B,EAAW1B,EAAM,IAAI,EAAIwB,EAAY,oCACpCxB,EAAM,MAAQ,eAErD,CAAC,EAAE,KAAK,EAAE,GAId6R,GAAmBzW,EAAK,YAAY,EAGpC,IAAIqU,EAAgB,SAAS,eAAe,oBAAoB,EAC5D+G,EAAgB,SAAS,eAAe,oBAAoB,EAEhE,GAAI9K,GAAiBA,EAAc,SAAU,CACrC+D,GAAeA,EAAc,UAAU,OAAO,QAAQ,EACtD+G,GAAeA,EAAc,UAAU,IAAI,QAAQ,EAEvD,IAAIC,EAAa,SAAS,eAAe,cAAc,EACnDA,IACAA,EAAW,QAAUC,GAE7B,MACQjH,GAAeA,EAAc,UAAU,IAAI,QAAQ,EACnD+G,GAAeA,EAAc,UAAU,OAAO,QAAQ,EAI9D,GAAI9K,EAAe,CACf,IAAItC,EAAchO,EAAK,cAAgB,GAGnCub,EAAajL,EAAc,aAAe,EAC1CkL,EAAgBD,IAAevN,GAAeA,EAAc,EAE5DwN,EAEAtH,GAAgB,SAAS,EAClB5D,EAAc,OAAS,GAE9B4D,GAAgB,QAAQ,CAEhC,CACJ,CAUA,SAASuH,GAAiBzb,EAAM,CAC5B,IAAI0b,EAAY,SAAS,eAAe,eAAe,EACnDA,IACI1b,EAAK,eAAiB,qBACtB0b,EAAU,YAAc,mCACjB1b,EAAK,eAAiB,qBAC7B0b,EAAU,YAAc,qEAExBA,EAAU,YAAc,8BAGpC,CAKA,SAASJ,IAAgB,CACrB,GAAK,QAAQ,mBAAmB,EAIhC,KAAI9I,EAAM,SAAS,eAAe,cAAc,EAC5CA,IACAA,EAAI,SAAW,GACfA,EAAI,YAAc,kBAItB,GAAI,CACA,eAAe,WAAW,oBAAoB,EAC9C,eAAe,WAAW,kBAAkB,CAChD,OAASrP,EAAG,CAEZ,CAGA,OAAO,SAAS,KAAO,iBAC3B,CAGA,IAAIwY,GAAmB,GACnBC,GAAyB,IAK7B,SAASC,IAAkB,CAEvB,GAAI,CAAAF,IAIAhS,GAAMA,EAAG,aAAe,UAAU,KAAM,CACxCgS,GAAmB,GAGnB,IAAIG,EAAY,SAAS,eAAe,gBAAgB,EACpDC,EAAS,SAAS,eAAe,sBAAsB,EAM3D,GAJID,IACAA,EAAU,SAAW,GACrBA,EAAU,YAAc,cAExBC,EAAQ,CACRA,EAAO,SAAW,GAClB,IAAIC,EAAUD,EAAO,cAAc,gBAAgB,EAC/CC,IAASA,EAAQ,YAAc,UACvC,CAEArS,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,QACN,OAAQ,YACZ,CAAC,CAAC,EAGF,WAAW,UAAW,CAClBgS,GAAmB,GACfG,IAAWA,EAAU,SAAW,IAChCC,IAAQA,EAAO,SAAW,GAClC,EAAGH,EAAsB,CAC7B,CACJ,CAOA,IAAIK,GAAqB,GACzB,IAAIC,GAA2B,IAG/B,IAAIC,EAAc,GAGdC,GAAgB,GAMpB,SAASC,IAAsB,CAC3B,OAAIJ,GAA2B,IAC/BA,GAAqB,GACrB,WAAW,UAAW,CAAEA,GAAqB,EAAO,EAAGC,EAAwB,EACxE,GACX,CAKA,SAASI,IAAsB,CAC3B,GAAKC,EACL,KAAIC,EAAM,SAAS,eAAe,mBAAmB,EACjDA,IACAA,EAAI,UAAU,OAAO,QAAQ,EAC7B,SAAS,KAAK,UAAU,IAAI,iBAAiB,GAErD,CAKA,SAASC,IAAsB,CAC3B,IAAID,EAAM,SAAS,eAAe,mBAAmB,EACjDA,IACAA,EAAI,UAAU,IAAI,QAAQ,EAC1B,SAAS,KAAK,UAAU,OAAO,iBAAiB,EAExD,CAMA,SAASE,GAAsBC,EAAO,CAClC,IAAIC,EAAU,SAAS,eAAe,eAAe,EACjDC,EAAU,SAAS,eAAe,sBAAsB,EAE5D,GAAIF,IAAU,WASV,GAPAG,GAAsB,EAElBF,GAAW,CAACT,IACZS,EAAQ,UAAU,OAAO,aAAa,EACtCA,EAAQ,SAAW,IAGnBC,EAAS,CACTA,EAAQ,UAAU,OAAO,aAAa,EACtCA,EAAQ,SAAW,GACnB,IAAIb,EAAUa,EAAQ,cAAc,gBAAgB,EAChDb,IAASA,EAAQ,YAAc,OACvC,UACOW,IAAU,UAMjB,GAJIC,GAAW,CAACT,IACZS,EAAQ,UAAU,OAAO,aAAa,EACtCA,EAAQ,SAAW,IAEnBC,EAAS,CACTA,EAAQ,UAAU,OAAO,aAAa,EACtCA,EAAQ,SAAW,GACnB,IAAIb,EAAUa,EAAQ,cAAc,gBAAgB,EAChDb,IAASA,EAAQ,YAAc,OACvC,UAGIa,EAAS,CACTA,EAAQ,UAAU,IAAI,aAAa,EACnCA,EAAQ,SAAW,GACnB,IAAIb,EAAUa,EAAQ,cAAc,gBAAgB,EAChDb,IAASA,EAAQ,YAAc,OACvC,CAGR,CAKA,SAASe,IAAiB,CAEtB,GAAI,CAAAZ,GAECE,GAAoB,EAEzB,IAAI,CAAC1S,GAAMA,EAAG,aAAe,UAAU,KAAM,CACzC,QAAQ,KAAK,qDAAqD,EAClE,MACJ,CAGA,IAAIiT,EAAU,SAAS,eAAe,eAAe,EACrD,GAAIA,EAAS,CACTA,EAAQ,UAAU,IAAI,aAAa,EACnCA,EAAQ,SAAW,GACnB,IAAIZ,EAAUY,EAAQ,cAAc,gBAAgB,EAChDZ,IAASA,EAAQ,YAAc,cACvC,CAEArS,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,QACN,OAAQ,WACZ,CAAC,CAAC,EACN,CAKA,SAASqT,IAAiB,CAEtB,GAAIZ,IAAiB,EAAK,CACtBa,GAAwB,KAAK,EAC7B,MACJ,CACKZ,GAAoB,IACrB,CAAC1S,GAAMA,EAAG,aAAe,UAAU,MAEvCA,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,QACN,OAAQ,aACR,UAAW,IACf,CAAC,CAAC,EACN,CAKA,SAASuT,IAAmB,CAExB,GAAId,IAAiB,EAAK,CACtBa,GAAwB,KAAK,EAC7B,MACJ,CACKZ,GAAoB,IACrB,CAAC1S,GAAMA,EAAG,aAAe,UAAU,MAEvCA,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,QACN,OAAQ,aACR,UAAW,MACf,CAAC,CAAC,EACN,CAMA,SAASsT,GAAwBE,EAAO,CACpC,IAAI3S,EAAY,SAAS,eAAe,kBAAkB,EACrDA,IAELA,EAAU,YAAc2S,IAAU,MAAQ,gBAAW,gBACrD3S,EAAU,UAAU,OAAO,QAAQ,EACnCA,EAAU,UAAU,IAAI,YAAY,EAGpC,WAAW,UAAW,CAClBA,EAAU,UAAU,OAAO,YAAY,EACvC,WAAW,UAAW,CAClBA,EAAU,UAAU,IAAI,QAAQ,CACpC,EAAG,GAAG,CACV,EAAG,GAAI,EACX,CAKA,SAAS4S,IAAgB,CACrB,GAAK,QAAQhe,EAAE,0BAA0B,CAAC,GACrCid,GAAoB,EACzB,IAAI,CAAC1S,GAAMA,EAAG,aAAe,UAAU,KAAM,CACzC,MAAMvK,EAAE,wBAAwB,CAAC,EACjC,MACJ,CAGA,IAAIie,EAAS,SAAS,eAAe,cAAc,EACnD,GAAIA,EAAQ,CACRA,EAAO,SAAW,GAClB,IAAIrB,EAAUqB,EAAO,cAAc,gBAAgB,EAC/CrB,IAASA,EAAQ,YAAc,YACvC,CAEArS,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,QACN,OAAQ,UACZ,CAAC,CAAC,EACN,CAKA,SAAS2T,IAAyB,CAC9BzB,GAAgB,CACpB,CAKA,SAAS0B,IAAuB,CAC5B,IAAIX,EAAU,SAAS,eAAe,eAAe,EACjDY,EAAW,SAAS,eAAe,eAAe,EAClDC,EAAa,SAAS,eAAe,iBAAiB,EACtDZ,EAAU,SAAS,eAAe,sBAAsB,EACxDQ,EAAS,SAAS,eAAe,cAAc,EAE/CT,GAASA,EAAQ,iBAAiB,QAASG,EAAc,EACzDS,GAAUA,EAAS,iBAAiB,QAASR,EAAc,EAC3DS,GAAYA,EAAW,iBAAiB,QAASP,EAAgB,EACjEL,GAASA,EAAQ,iBAAiB,QAASS,EAAsB,EACjED,GAAQA,EAAO,iBAAiB,QAASD,EAAa,CAC9D,CAKA,SAASM,IAAoB,CACzBvB,EAAc,GACd,IAAIS,EAAU,SAAS,eAAe,eAAe,EACrD,GAAIA,EAAS,CACTA,EAAQ,UAAU,IAAI,YAAY,EAClCA,EAAQ,UAAU,IAAI,aAAa,EACnCA,EAAQ,SAAW,GACnB,IAAIe,EAASf,EAAQ,cAAc,eAAe,EAC9CZ,EAAUY,EAAQ,cAAc,gBAAgB,EAChDe,IAAQA,EAAO,YAAc,UAC7B3B,IAASA,EAAQ,YAAc,UACvC,CACJ,CAKA,SAASc,IAAwB,CAC7BX,EAAc,GACd,IAAIS,EAAU,SAAS,eAAe,eAAe,EACrD,GAAIA,EAAS,CACTA,EAAQ,UAAU,OAAO,YAAY,EACrCA,EAAQ,UAAU,OAAO,aAAa,EACtCA,EAAQ,SAAW,GACnB,IAAIe,EAASf,EAAQ,cAAc,eAAe,EAC9CZ,EAAUY,EAAQ,cAAc,gBAAgB,EAChDe,IAAQA,EAAO,YAAc,gBAC7B3B,IAASA,EAAQ,YAAc,OACvC,CACJ,CAMA,SAAS4B,GAAoBC,EAAO,CAChCzB,GAAgByB,EAChBC,GAAoBD,CAAK,EACzBE,GAAwBF,CAAK,CACjC,CAMA,SAASC,GAAoBD,EAAO,CAChC,IAAIrT,EAAY,SAAS,eAAe,kBAAkB,EAC1D,GAAKA,EAEL,KAAIwT,EAAa,KAAK,MAAMH,EAAQ,GAAG,EACvCrT,EAAU,YAAc,aAAQwT,EAAa,IAC7CxT,EAAU,UAAU,OAAO,QAAQ,EACnCA,EAAU,UAAU,IAAI,YAAY,EAGpC,WAAW,UAAW,CAClBA,EAAU,UAAU,OAAO,YAAY,EACvC,WAAW,UAAW,CAClBA,EAAU,UAAU,IAAI,QAAQ,CACpC,EAAG,GAAG,CACV,EAAG,IAAI,EACX,CAMA,SAASuT,GAAwBF,EAAO,CACpC,IAAII,EAAQ,SAAS,eAAe,eAAe,EAC/CC,EAAU,SAAS,eAAe,iBAAiB,EAEnDD,GACAA,EAAM,UAAU,OAAO,cAAeJ,GAAS,CAAG,EAElDK,GACAA,EAAQ,UAAU,OAAO,cAAeL,GAAS,CAAG,CAE5D,CAMA,IAAItB,EAAU,GAMd,SAAS4B,IAAmB,CACxB,MAAMC,EAAc,eAAe,QAAQ,kBAAkB,EACvDC,EAAa,eAAe,QAAQ,oBAAoB,EAE9D,OAAID,IAAgB,QAAUC,IAC1B9B,EAAU,GACVrV,EAAamX,EAEb,eAAe,WAAW,kBAAkB,GAEzC9B,CACX,CAMA,SAAS+B,GAAoBlV,EAAS,CAClC,MAAMiL,EAAgB,SAAS,eAAe,gBAAgB,EACxDkK,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAqB,SAAS,eAAe,sBAAsB,EACzE,GAAI,CAACnK,EAAe,OAGpB,MAAM/D,EAAgBlH,EAAQ,KAAK,SAASgC,EAAG,CAAE,OAAOA,EAAE,OAASlE,CAAY,CAAC,GAC1DoJ,GAAA,YAAAA,EAAe,YAAa,IAG9C+D,EAAc,UAAU,OAAO,QAAQ,EACnCkK,GAAaA,EAAY,UAAU,IAAI,QAAQ,EAE/CC,GAAoBA,EAAmB,UAAU,IAAI,QAAQ,IAEjEnK,EAAc,UAAU,IAAI,QAAQ,EAChCkK,GAAaA,EAAY,UAAU,OAAO,QAAQ,EAElDC,GAAoBA,EAAmB,UAAU,OAAO,QAAQ,EAE5E,CAKA,SAASC,IAAqB,CAC1B,MAAMC,EAAW,SAAS,eAAe,gBAAgB,EAEzDA,GAAA,MAAAA,EAAU,iBAAiB,QAAS,UAAW,CACvC,CAAC/U,GAAMA,EAAG,aAAe,UAAU,OAEvC+U,EAAS,SAAW,GACpBA,EAAS,YAAc,cAEvB/U,EAAG,KAAK,KAAK,UAAU,CACnB,KAAM,QACN,OAAQ,YACZ,CAAC,CAAC,EACN,GAGA,MAAMgV,EAAW,SAAS,eAAe,gBAAgB,EACzDA,GAAA,MAAAA,EAAU,iBAAiB,QAAS,UAAW,CAC3CC,GAAgB,CACpB,EACJ,CAMA,IAAIjV,EAAK,KACLzC,EAAa,KACb0C,EAAoB,EACxB,MAAMK,EAAyB,GACzB4U,GAAyB,IACzBC,GAAmB,sBACnBC,GAAsB,kBACtBC,GAAuB,mBAG7B,IAAInV,EAAiB,GAGjBoV,EAAmB,GAMvB,SAAS5U,IAAoB,CAEzB,OAAO,KAAK,IAAI,IAAO,KAAK,IAAI,EAAGT,CAAiB,EAAGiV,EAAsB,CACjF,CAMA,SAASK,IAAsB,CAC3B,GAAI,CACA,IAAIC,EAAe,aAAa,QAAQJ,EAAmB,EACvDV,EAAa,aAAa,QAAQS,EAAgB,EAGtD,GAFA,QAAQ,IAAI,kDAAmDK,EAAc,iBAAkBvhB,EAAQ,cAAeygB,CAAU,EAE5Hc,GAAgBA,IAAiBvhB,EACjC,eAAQ,IAAI,kDAAmDygB,CAAU,EAClEA,EAGPc,GAAgBA,IAAiBvhB,IAEjC,QAAQ,IAAI,mDAAmD,EAC/D,aAAa,WAAWkhB,EAAgB,EACxC,aAAa,WAAWC,EAAmB,EAEnD,OAAS5b,EAAG,CACR,QAAQ,MAAM,gCAAiCA,CAAC,CACpD,CACA,OAAO,IACX,CAMA,SAASic,GAAgBzZ,EAAM,CAC3B,GAAI,CACA,aAAa,QAAQmZ,GAAkBnZ,CAAI,EAC3C,aAAa,QAAQoZ,GAAqBnhB,CAAM,EAChD,QAAQ,IAAI,gCAAiC+H,EAAM,YAAa/H,CAAM,CAC1E,OAASuF,EAAG,CACR,QAAQ,MAAM,yCAA0CA,CAAC,CAC7D,CACJ,CAKA,SAASkc,IAAwB,CAC7B,GAAI,CACA,aAAa,WAAWP,EAAgB,EACxC,aAAa,WAAWC,EAAmB,CAC/C,OAAS,EAAG,CAEZ,CACJ,CAMA,SAASO,GAAkBzf,EAAM,CAC7B,GAAI,CACA,aAAa,QAAQmf,GAAsBnf,CAAI,CACnD,OAASsD,EAAG,CAEZ,CACJ,CAMA,SAASoc,IAAoB,CACzB,GAAI,CACA,OAAO,aAAa,QAAQP,EAAoB,CACpD,OAAS,EAAG,CACR,OAAO,IACX,CACJ,CAKA,SAAS9U,IAA0B,CAC/B,IAAIsV,EAAU,SAAS,eAAe,sBAAsB,EACxDA,GACAA,EAAQ,UAAU,OAAO,QAAQ,CAEzC,CAKA,SAAS1V,IAA0B,CAC/B,IAAI0V,EAAU,SAAS,eAAe,sBAAsB,EACxDA,GACAA,EAAQ,UAAU,IAAI,QAAQ,CAEtC,CAMA,SAASrV,GAAsBsV,EAAS,CACpC,IAAIC,EAAW,SAAS,eAAe,kBAAkB,EACrDA,IACAA,EAAS,YAAc,4BAA8BD,EAAU,IAAMxV,EAAyB,IAEtG,CAKA,SAASK,IAAyB,CAC9B9L,EAAS,sBAAsB,CACnC,CAKA,SAASmhB,IAAuB,CAC5B,IAAIC,EAAW,SAAS,eAAe,sBAAsB,EACzDA,GACAA,EAAS,iBAAiB,QAAS,UAAW,CACtC1Y,GACA0C,EAAoB,EACpBpL,EAAS,cAAc,EACvBqhB,GAAiB3Y,CAAU,GAG3BnH,GAAgB,CAExB,CAAC,CAET,CAMA,SAAS8f,GAAiBla,EAAM,CAC5BuB,EAAavB,EAEbyZ,GAAgBzZ,CAAI,EAGpB,MAAM+D,GADa,OAAO,SAAS,WAAa,SAAW,OAAS,OACzC,KAAO,OAAO,SAAS,KAAO,cAEzDC,EAAK,IAAI,UAAUD,CAAK,EAExBC,EAAG,OAAS,UAAW,CACnBC,EAAoB,EACpBC,EAAiB,GACjBC,GAAwB,EAExB,IAAIgW,EAAU,CAAE,KAAM,OAAQ,KAAMna,CAAK,EACrC4W,IACAuD,EAAQ,SAAW,IAEvBnW,EAAG,KAAK,KAAK,UAAUmW,CAAO,CAAC,CACnC,EAEAnW,EAAG,UAAY,SAASI,EAAO,CAC3B,GAAI,CACA,MAAM/J,EAAO,KAAK,MAAM+J,EAAM,IAAI,EAClCC,GAAoBhK,CAAI,CAC5B,OAASmD,EAAG,CACR,QAAQ,MAAM,qCAAsCA,CAAC,CACzD,CACJ,EAEAwG,EAAG,QAAU,UAAW,CAEpB,GAAIsV,EAAkB,CAClBA,EAAmB,GACnB,MACJ,CAEA,GAAI/X,GAAc0C,EAAoBK,EAAwB,CAC1DJ,EAAiB,GACjBD,IACAM,GAAwB,EACxBC,GAAsBP,CAAiB,EAEvC,MAAMQ,EAAQC,GAAkB,EAChC,QAAQ,IAAI,qCAAuCD,EAAQ,kBAAoBR,EAAoB,GAAG,EACtG,WAAW,UAAW,CAAEiW,GAAiB3Y,CAAU,CAAG,EAAGkD,CAAK,CAClE,MAAWR,GAAqBK,IAE5BJ,EAAiB,GACjBC,GAAwB,EACxBQ,GAAuB,EAE/B,EAEAX,EAAG,QAAU,SAAStJ,EAAK,CACvB,QAAQ,MAAM,mBAAoBA,CAAG,CACzC,CACJ,CAMA,SAAS2J,GAAoBhK,EAAM,CAC/B,MAAM+f,EAAU,SAAS,eAAe,UAAU,EAC5CC,EAAY,SAAS,eAAe,YAAY,EAEtD,GAAIhgB,EAAK,OAAS,QAAS,CAEvB,IAAIoJ,EAAUpJ,EAAK,SAAW,CAAC,EAC3BsQ,EAAgBlH,EAAQ,KAAK,SAASgC,EAAG,CAAE,OAAOA,EAAE,OAASlE,CAAY,CAAC,EA2B9E,GA1BIoJ,IACAiM,EAAUjM,EAAc,WAAa,IAKrCtQ,EAAK,WAELsf,GAAkBtf,EAAK,QAAQ,EAE3B,OAAO,aAAgB,aAAeA,EAAK,WAAa,YAAY,YAAY,GAChF,YAAY,YAAYA,EAAK,QAAQ,EAAE,KAAK,UAAW,CACnD,YAAY,qBAAqB,EAEjC6K,GAAiBzB,CAAO,EACpBpJ,EAAK,YACL4L,GAAsB5L,EAAK,UAAU,EAGrCA,EAAK,QAAU,UACfiT,GAAiBjT,CAAI,CAE7B,CAAC,GAILA,EAAK,QAAU,QACfyN,EAAc,EACdgP,GAAoB,EACpB7L,GAAqB,EACrBqP,EAAe,QAAQ,EACvBzhB,EAAS,YAAY,EACrBqM,GAAiBzB,CAAO,EAEpBpJ,EAAK,YACL4L,GAAsB5L,EAAK,UAAU,EAGrCA,EAAK,UACLmM,GAAanM,EAAK,QAAQ,EAG9Bse,GAAoBlV,CAAO,UACpBpJ,EAAK,QAAU,UAAW,CAEjC,IAAIkgB,EAAWlgB,EAAK,OAAS,EACzBkgB,IAAatP,KACbA,GAAqBsP,EACrBlO,GAAqB,GAEzBiO,EAAe,OAAO,EACtBzhB,EAAS,WAAW,EACpBsO,GAAiB,EACjBgB,GAAe9N,CAAI,EAEfA,EAAK,YACL4L,GAAsB5L,EAAK,UAAU,EAErCA,EAAK,UACLuN,GAAevN,EAAK,QAAQ,EAEhC8Q,GAAiB,EACjBP,GAAuB,EAEvB+L,GAAoB,EACpBI,GAAsB,SAAS,CACnC,MAAW1c,EAAK,QAAU,UACtByN,EAAc,EACdwS,EAAe,OAAO,EACtBzhB,EAAS,aAAa,EACtByU,GAAiBjT,CAAI,EAErBsc,GAAoB,EACpBI,GAAsB,QAAQ,GACvB1c,EAAK,QAAU,UAEtByN,EAAc,EACdgP,GAAoB,EACpBwD,EAAe,QAAQ,EACvBzhB,EAAS,aAAa,EACtBid,GAAiBzb,CAAI,GACdA,EAAK,QAAU,QACtByN,EAAc,EACdgP,GAAoB,EACpB7L,GAAqB,EACrBqP,EAAe,QAAQ,EACvBzhB,EAAS,UAAU,EACnBqc,GAAc7a,CAAI,EAElBqf,GAAsB,EAE9B,SAAWrf,EAAK,OAAS,WAAY,CAE7BA,EAAK,YACLO,GAAiBP,EAAK,UAAU,EAGpC,GAAI,CACA,eAAe,WAAW,oBAAoB,EAC9C,eAAe,WAAW,kBAAkB,CAChD,OAASmD,EAAG,CAEZ,CACJ,SAAWnD,EAAK,OAAS,gBAEjBA,EAAK,SAAWA,EAAK,MACrBkH,EAAalH,EAAK,KAClBof,GAAgBpf,EAAK,IAAI,EACzBuK,GAAqBvK,EAAK,IAAI,IAI9Ba,EAAmB,EACnBwe,GAAsB,EACtBnY,EAAa,KACb1I,EAAS,WAAW,WAEjBwB,EAAK,OAAS,aAErB2R,GAAgB,UACT3R,EAAK,OAAS,QAAS,CAE9B,GAAIA,EAAK,OAAS,iBAAmBA,EAAK,OAAS,oBAAqB,CACpE8R,GAAkB9R,CAAI,EACtB,MACJ,CAEA,GAAIA,EAAK,OAAS,aAAc,CAC5BxB,EAAS,UAAU,EACnB,MACJ,CAEA,GAAIwB,EAAK,OAAS,YAAa,CAC3Buc,EAAU,GACVE,GAAoB,EACpB,QAAQ,KAAK,kCAAkC,EAC/C,MACJ,CAEA,GAAIzc,EAAK,OAAS,mBAAoB,CAClC6J,EAAiB,GACjBC,GAAwB,EAExB5C,EAAa,KACboD,GAAuB,EACvB,QAAQ,KAAK,mCAAmC,EAChD,MACJ,CAEA,GAAItK,EAAK,OAAS,oBAAqB,CACnCa,EAAmB,EAEnBoe,EAAmB,GAEftV,GACAA,EAAG,MAAM,EAGbnL,EAAS,WAAW,EACpB,MACJ,CAEA,GAAIwB,EAAK,OAAS,qBAAsB,CAEpCif,EAAmB,GAEnB,MAAMjf,EAAK,SAAW,0CAA0C,EAChE,MACJ,CAEA,GAAIA,EAAK,OAAS,kBAAoBA,EAAK,UAAY,kBAAmB,CAEtE8c,GAAsB,EACtB,QAAQ,KAAK,6CAA6C,EAC1D,MACJ,CAEAte,EAAS,WAAW,EAEpB2hB,GAAcngB,EAAK,OAAO,EACtB+f,IACAA,EAAQ,SAAW,GACnBA,EAAQ,YAAc3gB,EAAE,iBAAiB,GAEzC4gB,GACAA,EAAU,MAAM,EAGpB9Y,EAAa,KAEbmY,GAAsB,CAC1B,MAAWrf,EAAK,OAAS,eAErB0d,GAAkB,EACX1d,EAAK,OAAS,iBAErB4d,GAAoB5d,EAAK,KAAK,EACvBA,EAAK,OAAS,aAErBogB,GAAgB,EACTpgB,EAAK,OAAS,OAErBqgB,GAAe,EACRrgB,EAAK,OAAS,gBAErB8S,GAAmB9S,CAAI,EAChBA,EAAK,OAAS,aAErB4S,GAAe5S,CAAI,CAE3B,CAKA,SAASqgB,IAAiB,CAEtBhB,GAAsB,EACtBxe,EAAmB,EAGnBqG,EAAa,KACbqV,EAAU,GAGV/d,EAAS,WAAW,CACxB,CAKA,SAASogB,IAAkB,CACvB,GAAI,GAACjV,GAAMA,EAAG,aAAe,UAAU,MAKvC,IAAI4S,EAAS,CACT,MAAM,0CAA0C,EAChD,MACJ,CAGK,QAAQ,0CAA0C,IAKvD0C,EAAmB,GAGnBtV,EAAG,KAAK,KAAK,UAAU,CAAE,KAAM,OAAQ,CAAC,CAAC,GAC7C,CAKA,SAASyW,IAAkB,CAEvBf,GAAsB,EACtBxe,EAAmB,EACnB,GAAI,CACA,eAAe,WAAW,oBAAoB,EAC9C,eAAe,WAAW,kBAAkB,CAChD,OAASsC,EAAG,CAEZ,CAuBA,GApBA2D,GAA2B,EAG3B0B,GAAyB,EAGzB1E,GAAe,MAAM,EACrByU,GAAa,EAGbrR,EAAa,KACbqV,EAAU,GAGN5S,GAAMA,EAAG,aAAe,UAAU,MAClCA,EAAG,MAAM,EAEbA,EAAK,KAGD,GAACrL,IAAW,CAACA,GAAQ,UAAU,SAAS,QAAQ,GAKpD,KAAIgiB,EAAa,SAAS,eAAe,oBAAoB,EACzDA,IACAA,EAAW,UACP,qGAEJA,EAAW,UAAU,OAAO,QAAQ,GAGxC9hB,EAAS,UAAU,EACvB,CAMA,SAAS2hB,GAAcpO,EAAS,CAC5B,MAAMwO,EAAgB,SAAS,eAAe,qBAAqB,EAC/DA,IACAA,EAAc,YAAcxO,EAC5BwO,EAAc,UAAU,OAAO,QAAQ,EAE/C,CAOA,SAASC,GAAa7a,EAAM,CACxB,MAAM8I,GAAW9I,GAAQ,IAAI,KAAK,EAClC,OAAK8I,EAGDA,EAAQ,OAAShE,GACV,CAAE,MAAO,GAAO,MAAO,mCAAoC,EAE/D,CAAE,MAAO,GAAM,KAAMgE,CAAQ,EALzB,CAAE,MAAO,GAAO,MAAO,qBAAsB,CAM5D,CAKA,SAASgS,IAAkB,CACvB,MAAMT,EAAY,SAAS,eAAe,YAAY,EAChDD,EAAU,SAAS,eAAe,UAAU,EAC5CQ,EAAgB,SAAS,eAAe,qBAAqB,EACnE,GAAI,CAACP,GAAa,CAACD,EAAS,OAE5B,MAAMW,EAASF,GAAaR,EAAU,KAAK,EACtCU,EAAO,QAEZX,EAAQ,SAAW,GACnBA,EAAQ,YAAc,aAGlBQ,GACAA,EAAc,UAAU,IAAI,QAAQ,EAGxCV,GAAiBa,EAAO,IAAI,EAChC,CAKA,SAASC,IAAgB,CACrB,MAAMX,EAAY,SAAS,eAAe,YAAY,EAChDD,EAAU,SAAS,eAAe,UAAU,EAC5CQ,EAAgB,SAAS,eAAe,qBAAqB,EAC/D,CAACP,GAAa,CAACD,IAEnBC,EAAU,iBAAiB,QAAS,UAAW,CAC3C,MAAMU,EAASF,GAAa,KAAK,KAAK,EACtCT,EAAQ,SAAW,CAACW,EAAO,MACvBH,IACAA,EAAc,YAAe,CAACG,EAAO,OAAS,KAAK,MAASA,EAAO,MAAQ,GAC3EH,EAAc,UAAU,OAAO,SAAUG,EAAO,OAAS,CAAC,KAAK,KAAK,EAE5E,CAAC,EAEDX,EAAQ,iBAAiB,QAASU,EAAe,EACjDT,EAAU,iBAAiB,WAAY,SAAS7c,EAAG,CAC3CA,EAAE,MAAQ,SAAW,CAAC4c,EAAQ,UAC9BU,GAAgB,CAExB,CAAC,EACL,CAGA,MAAMG,GAAmBpiB,EACzBA,EAAW,SAASC,EAAQ,CACxBmiB,GAAiBniB,CAAM,GAGnBA,IAAW,aAAeA,IAAW,gBACrCA,IAAW,kBAAoBA,IAAW,cAC1CA,IAAW,oBAAsBA,IAAW,yBAC5CwhB,EAAe,MAAM,EAGrBxhB,IAAW,aACX,WAAW,UAAW,CAClB,IAAIuhB,EAAY,SAAS,eAAe,YAAY,EAChDA,GAAWA,EAAU,MAAM,CACnC,EAAG,GAAG,CAEd,EAUA,SAASC,EAAepC,EAAO,CAC3B,SAAS,KAAK,UAAU,OAAO,cAAe,gBAAiB,cAAc,EAC7E,SAAS,KAAK,UAAU,IAAI,UAAYA,CAAK,CACjD,CAOA,IAAIgD,EAAsB,KACtBC,EAAqB,KAQzB,SAAS5M,GAAgB6M,EAAM,CAE3B,GAAIzf,EAAe,qBAAqB,EAAG,CACvC0f,GAAsB,EACtB,MACJ,CAGA,GAAI,OAAO,UAAa,YAAa,CACjC,QAAQ,KAAK,+BAA+B,EAC5C,MACJ,CAGAzI,GAAa,EAGb,IAAIlX,EAAUC,EAAe,mBAAmB,EAC5C2f,EAAgB5f,EAAQ,kBAG5B,GAAI4f,IAAkB,EAAG,CACrBD,GAAsB,EACtB,MACJ,CAGA,IAAIvd,EAAOnC,EAAe,cAAc,EACpC4f,EAAqBzd,IAAS,MAAQ,GAAOA,IAAS,SAAW,IAAO,EAK5E,OAFAsd,EAAOA,GAAQ,QAEPA,EAAM,CACV,IAAK,QAED,IAAII,EAAgB,KAAK,MAAM,IAAOD,CAAkB,EACpDE,EAAW,KAAK,IAAI,EAAID,GAC3B,SAASE,GAAa,CACnB,SAAS,CACL,cAAeJ,EACf,OAAQ,GACR,OAAQ,CAAE,EAAG,EAAI,EACjB,OAAQ,CAAC,UAAW,UAAW,SAAS,CAC5C,CAAC,EACG,KAAK,IAAI,EAAIG,IACbP,EAAsB,sBAAsBQ,CAAU,EAE9D,GAAE,EACF,MAEJ,IAAK,SAED,IAAIC,EAAiB,KAAK,MAAM,IAAOJ,CAAkB,EACrDK,EAAY,KAAK,IAAI,EAAID,GAC5B,SAASE,GAAc,CACpB,SAAS,CACL,cAAe,KAAK,MAAMP,EAAgB,GAAI,EAC9C,OAAQ,IACR,OAAQ,CAAE,EAAG,GAAK,EAAG,KAAK,OAAO,CAAE,EACnC,OAAQ,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,SAAS,CAC7E,CAAC,EACG,KAAK,IAAI,EAAIM,IACbV,EAAsB,sBAAsBW,CAAW,EAE/D,GAAE,EACF,MAEJ,IAAK,SAED,IAAIC,EAAiB,KAAK,MAAM,IAAOP,CAAkB,EACrDQ,EAAY,KAAK,IAAI,EAAID,GAC5B,SAASE,GAAc,CACpB,SAAS,CACL,cAAe,KAAK,MAAMV,EAAgB,GAAI,EAC9C,MAAO,GACP,OAAQ,GACR,OAAQ,CAAE,EAAG,CAAE,EACf,OAAQ,CAAC,UAAW,UAAW,UAAW,SAAS,CACvD,CAAC,EACD,SAAS,CACL,cAAe,KAAK,MAAMA,EAAgB,GAAI,EAC9C,MAAO,IACP,OAAQ,GACR,OAAQ,CAAE,EAAG,CAAE,EACf,OAAQ,CAAC,UAAW,UAAW,UAAW,SAAS,CACvD,CAAC,EACG,KAAK,IAAI,EAAIS,IACbb,EAAsB,sBAAsBc,CAAW,EAE/D,GAAE,EACF,MAEJ,IAAK,UAED,IAAIC,EAAkB,KAAK,MAAM,IAAOV,CAAkB,EACtDW,EAAa,KAAK,IAAI,EAAID,EAG9Bd,EAAqB,YAAY,UAAW,CACxC,SAAS,CACL,cAAeG,EAAgB,EAC/B,OAAQ,IACR,OAAQ,CAAE,EAAG,EAAI,EACjB,OAAQ,CAAC,UAAW,UAAW,SAAS,CAC5C,CAAC,CACL,EAAGxd,IAAS,MAAQ,IAAM,GAAG,EAG7B,WAAW,UAAW,CACdqd,IACA,cAAcA,CAAkB,EAChCA,EAAqB,KAE7B,EAAGc,CAAe,EAEjB,SAASE,GAAe,CACrB,SAAS,CACL,cAAe,KAAK,MAAMb,EAAgB,EAAG,EAC7C,MAAO,GACP,OAAQ,GACR,OAAQ,CAAE,EAAG,CAAE,EACf,OAAQ,CAAC,UAAW,UAAW,UAAW,SAAS,CACvD,CAAC,EACD,SAAS,CACL,cAAe,KAAK,MAAMA,EAAgB,EAAG,EAC7C,MAAO,IACP,OAAQ,GACR,OAAQ,CAAE,EAAG,CAAE,EACf,OAAQ,CAAC,UAAW,UAAW,UAAW,SAAS,CACvD,CAAC,EACG,KAAK,IAAI,EAAIY,IACbhB,EAAsB,sBAAsBiB,CAAY,EAEhE,EAAE,EACF,MAEJ,QACI,QAAQ,KAAK,2BAA4Bf,CAAI,CACrD,CACJ,CAKA,SAASxI,IAAe,CAEhBsI,IACA,qBAAqBA,CAAmB,EACxCA,EAAsB,MAGtBC,IACA,cAAcA,CAAkB,EAChCA,EAAqB,MAGrB,OAAO,UAAa,aAAe,SAAS,OAC5C,SAAS,MAAM,CAEvB,CAKA,SAASE,IAAwB,CAC7B,IAAI3I,EAAY,SAAS,eAAe,gBAAgB,EACxD,GAAIA,EAAW,CACX,IAAI0J,EAAe1J,EAAU,cAAc,mBAAmB,EAC9D,GAAI,CAAC0J,EAAc,CACf,IAAItR,EAAO,SAAS,cAAc,MAAM,EACxCA,EAAK,UAAY,mBACjBA,EAAK,YAAc,aACnB4H,EAAU,YAAY5H,CAAI,CAC9B,CACJ,CACJ,CAMA,SAASuR,IAAsB,CAC3B,IAAI1N,EAAe,SAAS,eAAe,gBAAgB,EACvDA,GACAA,EAAa,iBAAiB,QAASuH,EAAe,EAI1D,IAAIoG,EAAe,SAAS,eAAe,aAAa,EACpDA,GACAA,EAAa,iBAAiB,QAAS,SAAS9e,EAAG,CAE3CA,EAAE,OAAO,UAAY,UAAYA,EAAE,OAAO,QAAQ,QAAQ,IAI1DW,GAAe,UAAU,GACzBA,GAAe,QAAQ,EAE3ByU,GAAa,EACjB,CAAC,CAET,CAGA,SAAe2J,IAAU,QAAAjjB,GAAA,sBAErB,IAAIkjB,EAAa7gB,EAAe,cAAc,EAC9C,SAAS,KAAK,UAAU,IAAI,eAAiB6gB,CAAU,EAKvD,IAAIC,EAAgB,MAAMtjB,GAAY,EACtC,GAAI,CAACsjB,EACD,QAAQ,MAAM,wEAAwE,MACnF,CACH,IAAIC,EAAa9C,GAAkB,EACnC,MAAM,YAAY,KAAK8C,CAAU,EACjC,YAAY,qBAAqB,CACrC,CAGA,IAAIC,EAAkB,SAAS,eAAe,oBAAoB,EAgBlE,GAfIA,IACAA,EAAgB,YAAc,OAAO,SAAS,OAAS,sBAG3D3B,GAAc,EACdjU,GAAa,EACbS,GAAiB,EACjBsR,GAAmB,EACnBuD,GAAoB,EACpBzE,GAAqB,EACrBoC,GAAqB,EACrB5Y,GAA8B,EAI1BoX,GAAiB,GAAKjX,EAAY,CAElC2Y,GAAiB3Y,CAAU,EAC3B,MACJ,CAGA,IAAImX,EAAaa,GAAoB,EACrC,GAAIb,GAAczgB,EAAQ,CACtB,QAAQ,IAAI,kCAAmCygB,CAAU,EAEzDwB,GAAiBxB,CAAU,EAC3B,MACJ,CAGA,GAAIA,EAAY,CACZ,IAAI2B,EAAY,SAAS,eAAe,YAAY,EAChDD,EAAU,SAAS,eAAe,UAAU,EAChD,GAAIC,IACAA,EAAU,MAAQ3B,EACd0B,GAAS,CACT,IAAIW,EAASF,GAAanC,CAAU,EACpC0B,EAAQ,SAAW,CAACW,EAAO,KAC/B,CAER,CACJ,GAEI,SAAS,aAAe,UACxB,SAAS,iBAAiB,mBAAoBwB,EAAO,EAErDA,GAAQ,EAWR,kBAAmB,WACnB,OAAO,iBAAiB,OAAQ,UAAW,CACvC,UAAU,cAAc,SAAS,wBAAyB,CACtD,MAAO,WACX,CAAC,EAAE,KAAK,SAASK,EAAc,CAC3B,QAAQ,IAAI,2BAA4BA,EAAa,KAAK,CAC9D,CAAC,EAAE,MAAM,SAASC,EAAO,CACrB,QAAQ,KAAK,oCAAqCA,CAAK,CAC3D,CAAC,CACL,CAAC,CAGT,GAAG",
  "names": ["_a", "_b", "gameId", "loadingView", "notFoundView", "endedView", "inProgressView", "joinView", "lobbyView", "gameView", "revealView", "pausedView", "endView", "connectionLostView", "showView", "viewId", "v", "view", "isValidGameIdFormat", "id", "waitForI18n", "timeout", "interval", "__async", "start", "resolve", "t", "key", "params", "fallback", "str", "param", "getLocalizedSongField", "song", "field", "lang", "localizedKey", "checkGameStatus", "data", "adminName", "sessionCookie", "getSessionCookie", "connectWithSession", "err", "SESSION_COOKIE_NAME", "setSessionCookie", "sessionId", "secureFlag", "cookies", "i", "cookie", "clearSessionCookie", "prefersReducedMotion", "easeOutQuart", "animateValue", "element", "end", "duration", "easing", "quality", "AnimationUtils", "adjustedDuration", "startTime", "animationId", "cancelled", "finalValue", "step", "timestamp", "elapsed", "progress", "easedProgress", "currentValue", "animateScoreChange", "oldScore", "newScore", "options", "animationClass", "cleanup", "onEnd", "showPointsPopup", "targetElement", "points", "popup", "rect", "previousState", "isPreviousStateInitialized", "STREAK_MILESTONES", "reducedMotionQuery", "_prefersReducedMotion", "e", "_deviceTier", "getDeviceTier", "cores", "memory", "isIOSSafari", "tier", "animationFn", "fallbackFn", "properties", "durationMs", "AnimationQueue", "queue", "running", "currentAnimation", "animationTimeoutId", "MAX_ANIMATION_DURATION", "processNext", "animation", "anim", "LEADERBOARD_LAZY_CONFIG", "lazyLeaderboardState", "initLeaderboardObserver", "listEl", "entries", "entry", "fullData", "range", "buffer", "newStart", "renderLazyLeaderboardRange", "newEnd", "entryHeight", "topSpacerHeight", "bottomSpacerHeight", "scrollTop", "html", "renderLeaderboardEntry", "sentinels", "sentinel", "name", "rank", "score", "rankClass", "currentClass", "changeIndicator", "streakIndicator", "hotClass", "disconnectedClass", "awayBadge", "displayScore", "escapeHtml", "calculateInitialVisibleRange", "displayList", "currentPlayerName", "config", "viewportHeight", "viewportEntries", "currentIdx", "cleanupLeaderboardObserver", "setupLeaderboardResizeHandler", "resizeTimeout", "handleResize", "playerName", "VIRTUAL_LIST_CONFIG", "virtualPlayerList", "initVirtualPlayerList", "container", "ticking", "renderVirtualPlayerList", "setVirtualPlayerListItems", "items", "renderItemFn", "prevScrollTop", "wasVirtual", "renderAllPlayerCards", "setupVirtualContainer", "topSpacer", "contentWrapper", "bottomSpacer", "containerHeight", "itemHeight", "overscan", "startIdx", "endIdx", "cleanupVirtualPlayerList", "isStreakMilestone", "oldStreak", "newStreak", "milestone", "detectRankChanges", "newLeaderboard", "newOrder", "changes", "newRank", "oldRank", "updatePreviousState", "players", "leaderboard", "player", "resetPreviousState", "isValidUUID", "wsProtocol", "wsUrl", "ws", "reconnectAttempts", "isReconnecting", "hideReconnectingOverlay", "event", "handleServerMessage", "MAX_RECONNECT_ATTEMPTS", "showReconnectingOverlay", "updateReconnectStatus", "delay", "getReconnectDelay", "showConnectionLostView", "showWelcomeBackToast", "indicator", "MAX_NAME_LENGTH", "previousPlayers", "text", "div", "renderPlayerList", "countEl", "count", "sortedPlayers", "a", "b", "previousNames", "p", "newNames", "renderPlayerCard", "isNew", "isYou", "isDisconnected", "classes", "newCards", "renderDifficultyBadge", "difficulty", "labelKey", "label", "lobbyBadge", "gameBadge", "currentJoinUrl", "renderQRCode", "joinUrl", "openQRModal", "modal", "modalCode", "closeBtn", "closeQRModal", "setupQRModal", "backdrop", "openInviteModal", "urlInput", "closeInviteModal", "feedback", "copyJoinUrl", "showCopyFeedback", "fallbackCopy", "setupInviteModal", "inviteBtn", "copyBtn", "countdownInterval", "startCountdown", "deadline", "stopCountdown", "timerElement", "updateCountdown", "now", "remaining", "updateGameView", "currentRound", "totalRounds", "lastRoundBanner", "albumCover", "albumLoading", "newSrc", "renderSubmissionTracker", "updateLeaderboard", "updateStealUI", "getInitials", "trimmed", "parts", "tracker", "playerList", "submittedCount", "totalCount", "allSubmitted", "isCompact", "initials", "isCurrentPlayer", "targetListId", "isRevealPhase", "shouldAnimate", "rankChanges", "rankChange", "prevPlayer", "prevScore", "compressLeaderboard", "useLazyLoading", "scoreAnimations", "entryMap", "entryEl", "scoreEl", "scrollToCurrentPlayer", "updateYouIndicator", "top5", "bottom3", "currentEntry", "youEl", "currentPlayer", "setupLeaderboardToggle", "toggle", "icon", "hasSubmitted", "betActive", "currentRoundNumber", "hasStealAvailable", "initYearSelector", "slider", "yearDisplay", "betToggle", "submitBtn", "handleSubmitGuess", "stealBtn", "handleStealClick", "stealModalClose", "closeStealModal", "stealModal", "year", "showSubmitError", "handleSubmitAck", "yearSelector", "confirmation", "handleSubmitError", "message", "resetSubmissionState", "hideStealUI", "stealIndicator", "openStealModal", "targets", "targetList", "noTargets", "target", "btn", "selectStealTarget", "targetName", "confirmMsg", "handleStealAck", "showStealConfirmation", "handleStealTargets", "toast", "msg", "updateRevealView", "roundEl", "totalEl", "correctYear", "titleEl", "artistEl", "funFactContainer", "funFactText", "funFactHeader", "localizedFunFact", "renderRichSongInfo", "renderSongDifficulty", "richInfo", "hasRichInfo", "hasFunFact", "showRevealEmotion", "renderPersonalResult", "triggerConfetti", "renderPlayerResultCards", "renderRoundAnalytics", "adminControls", "nextRoundBtn", "analytics", "avgComparison", "diff", "histogramHtml", "renderHistogram", "achievementsHtml", "names", "furthestOff", "avgDisplay", "allGuesses", "NUM_BINS", "guesses", "g", "minGuess", "maxGuess", "yearsPerBin", "totalYears", "extraYears", "startYear", "bins", "binStart", "binEnd", "j", "guess", "k", "maxCount", "m", "barsHtml", "n", "bin", "heightPercent", "barClass", "barHeight", "countHtml", "renderSuperlatives", "superlatives", "award", "index", "valueText", "el", "stars", "badges", "chartBadges", "renderChartBadges", "certBadges", "renderCertificationBadges", "localizedAwards", "awardBadges", "renderAwardBadges", "chartInfo", "weeksText", "certifications", "cert", "badgeClass", "getCertificationBadgeClass", "getCertificationIcon", "certLower", "awards", "displayAwards", "getAwardBadgeClass", "getAwardIcon", "awardLower", "emotionEl", "personalResult", "stopConfetti", "emotions", "randomFrom", "arr", "getOffByText", "years", "emotionType", "emotionText", "subtitle", "yearsOff", "emotionHtml", "resultContent", "missedHtml", "previousStreak", "yearsOffText", "resultClass", "speedMultiplier", "baseScore", "hasSpeedBonus", "streakBonus", "scoreBreakdown", "betOutcomeHtml", "streakBonusHtml", "totalScore", "isBigScore", "prevStreak", "streakMilestone", "scoreValueEl", "totalValueEl", "milestoneBonus", "sorted", "isMissed", "roundScore", "scoreClass", "guessDisplay", "yearsOffDisplay", "betIndicator", "stealerNames", "updateEndView", "place", "nameEl", "rankEl", "bestStreakEl", "roundsEl", "betsEl", "playerMessage", "newGameBtn", "handleNewGame", "bestStreak", "isPerfectGame", "updatePausedView", "messageEl", "nextRoundPending", "NEXT_ROUND_DEBOUNCE_MS", "handleNextRound", "revealBtn", "barBtn", "labelEl", "adminActionPending", "ADMIN_ACTION_DEBOUNCE_MS", "songStopped", "currentVolume", "debounceAdminAction", "showAdminControlBar", "isAdmin", "bar", "hideAdminControlBar", "updateControlBarState", "phase", "stopBtn", "nextBtn", "resetSongStoppedState", "handleStopSong", "handleVolumeUp", "showVolumeLimitFeedback", "handleVolumeDown", "limit", "handleEndGame", "endBtn", "handleNextRoundFromBar", "setupAdminControlBar", "volUpBtn", "volDownBtn", "handleSongStopped", "iconEl", "handleVolumeChanged", "level", "showVolumeIndicator", "updateVolumeLimitStates", "percentage", "upBtn", "downBtn", "checkAdminStatus", "storedAdmin", "storedName", "updateAdminControls", "lobbyStatus", "leaveGameContainer", "setupAdminControls", "startBtn", "leaveBtn", "handleLeaveGame", "MAX_RECONNECT_DELAY_MS", "STORAGE_KEY_NAME", "STORAGE_KEY_GAME_ID", "STORAGE_KEY_LANGUAGE", "intentionalLeave", "getStoredPlayerName", "storedGameId", "storePlayerName", "clearStoredPlayerName", "storeGameLanguage", "getStoredLanguage", "overlay", "attempt", "statusEl", "setupRetryConnection", "retryBtn", "connectWebSocket", "joinMsg", "joinBtn", "nameInput", "setEnergyLevel", "newRound", "showJoinError", "handleGameEnded", "handleLeftGame", "endMessage", "validationMsg", "validateName", "handleJoinClick", "result", "setupJoinForm", "originalShowView", "confettiAnimationId", "confettiIntervalId", "type", "showStaticCelebration", "baseParticles", "durationMultiplier", "exactDuration", "exactEnd", "exactFrame", "recordDuration", "recordEnd", "recordFrame", "winnerDuration", "winnerEnd", "winnerFrame", "perfectDuration", "perfectEnd", "perfectFrame", "existingIcon", "setupRevealControls", "revealViewEl", "initAll", "deviceTier", "i18nAvailable", "storedLang", "dashboardHintEl", "registration", "error"]
}

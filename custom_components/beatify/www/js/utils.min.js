(()=>{var S=(w,d,f)=>new Promise((g,s)=>{var v=e=>{try{u(f.next(e))}catch(n){s(n)}},y=e=>{try{u(f.throw(e))}catch(n){s(n)}},u=e=>e.done?g(e.value):Promise.resolve(e.value).then(v,y);u((f=f.apply(w,d)).next())});window.BeatifyUtils=function(){"use strict";function w(e,n){return S(this,null,function*(){e=e||3e3,n=n||50;for(var r=Date.now();typeof BeatifyI18n=="undefined";){if(Date.now()-r>e)return!1;yield new Promise(function(o){setTimeout(o,n)})}return!0})}function d(e,n){var r=null,o=null;if(typeof n=="string"?o=n:n&&typeof n=="object"&&(r=n),typeof BeatifyI18n!="undefined"&&BeatifyI18n.t){var i=BeatifyI18n.t(e,r);return i===e&&o?o:i||o||e}if(o)return o;var t=e.split(".").pop().replace(/([A-Z])/g," $1").replace(/^./,function(c){return c.toUpperCase()}).trim();return r&&Object.keys(r).forEach(function(c){t=t.replace(new RegExp("\\{"+c+"\\}","g"),r[c])}),t}function f(e,n){e.forEach(function(o){o&&o.classList.add("hidden")});var r=document.getElementById(n);r&&r.classList.remove("hidden")}function g(e,n){if(!e)return null;var r=typeof BeatifyI18n!="undefined"?BeatifyI18n.getLanguage():"en";if(r&&r!=="en"){var o=n+"_"+r;if(e[o])return e[o]}return e[n]||null}function s(e){if(e==null)return"";var n=document.createElement("div");return n.textContent=String(e),n.innerHTML}function v(e){e=e||{};var n=e.path||"/beatify/ws",r=e.maxReconnectAttempts||20,o=e.maxReconnectDelay||3e4,i=e.logPrefix||"WebSocket",t=null,c=0,m=!1;function p(){return Math.min(1e3*Math.pow(2,c),o)}function h(){var l=window.location.protocol==="https:"?"wss:":"ws:",b=l+"//"+window.location.host+n;t=new WebSocket(b),t.onopen=function(){console.log("["+i+"] Connected"),c=0,e.onOpen&&e.onOpen(t)},t.onmessage=function(a){try{var P=JSON.parse(a.data);e.onMessage&&e.onMessage(P,t)}catch(E){console.error("["+i+"] Failed to parse message:",E)}},t.onclose=function(){if(console.log("["+i+"] Disconnected"),!m)if(c<r){c++;var a=p();console.log("["+i+"] Reconnecting in "+a+"ms (attempt "+c+")"),setTimeout(h,a)}else console.log("["+i+"] Max reconnect attempts reached"),e.onClose&&e.onClose()},t.onerror=function(a){console.error("["+i+"] Error:",a),e.onError&&e.onError(a)}}return h(),{send:function(l){return t&&t.readyState===WebSocket.OPEN?(t.send(typeof l=="string"?l:JSON.stringify(l)),!0):!1},close:function(){m=!0,t&&t.close()},getSocket:function(){return t},isConnected:function(){return t&&t.readyState===WebSocket.OPEN},resetReconnect:function(){c=0}}}function y(e){var n=new URLSearchParams(window.location.search);return n.get(e)}function u(e){e=e||"/beatify/ws";var n=window.location.protocol==="https:"?"wss:":"ws:";return n+"//"+window.location.host+e}return{waitForI18n:w,t:d,showView:f,getLocalizedSongField:g,escapeHtml:s,createWebSocket:v,buildWebSocketUrl:u,getQueryParam:y}}();})();
//# sourceMappingURL=utils.min.js.map

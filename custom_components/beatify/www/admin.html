<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title data-i18n="admin.title">Beatify Admin</title>
    <!-- Preconnect for faster font loading (Story 9.8) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;900&display=swap" rel="stylesheet">
    <!-- Story 18.4: Use minified CSS in production -->
    <link rel="stylesheet" href="/beatify/static/css/styles.min.css?v=1.7.0" onerror="this.onerror=null;this.href='/beatify/static/css/styles.css?v=1.7.0'">
</head>
<body class="theme-dark">
    <header class="admin-header">
        <h1 class="wordmark"><span class="wordmark-beat">Beat</span><span class="wordmark-gradient">ify</span></h1>
        <!-- Analytics Link (Story 19.2, updated 19.13) -->
        <a href="/beatify/analytics" class="analytics-icon-link" id="analytics-link" aria-label="Analytics Dashboard">
            <span aria-hidden="true">üìä</span>
        </a>
    </header>

    <main class="admin-content">
        <!-- Media Player Section - Collapsible with last-used memory -->
        <section id="media-players" class="section-collapsible" aria-labelledby="media-players-heading">
            <button type="button" class="section-header-collapsible" id="media-players-toggle" aria-expanded="true" aria-controls="media-players-content">
                <span class="section-icon" aria-hidden="true">üîä</span>
                <span data-i18n="admin.mediaPlayers">Media Players</span>
                <span class="section-summary" id="media-player-summary">Select...</span>
                <span class="section-toggle" aria-hidden="true">‚ñº</span>
            </button>
            <div class="section-content" id="media-players-content">
                <div id="media-players-list" data-i18n="common.loading">Loading...</div>
            </div>
        </section>

        <!-- Playlists Section - Always expanded -->
        <section id="playlists" class="card-section">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">üéµ</span><span data-i18n="admin.playlists">Playlists</span></h2>
            <div id="playlists-list" data-i18n="common.loading">Loading...</div>
            <div id="playlist-summary" class="selection-summary hidden">
                <span data-i18n="admin.selected">Selected:</span> <span id="selected-count">0</span> <span data-i18n="admin.playlistsLabel">playlists,</span>
                <span id="total-songs">0</span> <span data-i18n="admin.songsLabel">songs</span>
            </div>
        </section>

        <!-- Game Settings Section - Collapsible with all settings -->
        <section id="game-settings" class="section-collapsible collapsed" aria-labelledby="game-settings-heading">
            <button type="button" class="section-header-collapsible" id="game-settings-toggle" aria-expanded="false" aria-controls="game-settings-content">
                <span class="section-icon" aria-hidden="true">‚öôÔ∏è</span>
                <span data-i18n="admin.gameSettings">Game Settings</span>
                <span class="section-summary" id="game-settings-summary">Normal ‚Ä¢ 45s ‚Ä¢ EN</span>
                <span class="section-toggle" aria-hidden="true">‚ñº</span>
            </button>
            <div class="section-content" id="game-settings-content">
                <!-- Language - Compact chips -->
                <div class="setting-row">
                    <span class="setting-label">
                        <span class="setting-icon" aria-hidden="true">üåê</span>
                        <span data-i18n="admin.language">Language</span>
                    </span>
                    <div class="chip-group" role="group" aria-label="Game language">
                        <button type="button" id="lang-en" class="chip chip--active" data-lang="en">EN</button>
                        <button type="button" id="lang-de" class="chip" data-lang="de">DE</button>
                        <button type="button" id="lang-es" class="chip" data-lang="es">ES</button>
                    </div>
                </div>

                <!-- Timer - Compact chips -->
                <div class="setting-row">
                    <span class="setting-label">
                        <span class="setting-icon" aria-hidden="true">‚è±Ô∏è</span>
                        <span data-i18n="admin.timer">Timer</span>
                    </span>
                    <div class="chip-group" role="group" aria-label="Round timer">
                        <button type="button" id="timer-quick" class="chip" data-duration="30">30s</button>
                        <button type="button" id="timer-normal" class="chip chip--active" data-duration="45">45s</button>
                        <button type="button" id="timer-relaxed" class="chip" data-duration="60">60s</button>
                    </div>
                </div>

                <!-- Difficulty - Compact chips -->
                <div class="setting-row">
                    <span class="setting-label">
                        <span class="setting-icon" aria-hidden="true">üéØ</span>
                        <span data-i18n="admin.difficulty">Difficulty</span>
                    </span>
                    <div class="chip-group" role="group" aria-label="Difficulty">
                        <button type="button" class="chip" data-difficulty="easy" data-i18n="admin.easy">Easy</button>
                        <button type="button" class="chip chip--active" data-difficulty="normal" data-i18n="admin.normal">Normal</button>
                        <button type="button" class="chip" data-difficulty="hard" data-i18n="admin.hard">Hard</button>
                    </div>
                </div>

                <!-- Artist Challenge - Inline toggle -->
                <div class="setting-row">
                    <span class="setting-label">
                        <span class="setting-icon" aria-hidden="true">üé§</span>
                        <span data-i18n="admin.artistChallenge">Artist Challenge</span>
                    </span>
                    <label class="toggle-compact">
                        <input type="checkbox" id="artist-challenge-toggle" checked>
                        <span class="toggle-switch-compact"></span>
                    </label>
                </div>

                <!-- Music Service (Provider) - Dynamic based on speaker -->
                <div class="setting-row">
                    <span class="setting-label">
                        <span class="setting-icon" aria-hidden="true">üéµ</span>
                        <span data-i18n="admin.musicService">Music Service</span>
                    </span>
                    <div class="chip-group" role="group" aria-label="Music service">
                        <button type="button" class="chip chip--active" data-provider="spotify">Spotify</button>
                        <button type="button" class="chip" data-provider="apple_music">Apple Music</button>
                    </div>
                </div>
                <p id="provider-hint" class="hint-text hidden"></p>
                <div id="provider-warning" class="hidden"></div>
            </div>
        </section>

        <!-- Validation messages and Start button -->
        <div class="admin-actions">
            <p id="media-player-validation-msg" class="status-error hidden" data-i18n="admin.selectMediaPlayerHint">Select a media player</p>
            <p id="playlist-validation-msg" class="status-error hidden" data-i18n="admin.selectPlaylistHint">Select at least one playlist</p>
            <button id="start-game" class="btn btn-primary btn-large btn-full-width hidden" disabled data-i18n="admin.startGame">Start Game</button>
        </div>

        <!-- Lobby view (Story 2.3, mobile-optimized compact layout) -->
        <div id="lobby-section" class="lobby-view-wrapper hidden">
            <div class="lobby-container lobby-container--compact">
                <!-- Header with inline stat badges -->
                <div class="lobby-header-compact">
                    <h2 class="section-header section-header--inline">
                        <span class="section-icon" aria-hidden="true">üéÆ</span>
                        <span data-i18n="lobby.gameLobby">Game Lobby</span>
                    </h2>
                    <div class="stat-badge-bar" aria-live="polite">
                        <span class="stat-badge">
                            <span class="stat-badge-icon" aria-hidden="true">üë•</span>
                            <span id="lobby-player-count" class="stat-badge-value">0</span>
                        </span>
                        <!-- Difficulty Badge -->
                        <span id="lobby-difficulty-badge" class="stat-badge stat-badge--difficulty"></span>
                    </div>
                </div>

                <!-- Invite Friends Section - Expanded by default for admin -->
                <section class="section-collapsible" id="qr-section">
                    <button type="button" class="section-header-collapsible" aria-expanded="true" aria-controls="qr-content">
                        <span class="section-icon" aria-hidden="true">üì≤</span>
                        <span data-i18n="lobby.inviteFriends">Invite Friends</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content" id="qr-content">
                        <div class="qr-section qr-section--compact">
                            <div class="qr-container" id="admin-qr-container" role="button" tabindex="0"
                                 aria-label="Tap to enlarge QR code">
                                <div id="qr-code"></div>
                            </div>
                            <p id="join-url" class="qr-url-display qr-url-display--compact"></p>
                            <!-- Inline dashboard link -->
                            <a href="#" id="admin-dashboard-url" class="dashboard-link" target="_blank">
                                <span aria-hidden="true">üì∫</span>
                                <span data-i18n="dashboard.castToTv">Cast to TV</span>
                                <span class="dashboard-link-arrow" aria-hidden="true">‚Üí</span>
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Players Section - Collapsible -->
                <section class="section-collapsible" id="admin-players-section">
                    <button type="button" class="section-header-collapsible" aria-expanded="true" aria-controls="admin-players-content">
                        <span class="section-icon" aria-hidden="true">üë•</span>
                        <span data-i18n="lobby.playersInLobby">Players in Lobby</span>
                        <span class="section-summary" id="admin-players-summary">0</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content" id="admin-players-content">
                        <div id="lobby-players" class="player-cards-grid" aria-live="polite" aria-label="Player list">
                            <!-- Rendered dynamically by renderLobbyPlayers() -->
                        </div>
                        <p id="lobby-players-empty" class="empty-state-inline">
                            <span aria-hidden="true">üë•</span>
                            <span data-i18n="lobby.waitingForPlayers">Waiting for players to join...</span>
                        </p>
                    </div>
                </section>

                <!-- Sticky Lobby Actions -->
                <div class="lobby-actions lobby-actions--sticky">
                    <button id="participate-btn" class="btn btn-primary btn-large btn-full-width">
                        <span class="btn-icon" aria-hidden="true">üéÆ</span>
                        <span data-i18n="admin.joinAsPlayer">Join as Player</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Existing game view (Story 2.3) -->
        <section id="existing-game-section" class="card-section hidden">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">‚ñ∂Ô∏è</span><span data-i18n="admin.gameInProgress">Game In Progress</span></h2>
            <div class="game-info">
                <p><strong data-i18n="admin.gameId">Game ID:</strong> <span id="existing-game-id"></span></p>
                <p><strong data-i18n="admin.phase">Phase:</strong> <span id="existing-game-phase"></span></p>
                <p><strong data-i18n="admin.players">Players:</strong> <span id="existing-game-players"></span></p>
            </div>
            <div class="game-controls-bar">
                <button id="rejoin-game" class="btn btn-primary" data-i18n="admin.rejoinGame">Rejoin Game</button>
                <button id="end-game-existing" class="btn btn-danger" data-i18n="admin.endGame">End Game</button>
            </div>
        </section>
    </main>

    <!-- Admin join modal -->
    <div id="admin-join-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 data-i18n="admin.joinTheGame">Join the Game</h2>
            <p data-i18n="admin.enterDisplayName">Enter your display name to join as a player with admin controls.</p>
            <div class="form-group">
                <input type="text" id="admin-name-input" class="name-input"
                       data-i18n-placeholder="join.namePlaceholder"
                       placeholder="Your name" maxlength="20"
                       autocomplete="off" autocapitalize="words">
                <p id="admin-name-error" class="validation-msg hidden"></p>
            </div>
            <div class="modal-actions">
                <button id="admin-join-btn" class="btn btn-primary" disabled data-i18n="join.joinButton">Join</button>
                <button id="admin-cancel-btn" class="btn btn-secondary" data-i18n="common.cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- End Game confirmation modal (Story 9.10) -->
    <div id="end-game-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="end-game-modal-title">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="end-game-modal-title" data-i18n="admin.endGameConfirm">End Game?</h2>
            <p data-i18n="admin.endGameWarning">All players will be disconnected.</p>
            <div class="modal-actions">
                <button id="end-game-confirm-btn" class="btn btn-primary" data-i18n="admin.endGame">End Game</button>
                <button id="end-game-cancel-btn" class="btn btn-secondary" data-i18n="common.cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- QR Modal (tap to enlarge) -->
    <div id="qr-modal" class="qr-modal hidden" role="dialog" aria-modal="true"
         aria-labelledby="qr-modal-title">
        <div class="qr-modal-backdrop"></div>
        <div class="qr-modal-content">
            <h2 id="qr-modal-title" class="sr-only" data-i18n="lobby.joinGameQr">Join Game QR Code</h2>
            <div id="qr-modal-code" class="qr-modal-code">
                <!-- Large QR code rendered here -->
            </div>
            <p class="qr-modal-label" data-i18n="lobby.scanToJoin">Scan to join the game</p>
            <button id="qr-modal-close" class="btn btn-secondary qr-modal-close"
                    aria-label="Close QR code" data-i18n="common.close">Close</button>
        </div>
    </div>

    <footer>
        <p>Beatify <span id="app-version">v...</span></p>
    </footer>

    <script src="/beatify/static/js/vendor/qrcode.min.js"></script>
    <!-- Story 18.4: Use minified JS in production with fallback to source -->
    <!-- Version query strings prevent browser caching issues -->
    <script src="/beatify/static/js/i18n.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/i18n.js?v=1.7.0';document.head.appendChild(s);"></script>
    <script src="/beatify/static/js/utils.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/utils.js?v=1.7.0';document.head.appendChild(s);"></script>
    <script src="/beatify/static/js/admin.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/admin.js?v=1.7.0';document.head.appendChild(s);"></script>
</body>
</html>

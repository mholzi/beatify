<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title data-i18n="admin.title">Beatify Admin</title>
    <!-- Preconnect for faster font loading (Story 9.8) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;900&display=swap" rel="stylesheet">
    <!-- Story 18.4: Use minified CSS in production -->
    <link rel="stylesheet" href="/beatify/static/css/styles.min.css?v=1.7.0" onerror="this.onerror=null;this.href='/beatify/static/css/styles.css?v=1.7.0'">
</head>
<body class="theme-dark">
    <header class="admin-header">
        <h1 class="wordmark"><span class="wordmark-beat">Beat</span><span class="wordmark-gradient">ify</span></h1>
        <!-- Analytics Link (Story 19.2, updated 19.13) -->
        <a href="/beatify/analytics" class="analytics-icon-link" id="analytics-link" aria-label="Analytics Dashboard">
            <span aria-hidden="true">ğŸ“Š</span>
        </a>
    </header>

    <main class="admin-content">
        <section id="media-players" class="card-section">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">ğŸ”Š</span><span data-i18n="admin.mediaPlayers">Media Players</span></h2>
            <div id="media-players-list" data-i18n="common.loading">Loading...</div>
            <p id="media-player-validation-msg" class="status-error hidden" style="margin-top: 12px;" data-i18n="admin.selectMediaPlayerHint">Select a media player</p>
        </section>

        <section id="playlists" class="card-section">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">ğŸµ</span><span data-i18n="admin.playlists">Playlists</span></h2>
            <div id="playlists-list" data-i18n="common.loading">Loading...</div>
            <div id="playlist-summary" class="selection-summary hidden">
                <span data-i18n="admin.selected">Selected:</span> <span id="selected-count">0</span> <span data-i18n="admin.playlistsLabel">playlists,</span>
                <span id="total-songs">0</span> <span data-i18n="admin.songsLabel">songs</span>
            </div>
        </section>

        <!-- Provider Selector (Story 17.2) -->
        <section id="provider-section" class="card-section">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">ğŸ§</span><span data-i18n="admin.selectProvider">Music Provider</span></h2>
            <div class="provider-selector" role="group" aria-label="Music provider selection">
                <button type="button" class="provider-btn provider-btn--active" data-provider="spotify" tabindex="0">
                    <span class="provider-icon" aria-hidden="true">ğŸµ</span>
                    <span class="provider-label" data-i18n="admin.providerSpotify">Spotify</span>
                </button>
            </div>
        </section>

        <!-- Language Selector (Story 12.4) -->
        <section id="language-section" class="card-section">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">ğŸŒ</span><span data-i18n="admin.selectLanguage">Game Language</span></h2>
            <div class="language-selector">
                <button type="button" id="lang-en" class="lang-btn lang-btn--active" data-lang="en">
                    <span class="lang-flag">ğŸ‡¬ğŸ‡§</span>
                    <span class="lang-name">English</span>
                </button>
                <button type="button" id="lang-de" class="lang-btn" data-lang="de">
                    <span class="lang-flag">ğŸ‡©ğŸ‡ª</span>
                    <span class="lang-name">Deutsch</span>
                </button>
                <button type="button" id="lang-es" class="lang-btn" data-lang="es">
                    <span class="lang-flag">ğŸ‡ªğŸ‡¸</span>
                    <span class="lang-name">EspaÃ±ol</span>
                </button>
            </div>
        </section>

        <!-- Timer Selector (Story 13.1) -->
        <section id="timer-section" class="card-section">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">â±ï¸</span><span data-i18n="admin.selectTimer">Round Timer</span></h2>
            <div class="timer-selector" role="group" aria-label="Round timer duration">
                <button type="button" id="timer-quick" class="timer-btn" data-duration="30" tabindex="0">
                    <span class="timer-icon" aria-hidden="true">âš¡</span>
                    <span class="timer-label" data-i18n="admin.timerQuick">Quick</span>
                    <span class="timer-value">30s</span>
                </button>
                <button type="button" id="timer-normal" class="timer-btn timer-btn--active" data-duration="45" tabindex="0">
                    <span class="timer-icon" aria-hidden="true">â±ï¸</span>
                    <span class="timer-label" data-i18n="admin.timerNormal">Normal</span>
                    <span class="timer-value">45s</span>
                </button>
                <button type="button" id="timer-relaxed" class="timer-btn" data-duration="60" tabindex="0">
                    <span class="timer-icon" aria-hidden="true">ğŸ§˜</span>
                    <span class="timer-label" data-i18n="admin.timerRelaxed">Relaxed</span>
                    <span class="timer-value">60s</span>
                </button>
            </div>
        </section>

        <!-- Difficulty Selector (Story 14.1) -->
        <section id="difficulty-section" class="card-section">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">ğŸ¯</span><span data-i18n="admin.selectDifficulty">Difficulty</span></h2>
            <div class="difficulty-selector" role="group" aria-label="Scoring difficulty">
                <button type="button" class="difficulty-btn" data-difficulty="easy" tabindex="0">
                    <span class="difficulty-icon" aria-hidden="true">ğŸ˜Š</span>
                    <span class="difficulty-label" data-i18n="admin.difficultyEasy">Easy</span>
                </button>
                <button type="button" class="difficulty-btn difficulty-btn--active" data-difficulty="normal" tabindex="0">
                    <span class="difficulty-icon" aria-hidden="true">ğŸ¯</span>
                    <span class="difficulty-label" data-i18n="admin.difficultyNormal">Normal</span>
                </button>
                <button type="button" class="difficulty-btn" data-difficulty="hard" tabindex="0">
                    <span class="difficulty-icon" aria-hidden="true">ğŸ”¥</span>
                    <span class="difficulty-label" data-i18n="admin.difficultyHard">Hard</span>
                </button>
            </div>
            <p class="difficulty-description" id="difficulty-description" data-i18n="admin.difficultyNormalDesc">
                Guess within 3 years for points. Exact year = 10 points.
            </p>
        </section>

        <!-- Artist Challenge Toggle (Story 20.7) -->
        <section id="artist-challenge-section" class="card-section">
            <h2 class="section-header">
                <span class="section-icon" aria-hidden="true">ğŸ¤</span>
                <span data-i18n="admin.artistChallenge">Artist Challenge</span>
            </h2>
            <label class="toggle-option">
                <input type="checkbox" id="artist-challenge-toggle" checked>
                <span class="toggle-switch"></span>
                <span class="toggle-label" data-i18n="admin.enableArtistChallenge">Enable Artist Challenge</span>
            </label>
            <p class="option-description" data-i18n="admin.artistChallengeDesc">
                First correct guess: +10 pts
            </p>
        </section>

        <!-- Start Game button (Story 9.10: moved from Game Controls card) -->
        <p id="playlist-validation-msg" class="status-error hidden" style="margin: var(--space-md) 0;" data-i18n="admin.selectPlaylistHint">Select at least one playlist</p>
        <button id="start-game" class="btn btn-primary btn-large btn-full-width hidden" disabled data-i18n="admin.startGame">Start Game</button>

        <!-- Lobby view (Story 2.3, mobile-optimized compact layout) -->
        <section id="lobby-section" class="card-section hidden">
            <!-- Header with inline stat badges -->
            <div class="lobby-header-compact">
                <h2 class="section-header section-header--inline">
                    <span class="section-icon" aria-hidden="true">ğŸ®</span>
                    <span data-i18n="lobby.gameLobby">Game Lobby</span>
                </h2>
                <div class="stat-badge-bar" aria-live="polite">
                    <span class="stat-badge">
                        <span class="stat-badge-icon" aria-hidden="true">ğŸ‘¥</span>
                        <span id="lobby-player-count" class="stat-badge-value">0</span>
                    </span>
                    <span class="stat-badge stat-badge--status">
                        <span class="stat-badge-icon" aria-hidden="true">â³</span>
                        <span id="lobby-status-value" class="stat-badge-value">Waiting</span>
                    </span>
                </div>
            </div>

            <!-- Compact QR Section -->
            <div class="qr-section qr-section--compact qr-print-area">
                <div class="qr-container">
                    <div id="qr-code" aria-label="QR code to join Beatify game"></div>
                </div>
                <p class="qr-hint" data-i18n="admin.scanToPlay">Scan to Play Beatify!</p>
                <p id="join-url" class="qr-url-display qr-url-display--compact"></p>
                <!-- Inline dashboard link -->
                <a href="#" id="admin-dashboard-url" class="dashboard-link no-print" target="_blank">
                    <span aria-hidden="true">ğŸ“º</span>
                    <span data-i18n="dashboard.castToTv">Cast to TV</span>
                    <span class="dashboard-link-arrow" aria-hidden="true">â†’</span>
                </a>
            </div>

            <!-- Compact Player List Section -->
            <div class="player-list-section player-list-section--compact">
                <h3 class="section-subheader section-subheader--compact">
                    <span class="section-icon" aria-hidden="true">ğŸ¯</span>
                    <span data-i18n="lobby.playersInLobby">Players in Lobby</span>
                </h3>
                <div id="lobby-players" class="player-cards-grid" aria-live="polite" aria-label="Player list">
                    <!-- Rendered dynamically by renderLobbyPlayers() -->
                </div>
                <p id="lobby-players-empty" class="empty-state-inline">
                    <span aria-hidden="true">ğŸ‘¥</span>
                    <span data-i18n="lobby.waitingForPlayers">Waiting for players to join...</span>
                </p>
            </div>

            <!-- Sticky Lobby Actions -->
            <div class="lobby-actions lobby-actions--sticky no-print">
                <button id="participate-btn" class="btn btn-primary btn-large btn-full-width">
                    <span class="btn-icon" aria-hidden="true">ğŸ®</span>
                    <span data-i18n="admin.joinAsPlayer">Join as Player</span>
                </button>
            </div>
        </section>

        <!-- Existing game view (Story 2.3) -->
        <section id="existing-game-section" class="card-section hidden">
            <h2 class="section-header"><span class="section-icon" aria-hidden="true">â–¶ï¸</span><span data-i18n="admin.gameInProgress">Game In Progress</span></h2>
            <div class="game-info">
                <p><strong data-i18n="admin.gameId">Game ID:</strong> <span id="existing-game-id"></span></p>
                <p><strong data-i18n="admin.phase">Phase:</strong> <span id="existing-game-phase"></span></p>
                <p><strong data-i18n="admin.players">Players:</strong> <span id="existing-game-players"></span></p>
            </div>
            <div class="game-controls-bar">
                <button id="rejoin-game" class="btn btn-primary" data-i18n="admin.rejoinGame">Rejoin Game</button>
            </div>
        </section>
    </main>

    <!-- Admin join modal -->
    <div id="admin-join-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 data-i18n="admin.joinTheGame">Join the Game</h2>
            <p data-i18n="admin.enterDisplayName">Enter your display name to join as a player with admin controls.</p>
            <div class="form-group">
                <input type="text" id="admin-name-input" class="name-input"
                       data-i18n-placeholder="join.namePlaceholder"
                       placeholder="Your name" maxlength="20"
                       autocomplete="off" autocapitalize="words">
                <p id="admin-name-error" class="validation-msg hidden"></p>
            </div>
            <div class="modal-actions">
                <button id="admin-join-btn" class="btn btn-primary" disabled data-i18n="join.joinButton">Join</button>
                <button id="admin-cancel-btn" class="btn btn-secondary" data-i18n="common.cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- End Game confirmation modal (Story 9.10) -->
    <div id="end-game-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="end-game-modal-title">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="end-game-modal-title" data-i18n="admin.endGameConfirm">End Game?</h2>
            <p data-i18n="admin.endGameWarning">All players will be disconnected.</p>
            <div class="modal-actions">
                <button id="end-game-confirm-btn" class="btn btn-primary" data-i18n="admin.endGame">End Game</button>
                <button id="end-game-cancel-btn" class="btn btn-secondary" data-i18n="common.cancel">Cancel</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Beatify <span id="app-version">v...</span></p>
    </footer>

    <script src="/beatify/static/js/vendor/qrcode.min.js"></script>
    <!-- Story 18.4: Use minified JS in production with fallback to source -->
    <!-- Version query strings prevent browser caching issues -->
    <script src="/beatify/static/js/i18n.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/i18n.js?v=1.7.0';document.head.appendChild(s);"></script>
    <script src="/beatify/static/js/utils.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/utils.js?v=1.7.0';document.head.appendChild(s);"></script>
    <script src="/beatify/static/js/admin.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/admin.js?v=1.7.0';document.head.appendChild(s);"></script>
</body>
</html>

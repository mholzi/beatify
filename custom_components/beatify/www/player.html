<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title data-i18n="join.title">Beatify - Join Game</title>
    <!-- Preconnect for faster font loading (Story 9.8) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@700;900&display=swap" rel="stylesheet">
    <!-- Story 18.4: Use minified CSS in production -->
    <link rel="stylesheet" href="/beatify/static/css/styles.min.css?v=1.7.0" onerror="this.onerror=null;this.href='/beatify/static/css/styles.css?v=1.7.0'">
    <!-- Confetti library for celebrations (Story 14.5) -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body class="theme-dark">
    <header class="player-header">
        <h1 class="wordmark"><span class="wordmark-beat">Beat</span><span class="wordmark-gradient">ify</span></h1>
    </header>

    <main class="player-container">
        <!-- Loading state -->
        <div id="loading-view" class="view">
            <div class="loading-spinner"></div>
            <p data-i18n="common.connecting">Connecting to game...</p>
        </div>

        <!-- Error: Game not found -->
        <div id="not-found-view" class="view hidden">
            <div class="error-icon">üéµ</div>
            <h1 data-i18n="errors.gameNotFound">Game Not Found</h1>
            <p data-i18n="errors.gameNotFoundHint">This game doesn't exist or the link is incorrect.</p>
            <p class="hint" data-i18n="errors.askHostQr">Ask the host for a new QR code.</p>
            <button id="refresh-btn" class="btn btn-primary btn-glow" data-i18n="common.retry">Try Again</button>
        </div>

        <!-- Error: Game ended -->
        <div id="ended-view" class="view hidden">
            <div class="error-icon">üéâ</div>
            <h1 data-i18n="errors.gameHasEnded">Game Has Ended</h1>
            <p data-i18n="errors.thanksForPlaying">Thanks for playing Beatify!</p>
            <p class="hint" data-i18n="errors.askHostNewGame">Ask the host to start a new game.</p>
        </div>

        <!-- Error: Game in progress (can't join mid-reveal) -->
        <div id="in-progress-view" class="view hidden">
            <div class="error-icon">‚è≥</div>
            <h1 data-i18n="errors.gameInProgress">Game In Progress</h1>
            <p data-i18n="errors.gameInProgressHint">The game is currently in a round. Try again in a moment.</p>
            <button id="retry-btn" class="btn btn-primary btn-glow" data-i18n="common.retry">Try Again</button>
        </div>

        <!-- Join form -->
        <div id="join-view" class="view hidden">
            <div class="join-form">
                <p data-i18n="join.enterName">Enter your name to play</p>
                <div class="form-group">
                    <input type="text" id="name-input" class="name-input"
                           data-i18n-placeholder="join.namePlaceholder"
                           placeholder="Your name" maxlength="20"
                           autocomplete="off" autocapitalize="words"
                           aria-describedby="name-validation-msg">
                    <p id="name-validation-msg" class="validation-msg hidden"></p>
                </div>
                <button id="join-btn" class="btn btn-primary btn-glow join-btn" disabled data-i18n="join.joinButton">Join Game</button>
            </div>
        </div>

        <!-- Lobby view - Redesigned to match admin lobby -->
        <div id="lobby-view" class="view hidden">
            <div class="lobby-container lobby-container--compact">
                <!-- Compact Header with Stat Badges -->
                <div class="lobby-header-compact">
                    <h2 class="section-header section-header--inline">
                        <span class="section-icon" aria-hidden="true">üéÆ</span>
                        <span data-i18n="lobby.gameLobby">Game Lobby</span>
                    </h2>
                    <div class="stat-badge-bar" aria-live="polite">
                        <span class="stat-badge">
                            <span class="stat-badge-icon" aria-hidden="true">üë•</span>
                            <span id="player-count-badge" class="stat-badge-value">0</span>
                        </span>
                        <!-- Difficulty Badge (Story 14.1) -->
                        <span id="lobby-difficulty-badge" class="stat-badge stat-badge--difficulty"></span>
                    </div>
                </div>

                <!-- How to Play Section - Collapsible -->
                <section class="section-collapsible collapsed" id="how-to-play-section">
                    <button type="button" class="section-header-collapsible" aria-expanded="false" aria-controls="how-to-play-content">
                        <span class="section-icon" aria-hidden="true">üéµ</span>
                        <span data-i18n="lobby.howToPlay">How to Play</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content" id="how-to-play-content">
                        <ol class="how-to-play-steps-compact">
                            <li data-i18n="lobby.howToPlayStep1">Listen to the song that plays</li>
                            <li data-i18n="lobby.howToPlayStep2">Guess what year it was released</li>
                            <li data-i18n="lobby.howToPlayStep3">Submit before the timer runs out</li>
                            <li data-i18n="lobby.howToPlayStep4">Closer guesses earn more points!</li>
                        </ol>
                    </div>
                </section>

                <!-- Players Section - Collapsible -->
                <section class="section-collapsible" id="players-section">
                    <button type="button" class="section-header-collapsible" aria-expanded="true" aria-controls="players-content">
                        <span class="section-icon" aria-hidden="true">üë•</span>
                        <span data-i18n="lobby.playersInLobby">Players in Lobby</span>
                        <span class="section-summary" id="players-summary">0</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content" id="players-content">
                        <div id="player-list" class="player-cards-grid" aria-live="polite">
                            <!-- Player cards rendered by JS -->
                        </div>
                        <p id="players-empty" class="empty-state-inline hidden">
                            <span aria-hidden="true">üë•</span>
                            <span data-i18n="lobby.waitingForPlayers">Waiting for players to join...</span>
                        </p>
                    </div>
                </section>

                <!-- Invite Friends Section - Collapsible with QR and Dashboard -->
                <section class="section-collapsible collapsed" id="invite-section">
                    <button type="button" class="section-header-collapsible" aria-expanded="false" aria-controls="invite-content">
                        <span class="section-icon" aria-hidden="true">üì≤</span>
                        <span data-i18n="lobby.inviteFriends">Invite Friends</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content" id="invite-content">
                        <div class="qr-section qr-section--compact">
                            <div class="qr-container" id="player-qr-code" role="button" tabindex="0"
                                 aria-label="Tap to enlarge QR code">
                                <!-- QR code rendered here by JS -->
                            </div>
                            <p class="qr-hint" data-i18n="lobby.scanQrHint">Share the QR code or URL above</p>
                            <!-- Inline dashboard link -->
                            <a href="#" id="player-dashboard-url" class="dashboard-link" target="_blank">
                                <span aria-hidden="true">üì∫</span>
                                <span data-i18n="dashboard.castToTv">Cast to TV</span>
                                <span class="dashboard-link-arrow" aria-hidden="true">‚Üí</span>
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Lobby Status (for non-admin players) -->
                <div id="lobby-status" class="lobby-status-compact hidden">
                    <p data-i18n="lobby.waitingForHost">Waiting for host to start the game...</p>
                </div>

                <!-- Sticky Lobby Actions (Admin only) -->
                <div id="admin-controls" class="lobby-actions lobby-actions--sticky hidden">
                    <button id="start-game-btn" class="btn btn-primary btn-large btn-full-width">
                        <span class="btn-icon" aria-hidden="true">üéâ</span>
                        <span data-i18n="lobby.startGame">Start Game</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Game view (Epic 4) -->
        <div id="game-view" class="view hidden">
            <div class="game-container">
                <!-- Game Header with Round Info -->
                <div class="game-header-compact">
                    <div class="game-header-left">
                        <span class="section-icon" aria-hidden="true">üéÆ</span>
                        <span id="round-indicator" class="round-indicator-text">
                            <span data-i18n="game.roundLabel">Round</span>
                            <span id="current-round">1</span>
                            <span data-i18n="game.ofLabel">of</span>
                            <span id="total-rounds">10</span>
                        </span>
                    </div>
                    <div class="stat-badge-bar">
                        <!-- Difficulty Badge -->
                        <span id="game-difficulty-badge" class="stat-badge stat-badge--difficulty"></span>
                        <!-- Steal Available Indicator (Story 15.3) -->
                        <span id="steal-indicator" class="stat-badge stat-badge--steal hidden">
                            <span class="stat-badge-icon" aria-hidden="true">ü•∑</span>
                        </span>
                    </div>
                </div>
                <!-- Last Round Banner -->
                <div id="last-round-banner" class="last-round-banner hidden" data-i18n="game.finalRound">
                    Final Round!
                </div>
                <!-- Intro Round Badge (Issue #23) -->
                <div id="intro-badge" class="intro-badge hidden">
                    <span class="intro-badge-icon" aria-hidden="true">‚ö°</span>
                    <span data-i18n="game.introRound">INTRO ROUND</span>
                </div>
                <!-- Intro Round Splash Overlay -->
                <div id="intro-splash" class="intro-splash hidden" aria-hidden="true">
                    <div class="intro-splash-content">
                        <span class="intro-splash-icon">‚ö°</span>
                        <span class="intro-splash-text" data-i18n="game.introRound">INTRO ROUND</span>
                        <span class="intro-splash-hint" data-i18n="game.introHint">Only 10 seconds!</span>
                    </div>
                </div>

                <!-- Album Cover -->
                <div class="album-cover-container">
                    <img id="album-cover"
                         src="/beatify/static/img/no-artwork.svg"
                         alt="Album Cover"
                         class="album-cover">
                    <div id="album-loading" class="album-loading hidden">
                        <div class="loading-spinner"></div>
                    </div>
                </div>

                <!-- Timer with ARIA support (Story 9.7) -->
                <div class="timer-container">
                    <div id="timer" class="timer" role="timer" aria-live="polite" aria-label="Time remaining: 30 seconds">30</div>
                </div>

                <!-- Submission Tracker (Story 4.4) -->
                <div id="submission-tracker" class="submission-tracker">
                    <div id="submitted-players" class="submitted-players">
                        <!-- Player indicators populated dynamically -->
                        <!-- Each player has optional badges: .player-badge--bet (üé≤) and .player-badge--steal (ü•∑) -->
                    </div>
                </div>

                <!-- Artist Challenge (Story 20.5) - Aligned with card-section pattern -->
                <section id="artist-challenge-container" class="card-section artist-challenge hidden">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üé§</span>
                        <span data-i18n="artistChallenge.whoSings">Who sings this song?</span>
                        <span class="stat-badge stat-badge--bonus">+5</span>
                    </h2>
                    <div id="artist-options" class="artist-options-grid">
                        <!-- Dynamically populated -->
                    </div>
                    <div id="artist-result" class="artist-result hidden"></div>
                </section>

                <!-- Movie Challenge (Issue #28) - Aligned with card-section pattern -->
                <section id="movie-challenge-container" class="card-section movie-challenge hidden">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üé¨</span>
                        <span data-i18n="movieChallenge.whichMovie">Which movie features this song?</span>
                        <span class="stat-badge stat-badge--bonus">+5/3/1</span>
                    </h2>
                    <div id="movie-options" class="movie-options-grid">
                        <!-- Dynamically populated -->
                    </div>
                    <div id="movie-result" class="movie-result hidden"></div>
                </section>

                <!-- Year Selector (Story 4.3) - Aligned with card-section pattern -->
                <section id="year-selector-container" class="card-section year-selector-section">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üéØ</span>
                        <span data-i18n="game.yourGuess">Your Guess</span>
                    </h2>
                    <div id="year-selector" class="year-selector">
                        <div class="year-display">
                            <span id="selected-year">1990</span>
                        </div>

                        <div class="slider-container">
                            <span class="slider-label slider-label--min">1950</span>
                            <input type="range"
                                   id="year-slider"
                                   min="1950"
                                   max="2025"
                                   value="1990"
                                   class="year-slider">
                            <span class="slider-label slider-label--max">2025</span>
                        </div>

                        <!-- Bet Toggle (Story 5.3) -->
                        <div class="bet-container">
                            <button id="bet-toggle" class="bet-toggle" type="button">
                                <span class="bet-icon">üé≤</span>
                                <span class="bet-label" data-i18n="game.bet">Double or Nothing</span>
                            </button>
                        </div>

                        <button id="submit-btn" class="submit-btn" data-i18n="game.submitGuess">
                            Submit Guess
                        </button>

                        <!-- Steal Power-up Button (Story 15.3) -->
                        <button id="steal-btn" class="steal-btn hidden" type="button">
                            <span class="steal-btn-icon">ü•∑</span>
                            <span class="steal-btn-label" data-i18n="steal.button">Steal Answer</span>
                        </button>

                        <div id="submitted-confirmation" class="submitted-confirmation hidden">
                            <span class="checkmark">‚úì</span>
                            <span data-i18n="game.submitted">Submitted!</span>
                        </div>
                    </div>
                </section>

                <!-- Leaderboard (Story 5.5) - Collapsible section pattern -->
                <section id="game-leaderboard" class="section-collapsible leaderboard-section collapsed">
                    <button type="button" class="section-header-collapsible" id="leaderboard-toggle" aria-expanded="false" aria-controls="leaderboard-content">
                        <span class="section-icon" aria-hidden="true">üèÜ</span>
                        <span data-i18n="leaderboard.title">Leaderboard</span>
                        <span class="section-summary" id="leaderboard-summary">--</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content" id="leaderboard-content">
                        <div id="leaderboard-list" class="leaderboard-list">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Reveal View (Story 4.6) -->
        <div id="reveal-view" class="view hidden">
            <div class="reveal-container reveal-container--compact">
                <!-- Compact Header Bar -->
                <div class="reveal-header-compact">
                    <div class="reveal-header-left">
                        <span class="section-icon" aria-hidden="true">üéµ</span>
                        <span class="round-indicator-text">
                            <span data-i18n="game.roundLabel">Round</span>
                            <span id="reveal-round">1</span>
                            <span data-i18n="game.ofLabel">of</span>
                            <span id="reveal-total">10</span>
                        </span>
                    </div>
                    <div class="stat-badge-bar">
                        <span id="reveal-difficulty-badge" class="stat-badge stat-badge--difficulty"></span>
                    </div>
                </div>

                <!-- Song Hero: Album + Info side by side -->
                <div class="reveal-song-hero">
                    <img id="reveal-album-cover"
                         src="/beatify/static/img/no-artwork.svg"
                         alt="Album Cover"
                         class="reveal-album-cover-compact">
                    <div class="reveal-song-info">
                        <div id="song-title" class="song-title">Unknown Song</div>
                        <div id="song-artist" class="song-artist">Unknown Artist</div>
                    </div>
                </div>

                <!-- Year Reveal with Emotion -->
                <div class="reveal-year-section">
                    <div id="reveal-emotion" class="reveal-emotion-inline hidden" aria-live="polite" aria-atomic="true">
                        <!-- Populated by JS: NAILED IT!, SO CLOSE!, Oops!, etc. -->
                    </div>
                    <div class="correct-year-label" data-i18n="reveal.theYearWas">The year was</div>
                    <div id="correct-year" class="correct-year text-glow">1984</div>
                </div>

                <!-- Confetti Canvas (Story 9.4) -->
                <canvas id="confetti-canvas" class="confetti-canvas"></canvas>

                <!-- Fun Fact Card Section (Story 14.3) -->
                <section id="fun-fact-container" class="card-section fun-fact-section hidden">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üí°</span>
                        <span data-i18n="reveal.funFact">Fun Fact</span>
                    </h2>
                    <div class="section-content-padded">
                        <div id="fun-fact" class="fun-fact-text"></div>
                        <div id="song-rich-info" class="song-rich-info">
                            <!-- Populated by JavaScript: chart info, certifications, awards -->
                        </div>
                    </div>
                </section>

                <!-- Artist Challenge Reveal - Card Section (Story 20.6) -->
                <section id="artist-reveal-section" class="card-section artist-reveal-section hidden">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üé§</span>
                        <span data-i18n="artistChallenge.theArtistWas">The artist was</span>
                    </h2>
                    <div class="section-content-padded">
                        <div id="artist-reveal-name" class="artist-reveal-name"></div>
                        <div id="artist-reveal-winner" class="artist-reveal-winner hidden"></div>
                    </div>
                </section>

                <!-- Movie Challenge Reveal (Issue #28) -->
                <section id="movie-reveal-section" class="card-section movie-reveal-section hidden">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üé¨</span>
                        <span data-i18n="movieChallenge.theMovieWas">The movie was</span>
                    </h2>
                    <div class="section-content-padded">
                        <div id="movie-reveal-name" class="movie-reveal-name"></div>
                        <div id="movie-reveal-winners" class="movie-reveal-winners hidden"></div>
                    </div>
                </section>

                <!-- Personal Result - Card Section -->
                <section id="personal-result" class="card-section personal-result-section">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üéØ</span>
                        <span data-i18n="reveal.yourResult">Your Result</span>
                    </h2>
                    <div id="result-content" class="section-content-padded">
                        <!-- Populated dynamically -->
                    </div>
                </section>

                <!-- All Guesses Card Section (Story 9.10) -->
                <section class="card-section guesses-section">
                    <h2 class="section-header">
                        <span class="section-icon" aria-hidden="true">üë•</span>
                        <span data-i18n="reveal.allGuesses">All Guesses</span>
                    </h2>
                    <div id="reveal-results-cards" class="reveal-results-grid section-content-padded">
                        <!-- Populated by JavaScript: shows all player guesses -->
                    </div>
                </section>

                <!-- Leaderboard - Expanded by default -->
                <section id="reveal-leaderboard" class="section-collapsible leaderboard-section">
                    <button type="button" class="section-header-collapsible" id="reveal-leaderboard-toggle" aria-expanded="true" aria-controls="reveal-leaderboard-content">
                        <span class="section-icon" aria-hidden="true">üèÜ</span>
                        <span data-i18n="leaderboard.standings">Standings</span>
                        <span class="section-summary" id="reveal-leaderboard-summary">--</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content" id="reveal-leaderboard-content">
                        <div id="reveal-leaderboard-list" class="leaderboard-list">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Round Analytics (Story 13.3) - Collapsible, collapsed by default -->
                <section id="round-analytics" class="section-collapsible round-analytics-section collapsed hidden">
                    <button type="button" class="section-header-collapsible" id="round-analytics-toggle" aria-expanded="false">
                        <span class="section-icon" aria-hidden="true">üìä</span>
                        <span data-i18n="analytics.title">Round Stats</span>
                        <span class="section-toggle" aria-hidden="true">‚ñº</span>
                    </button>
                    <div class="section-content">
                        <div id="round-analytics-content" class="section-content-padded">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Song difficulty rating - hidden, used for badge (Story 15.1) -->
                <div id="song-difficulty" class="hidden"></div>

                <!-- Admin Controls -->
                <div id="reveal-admin-controls" class="reveal-admin-controls hidden">
                    <div class="reveal-admin-buttons">
                        <button id="invite-players-btn" class="invite-btn" type="button"
                                aria-label="Invite players to join the game">
                            <span class="invite-btn-icon">üì≤</span>
                            <span class="invite-btn-label" data-i18n="lobby.invitePlayers">Invite Players</span>
                        </button>
                        <button id="next-round-btn" class="next-round-btn" data-i18n="admin.nextRound">
                            Next Round
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paused View (Story 7-1) -->
        <div id="paused-view" class="view hidden">
            <div class="paused-container">
                <div class="paused-icon">‚è∏Ô∏è</div>
                <h1 data-i18n="game.paused">Game Paused</h1>
                <p id="pause-message" data-i18n="game.waitingForHost">Waiting for host to reconnect...</p>
                <div class="paused-spinner">
                    <div class="spinner"></div>
                </div>
                <p class="paused-hint" data-i18n="game.pausedHint">The game will resume when the host returns</p>
            </div>
        </div>

        <!-- End View (Story 5.6) -->
        <div id="end-view" class="view hidden">
            <div class="end-container">
                <!-- Header -->
                <div class="end-header">
                    <h1 class="end-title" data-i18n="leaderboard.gameOver">Game Over!</h1>
                    <p class="end-subtitle" data-i18n="leaderboard.thanksForPlaying">Thanks for playing Beatify</p>
                </div>

                <!-- Podium for top 3 -->
                <div class="podium">
                    <div class="podium-place podium-2">
                        <div class="podium-medal">ü•à</div>
                        <div class="podium-name" id="podium-2-name">---</div>
                        <div class="podium-score" id="podium-2-score">0</div>
                        <div class="podium-stand">2</div>
                    </div>
                    <div class="podium-place podium-1">
                        <div class="podium-medal">ü•á</div>
                        <div class="podium-name" id="podium-1-name">---</div>
                        <div class="podium-score" id="podium-1-score">0</div>
                        <div class="podium-stand">1</div>
                    </div>
                    <div class="podium-place podium-3">
                        <div class="podium-medal">ü•â</div>
                        <div class="podium-name" id="podium-3-name">---</div>
                        <div class="podium-score" id="podium-3-score">0</div>
                        <div class="podium-stand">3</div>
                    </div>
                </div>

                <!-- Your result -->
                <div class="your-result">
                    <div class="your-result-header" data-i18n="reveal.yourResult">Your Result</div>
                    <div class="your-result-rank" id="your-final-rank">#?</div>
                    <div class="your-result-score" id="your-final-score">0 points</div>
                    <div class="your-result-stats">
                        <div class="stat">
                            <span class="stat-value" id="stat-best-streak">0</span>
                            <span class="stat-label" data-i18n="leaderboard.bestStreak">Best Streak</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="stat-rounds">0</span>
                            <span class="stat-label" data-i18n="leaderboard.roundsPlayed">Rounds Played</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="stat-bets">0</span>
                            <span class="stat-label" data-i18n="leaderboard.betsWon">Bets Won</span>
                        </div>
                    </div>
                </div>

                <!-- Superlatives / Fun Awards (Story 15.2) -->
                <div id="superlatives-container" class="superlatives-container hidden">
                    <!-- Rendered by JS: award cards with emoji, title, player name, value -->
                </div>

                <!-- Highlights Reel (Issue #75) -->
                <div id="highlights-container" class="highlights-container hidden">
                    <div class="highlights-header" data-i18n="highlights.highlightsTab">üé¨ Highlights</div>
                    <div id="highlights-list" class="highlights-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Shareable Result Cards (Issue #120) -->
                <div id="share-container" class="share-container hidden">
                    <div class="share-header" data-i18n="share.share_tab">üì§ Share</div>
                    <pre id="share-emoji-grid" class="emoji-grid-preview"></pre>
                    <div class="share-buttons">
                        <button id="share-copy-btn" class="share-btn" data-i18n="share.share_copy">üìã Copy Text</button>
                        <button id="share-save-btn" class="share-btn" data-i18n="share.share_save">üì∏ Save Card</button>
                    </div>
                    <div id="share-toast" class="share-toast hidden" data-i18n="share.share_copied">Copied!</div>
                </div>

                <!-- Full leaderboard -->
                <div class="final-leaderboard">
                    <div class="final-leaderboard-header" data-i18n="leaderboard.fullRankings">Full Rankings</div>
                    <div id="final-leaderboard-list" class="final-leaderboard-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Admin controls -->
                <div id="end-admin-controls" class="end-admin-controls hidden">
                    <button id="new-game-btn" class="new-game-btn" data-i18n="admin.startNewGame">
                        Start New Game
                    </button>
                </div>

                <!-- Player message -->
                <div id="end-player-message" class="end-player-message hidden">
                    <p data-i18n="leaderboard.thanksEmoji">Thanks for playing! üéâ</p>
                    <p class="end-hint" data-i18n="leaderboard.waitForHost">Wait for the host to start a new game</p>
                </div>
            </div>
        </div>

        <!-- Admin Control Bar (Story 6.1) - visible across PLAYING/REVEAL for admin -->
        <div id="admin-control-bar" class="admin-control-bar hidden">
            <!-- Volume feedback indicator (Story 6.4) -->
            <div id="volume-indicator" class="volume-indicator hidden">üîä 50%</div>
            <button id="stop-song-btn" class="control-btn" type="button">
                <span class="control-icon">‚èπÔ∏è</span>
                <span class="control-label" data-i18n="admin.stop">Stop</span>
            </button>
            <button id="volume-down-btn" class="control-btn" type="button">
                <span class="control-icon">üîâ</span>
            </button>
            <button id="volume-up-btn" class="control-btn" type="button">
                <span class="control-icon">üîä</span>
            </button>
            <button id="next-round-admin-btn" class="control-btn" type="button">
                <span class="control-icon">‚è≠Ô∏è</span>
                <span class="control-label" data-i18n="admin.next">Next</span>
            </button>
            <button id="end-game-btn" class="control-btn control-btn--danger" type="button">
                <span class="control-icon">üõë</span>
                <span class="control-label" data-i18n="admin.end">End</span>
            </button>
        </div>

        <!-- Reaction Bar (Story 18.9) - visible during REVEAL only -->
        <div id="reaction-bar" class="reaction-bar hidden">
            <div class="reaction-bar-container">
                <button class="reaction-btn" data-emoji="üî•" data-i18n-aria-label="reaction.fire" aria-label="Fire reaction">üî•</button>
                <button class="reaction-btn" data-emoji="üòÇ" data-i18n-aria-label="reaction.laugh" aria-label="Laugh reaction">üòÇ</button>
                <button class="reaction-btn" data-emoji="üò±" data-i18n-aria-label="reaction.shocked" aria-label="Shocked reaction">üò±</button>
                <button class="reaction-btn" data-emoji="üëè" data-i18n-aria-label="reaction.applause" aria-label="Applause reaction">üëè</button>
                <button class="reaction-btn" data-emoji="ü§î" data-i18n-aria-label="reaction.thinking" aria-label="Thinking reaction">ü§î</button>
            </div>
        </div>

        <!-- Floating Reactions Display (Story 18.9) -->
        <div id="reaction-container" class="reaction-container"></div>
    </main>

    <!-- Reconnecting Overlay (Story 7-3) -->
    <div id="reconnecting-overlay" class="reconnecting-overlay hidden">
        <div class="reconnecting-content">
            <div class="reconnecting-spinner">
                <div class="spinner"></div>
            </div>
            <p id="reconnect-status" class="reconnect-status" data-i18n="errors.RECONNECTING">Reconnecting...</p>
        </div>
    </div>

    <!-- Connection Lost View (Story 7-4) -->
    <div id="connection-lost-view" class="view hidden">
        <div class="connection-lost-container">
            <div class="connection-lost-icon">üì°</div>
            <h1 data-i18n="errors.CONNECTION_LOST">Connection Lost</h1>
            <p data-i18n="errors.connectionLostHint">We couldn't reconnect to the game server.</p>
            <button id="retry-connection-btn" class="btn btn-primary btn-glow" data-i18n="common.retry">Try Again</button>
            <p class="connection-lost-hint" data-i18n="errors.checkNetwork">Make sure you're connected to the network</p>
        </div>
    </div>

    <!-- QR Modal (Lobby - full screen) -->
    <div id="qr-modal" class="qr-modal hidden" role="dialog" aria-modal="true"
         aria-labelledby="qr-modal-title">
        <div class="qr-modal-backdrop"></div>
        <div class="qr-modal-content">
            <h2 id="qr-modal-title" class="sr-only" data-i18n="lobby.joinGameQr">Join Game QR Code</h2>
            <div id="qr-modal-code" class="qr-modal-code">
                <!-- Large QR code rendered here -->
            </div>
            <p class="qr-modal-label" data-i18n="lobby.scanToJoin">Scan to join the game</p>
            <button id="qr-modal-close" class="btn btn-secondary qr-modal-close"
                    aria-label="Close QR code" data-i18n="common.close">Close</button>
        </div>
    </div>

    <!-- Invite Modal (Story 16.5 - QR code during active game for admin) -->
    <div id="invite-modal" class="invite-modal hidden" role="dialog" aria-modal="true"
         aria-labelledby="invite-modal-title">
        <div class="invite-modal-backdrop"></div>
        <div class="invite-modal-content">
            <h2 id="invite-modal-title" class="invite-modal-title" data-i18n="lobby.invitePlayers">Invite Players</h2>
            <p class="invite-modal-hint" data-i18n="lobby.invitePlayersHint">Share this QR code or link with friends</p>
            <div id="invite-modal-code" class="invite-modal-code">
                <!-- QR code rendered here -->
            </div>
            <div class="invite-modal-url-container">
                <input type="text" id="invite-modal-url" class="invite-modal-url" readonly
                       aria-label="Join URL">
                <button id="invite-copy-btn" class="invite-copy-btn" type="button"
                        aria-label="Copy join link">
                    <span class="invite-copy-icon">üìã</span>
                </button>
            </div>
            <p id="invite-copy-feedback" class="invite-copy-feedback hidden">Copied!</p>
            <button id="invite-modal-close" class="btn btn-secondary invite-modal-close"
                    aria-label="Close invite popup" data-i18n="common.close">Close</button>
        </div>
    </div>

    <!-- Steal Target Modal (Story 15.3 AC2, AC5) -->
    <div id="steal-modal" class="steal-modal hidden" role="dialog" aria-modal="true"
         aria-labelledby="steal-modal-title">
        <div class="steal-modal-backdrop"></div>
        <div class="steal-modal-content">
            <h2 id="steal-modal-title" class="steal-modal-title" data-i18n="steal.selectTarget">Select a target</h2>
            <p class="steal-modal-subtitle" data-i18n="steal.selectTargetHint">Copy their answer for this round</p>
            <div id="steal-target-list" class="steal-target-list">
                <!-- Populated by JavaScript -->
            </div>
            <button id="steal-modal-close" class="btn btn-secondary steal-modal-cancel"
                    aria-label="Cancel steal" data-i18n="common.cancel">Cancel</button>
        </div>
    </div>

    <!-- Steal Confirmation Toast (Story 15.3 AC3) -->
    <div id="steal-confirmation" class="steal-confirmation hidden">
        <span class="steal-confirmation-icon">ü•∑</span>
        <span id="steal-confirmation-text" class="steal-confirmation-text"></span>
    </div>

    <!-- Generic Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirm-modal-title">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <h2 id="confirm-modal-title">Confirm</h2>
            <p id="confirm-modal-message"></p>
            <div class="modal-actions">
                <button id="confirm-modal-yes" class="btn btn-primary" data-i18n="common.confirm">Confirm</button>
                <button id="confirm-modal-no" class="btn btn-secondary" data-i18n="common.cancel">Cancel</button>
            </div>
        </div>
    </div>

    <script src="/beatify/static/js/vendor/qrcode.min.js"></script>
    <!-- Story 18.4: Use minified JS in production with fallback to source -->
    <!-- Version query strings prevent browser caching issues -->
    <script src="/beatify/static/js/i18n.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/i18n.js?v=1.7.0';document.head.appendChild(s);"></script>
    <script src="/beatify/static/js/utils.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/utils.js?v=1.7.0';document.head.appendChild(s);"></script>
    <script src="/beatify/static/js/player.min.js?v=1.7.0" onerror="var s=document.createElement('script');s.src='/beatify/static/js/player.js?v=1.7.0';document.head.appendChild(s);"></script>
</body>
</html>
